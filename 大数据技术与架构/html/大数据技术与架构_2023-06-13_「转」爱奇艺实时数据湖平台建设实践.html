<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"大数据技术与架构","title":"爱奇艺实时数据湖平台建设实践","time":"2023-06-13 17:41:00","timeStamp":"1686649260"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&mid=2247519101&idx=1&sn=b5bfcda5d539df6e227ae2e6cbd6036a&chksm=fd3ecde8ca4944fe0b984e65fbb1942dcd8762c6cd7dda389cca3a28b00c30447301cc8a23d7#rd" target="_blank">爱奇艺实时数据湖平台建设实践</a></h1><div id="meta_content" class="rich_media_meta_list"><span class="rich_media_meta rich_media_meta_text">林豪&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">大数据技术与架构&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2023-06-13 17:41:00</em></div><content><div class="reprint"><p>转自公众号：DataFunTalk<br><a href="http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247657359&idx=1&sn=9489db5cf16dbba72ce54a50706823bc" target="_blank" title="阅读原文">http://mp.weixin.qq.com/s?__biz=MzU1NTMyOTI4Mw==&mid=2247657359&idx=1&sn=9489db5cf16dbba72ce54a50706823bc</a></p></div><section mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: normal;orphans: 2;text-align: justify;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;outline: 0px;color: rgb(34, 34, 34);font-size: 14.875px;text-size-adjust: auto;letter-spacing: 0.544px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;background-color: rgb(255, 255, 255);line-height: 23.625px;visibility: visible;" data-mpa-powered-by="yiban.io"><section powered-by="xiumi.us" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section powered-by="xiumi.us" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-role="outer" label="Powered by 135editor.com" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-tools="135编辑器" data-id="98469" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" mp-original-font-size="16" mp-original-line-height="25" style="margin: 0px;padding: 0px 10px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-size: 14px;color: black;line-height: 21.875px;letter-spacing: 0px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;visibility: visible;"><blockquote data-tool="mdnice编辑器" mp-original-font-size="14.399999618530273" mp-original-line-height="23" style="margin: 20px 0px;padding: 10px 10px 10px 20px;border-left: 3px solid rgb(239, 112, 96);color: rgb(106, 115, 125);line-height: 20.125px;font-size: 12.6px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;border-top-style: none;border-right-style: none;border-bottom-style: none;overflow: auto;background-color: rgb(255, 249, 249);visibility: visible;"><p mp-original-font-size="16" mp-original-line-height="26" style="margin: 0px;padding: 8px 0px;clear: both;min-height: 1em;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-size: 14px;color: black;line-height: 22.75px;visibility: visible;"><span mp-original-font-size="14" mp-original-line-height="26" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: normal;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;color: rgb(89, 89, 89);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;letter-spacing: 0.544px;text-align: left;font-size: 12.25px;visibility: visible;line-height: 22.75px;"><strong mp-original-font-size="14" mp-original-line-height="26" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;visibility: visible;font-size: 12.25px;line-height: 22.75px;"><img class="rich_pages wxw-img" data-ratio="1" data-type="png" data-w="64" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/1_6VyhjNCMic3DGmPLZocTtEmtWBJKsQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2OP8CL6Mmrc9shxR4OiamrPMlRCKiaicf2n4JLNDRcyH1jfEKxo6VyhjNCMic3DGmPLZocTtEmtWBJKsQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1'" style="margin: 0px;padding: 0px;max-width: 100%;height: auto !important;overflow-wrap: break-word !important;vertical-align: text-bottom;outline: 0px;display: inline-block;font-size: 10.7188px;line-height: 19.9062px;box-sizing: border-box !important;visibility: visible !important;width: 20px !important;"  /><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247518343&amp;idx=1&amp;sn=eaf44bee8c4d90aedd508201475b57a9&amp;chksm=fd3ece12ca494704cdf02300bbfe39c1d4245ac30f41aba3065efe66eb9aa453a23e0b6dae6e&amp;scene=21#wechat_redirect" textvalue="300万字！全网最全大数据学‍习面试社区等你来！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-size: 14px;color: rgb(255, 41, 65);">300万字！全网最全大数据学习面试社区等你来！</span></strong></a></strong></span></p></blockquote></section></section></section></section></section></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="padding-right: 10px;padding-left: 10px;text-align: left;line-height: 1.6;letter-spacing: 0.034em;color: rgb(63, 63, 63);font-size: 16px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;"><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">导读</strong> 本文将介绍 Iceberg 在爱奇艺的落地与实践</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">主要内容包括以下几大部分：</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">爱奇艺 OLAP 简介</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">为什么要数据湖</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">数据湖平台建设</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">性能优化</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">业务落地</section></li></ol><h3 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;"><span style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4LicMl9ZuYw7sHCxV3NVXH3AhicoWEqAibAsgFA1C5JpS0dVCich5qRubbg/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;"></span><span style="display: none;"></span><span style="font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);">1. &nbsp; 爱奇艺 OLAP 简介</span><span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">首先简单介绍一下爱奇艺 OLAP 的基本情况：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/2_pHrm4vgQmaMVnOs70FKutedEPNrn5Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4vUsE8oFQpaCZnKlnficTBYUP5pHrm4vgQmaMVnOs70FKutedEPNrn5Q/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">存储方面，OLAP 目前支持三类存储：</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">离线 HDFS：用于离线分析、批处理等场景；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">实时 Kafka：用于实时分析、在线处理等场景；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">近实时 Iceberg：分钟级延迟，是今天要重点介绍的数据湖产品。</section></li></ol><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">存储之上是查询引擎，我们采用 SparkSQL 做 ETL 处理，采用 Trino 做 Ad-hoc 即席查询，ClickHouse 用于查询加速的场景。我们通过 Pilot 提供对外的统一查询，支持各类应用场景。</p><h3 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;"><span style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4LicMl9ZuYw7sHCxV3NVXH3AhicoWEqAibAsgFA1C5JpS0dVCich5qRubbg/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;"></span><span style="display: none;"></span><span style="font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);">2. &nbsp; 为什么要数据湖</span><span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">下面来介绍一下爱奇艺数据湖的建设背景。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>1. 数据湖技术加速数据流通<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/3_Un68zMENAUpo3EQm0UUaYXgiaNhAlg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4m7kX4qmibpc6VnneptjZDYrMjNUn68zMENAUpo3EQm0UUaYXgiaNhAlg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">为什么要有数据湖？数据湖其实就是为了加速数据流通。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">爱奇艺 Pingback 投递的场景：</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Pingback 是爱奇艺内部对端上埋点的习惯名称，每个公司都会有类似的服务。在经典的 Lambda 架构解决方案里，Pingback 数据在投递后，有离线和实时两个通路。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">离线通路写到 HDFS 里，然后由离线开发平台构建离线数仓。离线数仓的优点是成本很低，支持的容量也很大。缺点是延迟大，可能要 1 小时或者 1 天。为了解决这个时效性问题，往往会再构建一个实时数仓。通常用 Kafka 作为存储，用 Flink 或者 Spark 这类的流计算任务处理 Kafka 数据，构建实时数仓。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">实时数仓的延迟非常低，能做到秒级的延迟，但缺点是成本很高，只能放最近几个小时的数据，要基于 Kafka 做明细查询也是比较的困难的。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">其实很多实时分析场景并不需要秒级的延迟，分钟级的延迟就足够了。譬如说广告、会员的运营场景，或者监控大盘等。数据湖产品提供了性价比很高，容量很大的分钟级延迟的解决方案。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>2. Iceberg 定义-新型表格式<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/4_cic0AUMCZyDzichdcat56GlvNicWaw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z492lNvAz0vLJ7licsib36EbUV3POcvcic0AUMCZyDzichdcat56GlvNicWaw/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">爱奇艺的数据湖选型用的是 Iceberg，Iceberg 是一种新设计的开源表格式，用于大规模数据分析。</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Iceberg 本质上不是存储，因为它底层存储复用了 HDFS，或者对象存储。在存储之上构建了 Iceberg 表级抽象，对标 Hive 的表设计。</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">它也不是查询引擎或者流计算引擎，它支持各类计算引擎，比如 Hive、 Flink、 Spark，也支持各类的 SQL 查询引擎。</p></section></li></ol><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（1）表格式-Hive 及其缺陷</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/5_85f4wZuaDicSqmmOPrGC3NicamQTkQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4Tz8HpuEc8cVHzB24Mq0yYbH68185f4wZuaDicSqmmOPrGC3NicamQTkQ/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">为什么有了 Hive 表格式还要引入 Iceberg 表格式？</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">一个经典的 Hive 表可能会有天级分区、小时级分区，或者进一步的子分区。其设计核心是用目录树去组织数据，能够很好地做分区级过滤。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">但是它也有着以下缺点：</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">元数据统一存在 Metastore，通常底下是 MySQL，很容易成为瓶颈。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">由于元信息是分区级别的，没有文件级别的信息，因而当发起一个查询时，制定执行计划需要拿到分区下的文件列表。拿到文件列表本质上是对每一个分区请求 NameNode 做 List 请求。举个例子，一天有 200 多个分区，查 7 天的数据，分区数就会非常多，会发起 O(N) 复杂度的 NameNode 的 List 请求调用，这个元数据的枚举过程会非常的慢。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">由于它的最小单位是分区级别的，最大的原子操作就是分区级别的覆盖，其他一些原子操作是不支持的。</section></li></ol><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（2）表格式-Iceberg</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/6_j9WfUB7mpaVcAZQXJbtSOPOhqOSibg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4boOsVhicd5RdGDVn8b5uXlk8Lpj9WfUB7mpaVcAZQXJbtSOPOhqOSibg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Iceberg 新定义的表结构有元数据层和数据层。数据层就是数据文件。元数据层是它很重要的设计点，可以复用 Hive 的 MetaStore，指向最新的快照。元数据里面分多层，记录了具体的文件列表。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">每次有新的 Commit，就会创建出新的快照，读请求可以访问旧的快照，写请求写新的。在写的过程中，新创建的数据文件读是不可见的，只有在提交后把最新的版本指过去，新写入的文件才可见。做到了读写分离。同时修改操作是原子的，能够支持细粒度的分区内部的修改。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（3）表格式-Hive VS Iceberg</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/7_ua1GqjRsweia08diaaRJ4hfelScFEw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4F978seA5jPJ6DtICuLmiciaNBZcVua1GqjRsweia08diaaRJ4hfelScFEw/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">简单比较一下 Hive 和 Iceberg：两者底层都采用 HDFS 或者对象存储，都是 PB 级的廉价存储方案。区别 Hive 元信息是分区级，Iceberg 是文件级。比如 Hive 分区原本有 100 个文件，加了 5 个文件，那么 Hive 下游任务就需要重新计算 Hive 分区下的全部数据。Iceberg 能够获取到修改的 5 个文件，可以做增量的下游计算。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">时效性是 Iceberg 很明显的优势，能够做到近实时，比如 5 分钟级，如果每分钟提交一次则可以做到分钟级。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">制定执行计划时，Iceberg 是常数级的，它只读取固定的元数据文件就能够拿到文件列表。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Iceberg 还支持文件级别的过滤，比如基于统计信息或者字典做过滤。</p><h3 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;"><span style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4LicMl9ZuYw7sHCxV3NVXH3AhicoWEqAibAsgFA1C5JpS0dVCich5qRubbg/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;"></span><span style="display: none;"></span><span style="font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);">3. &nbsp; 数据湖平台建设</span><span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">为了方便用户使用，爱奇艺在引入数据湖以后，首先要做平台化建设。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>1. 平台总览<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">这是爱奇艺数据湖整体的产品架构图：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/8_2ZPdlHw5DnZ0cEBTkQyeRpjhV4moCg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4T2OodwcGSQMVmAWy0mNgpjIB2ZPdlHw5DnZ0cEBTkQyeRpjhV4moCg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">最底下是数据源，比如前面提到的 Pingback、用户 MySQL 的 Binlog 解析、日志和监控信息，会分别进到实时、离线和 Iceberg 通道。在 Iceberg 之上，通过 RCP 平台、Babel 平台分别做流式入湖和离线入湖。使用 Trino 和 Spark SQL 去做查询。同时我们开发了数据湖平台去完成元数据管理、权限管理等等。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>2. 流式入湖<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/9_SHia9IMsiclmibRUf18ZZG9pZZugQA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4gU2WH1dcnibU2pJTLqpmAun9rTvjSHia9IMsiclmibRUf18ZZG9pZZugQA/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">爱奇艺通过实时计算平台，能够做到很简单的入湖。一个 Kafka 的数据只需要三步，就可以完成配置流任务：首先配置从哪个 Kafka 开始读；然后在里面做 Transform 逻辑，比如筛选、重命名，最后定义写到哪个 Iceberg。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>3. 出湖查询<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/10_ch2kpU0R8YwSZxiap5n26wf6fI1NMg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z42icDpAj1ACib04ahmuAkwQBJjIQich2kpU0R8YwSZxiap5n26wf6fI1NMg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">入湖的下一步是查询，也就是出湖。目前 Iceberg 有两类文件格式，V1 格式支持 Append Only 数据，不支持行级修改。Iceberg 发布的最新版本 V2 格式能支持行级更新。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">目前 V1 格式是通过 Trino 引擎查询，V2 格式通过 SparkSQL 查询。前端是通过 Pilot，我们的自研 SQL 引擎做分发，能够基于文件格式自动地选择引擎，支持各类用户场景。</p><h3 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;"><span style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4LicMl9ZuYw7sHCxV3NVXH3AhicoWEqAibAsgFA1C5JpS0dVCich5qRubbg/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;"></span><span style="display: none;"></span><span style="font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);">4. &nbsp; 性能优化</span><span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">下面介绍一些性能优化的工作。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>1. 小文件<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/11_aA5SK8uySy98ZGwyFZdgdjO0peOwXw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4pj0BmVuQ3uF4vwt0ukjseic0ciaA5SK8uySy98ZGwyFZdgdjO0peOwXw/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">说到数据湖，无论哪个产品都绕不开的一个问题就是小文件问题。Hive 可以批量，比如每小时做一次计算，可以写出很大的文件。在 Iceberg 中，由于需要做到近实时，每分钟或者每 5 分钟写文件，文件就比较小，必然会有小文件问题。我们主要通过两个方面去解决小文件问题:</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（1）生命周期</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">根据表的生命周期做处理。比如一张表可能只需要保留一年，或者保留 30 天，历史的数据可以删除。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">目前平台会限制用户建表必须配置生命周期，通过数据湖平台自动地完成清理逻辑。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">清理用的是 Iceberg 官方提供的解决方案，Spark 的 Procedure，先是 Drop 分区，然后 Expire 历史的 Snapshot，再删除孤儿文件，最后重写元数据文件。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">这套流程直接跑，有些环节是存在性能问题的，并不能够满足清理的效率：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">第一：Spark 的使用模式，每次跑任务都需要提交一个 Spark 任务，需要先申请Yarn 资源，再启动 Application，跑完这个任务后这个 Application 就释放掉了。这里可以采用 Spark 的常驻模式，生命周期清理 SQL 可以跑得很快， 资源是不释放的，避免了申请和启动的耗时。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">第二：天级的目录删除，Iceberg 官方的实现是比较慢的。它用的是孤儿文件删除的策略，在文件数比较多的时候，扫描过程比较慢。我们做了改进，因为明确知道整个天级目录都不需要，可以直接删除整个目录。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">第三：我们添加了回收站的机制，生命周期误删除时能有恢复的手段。</section></li></ul><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">做了这些优化以后，线上大概几千个表，都能够按时完成生命周期的清理。比如 Venus 库原先可能有 2 亿个 iNode，清理完以后稳定在 4000 万的数量级。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（2）智能合并</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/12_a4gY9Han6GIlV0cz7BZar5mT8WnIrg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4vRcbSqHNb5XDq0eFp3jDiaySya4gY9Han6GIlV0cz7BZar5mT8WnIrg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">另外一个处理小文件问题的方式就是合并。最简单的就是配置一个定时合并。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">人工配置定时合并比较大的问题是：定时策略比较难配置。比如，什么时机应该做合并，这次合并应该要合并什么范围的数据，如果让业务去配这些信息，每一个 Iceberg 用户就需要非常深入地去理解小文件产生的机理才能够比较好地控制合并的范围。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">为了解决这个问题，我们参考了 Netflix 的文章，做了智能合并，它的核心思想是：</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">不再由用户指定合并行为，而是统计 Iceberg 表每个分区下面的文件数，计算均方差，再结合表的权重因子，算出来哪些表合并以后效果是最好的，添加到待合并的分区列表里面。然后由合并任务按照优先级完成合并过程，用户无需做配置。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（3）合并性能优化</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/13_gJGnl51icPiaLLVCU4F8Qq8rAkvNoQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4icbdedSES4VBZT3kD6cXicYQgAM8gJGnl51icPiaLLVCU4F8Qq8rAkvNoQ/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">有了智能合并以后，还要解决合并的性能优化问题，我们也一直跟随社区的发展。在使用过程中，最初 Iceberg 在文件合并这块做得还不是很好。最早的时候，有个问题，Delete File 在合并以后并没有被真正地删除，目前已经修复。举个例子，如果 Delete 以后马上有个 Rewrite Data File，那么相应的 Delete File 是不会被删除的。这个问题目前有一些解决方案，但最标准的解决方案，社区还在跟进当中。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">还有一些大表合并任务经常失败。这里我们可以配置 Bucket 分区，将全表合并改为每次合并其中一个 Bucket 分区，减少单次合并的数据量。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">还可以应用 Binpack 合并策略去控制合并选择的逻辑。应用 Bucket 分区和 Binpack合并策略以后，如右上示意图体现的是文件数的变化，可以判断这个文件数一直在增长，这个小的下降是小时级分区合并，到一定时间做全表合并，它的文件数据减少得比较多，存在周期性的震荡。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">还有一个例子，我们发现在做合并的时候经常会和写入任务冲突，会报一个错误，要合并的这个文件有一个 Position Delete 在引用，其实是一个误判，因为在社区的默认的参数里面，去判断这个 Data File 有没有被新的 Delete File 引用的时候，有Upper bound 和 Lower bound，但这两个 Bound 被截取了，这个 Data File 其实没有被引用，但截取以后它就在这个区间里面了，解决方法修改表属性控制相应行为。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（4）写入参数控制</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/14_2iazcRotpPeBLPXW2GsHvAjMkz6m6g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z42K6QRlq6LhecU2HhMReEjhKIG2iazcRotpPeBLPXW2GsHvAjMkz6m6g/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">前文介绍了当小文件已经产生的时候如何优化，但我们更希望小文件最好不要产生，在写入的时候就把文件数控制住。我们需要去了解 Flink 任务写入的时候是怎么控制文件数量的。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">左上角示意图中这个 Flink 任务有 100 个并行度，在默认参数 Distribution-mode = None 时每一个并行度都会往分区下写文件，就会写入 100 个文件，一分钟写 100 个文件每个数据文件都很小。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果配置 Distribution-mode = Hash，如左下角的图中，在写入的时候会先做 Shuffle，基于 Partition Key Shuffle 到特定的 Sink，这个 Flink 任务会把数据都集中到一个 Sink，写到一个文件，就解决了小文件问题。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">但又会引入新的问题，数据量比较大的时候，单个任务写文件的效率跟不上，就会造成 Flink 任务反压。这个时候我们用哈希策略结合 Bucket 分区。比如，可以控制 1 个 Hour 下面 10 个 Bucket，通过两者结合起来就可以很精确地去控制 1 个分区到底要生产多少个文件。一般建议写入文件大概在 100 MB 左右是比较合适的。上图的表格中列出了各个参数配置下的文件数量。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>2. 查询优化<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/15_3bB6JpxLBWwpicjWAShKrWcjYIFYmw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4Thag75zCQdscpNxQwZXomkwWk3bB6JpxLBWwpicjWAShKrWcjYIFYmw/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">解决了小文件问题，接下来是查询的性能问题。在最初做 Iceberg 性能验证的时候，我们发现它的批量 Scan 性能是非常好的，但是点查询的性能就比较糟糕。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（1）ID 查询慢</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">举个例子，在订单表中，用特定 ID，如订单 ID 或者用户 ID 去查询明细，简化后的SQL 就是 order_id = ‘555’。默认的情况下，Iceberg 会基于 MinMax 做过滤，但数据按照时间戳排序，MinMax 过滤其实是不生效的，比如 File A 的 MinMax 范围包含 555，File N MinMax 321 到 987 也包含 555，其实是过滤不掉的。因而点查询事实上就是全表扫描。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">针对点查询场景，BloomFilter 是非常适用的。最初社区没有这个功能，Parquet 在 1.12 的时候支持 BloomFilter，Iceberg 的默认存储格式也是 Parquet，所以我们考虑修改 Iceberg 引入这一功能。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（2）开启 BloomFilter</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/16_29pqdictrKTzyJtq2vHbWS5VTR8j8Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4oiaMPKy0bfGqD2FjmzibWiaAMm0929pqdictrKTzyJtq2vHbWS5VTR8j8Q/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">先介绍一下 BloomFilter 的作用，在这个架构图中，比如，针对 order_id 开启了 BloomFilter，为每一个数据文件构建 BloomFilter，将 order_id 进行哈希后映射到对应 bit，如果值存在就把对应的位设为 1，如果不存在对应的位默认是 0。在 Bloom Filter 里面，如果标志位为 1，这个值不一定存在，但如果标志位为 0，这个值一定不存在。通过努力，我们在 Iceberg 的内核里面添加了相应的支持。在 Spark 读取 &nbsp;Iceberg 和 Trino 读取的时候也添加了相应的能力。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">BloomFilter 支持 Equals 和 In 过滤。如果标志位为 0 是一定能过滤的。不支持 not equals、not in、比较符等过滤条件。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">示意图中 order_id = 555 这个条件，哈希后另外两个文件对应的标志位值都是 0，在查询的时候就可以很快地把其他文件过滤掉了，能够精确命中订单所在的数据文件。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（3）BloomFilter 效果</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/17_EzSN3UZ2n01ian2jhdYYcDqgASygEg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4hagg5IaHOiaoiasxoHnJddLMibicXEzSN3UZ2n01ian2jhdYYcDqgASygEg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">经过测试，在 Spark SQL 中的订单 ID 查询，原来全表扫描需要将近 1000 秒，开启 BloomFilter 后只需要 10 秒钟。Trino 开启 BF 后，可以过滤 98.5% 的查询，CPU 消耗只有以前的 5%。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">BloomFilter 会带来额外的空间开销。经过简单的测试，大概有 3% 的额外空间损耗。即 3% 的存储代价可以带来点查询 100 倍的提升。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（4）Alluxio 缓存</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/18_Y7tytVI3gwicALA7V6SuFSJgef2sIg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4eEdmH1ttNn8hibibbpml1oibLq4OY7tytVI3gwicALA7V6SuFSJgef2sIg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">查询优化另外一个工作是缓存加速，如使用 Alluxio 做缓存加速。这是爱奇艺 Trino 查数据湖的架构图。业务通过 Pilot 引擎分发到 Trino 网关，自动地选择使用哪个 Trino 集群执行查询。原本 Trino Worker 上面的 SSD 存储是浪费的，我们在之上混布了 Alluxio，复用了原本闲置的 SSD 存储，几乎没有什么额外机器开销。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">以前去查 HDFS 可能会有性能抖动，比如，业务有一个大的批任务，导致 HDFS 性抖动，查询性能会降得很厉害，Alluxio 缓存能够很好地屏蔽这一点。经过测试 Venus 日志应用 Alluxio 以后，P90 从 18 秒可以降低到 1 秒。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">（5）Trino 元数据读取问题</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/19_zicupjco4BhWSVpKuLMDaOJMQJHU2Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4Sp3LYT7QqRebK93icNo3m8thXEzicupjco4BhWSVpKuLMDaOJMQJHU2Q/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在实际的使用过程中发现 Trino 查询有个意想不到的问题，元数据读取性能远比我们想象中的要慢。比如，读取一个 5 M 的元数据竟然要 3 秒钟，后面查数据可能只需要 1 秒，元数据反而更慢。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">通过火焰图和阿里的 Arthas 做定位，发现 Read 的方法被调用了百万次，文件总共 5 M，读取 100 多万次是非常不合理的。进一步跟踪，定位原因是父类里面一个 Read 方法的默认实现会逐个 Byte 读取，Trino 这边没有覆盖这个方法的实现，就会降级到默认方法，每次读 1 个 Byte ，所以调用次数非常多，导致很慢，优化以后耗时缩短到了 0.5 秒。</p><h3 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;"><span style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4LicMl9ZuYw7sHCxV3NVXH3AhicoWEqAibAsgFA1C5JpS0dVCich5qRubbg/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;"></span><span style="display: none;"></span><span style="font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);">5. &nbsp; 业务落地</span><span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">最后来介绍业务落地的情况，在应用了上述优化后，业务能取得什么样的效果。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>1. 广告流批一体<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/20_TDibu1ga14ibQaWKFu7c6ib4U1nvMA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4UP94GWdAFJTIGqWWnq8ymFTePXnTDibu1ga14ibQaWKFu7c6ib4U1nvMA/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">第一个例子是广告的流批一体场景。原来的实时链路中，实时数据通过 Kafka 写到 &nbsp;Kudu，离线数据同步到 Hive，通过 Impala 来统一查询，基于离线覆盖的进度将查询分发到 Kudu 和 Hive。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">使用 Iceberg 以后，实时和离线数据都更新 Iceberg，不需要进度管理，直接查询 Iceberg 表即可。Iceberg 实现了两方面的统一，一是存储统一，不需要有两个类型的存储，查询不需要做拆分。二是任务开发统一为 SQL，原先离线是 HiveSQL，实时是 Spark Jar 包，统一为 SQL 开发。数据入湖后结合分布式改造，广告智能出价全链路由 35 分钟缩短到 7-10 分钟。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>2. Venus 日志入湖<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/21_cM0icqLgn6GFxvicsqZsGlWfyWw8xA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4MPPdrBgwfewkrYo2LwGo37ffBOcM0icqLgn6GFxvicsqZsGlWfyWw8xA/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Venus 是爱奇艺内部的日志分析平台。之前的架构中 Kafka 数据往 ElasticSearch 里面存储，如果业务流量较大就给它一个独立集群，小流量业务则用公共集群。这个方案存在一些问题：一是流量调度很难做，当集群流量有瓶颈时，需要把流量拆分走；二是 ES 的存储成本非常高。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">存储改用 Iceberg 方案后，所有业务的流量都写到一个 Iceberg 集群，不需要拆分流量。Venus 接入层通过日志查询平台，数据存储的切换对用户是透明的。Iceberg 带来的好处包括：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">成本显著下降。不需要独立的 ES 集群了，Iceberg 和 Trino 都复用现有的资源，并没有什么额外的成本。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">稳定性大幅提升。因为 ES 的成本太贵，没有配副本，一旦单个磁盘或节点有问题，都会引发用户的报障。用 Iceberg 以后，写入带宽非常大而且稳定性很好，报障减少了 80% 以上。</section></li></ul><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>3. 审核场景<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/22_AFzCsnkc9oKic3O3RxozQCXk3pu0Wg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4RbcGdrDXnp9uuUMcYHSgWpujTAFzCsnkc9oKic3O3RxozQCXk3pu0Wg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">接下来是爱奇艺内部的审核场景，审核场景需要对一些历史的行记录做修改。没有 Iceberg 以前，没有很好的技术方案支持行级更新。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">原来解决方案里用 MongoDB 存全量的数据，做行级的更新，然后用 ES 构建二级索引，改用 Iceberg 以后两个存储都统一到 Iceberg 里面。对业务带来的好处是：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">原本的监控告警要定期查 ES 做聚合，用 MySQL 开发报表，现在不需要了，报表直接查 Iceberg 就可以，能够支持实时告警。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">数据湖大幅提高业务的效率。原本分析任务开发非常复杂，要从 Mongo 里面导数非常不方便。有了数据湖以后可以统一为 SQL 查询。</section></li></ul><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>4. CDC 订单入湖<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/23_3kGl3YFk2lw3jsYGS8Vt0eCuIjXf6g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4UEfGUbx1ROIWLh1pUicJNKuc63kGl3YFk2lw3jsYGS8Vt0eCuIjXf6g/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">最后是 CDC 类数据入湖，此处以订单为例。基于 MySQL 数据做大数据分析，有两类解决方案：第一类是每天导出一份到 Hive，缺点是每次导出都是全量，延迟很大，只能看一天以前的数据。另外全量导的性能也很差，对 MySQL 压力也比较大。第二类是实时解决方案，增量变更写在 Kudu 里面，Kudu 是一个成本很高的解决方案。如果 Kudu 写入带宽波动，同步任务负责人需要去做运维操作。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">使用数据湖方案，爱奇艺实时计算平台，通过 Flink CDC 技术很方便地可以将 MySQL 数据入湖。数据湖方案具备如下优势，一是近实时，数据延迟在分钟级，远优于之前的离线方案；二是成本低，相比于 Kudu 无需独立节点，大幅降低机器成本；三是省运维，Iceberg 写入带宽大且稳定，大幅降低运维代价。</p><h3 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;"><span style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z4LicMl9ZuYw7sHCxV3NVXH3AhicoWEqAibAsgFA1C5JpS0dVCich5qRubbg/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;"></span><span style="display: none;"></span><span style="font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);">6. &nbsp; 未来规划</span><span style="display: none;"></span></h3><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img data-ratio="0.562962962962963" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/24_8X9ZAndmtmx3cHrSe44YcT3O5wQibw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MbogibzyQYZp0gKJbV2v4z468rPR2JicmzRiaXYZQCdbNolW0N8X9ZAndmtmx3cHrSe44YcT3O5wQibw/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">最后介绍一下未来规划。爱奇艺未来会在流批一体里面有更多的落地，包括广告的全面推广、Pingback 在 BI 场景的落地。另外，我们计划把数据湖落地在特征生产，可以由以前离线或者批的特征生产，变成近实时，能够支持晚到数据，支持样本的行级的修正。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在技术方面会尝试把 Iceberg 的 Puffin 统计信息用于查询加速的场景。还会对社区在做的 Branch 和 Tag 进行调研，寻找内部的落地场景。</p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="margin: 0px;padding: 0px 10px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;line-height: 1.6;letter-spacing: 0.034em;color: rgb(63, 63, 63);font-size: 16px;"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0.476px;text-indent: 0px;text-transform: none;white-space: normal;word-spacing: 0px;text-size-adjust: auto;-webkit-text-stroke: 0px rgb(178, 178, 178);font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.25px;font-family: &quot;Helvetica Neue&quot;;text-align: center;color: rgb(178, 178, 178);background-color: rgb(255, 255, 255);line-height: 21.4375px;visibility: visible;"><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0.476px;text-indent: 0px;text-transform: none;white-space: normal;word-spacing: 0px;text-size-adjust: auto;-webkit-text-stroke: 0px rgb(178, 178, 178);font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.25px;font-family: &quot;Helvetica Neue&quot;;text-align: center;color: rgb(178, 178, 178);background-color: rgb(255, 255, 255);line-height: 21.4375px;visibility: visible;"><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;color: rgb(74, 74, 74);font-size: 15px;">如果这个文章对你有帮助，不要忘记&nbsp;</span><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;outline: 0px;font-size: 15px;color: rgb(255, 104, 39);"><strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「在看」</strong>&nbsp;<strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「点赞」</strong>&nbsp;<strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「收藏」</strong></span><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;color: rgb(74, 74, 74);font-size: 15px;">&nbsp;三连啊喂！</span><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="1.215625" data-s="300,640" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/25_jNJdvwuULcOtMEU3DFFESPHpbU8Hdg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PDwSDUx452DKyaUxtxDoz47He3aCnMeSE9wLtZJwcdOFU6jNJdvwuULcOtMEU3DFFESPHpbU8Hdg/640?wx_fmt=png'" data-type="png" data-w="640" style="width: 241px;height: 293px;"  /></p><p style="margin: 0px 0px 0em;padding: 0px;clear: both;min-height: 1em;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;text-align: center;"><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;background-color: rgb(255, 255, 255);color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;"></span></p></section></section><section style="margin: 0px;padding: 0px;max-width: 100%;color: rgb(51, 51, 51);font-family: mp-quote, -apple-system-font, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: normal;orphans: 2;text-align: justify;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.10979228486646884" src="图片/大数据技术与架构_2023-06-13_「转」爱奇艺实时数据湖平台建设实践/26_zrkyKUN5kNeUFicVC3bMP1GEqKz1OQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/BSBqCXrZtzAicMToibKuIysLrB62M5A5YaLhZg6z86tI7ZeEZqTLLYyNrmlzrkyKUN5kNeUFicVC3bMP1GEqKz1OQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1011" style="margin: 0px;padding: 0px;max-width: 100%;height: 42px;overflow-wrap: break-word !important;vertical-align: bottom;color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);box-sizing: border-box;width: 384px;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247510040&amp;idx=1&amp;sn=aa335f25965975731173916f012d56f4&amp;chksm=fd3eee8dca49679b82f632048fb64d21fac01497d1a0fe33917edb01e194caf0f9a1930a55ce&amp;scene=21#wechat_redirect" textvalue="2022年全网首发|大数据专家级技能模型与学习指南(胜天半子篇)" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">2022年全网首发|大数据专家级技能模型与学习指南(胜天半子篇)</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247508317&amp;idx=1&amp;sn=0bcb7fb6997b42306994b890eaa0d47f&amp;chksm=fd3ee7c8ca496ede347a2971002c6ea68dcfd70abeeb90b43c8b02a2a60ebc7cec3a87ef7d52&amp;scene=21#wechat_redirect" textvalue="互联网最坏的时代可能真的来了" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">互联网最坏的时代可能真的来了</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247507860&amp;idx=1&amp;sn=807ac5003762f29c127bc4071dcebe33&amp;chksm=fd3e9901ca4910178cfc816043ea86c29f881f70cd943d252de9ae2e21cb7e8ba80bff162e1b&amp;scene=21#wechat_redirect" textvalue="我在B站读大学，大数据专业" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">我在B站读大学，大数据专业</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247499604&amp;idx=1&amp;sn=d938dfb30d221774704982d2938b30c1&amp;chksm=fd3eb9c1ca4930d76a391241333de461ca22d2aa27472eab3cffab1564872ae37f1b48fe2d3c&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我们在学习Flink的时候，到底在学习什么？</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504856&amp;idx=2&amp;sn=6f62e2a0c756ce56773eed253d2f41ee&amp;chksm=fd3e954dca491c5b732b7e2aa46db32efbc3f690e528522098659bb3c6e78e1582ab4529b5dc&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">193篇文章暴揍Flink，这个合集你需要关注一下</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504742&amp;idx=1&amp;sn=8765c198d8ad66219a7bcabb221e4a23&amp;chksm=fd3e95f3ca491ce52d0724b9e4154a47af0f5ea349e1e184c8fbc65aa17c0000242aa9b58429&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">Flink生产环境TOP难题与优化，阿里巴巴藏经阁YYDS</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504813&amp;idx=1&amp;sn=f5cd6ae2aa2b1e30f87a5ae55971c514&amp;chksm=fd3e9538ca491c2eb191677d070f2c7e4f1098eece00e256d6205b8a5d21b21c1e74f875f16f&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">Flink CDC我吃定了耶稣也留不住他！| Flink CDC线上问题小盘点</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=1&amp;sn=1f693e549f76622725b936041ff8896e&amp;chksm=e9bff2fbdec87bedecbdeed4547d7d612c72fc8d4918614a26a4e31666cf0128fd57b537f347&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我们在学习Spark的时候，到底在学习什么？</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504834&amp;idx=1&amp;sn=46ca1a3924b8fdb89ac1c2acb0319d6c&amp;chksm=fd3e9557ca491c41d837b917639ea62007ea16d3c2cc6c0c02d1f8a8c6e44318f5183b787c46&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">在所有Spark模块中，我愿称SparkSQL为最强！</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247502750&amp;idx=1&amp;sn=bd9a9173d060dc4e4ebd49c8efc6acfe&amp;chksm=fd3e8d0bca49041dea84da93910e5efdc4935e520525c09887c986691377aeb48e5cf7fb5667&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">硬刚Hive | 4万字基础调优面试小总结</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504382&amp;idx=2&amp;sn=550b78802acfe727e0e77cd9195f8784&amp;chksm=fd3e976bca491e7db2b8b2446d231736df01bbf13653804d680ac4390597ec17fa466ad4ae83&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">数据治理方法论和实践小百科全书</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503741&amp;idx=1&amp;sn=e5039be93123f2e337013756a818bfc3&amp;chksm=fd3e89e8ca4900fe603b63c5722a6fb8a32bd63d6ba23e0028851948a71b877eb1f742d95087&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">标签体系下的用户画像建设小指南</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503675&amp;idx=1&amp;sn=3ee6af64d0126c78b48cad219308f81e&amp;chksm=fd3e89aeca4900b8b8954e9569ee3c0877881fac8c792bfafc22e7e9d3e8524da8eb860d33d8&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">4万字长文 | ClickHouse基础&amp;实践&amp;调优全视角解析</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=2&amp;sn=57ecc77718f1b6f2f262d62e8318dcc9&amp;chksm=e9bff2fbdec87bedb1986765bfae7dbabb9aece45b0b2af147bbad1ac5d79ebc934c64df40ea&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">【面试&amp;个人成长】2021年过半，社招和校招的经验之谈</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504478&amp;idx=1&amp;sn=14efef3868ba42bd044f9618745a7fdc&amp;chksm=fd3e94cbca491dddb961b7b8b93105b2869c5bcf4c03f9f0dc83ad62be0dce4c124b52ed0ba3&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">大数据方向另一个十年开启 |《硬刚系列》第一版完结</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504410&amp;idx=1&amp;sn=7e81ab5a324395eb0f12397c40247ca1&amp;chksm=fd3e948fca491d9946456acbd93b2d651ae4d7a7d0127a211981e08f50f377e60d1b7c0d7b3a&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我写过的关于成长/面试/职场进阶的文章</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504783&amp;idx=1&amp;sn=72aed147a459368ed934a007a2df3bc9&amp;chksm=fd3e951aca491c0cade212390011eca7d8a68951fee6aa2844b8f4d14bcbd5b3ed26305d69dc&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">当我们在学习Hive的时候在学习什么？「硬刚Hive续集」</a></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p></content>
</div>
</body>
</html>