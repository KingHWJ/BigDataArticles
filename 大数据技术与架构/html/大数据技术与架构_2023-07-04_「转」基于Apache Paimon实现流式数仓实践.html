<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"大数据技术与架构","title":"基于Apache Paimon实现流式数仓实践","time":"2023-07-04 17:45:04","timeStamp":"1688463904"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&mid=2247519390&idx=1&sn=5a596cb17b0010602278188d150f2796&chksm=fd3eca0bca49431de0dd7f9cdb02a8eab5a5bf9068f793b36e32bdc1f012d2b202ba6fb27bb2#rd" target="_blank">基于Apache Paimon实现流式数仓实践</a></h1><div id="meta_content" class="rich_media_meta_list"><span class="rich_media_meta rich_media_meta_text">王新&amp;周文轩&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">大数据技术与架构&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2023-07-04 17:45:04</em></div><content><div class="reprint"><p>转自公众号：Apache Paimon<br><a href="http://mp.weixin.qq.com/s?__biz=MzkyNjQ1MDI3Mg==&mid=2247483906&idx=1&sn=499a621fbbf3cdcd2574cb9a51d55706" target="_blank" title="阅读原文">http://mp.weixin.qq.com/s?__biz=MzkyNjQ1MDI3Mg==&mid=2247483906&idx=1&sn=499a621fbbf3cdcd2574cb9a51d55706</a></p></div><section mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: normal;orphans: 2;text-align: justify;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;outline: 0px;color: rgb(34, 34, 34);font-size: 14.875px;text-size-adjust: auto;letter-spacing: 0.544px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;background-color: rgb(255, 255, 255);line-height: 23.625px;visibility: visible;" data-mpa-powered-by="yiban.io"><section powered-by="xiumi.us" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section powered-by="xiumi.us" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-role="outer" label="Powered by 135editor.com" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-tools="135编辑器" data-id="98469" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" mp-original-font-size="16" mp-original-line-height="25" style="margin: 0px;padding: 0px 10px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-size: 14px;color: black;line-height: 21.875px;letter-spacing: 0px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;visibility: visible;"><blockquote data-tool="mdnice编辑器" mp-original-font-size="14.399999618530273" mp-original-line-height="23" style="margin: 20px 0px;padding: 10px 10px 10px 20px;border-left: 3px solid rgb(239, 112, 96);color: rgb(106, 115, 125);line-height: 20.125px;font-size: 12.6px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;border-top-style: none;border-right-style: none;border-bottom-style: none;overflow: auto;background-color: rgb(255, 249, 249);visibility: visible;"><p mp-original-font-size="16" mp-original-line-height="26" style="margin: 0px;padding: 8px 0px;clear: both;min-height: 1em;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-size: 14px;color: black;line-height: 22.75px;visibility: visible;"><span mp-original-font-size="14" mp-original-line-height="26" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: normal;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;color: rgb(89, 89, 89);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;letter-spacing: 0.544px;text-align: left;font-size: 12.25px;visibility: visible;line-height: 22.75px;"><strong mp-original-font-size="14" mp-original-line-height="26" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;visibility: visible;font-size: 12.25px;line-height: 22.75px;"><img class="rich_pages wxw-img" data-ratio="1" data-type="png" data-w="64" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/1_6VyhjNCMic3DGmPLZocTtEmtWBJKsQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2OP8CL6Mmrc9shxR4OiamrPMlRCKiaicf2n4JLNDRcyH1jfEKxo6VyhjNCMic3DGmPLZocTtEmtWBJKsQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1'" style="margin: 0px;padding: 0px;max-width: 100%;height: auto !important;overflow-wrap: break-word !important;vertical-align: text-bottom;outline: 0px;display: inline-block;font-size: 10.7188px;line-height: 19.9062px;box-sizing: border-box !important;visibility: visible !important;width: 20px !important;"  /><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247518343&amp;idx=1&amp;sn=eaf44bee8c4d90aedd508201475b57a9&amp;chksm=fd3ece12ca494704cdf02300bbfe39c1d4245ac30f41aba3065efe66eb9aa453a23e0b6dae6e&amp;scene=21#wechat_redirect" textvalue="300万字！全网最全大数据学‍习面试社区等你来！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-size: 14px;color: rgb(255, 41, 65);">300万字！全网最全大数据学习面试社区等你来！</span></strong></a></strong></span></p></blockquote></section></section></section></section></section></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" mp-original-font-size="16" mp-original-line-height="25.14285659790039" style="margin: 0px 0px 24px;padding: 0px 10px;max-width: 100%;overflow-wrap: break-word;box-sizing: border-box !important;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0px;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;outline: 0px;text-size-adjust: auto;font-size: 14px;color: black;line-height: 22px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;visibility: visible;"><span style="color: rgba(0, 0, 0, 0.9);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: var(--articleFontsize);letter-spacing: 0.034em;"></span><br  /></section><section style="font-size: 16px;"><section style="will-change: transform;" powered-by="xiumi.us"><section style="margin: 15px 0% 20px;display: flex;flex-flow: row nowrap;text-align: center;justify-content: center;"><section style="display: inline-block;width: auto;vertical-align: top;border-style: solid;border-width: 0px 2px;border-color: rgb(0, 0, 0);padding-right: 10px;padding-left: 10px;align-self: flex-start;flex: 0 0 auto;min-width: 10%;height: auto;z-index: auto;"><section style="margin: -6px 0% 8px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section><section style="font-size: 17px;color: rgb(0, 0, 0);line-height: 1.8;letter-spacing: 0px;text-align: justify;" powered-by="xiumi.us"><p style="text-wrap: wrap;"><strong>摘要</strong></p></section><section style="margin: 8px 0% -6px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section></section></section></section></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">本文主要介绍作为供应链物流服务商海程邦达在数字化转型过程中采用 Paimon 实现流式数仓的落地方案。我们提供一个适用于 k8s 环境并且易于上手的生产操作手册，旨在帮助读者快速掌握 Paimon 的使用方法。</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">公司业务情况介绍</span></p></li><li><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">大数据技术痛点以及选型</span></p></li><li><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;">生产实践</span></p></li><li><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;">问题排查分析</span></p></li><li><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;">未来规划</span></p></li></ul><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><o:p></o:p><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.034em;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><section style="font-size: 16px;"><section style="text-align: center;justify-content: center;margin: 10px 0% -35px;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><section style="display: inline-block;width: auto;vertical-align: top;min-width: 10%;flex: 0 0 auto;height: auto;padding: 17px 10px;align-self: flex-start;"><section style="justify-content: center;transform: translate3d(-1px, 0px, 0px);display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><section style="display: inline-block;width: 100%;vertical-align: top;box-shadow: rgb(0, 0, 0) 0px 0px 0px;align-self: flex-start;flex: 0 0 auto;"><section style="transform: translate3d(1px, 0px, 0px);" powered-by="xiumi.us"><section style="color: rgb(0, 0, 0);font-size: 26px;line-height: 1;letter-spacing: 0px;padding-right: 10px;padding-left: 10px;"><p><span style="background-color: rgba(255, 255, 255, 0);"><strong>01</strong></span></p></section></section></section></section></section></section><section style="margin: 15px 0% 20px;display: flex;flex-flow: row nowrap;text-align: center;justify-content: center;" powered-by="xiumi.us"><section style="display: inline-block;width: auto;vertical-align: top;border-style: solid;border-width: 0px 2px;border-color: rgb(0, 0, 0);padding-right: 10px;padding-left: 10px;align-self: flex-start;flex: 0 0 auto;min-width: 10%;height: auto;z-index: auto;"><section style="margin: -6px 0% 8px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section><section style="font-size: 17px;color: rgb(0, 0, 0);line-height: 1.8;letter-spacing: 0px;text-align: justify;" powered-by="xiumi.us"><p style="text-wrap: wrap;"><strong>公司业务情况介绍</strong></p></section><section style="margin: 8px 0% -6px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section></section></section></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">海程邦达集团一直专注于供应链物流领域，通过打造优秀的国际化物流平台，为客户提供端到端一站式智慧型供应链物流服务。集团现有员工 2000 余人，年营业额逾 120 亿人民币，网络遍及全球 200 余个港口，在海内外有超 80 家分、子公司，助力中国企业与世界互联互通。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;color: rgb(216, 78, 106);font-size: 16px;">业务背景:</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">随着公司规模的不断扩大和业务复杂性的增加，为了更好地实现资源优化和流程改进，公司运营与流程管理部需要实时监控公司的业务运转情况，以确保业务流程的稳定性和高效性。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">公司运营与流程管理部负责监督公司各类业务流程的执行，包括海运、空运、铁运各个大区和事业部的订单量，大客户的订单量，航线订单量，关务、仓储、陆运各个操作站点的委托量，公司当天各个大区和事业部实际收入和支出情况等。通过对这些流程的监控和分析，公司能够识别出潜在的问题和瓶颈，提出改进措施和建议，以优化公司运营效率。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;color: rgb(216, 78, 106);font-size: 16px;">数仓批量处理架构：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><img class="rich_pages wxw-img" data-backh="817" data-backw="578" data-galleryid="" data-ratio="1.4141414141414141" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/2_qJdRibwgEIXxcc7H9lWiaIozcuoJdA.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrqwkV62L5cFsdUvmc89eABq4rwQqJdRibwgEIXxcc7H9lWiaIozcuoJdA/640?wx_fmt=png'" data-type="png" data-w="792" style="color: rgb(89, 89, 89);font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.578px;text-align: center;width: 100%;height: auto;"  /><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;color: rgb(216, 78, 106);font-size: 16px;">实时数仓架构情况：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="429" data-backw="578" data-galleryid="" data-ratio="0.7424242424242424" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/3_cVhia8c51icNCibiaJibWLaWaOXwyg.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrXTfPYjEmuZokKZJEnKXPib0LM5IW9McVhia8c51icNCibiaJibWLaWaOXwyg/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">当前系统要求直接从生产系统收集实时数据，但存在多个数据源需要进行关联查询，而帆软报表在处理多个数据源时展示不够友好，且无法再次聚合多个数据源。定时查询生产系统会给生产系统数据库带来压力，影响生产系统的稳定运行。因此，我们需要引入一个可以通过Flink CDC技术实现流式处理的数仓，以解决实时数据处理的问题。这个数仓需要能够从多个数据源收集实时数据并在此基础上实现复杂的关联SQL查询、机器学习等操作，并且可以避免不定时查询生产系统，从而减轻生产系统的压力，保障生产系统的稳定运行。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><section style="font-size: 16px;"><section style="text-align: center;justify-content: center;margin: 10px 0% -35px;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><section style="display: inline-block;width: auto;vertical-align: top;min-width: 10%;flex: 0 0 auto;height: auto;padding: 17px 10px;align-self: flex-start;"><section style="justify-content: center;transform: translate3d(-1px, 0px, 0px);display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><section style="display: inline-block;width: 100%;vertical-align: top;box-shadow: rgb(0, 0, 0) 0px 0px 0px;align-self: flex-start;flex: 0 0 auto;"><section style="transform: translate3d(1px, 0px, 0px);" powered-by="xiumi.us"><section style="color: rgb(0, 0, 0);font-size: 26px;line-height: 1;letter-spacing: 0px;padding-right: 10px;padding-left: 10px;"><p><span style="background-color: rgba(255, 255, 255, 0);"><strong>02</strong></span></p></section></section></section></section></section></section><section style="margin: 15px 0% 20px;display: flex;flex-flow: row nowrap;text-align: center;justify-content: center;" powered-by="xiumi.us"><section style="display: inline-block;width: auto;vertical-align: top;border-style: solid;border-width: 0px 2px;border-color: rgb(0, 0, 0);padding-right: 10px;padding-left: 10px;align-self: flex-start;flex: 0 0 auto;min-width: 10%;height: auto;z-index: auto;"><section style="margin: -6px 0% 8px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section><section style="font-size: 17px;color: rgb(0, 0, 0);line-height: 1.8;letter-spacing: 0px;text-align: justify;" powered-by="xiumi.us"><p style="text-wrap: wrap;"><strong>大数据技术痛点以及选型</strong></p></section><section style="margin: 8px 0% -6px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section></section></section></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">海程邦达大数据团队建立以来一直以高效运维工具或平台来实现对人员的高效配置，优化重复劳动，手工作业。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在离线批数处理已能够支持集团基础驾驶舱和管理报表的情况下，集团运管部门提出了业务要实时统计订单数量，操作单量的需求，财务部门有现金流实时展示的需求，在这样的背景下，基于大数据的流批一体方案势在必行。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">虽然大数据部门已经使用了Apache Doris来实现湖仓一体的存储和计算，此前已在Doris社区发表湖仓一体建设的文章，但是有些问题有待解决，流式数据存储无法复用、中间层数据不可查、做不到实时聚合计算问题。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">按照架构演进时间排序，近几年通用的架构解决方案如下：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;color: rgb(216, 78, 106);font-size: 16px;">hadoop架构：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">传统数仓和互联网数仓的分界点，在互联网早期的时候，大家对于数据分析的要求也不高，主要是做实时性不高的报表、支撑决策，对应的离线数据分析方案就产生了。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">优点：数据类型支持丰富，支持海量运算，机器配置要求低，时效性低，容错</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">缺点：不支持实时；运维复杂；查询优化器不如MPP，响应慢</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">选型依据：不支持实时；运维复杂，不符合人员精简配置原则；性能差</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;color: rgb(216, 78, 106);font-size: 16px;">lambda架构：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Lambda 架构是由 Storm 的作者 Nathan Marz 提出的一个实时大数据处理框架。Marz 在 Twitter 工作期间开发了著名的实时大数据处理框架 Storm，Lambda 架构是其根据多年进行分布式大数据系统的经验总结提炼而成。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="312" data-backw="578" data-galleryid="" data-ratio="0.5404040404040404" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/4_C2T8Zdfia1gmcLenv1607ktAoEvnYw.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrqeahribVvVwTGpUAV0AwG7X6uyC2T8Zdfia1gmcLenv1607ktAoEvnYw/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">数据流处理分为 ServingLayer、SpeedLayer、BatchLayer三层：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在Batch层主要是对离线数据进行处理，最后提供view服务给到业务；</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在Speed层主要是对实时增量数据进行处理，最后提供view服务给到业务；</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在Serving层主要是响应用户的请求，实现离线和增量数据的聚合计算，并最终提供服务；</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">优点是：离线和实时分开计算，使用两套框架，架构稳定</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">缺点是：离线和实时数据很难保持一致性，运维人员需要维护两套框架三层架构，开发人员需要写三套代码</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">选型依据：数据一致性不可控；运维、开发工作量大，不符合人员精简配置的原则；</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;color: rgb(216, 78, 106);font-size: 16px;">kappa架构：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">kappa架构只用一套数据流处理架构来解决离线和实时数据，用实时流来解决所有问题，旨在提供快速可靠的查询访问结果。它非常适合各种数据处理工作负载，包括连续数据管道、实时数据处理、机器学习模型和实时数据分析、物联网系统以及许多其他具有单一技术堆栈的用例。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">它通常使用流处理引擎实现，例如Apache Flink、Apache Storm、Apache Kinesis、 Apache Kafka，旨在处理大量数据流并提供快速可靠的查询访问结果。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="150" data-backw="578" data-galleryid="" data-ratio="0.2601010101010101" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/5_1HypoNn8TFvCdkdWJmlrmnB59UNsZg.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrgZKVAWicp8YlmibGZV0bNEH0dB1HypoNn8TFvCdkdWJmlrmnB59UNsZg/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">优点是：单数据流处理框架</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">缺点是：虽然它的架构相对lamabda架构简单，但是流式处理框架的设置和维护相对复杂，不具备真正意义上的离线数据处理能力；流平台中存储大数据成本高昂</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">选型依据：离线数据处理能力需要保留，控制成本</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;color: rgb(216, 78, 106);font-size: 16px;">Iceberg</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">为此我们也调研了Iceberg，它的快照功能一定程度上能够实现流批一体，但是它的问题是基于kafka做的实时表中间层不可查或者无法复用已经存在的表，对kafka有强依赖，需要利用kafka将中间结果写到iceberg表，增加了系统的复杂度和可维护性。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">选型依据：无kafka实时架构已落地，中间数据无法实现可查可复用</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;color: rgb(216, 78, 106);font-size: 16px;">流式数仓（kappa架构的延续）</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">海程邦达大数据团队自FTS0.3.0版本开始参与流式数仓建设，旨在进一步降低数据处理框架的复杂度和人员的精简配置，前期的宗旨是既然是趋势就要参与进来，过程中不断学习精进，向最前沿的技术靠拢，团队一致认为有坑就踩坑，摸着石头也要过河，好在经过几个版本的迭代，在社区的高效配合下，最开始出现的问题也慢慢得以解决</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">流式数仓架构如下：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="334" data-backw="578" data-galleryid="" data-ratio="0.5782828282828283" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/6_t2ebDR8ePGBTjIicRwT5TN1xGyJcdQ.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrAvNrRpdVdL6CibY4AmUWicO6iaYct2ebDR8ePGBTjIicRwT5TN1xGyJcdQ/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;text-align: left;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">延续了kappa架构的特点，一套流处理架构，好处在与，底层paimon的技术支撑使得数据在全链路可查，数仓分层架构得以复用，同时兼顾了离线和实时的处理能力，减少存储和计算的浪费</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><section style="font-size: 16px;"><section style="text-align: center;justify-content: center;margin: 10px 0% -35px;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><section style="display: inline-block;width: auto;vertical-align: top;min-width: 10%;flex: 0 0 auto;height: auto;padding: 17px 10px;align-self: flex-start;"><section style="justify-content: center;transform: translate3d(-1px, 0px, 0px);display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><section style="display: inline-block;width: 100%;vertical-align: top;box-shadow: rgb(0, 0, 0) 0px 0px 0px;align-self: flex-start;flex: 0 0 auto;"><section style="transform: translate3d(1px, 0px, 0px);" powered-by="xiumi.us"><section style="color: rgb(0, 0, 0);font-size: 26px;line-height: 1;letter-spacing: 0px;padding-right: 10px;padding-left: 10px;"><p><span style="background-color: rgba(255, 255, 255, 0);"><strong>03</strong></span></p></section></section></section></section></section></section><section style="margin: 15px 0% 20px;display: flex;flex-flow: row nowrap;text-align: center;justify-content: center;" powered-by="xiumi.us"><section style="display: inline-block;width: auto;vertical-align: top;border-style: solid;border-width: 0px 2px;border-color: rgb(0, 0, 0);padding-right: 10px;padding-left: 10px;align-self: flex-start;flex: 0 0 auto;min-width: 10%;height: auto;z-index: auto;"><section style="margin: -6px 0% 8px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section><section style="font-size: 17px;color: rgb(0, 0, 0);line-height: 1.8;letter-spacing: 0px;text-align: justify;" powered-by="xiumi.us"><p style="text-wrap: wrap;"><strong>生产实践</strong></p></section><section style="margin: 8px 0% -6px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section></section></section></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">本方案采用 Flink Application On K8s 集群，Flink CDC 实时摄取业务系统关系型数据库数据，通过 streampark 任务平台提交 Flink+Paimon Streaming Data Warehouse 任务， 最后采用 Trino 引擎接入 Finereport 提供服务和开发人员的查询。paimon底层存储支持 S3 协议，因为公司大数据服务依赖于阿里云所以使用对象存储OSS作为数据文件系统。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">形成一个全链路实时流动、可查、分层可复用的Pipline</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p>架构图：<o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="266" data-backw="578" data-galleryid="" data-ratio="0.4595959595959596" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/7_0RZcazeqlg4dzKrWMR17q4Q4sa31pQ.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfr4DQ6zs85E3MPo8FfUcwsQthc0RZcazeqlg4dzKrWMR17q4Q4sa31pQ/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">主要采用组件版本如下：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">flink-1.16.0-scala-2.12</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">paimon-flink-1.16-0.4-20230424.001927-40.jar</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">apache-streampark_2.12-2.0.0</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">kubernetes v1.18.3</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;color: rgb(216, 78, 106);font-size: 16px;">环境构建</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">下载 flink-1.16.0-scala-2.12.tar.gz 可以在 </span><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">flink官网</span> <span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">下载对应版本的安装包到streampark服务器</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="http"><code><span class="code-snippet_outer">#解压</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">tar zxvf flink-1.16.0-scala-2.12.tar.gz</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#修改 flink-conf 配置文件并启动集群</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">vim flink-1.16.0-scala-2.12/conf/flink-conf.yaml 文件，按如下配置修改</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">jobmanager.rpc.address: localhost</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">jobmanager.rpc.port: 6123</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">jobmanager.bind-host: localhost</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">jobmanager.memory.process.size: 4096m</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">taskmanager.bind-host: localhost</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">taskmanager.host: localhost</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">taskmanager.memory.process.size: 4096m</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">taskmanager.numberOfTaskSlots: 4</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">parallelism.default: 4</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">akka.ask.timeout: 100s</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">web.timeout: 1000000</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#checkpoints&amp;&amp;savepoints</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">state.checkpoints.dir: file:///opt/flink/checkpoints</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">state.savepoints.dir: file:///opt/flink/savepoints</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">execution.checkpointing.interval: 2min</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#当作业手动取消/暂停时，将会保留作业的 Checkpoint 状态信息</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">execution.checkpointing.externalized-checkpoint-retention: RETAIN_ON_CANCELLATION</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">state.backend: rocksdb</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">已完成的 cp 保存个数</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">state.checkpoints.num-retained: 2000</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">state.backend.incremental: true</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">execution.checkpointing.checkpoints-after-tasks-finish.enabled: true</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#OSS</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">fs.oss.endpoint: oss-cn-zhangjiakou-internal.aliyuncs.com</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">fs.oss.accessKeyId: xxxxxxxxxxxxxxxxxxxxxxx</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">fs.oss.accessKeySecret: xxxxxxxxxxxxxxxxxxxxxxx</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">fs.oss.impl: org.apache.hadoop.fs.aliyun.oss.AliyunOSSFileSystem</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">jobmanager.execution.failover-strategy: region</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">rest.port: 8081</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__section">rest.address: localhost</span></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">建议可以在本地添加 FLINK_HOME 方便在上 k8s 之前本地排查问题使用</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">vim /etc/profile</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="bash"><code><span class="code-snippet_outer"><span class="code-snippet__comment">#FLINK</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">export</span> FLINK_HOME=/data/src/flink-1.16.0-scala-2.12</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">export</span> PATH=<span class="code-snippet__variable">$PATH</span>:<span class="code-snippet__variable">$FLINK_HOME</span>/bin</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">source</span> /etc/profile</span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在streampark添加flink conf</span></p><p style="margin-bottom: 0px;letter-spacing: 0.578px;text-wrap: wrap;text-align: left;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="letter-spacing: 0.578px;text-wrap: wrap;text-align: center;"><img class="rich_pages wxw-img" data-backh="177" data-backw="578" data-galleryid="" data-ratio="0.3055555555555556" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/8_caicxRmQyia8ZcwASdF2ayySjAz7OQ.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrIhXkuP3wDic63vU1FMtcNCUeWSQicaicxRmQyia8ZcwASdF2ayySjAz7OQ/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 578px;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">构建 flink1.16.0 基础镜像从 </span><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">dockerhub</span> <span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">拉取对应版本的镜像</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span class="code-snippet__comment">#拉取镜像</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">docker</span> <span class="code-snippet__string">pull flink:1.16.0-scala_2.12-java8</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#打上 tag</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">docker</span> <span class="code-snippet__string">tagflink:1.16.0-scala_2.12-java8  registry-vpc.cn-zhangjiakou.aliyuncs.com/xxxxx/flink:1.16.0-scala_2.12-java8</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#push 到公司仓库</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">docker</span> <span class="code-snippet__string">pushregistry-vpc.cn-zhangjiakou.aliyuncs.com/xxxxx/flink:1.16.0-scala_2.12-java8</span></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">创建 Dockerfile 文件 &amp; target 目录将 flink-oss-fs-hadoop JAR包放置在该目录 Shaded Hadoop OSS file system jar包下载地址：</span><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">https://repository.apache.org/snapshots/org/apache/paimon/paimon-oss/</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">.</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">├── Dockerfile</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">└── target</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"> &nbsp; └── flink-oss-fs-hadoop-1.16.0.jar</span><o:p></o:p></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span class="code-snippet__attr">touch</span> <span class="code-snippet__string">Dockerfile</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">mkdir</span> <span class="code-snippet__string">target</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code></pre></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span class="code-snippet__comment">#vim Dockerfile</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">FROM</span> <span class="code-snippet__string">registry-vpc.cn-zhangjiakou.aliyuncs.com/xxxxx/flink:1.16.0-scala_2.12-java8</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">RUN</span> <span class="code-snippet__string">mkdir /opt/flink/plugins/oss-fs-hadoop</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">COPY</span> <span class="code-snippet__string">target/flink-oss-fs-hadoop-1.16.0.jar  /opt/flink/plugins/oss-fs-hadoop</span></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;text-align: left;text-wrap: wrap;">#</span>build 基础镜像</span><o:p></o:p></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span class="code-snippet__attr">docker</span> <span class="code-snippet__string">build -t flink-table-store:v1.16.0 .</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">docker</span> <span class="code-snippet__string">tag flink-table-store:v1.16.0 registry-vpc.cn-zhangjiakou.aliyuncs.com/xxxxx/flink-table-store:v1.16.0</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">docker</span> <span class="code-snippet__string">push registry-vpc.cn-zhangjiakou.aliyuncs.com/xxxxx/flink-table-store:v1.16.0</span></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;text-align: left;text-wrap: wrap;">#</span>准备 paimon jar 包</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">可以在 </span><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Apache Repository</span> <span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">下载对应版本，需要注意的是要和 flink 大版本保持一致</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;color: rgb(216, 78, 106);font-size: 16px;">使用 streampark 平台提交 paimon 任务</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">前提条件：</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Kubernetes 客户端连接配置</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Kubernetes RBAC 配置</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">容器镜像仓库配置 （案例中使用的是阿里云的容器镜像服务个人免费版）</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">创建挂载 checkpoint/savepoint 的 pvc 资源</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Kubernetes 客户端连接配置：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">将k8s master节点~/.kube/config配置直接拷贝到streampark服务器的目录，之后在streampark服务器执行以下命令显示k8s集群running代表权限和网络验证成功。</span><o:p></o:p></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="nginx"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">kubectl</span> cluster-<span class="code-snippet__literal">info</span></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Kubernetes RBAC 配置</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">创建streamx命名空间</span><o:p></o:p></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="nginx"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">kubectl</span> create ns streamx</span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">使用default账户创建clusterrolebinding 资源</span><o:p></o:p></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer">kubectl <span class="code-snippet__keyword">create</span> clusterrolebinding flink-<span class="code-snippet__keyword">role</span>-binding-<span class="code-snippet__keyword">default</span> <span class="code-snippet__comment">--clusterrole=edit --serviceaccount=streamx:default</span></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">容器镜像仓库配置</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">案例中使用阿里云容器镜像服务ACR，也可以使用自建镜像服务harbor代替。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">创建命名空间streampark(安全设置需要设置为私有)</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="169" data-backw="578" data-galleryid="" data-ratio="0.29292929292929293" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/9_WcjoBn5lISBH6HnGOM0tTBs2bwiaCw.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrUY80D0wVqUuEfzUq2ONmaKSwEWcjoBn5lISBH6HnGOM0tTBs2bwiaCw/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在streampark配置镜像仓库，任务构建镜像会推送到镜像仓库</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="193" data-backw="578" data-galleryid="" data-ratio="0.3333333333333333" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/10_SOOaIPSwNZf4cxxslMCnvM6VBrezEg.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrY9ds4XTvZviaziaI9835S8P4SeSOOaIPSwNZf4cxxslMCnvM6VBrezEg/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">创建k8s secret密钥用来拉取ACR中的镜像 streamparksecret为密钥名称 自定义</span><o:p></o:p></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer">kubectl <span class="code-snippet__keyword">create</span> secret docker-registry streamparksecret <span class="code-snippet__comment">--docker-server=registry-vpc.cn-zhangjiakou.aliyuncs.com --docker-username=xxxxxx --docker-password=xxxxxx -n streamx</span></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">创建挂载 checkpoint/savepoint 的 pvc 资源</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">基于阿里云的对象存储OSS做K8S的持久化</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">OSS CSI 插件：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">可以使用 OSS CSI 插件来帮助简化存储管理。您可以使用 csi 配置创建 pv，并且 pvc、pod 像往常一样定义，yaml 文件参考：https://bondextest.oss-cn-zhangjiakou.aliyuncs.com/ossyaml.zip</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">配置要求：</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">- 创建具有所需 RBAC 权限的服务帐户</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">参考：https://github.com/kubernetes-sigs/alibaba-cloud-csi-driver/blob/master/docs/oss.md&nbsp;</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">kubectl</span> <span class="code-snippet__selector-tag">-f</span> <span class="code-snippet__selector-tag">rbac</span><span class="code-snippet__selector-class">.yaml</span> </span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;">- 部署OSS CSI 插件</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">kubectl</span> <span class="code-snippet__selector-tag">-f</span> <span class="code-snippet__selector-tag">oss-plugin</span><span class="code-snippet__selector-class">.yaml</span></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;">- 创建CP&amp;SP的PV&nbsp;</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;"></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">kubectl</span> <span class="code-snippet__selector-tag">-f</span> <span class="code-snippet__selector-tag">checkpoints_pv</span><span class="code-snippet__selector-class">.yaml</span> <span class="code-snippet__selector-tag">kubectl</span> <span class="code-snippet__selector-tag">-f</span> <span class="code-snippet__selector-tag">savepoints_pv</span><span class="code-snippet__selector-class">.yaml</span> </span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;">- 创建CP&amp;SP的PVC&nbsp;</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;"></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">kubectl</span> <span class="code-snippet__selector-tag">-f</span> <span class="code-snippet__selector-tag">checkpoints_pvc</span><span class="code-snippet__selector-class">.yaml</span> <span class="code-snippet__selector-tag">kubectl</span> <span class="code-snippet__selector-tag">-f</span> <span class="code-snippet__selector-tag">savepoints_pvc</span><span class="code-snippet__selector-class">.yaml</span> </span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;">配置好依赖环境，接下来我们就开始使用paimon进行流式数仓的分层开发。</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;font-size: 16px;color: rgb(216, 78, 106);">案例：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">统计海运空运实时委托单量</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">任务提交：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">初始化paimon catalog配置</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="622" data-backw="578" data-galleryid="" data-ratio="1.0757575757575757" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/11_Vdia0XRKLjEIevq6cTic6ElsogtvEA.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrtBgtAo0Y3xTQfOEesiaJMqWWk0ZVdia0XRKLjEIevq6cTic6ElsogtvEA/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SET</span> <span class="code-snippet__string">'execution.runtime-mode'</span> = <span class="code-snippet__string">'streaming'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">set</span> <span class="code-snippet__string">'table.exec.sink.upsert-materialize'</span> = <span class="code-snippet__string">'none'</span>; </span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SET</span> <span class="code-snippet__string">'sql-client.execution.result-mode'</span> = <span class="code-snippet__string">'tableau'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 创建并使用 FTS Catalog 底层存储方案采用阿里云oss</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">CATALOG</span> <span class="code-snippet__string">`table_store`</span> <span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'type'</span> = <span class="code-snippet__string">'paimon'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'warehouse'</span> = <span class="code-snippet__string">'oss://xxxxx/xxxxx'</span> <span class="code-snippet__comment">#自定义oss存储路径</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">USE</span> <span class="code-snippet__keyword">CATALOG</span> <span class="code-snippet__string">`table_store`</span>;</span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">一个任务同时抽取postgres、mysql、sqlserver三种数据库的表数据写入到paimon</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="286" data-backw="578" data-galleryid="" data-ratio="0.494949494949495" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/12_Mb8gRy0eiavSU9XOXDCCX2wAXiceOQ.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrlsmka4Eyvurjqd5xh1HFPOOibXwMb8gRy0eiavSU9XOXDCCX2wAXiceOQ/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="280" data-backw="578" data-galleryid="" data-ratio="0.48484848484848486" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/13_KtzOIW5iclkoL0HVg0ktvq0YiaaHmw.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfribyL4sJIrxibXFZ7rHAxjfIrVDsAKtzOIW5iclkoL0HVg0ktvq0YiaaHmw/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="298" data-backw="578" data-galleryid="" data-ratio="0.5151515151515151" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/14_Dy62wMm0kAjBXxWOLJr5iaH3IPZrsw.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrHVhkuv9DElB4QUYycmDQ6u5DHDy62wMm0kAjBXxWOLJr5iaH3IPZrsw/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Development Mode：Flink SQL</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Execution Mode ：kubernetes application</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink Version ：flink-1.16.0-scala-2.12</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Kubernetes Namespace ：streamx</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Kubernetes ClusterId ：（任务名自定义即可）</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink Base Docker Image ：&nbsp;</span><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">registry-vpc.cn-zhangjiakou.aliyuncs.com/xxxxx/flink-table-store:v1.16.0</span><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">&nbsp;&nbsp;&nbsp; #上传到阿里云镜像仓库的基础镜像</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Rest-Service Exposed Type：NodePort</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">paimon基础依赖包：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">paimon-flink-1.16-0.4-20230424.001927-40.jar</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">flink-shaded-hadoop-2-uber-2.8.3-10.0.jar</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">flinkcdc依赖包下载地址：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">https://github.com/ververica/flink-cdc-connectors/releases/tag/release-2.2.0</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">pod template</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="http"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">apiVersion</span>: v1</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attribute">kind</span>: Pod</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">metadata</span>:<span class="code-snippet__string"></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">name</span>: <span class="code-snippet__string">pod-template</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">spec</span>:<span class="code-snippet__string"></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">containers</span>:<span class="code-snippet__string"></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__meta">-</span> <span class="code-snippet__string">name: flink-main-container</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__attr">volumeMounts</span>:<span class="code-snippet__string"></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">      <span class="code-snippet__meta">-</span> <span class="code-snippet__string">name: flink-checkpoints-csi-pvc</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">        <span class="code-snippet__attr">mountPath</span>: <span class="code-snippet__string">/opt/flink/checkpoints</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">      <span class="code-snippet__meta">-</span> <span class="code-snippet__string">name: flink-savepoints-csi-pvc</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">        <span class="code-snippet__attr">mountPath</span>: <span class="code-snippet__string">/opt/flink/savepoints</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">volumes</span>:<span class="code-snippet__string"></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__meta">-</span> <span class="code-snippet__string">name: flink-checkpoints-csi-pvc</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__attr">persistentVolumeClaim</span>:<span class="code-snippet__string"></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">      <span class="code-snippet__attr">claimName</span>: <span class="code-snippet__string">flink-checkpoints-csi-pvc</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__meta">-</span> <span class="code-snippet__string">name: flink-savepoints-csi-pvc</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__attr">persistentVolumeClaim</span>:<span class="code-snippet__string"></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">      <span class="code-snippet__attr">claimName</span>: <span class="code-snippet__string">flink-savepoints-csi-pvc</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">imagePullSecrets</span>:      <span class="code-snippet__string"></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">-</span> <span class="code-snippet__string">name: streamparksecret</span></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">flink sql</span><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">1. 构建源表和paimon中ods表的关系，这里就是源表和目标表一对一映射</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- postgre数据库 示例</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TEMPORARY</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__string">`shy_doc_hdworkdochd`</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`doccode`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">not</span> <span class="code-snippet__literal">null</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'主键'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`businessmodel`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">450</span>) <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'业务模式'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`businesstype`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">450</span>)  <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'业务性质'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`transporttype`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'运输类型'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">......</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`bookingguid`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'操作编号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`doccode`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) <span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'connector'</span> = <span class="code-snippet__string">'postgres-cdc'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'hostname'</span> = <span class="code-snippet__string">'数据库服务器IP地址'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'port'</span> = <span class="code-snippet__string">'端口号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'username'</span> = <span class="code-snippet__string">'用户名'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'password'</span> = <span class="code-snippet__string">'密码'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'database-name'</span> = <span class="code-snippet__string">'数据库名'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'schema-name'</span> = <span class="code-snippet__string">'dev'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'decoding.plugin.name'</span> = <span class="code-snippet__string">'wal2json'</span>,,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'table-name'</span> = <span class="code-snippet__string">'doc_hdworkdochd'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'debezium.slot.name'</span> = <span class="code-snippet__string">'hdworkdochdslotname03'</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TEMPORARY</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__string">`shy_base_enterprise`</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`entguid`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">not</span> <span class="code-snippet__literal">null</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'主键'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`entorgcode`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">450</span>) <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'客户编号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`entnature`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">450</span>)  <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'客户类型'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`entfullname`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'客户名称'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`entguid`</span>,<span class="code-snippet__string">`entorgcode`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) <span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'connector'</span> = <span class="code-snippet__string">'postgres-cdc'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'hostname'</span> = <span class="code-snippet__string">'数据库服务器IP地址'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'port'</span> = <span class="code-snippet__string">'端口号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'username'</span> = <span class="code-snippet__string">'用户名'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'password'</span> = <span class="code-snippet__string">'密码'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'database-name'</span> = <span class="code-snippet__string">'数据库名'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'schema-name'</span> = <span class="code-snippet__string">'dev'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'decoding.plugin.name'</span> = <span class="code-snippet__string">'wal2json'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'table-name'</span> = <span class="code-snippet__string">'base_enterprise'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'debezium.snapshot.mode'</span>=<span class="code-snippet__string">'never'</span>, <span class="code-snippet__comment">-- 增量同步(全量+增量忽略该属性)</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'debezium.slot.name'</span> = <span class="code-snippet__string">'base_enterprise_slotname03'</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 根据源表结构在paimon上ods层创建对应的目标表</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__keyword">IF</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">EXISTS</span> ods.<span class="code-snippet__string">`ods_shy_jh_doc_hdworkdochd`</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`o_year`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'分区字段'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`create_date`</span> <span class="code-snippet__built_in">timestamp</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'创建时间'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`o_year`</span>, <span class="code-snippet__string">`doccode`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) PARTITIONED <span class="code-snippet__keyword">BY</span> (<span class="code-snippet__string">`o_year`</span>)</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'changelog-producer.compaction-interval'</span> = <span class="code-snippet__string">'2m'</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) <span class="code-snippet__keyword">LIKE</span> <span class="code-snippet__string">`shy_doc_hdworkdochd`</span> (<span class="code-snippet__keyword">EXCLUDING</span> <span class="code-snippet__keyword">CONSTRAINTS</span> <span class="code-snippet__keyword">EXCLUDING</span> OPTIONS);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__keyword">IF</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">EXISTS</span> ods.<span class="code-snippet__string">`ods_shy_base_enterprise`</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`create_date`</span> <span class="code-snippet__built_in">timestamp</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'创建时间'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`entguid`</span>,<span class="code-snippet__string">`entorgcode`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">)</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'changelog-producer.compaction-interval'</span> = <span class="code-snippet__string">'2m'</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) <span class="code-snippet__keyword">LIKE</span> <span class="code-snippet__string">`shy_base_enterprise`</span> (<span class="code-snippet__keyword">EXCLUDING</span> <span class="code-snippet__keyword">CONSTRAINTS</span> <span class="code-snippet__keyword">EXCLUDING</span> OPTIONS);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 设置作业名，执行作业任务将源表数据实时写入到paimon对应表中</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SET</span> <span class="code-snippet__string">'pipeline.name'</span> = <span class="code-snippet__string">'ods_doc_hdworkdochd'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">INSERT</span> <span class="code-snippet__keyword">INTO</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">ods.<span class="code-snippet__string">`ods_shy_jh_doc_hdworkdochd`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SELECT</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">*</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,<span class="code-snippet__keyword">YEAR</span>(<span class="code-snippet__string">`docdate`</span>) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`o_year`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,TO_TIMESTAMP(<span class="code-snippet__keyword">CONVERT_TZ</span>(<span class="code-snippet__keyword">cast</span>(<span class="code-snippet__keyword">CURRENT_TIMESTAMP</span> <span class="code-snippet__keyword">as</span> <span class="code-snippet__built_in">varchar</span>), <span class="code-snippet__string">'UTC'</span>, <span class="code-snippet__string">'Asia/Shanghai'</span>)) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`create_date`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">FROM</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`shy_doc_hdworkdochd`</span> <span class="code-snippet__keyword">where</span> <span class="code-snippet__string">`docdate`</span> <span class="code-snippet__keyword">is</span> <span class="code-snippet__keyword">not</span> <span class="code-snippet__literal">null</span> <span class="code-snippet__keyword">and</span> <span class="code-snippet__string">`docdate`</span> &gt; <span class="code-snippet__string">'2023-01-01'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SET</span> <span class="code-snippet__string">'pipeline.name'</span> = <span class="code-snippet__string">'ods_shy_base_enterprise'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">INSERT</span> <span class="code-snippet__keyword">INTO</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">ods.<span class="code-snippet__string">`ods_shy_base_enterprise`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SELECT</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">*</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,TO_TIMESTAMP(<span class="code-snippet__keyword">CONVERT_TZ</span>(<span class="code-snippet__keyword">cast</span>(<span class="code-snippet__keyword">CURRENT_TIMESTAMP</span> <span class="code-snippet__keyword">as</span> <span class="code-snippet__built_in">varchar</span>), <span class="code-snippet__string">'UTC'</span>, <span class="code-snippet__string">'Asia/Shanghai'</span>)) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`create_date`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">FROM</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`shy_base_enterprise`</span> <span class="code-snippet__keyword">where</span> entorgcode <span class="code-snippet__keyword">is</span> <span class="code-snippet__keyword">not</span> <span class="code-snippet__literal">null</span> <span class="code-snippet__keyword">and</span> entorgcode &lt;&gt; <span class="code-snippet__string">''</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- mysql数据库 示例</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TEMPORARY</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__string">`doc_order`</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`id`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'主键'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`order_no`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'订单号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`business_no`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'OMS服务号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">......</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`is_deleted`</span> <span class="code-snippet__built_in">int</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'是否作废'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`id`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) <span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'connector'</span> = <span class="code-snippet__string">'mysql-cdc'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'hostname'</span> = <span class="code-snippet__string">'数据库服务器地址'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'port'</span> = <span class="code-snippet__string">'端口号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'username'</span> = <span class="code-snippet__string">'用户名'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'password'</span> = <span class="code-snippet__string">'密码'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'database-name'</span> = <span class="code-snippet__string">'库名'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'table-name'</span> = <span class="code-snippet__string">'doc_order'</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 根据源表结构在paimon上ods层创建对应的目标表</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__keyword">IF</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">EXISTS</span> ods.<span class="code-snippet__string">`ods_bondexsea_doc_order`</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`o_year`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'分区字段'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`create_date`</span> <span class="code-snippet__built_in">timestamp</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'创建时间'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`o_year`</span>, <span class="code-snippet__string">`id`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) PARTITIONED <span class="code-snippet__keyword">BY</span> (<span class="code-snippet__string">`o_year`</span>)</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'changelog-producer.compaction-interval'</span> = <span class="code-snippet__string">'2m'</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) <span class="code-snippet__keyword">LIKE</span> <span class="code-snippet__string">`doc_order`</span> (<span class="code-snippet__keyword">EXCLUDING</span> <span class="code-snippet__keyword">CONSTRAINTS</span> <span class="code-snippet__keyword">EXCLUDING</span> OPTIONS);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 设置作业名，执行作业任务将源表数据实时写入到paimon对应表中</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SET</span> <span class="code-snippet__string">'pipeline.name'</span> = <span class="code-snippet__string">'ods_bondexsea_doc_order'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">INSERT</span> <span class="code-snippet__keyword">INTO</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">ods.<span class="code-snippet__string">`ods_bondexsea_doc_order`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SELECT</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">*</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,<span class="code-snippet__keyword">YEAR</span>(<span class="code-snippet__string">`gmt_create`</span>) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`o_year`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,TO_TIMESTAMP(<span class="code-snippet__keyword">CONVERT_TZ</span>(<span class="code-snippet__keyword">cast</span>(<span class="code-snippet__keyword">CURRENT_TIMESTAMP</span> <span class="code-snippet__keyword">as</span> <span class="code-snippet__built_in">varchar</span>), <span class="code-snippet__string">'UTC'</span>, <span class="code-snippet__string">'Asia/Shanghai'</span>)) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`create_date`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">FROM</span> <span class="code-snippet__string">`doc_order`</span> <span class="code-snippet__keyword">where</span> gmt_create &gt; <span class="code-snippet__string">'2023-01-01'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- sqlserver数据库 示例</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TEMPORARY</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__string">`OrderHAWB`</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`HBLIndex`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'主键'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`CustomerNo`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'客户编号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">......</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`CreateOPDate`</span> <span class="code-snippet__built_in">timestamp</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'制单日期'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`HBLIndex`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) <span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'connector'</span> = <span class="code-snippet__string">'sqlserver-cdc'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'hostname'</span> = <span class="code-snippet__string">'数据库服务器地址'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'port'</span> = <span class="code-snippet__string">'端口号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'username'</span> = <span class="code-snippet__string">'用户名'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'password'</span> = <span class="code-snippet__string">'密码'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'database-name'</span> = <span class="code-snippet__string">'数据库名'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'schema-name'</span> = <span class="code-snippet__string">'dbo'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 'debezium.snapshot.mode' = 'initial' -- 全量增量都抽取</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'scan.startup.mode'</span> = <span class="code-snippet__string">'latest-offset'</span>,<span class="code-snippet__comment">-- 只抽取增量数据</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'table-name'</span> = <span class="code-snippet__string">'OrderHAWB'</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 根据源表结构在paimon上ods层创建对应的目标表</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__keyword">IF</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">EXISTS</span> ods.<span class="code-snippet__string">`ods_airsea_airfreight_orderhawb`</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`o_year`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'分区字段'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`create_date`</span> <span class="code-snippet__built_in">timestamp</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'创建时间'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`o_year`</span>, <span class="code-snippet__string">`HBLIndex`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) PARTITIONED <span class="code-snippet__keyword">BY</span> (<span class="code-snippet__string">`o_year`</span>)</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'changelog-producer.compaction-interval'</span> = <span class="code-snippet__string">'2m'</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) <span class="code-snippet__keyword">LIKE</span> <span class="code-snippet__string">`OrderHAWB`</span> (<span class="code-snippet__keyword">EXCLUDING</span> <span class="code-snippet__keyword">CONSTRAINTS</span> <span class="code-snippet__keyword">EXCLUDING</span> OPTIONS);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 设置作业名，执行作业任务将源表数据实时写入到paimon对应表中</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SET</span> <span class="code-snippet__string">'pipeline.name'</span> = <span class="code-snippet__string">'ods_airsea_airfreight_orderhawb'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">INSERT</span> <span class="code-snippet__keyword">INTO</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">ods.<span class="code-snippet__string">`ods_airsea_airfreight_orderhawb`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SELECT</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">RTRIM</span>(<span class="code-snippet__string">`HBLIndex`</span>) <span class="code-snippet__keyword">as</span> <span class="code-snippet__string">`HBLIndex`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">......</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,<span class="code-snippet__string">`CreateOPDate`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,<span class="code-snippet__keyword">YEAR</span>(<span class="code-snippet__string">`CreateOPDate`</span>) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`o_year`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,TO_TIMESTAMP(<span class="code-snippet__keyword">CONVERT_TZ</span>(<span class="code-snippet__keyword">cast</span>(<span class="code-snippet__keyword">CURRENT_TIMESTAMP</span> <span class="code-snippet__keyword">as</span> <span class="code-snippet__built_in">varchar</span>), <span class="code-snippet__string">'UTC'</span>, <span class="code-snippet__string">'Asia/Shanghai'</span>)) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`create_date`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">FROM</span> <span class="code-snippet__string">`OrderHAWB`</span> <span class="code-snippet__keyword">where</span> CreateOPDate &gt; <span class="code-snippet__string">'2023-01-01'</span>;</span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">业务表数据实时写入paimon ods表效果如下：</span><o:p></o:p></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="226" data-backw="578" data-galleryid="" data-ratio="0.39141414141414144" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/15_JGShyEFQ22FOkK1zqicBUXr7CTNq3A.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrV9l73BUiaxs6zJNDWfxgZrfjrKJGShyEFQ22FOkK1zqicBUXr7CTNq3A/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">2. 将ods层表的数据打宽写入dwd层中，这里其实就是将ods层相关业务表合并写入dwd中，这里主要是处理count_order字段的值，因为源表中的数据存在逻辑删除和物理删除所以通过count函数统计会有问题，所以我们这里采用sum聚合来计算单量，每个reference_no对应的count_order是1，如果逻辑作废通过sql将它处理成0，物理删除paimon会自动处理。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"> dim维表我们这边直接拿的doris里面处理好的维表来使用，维表更新频率低，所以没有在paimon里面进行二次开发。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 在paimon-dwd层创建宽表</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__keyword">IF</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">EXISTS</span> dwd.<span class="code-snippet__string">`dwd_business_order`</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`reference_no`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'委托单号主键'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`bondex_shy_flag`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">8</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'区分'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`is_server_item`</span> <span class="code-snippet__built_in">int</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'是否已经关联订单'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`order_type_name`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'业务分类'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`consignor_date`</span> <span class="code-snippet__built_in">DATE</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'统计日期'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`consignor_code`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'客户编号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`consignor_name`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">160</span>) <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'客户名称'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`sales_code`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">32</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'销售编号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`sales_name`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">200</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'销售名称'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`delivery_center_op_id`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">32</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'交付编号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`delivery_center_op_name`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">200</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'交付名称'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`pol_code`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">100</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'起运港代码'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`pot_code`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">100</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'中转港代码'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`port_of_dest_code`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">100</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span>  <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'目的港代码'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`is_delete`</span> <span class="code-snippet__built_in">int</span> <span class="code-snippet__keyword">not</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'是否作废'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`order_status`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">8</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'订单状态'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`count_order`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">not</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'订单数'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`o_year`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'分区字段'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`create_date`</span> <span class="code-snippet__built_in">timestamp</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'创建时间'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`o_year`</span>,<span class="code-snippet__string">`reference_no`</span>,<span class="code-snippet__string">`bondex_shy_flag`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) PARTITIONED <span class="code-snippet__keyword">BY</span> (<span class="code-snippet__string">`o_year`</span>)</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 每个 partition 下设置 2 个 bucket</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'bucket'</span> = <span class="code-snippet__string">'2'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'changelog-producer'</span> = <span class="code-snippet__string">'full-compaction'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'snapshot.time-retained'</span> = <span class="code-snippet__string">'2h'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'changelog-producer.compaction-interval'</span> = <span class="code-snippet__string">'2m'</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 设置作业名，将ods层的相关业务表合并写入到dwd层</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SET</span> <span class="code-snippet__string">'pipeline.name'</span> = <span class="code-snippet__string">'dwd_business_order'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">INSERT</span> <span class="code-snippet__keyword">INTO</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">dwd.<span class="code-snippet__string">`dwd_business_order`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SELECT</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">o.doccode,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">......,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">YEAR</span> (o.docdate) <span class="code-snippet__keyword">AS</span> o_year</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,TO_TIMESTAMP(<span class="code-snippet__keyword">CONVERT_TZ</span>(<span class="code-snippet__keyword">cast</span>(<span class="code-snippet__keyword">CURRENT_TIMESTAMP</span> <span class="code-snippet__keyword">as</span> <span class="code-snippet__built_in">varchar</span>), <span class="code-snippet__string">'UTC'</span>, <span class="code-snippet__string">'Asia/Shanghai'</span>)) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`create_date`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">FROM</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">ods.ods_shy_jh_doc_hdworkdochd o</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">INNER</span> <span class="code-snippet__keyword">JOIN</span> ods.ods_shy_base_enterprise en <span class="code-snippet__keyword">ON</span> o.businessguid = en.entguid</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">LEFT</span> <span class="code-snippet__keyword">JOIN</span> dim.dim_hhl_user_code sales <span class="code-snippet__keyword">ON</span> o.salesguid = sales.USER_GUID</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">LEFT</span> <span class="code-snippet__keyword">JOIN</span> dim.dim_hhl_user_code op <span class="code-snippet__keyword">ON</span> o.bookingguid = op.USER_GUID</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">UNION</span> <span class="code-snippet__keyword">ALL</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SELECT</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">business_no,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">......,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">YEAR</span> ( gmt_create ) <span class="code-snippet__keyword">AS</span> o_year</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,TO_TIMESTAMP(<span class="code-snippet__keyword">CONVERT_TZ</span>(<span class="code-snippet__keyword">cast</span>(<span class="code-snippet__keyword">CURRENT_TIMESTAMP</span> <span class="code-snippet__keyword">as</span> <span class="code-snippet__built_in">varchar</span>), <span class="code-snippet__string">'UTC'</span>, <span class="code-snippet__string">'Asia/Shanghai'</span>)) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`create_date`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">FROM</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">ods.ods_bondexsea_doc_order</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">UNION</span> <span class="code-snippet__keyword">ALL</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SELECT</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  HBLIndex,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"> ......,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__keyword">YEAR</span> ( CreateOPDate ) <span class="code-snippet__keyword">AS</span> o_year</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,TO_TIMESTAMP(<span class="code-snippet__keyword">CONVERT_TZ</span>(<span class="code-snippet__keyword">cast</span>(<span class="code-snippet__keyword">CURRENT_TIMESTAMP</span> <span class="code-snippet__keyword">as</span> <span class="code-snippet__built_in">varchar</span>), <span class="code-snippet__string">'UTC'</span>, <span class="code-snippet__string">'Asia/Shanghai'</span>)) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`create_date`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">FROM</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  ods.<span class="code-snippet__string">`ods_airsea_airfreight_orderhawb`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">;</span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">flink ui可以看到ods数据经过paimon实时join清洗到表dwd_business_order</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="346" data-backw="578" data-galleryid="" data-ratio="0.5984848484848485" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/16_MGqSQzALfSMm8ua0yEBFQFqxicArOg.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfr1soUvtNZNGyggibYH9vE0xnCIhMGqSQzALfSMm8ua0yEBFQFqxicArOg/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">3. 将dwd层数据轻度聚合到dwm层中，将相关数据写入</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">dwm.`dwm_business_order_count`表中，该表数据会根据主键对聚合字段做sum，sum_orderCount字段就是聚合结果，物理删除的数据sum时paimon会自动处理。</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 创建dwm层轻度汇总表，根据日期、销售、操作、业务类别、客户、起运港、目的港汇总单量</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__keyword">IF</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">EXISTS</span> dwm.<span class="code-snippet__string">`dwm_business_order_count`</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`l_year`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'统计年'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`l_month`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'统计月'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`l_date`</span> <span class="code-snippet__built_in">DATE</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span>  <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'统计日期'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`bondex_shy_flag`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">8</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'区分'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`order_type_name`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'业务分类'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`is_server_item`</span> <span class="code-snippet__built_in">int</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'是否已经关联订单'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`customer_code`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'客户编号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`sales_code`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'销售编号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`delivery_center_op_id`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'交付编号'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`pol_code`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">100</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'起运港代码'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`pot_code`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">100</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'中转港代码'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`port_of_dest_code`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">100</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'目的港代码'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`customer_name`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">200</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'客户名称'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`sales_name`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">200</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'销售名称'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`delivery_center_op_name`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">200</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'交付名称'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`sum_orderCount`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'订单数'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">`create_date`</span> <span class="code-snippet__built_in">timestamp</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'创建时间'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`l_year`</span>, <span class="code-snippet__string">`l_month`</span>,<span class="code-snippet__string">`l_date`</span>,<span class="code-snippet__string">`order_type_name`</span>,<span class="code-snippet__string">`bondex_shy_flag`</span>,<span class="code-snippet__string">`is_server_item`</span>,<span class="code-snippet__string">`customer_code`</span>,<span class="code-snippet__string">`sales_code`</span>,<span class="code-snippet__string">`delivery_center_op_id`</span>,<span class="code-snippet__string">`pol_code`</span>,<span class="code-snippet__string">`pot_code`</span>,<span class="code-snippet__string">`port_of_dest_code`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">) <span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'changelog-producer'</span> = <span class="code-snippet__string">'full-compaction'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'changelog-producer.compaction-interval'</span> = <span class="code-snippet__string">'2m'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'merge-engine'</span> = <span class="code-snippet__string">'aggregation'</span>, <span class="code-snippet__comment">-- 使用 aggregation 聚合计算 sum</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'fields.sum_orderCount.aggregate-function'</span> = <span class="code-snippet__string">'sum'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'fields.create_date.ignore-retract'</span>=<span class="code-snippet__string">'true'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'fields.sales_name.ignore-retract'</span>=<span class="code-snippet__string">'true'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'fields.customer_name.ignore-retract'</span>=<span class="code-snippet__string">'true'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'snapshot.time-retained'</span> = <span class="code-snippet__string">'2h'</span>,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">'fields.delivery_center_op_name.ignore-retract'</span>=<span class="code-snippet__string">'true'</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 设置作业名</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SET</span> <span class="code-snippet__string">'pipeline.name'</span> = <span class="code-snippet__string">'dwm_business_order_count'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">INSERT</span> <span class="code-snippet__keyword">INTO</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">dwm.<span class="code-snippet__string">`dwm_business_order_count`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SELECT</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">YEAR</span>(o.<span class="code-snippet__string">`consignor_date`</span>) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`l_year`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,<span class="code-snippet__keyword">MONTH</span>(o.<span class="code-snippet__string">`consignor_date`</span>) <span class="code-snippet__keyword">AS</span> <span class="code-snippet__string">`l_month`</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">......,</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">,TO_TIMESTAMP(<span class="code-snippet__keyword">CONVERT_TZ</span>(<span class="code-snippet__keyword">cast</span>(<span class="code-snippet__keyword">CURRENT_TIMESTAMP</span> <span class="code-snippet__keyword">as</span> <span class="code-snippet__built_in">varchar</span>), <span class="code-snippet__string">'UTC'</span>, <span class="code-snippet__string">'Asia/Shanghai'</span>)) <span class="code-snippet__keyword">AS</span> create_date</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">FROM</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">dwd.<span class="code-snippet__string">`dwd_business_order`</span> o</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink UI效果如下dwd_business_orders数据聚合写到dwm_business_order_count：</span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="3.3461538461538463" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/17_e7B0TrRTwYULgmGbrd0bFSWGZfHQlw.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfr2dmDUSC97HPHIr8oZS7sM5UBe7B0TrRTwYULgmGbrd0bFSWGZfHQlw/640?wx_fmt=png'" data-type="png" data-w="260" style="width: 260px;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><span style="">4.<span style="white-space:pre-wrap;">	</span>将dwm层数据聚合到dws层中，dws层是做了更小维度的汇总</span></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><span style=""><br  /></span></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 创建根据操作人、业务类型聚合当天的单量</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TABLE</span> <span class="code-snippet__keyword">IF</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">EXISTS</span> dws.<span class="code-snippet__string">`dws_business_order_count_op`</span> (</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">`l_year`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'统计年'</span>,</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">`l_month`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'统计月'</span>,</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">`l_date`</span> <span class="code-snippet__built_in">DATE</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span>  <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'统计日期'</span>,</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">`order_type_name`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'业务分类'</span>,</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">`delivery_center_op_id`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">50</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'交付编号'</span>,</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">`delivery_center_op_name`</span> <span class="code-snippet__built_in">varchar</span>(<span class="code-snippet__number">200</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'交付名称'</span>,</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">`sum_orderCount`</span> <span class="code-snippet__built_in">BIGINT</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'订单数'</span>,</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">`create_date`</span> <span class="code-snippet__built_in">timestamp</span> <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__literal">NULL</span> <span class="code-snippet__keyword">COMMENT</span> <span class="code-snippet__string">'创建时间'</span>,</span></code><code><span class="code-snippet_outer">  PRIMARY <span class="code-snippet__keyword">KEY</span> (<span class="code-snippet__string">`l_year`</span>, <span class="code-snippet__string">`l_month`</span>,<span class="code-snippet__string">`l_date`</span>,<span class="code-snippet__string">`order_type_name`</span>,<span class="code-snippet__string">`delivery_center_op_id`</span>) <span class="code-snippet__keyword">NOT</span> <span class="code-snippet__keyword">ENFORCED</span></span></code><code><span class="code-snippet_outer">) <span class="code-snippet__keyword">WITH</span> (</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'merge-engine'</span> = <span class="code-snippet__string">'aggregation'</span>, <span class="code-snippet__comment">-- 使用 aggregation 聚合计算 sum</span></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'fields.sum_orderCount.aggregate-function'</span> = <span class="code-snippet__string">'sum'</span>,</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'fields.create_date.ignore-retract'</span>=<span class="code-snippet__string">'true'</span>,</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'snapshot.time-retained'</span> = <span class="code-snippet__string">'2h'</span>,</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__string">'fields.delivery_center_op_name.ignore-retract'</span>=<span class="code-snippet__string">'true'</span></span></code><code><span class="code-snippet_outer">);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">-- 设置作业名</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SET</span> <span class="code-snippet__string">'pipeline.name'</span> = <span class="code-snippet__string">'dws_business_order_count_op'</span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">INSERT</span> <span class="code-snippet__keyword">INTO</span></span></code><code><span class="code-snippet_outer">  dws.<span class="code-snippet__string">`dws_business_order_count_op`</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">SELECT</span></span></code><code><span class="code-snippet_outer">  o.<span class="code-snippet__string">`l_year`</span></span></code><code><span class="code-snippet_outer">  ,o.<span class="code-snippet__string">`l_month`</span></span></code><code><span class="code-snippet_outer">  ,o.<span class="code-snippet__string">`l_date`</span></span></code><code><span class="code-snippet_outer">  ,o.<span class="code-snippet__string">`order_type_name`</span></span></code><code><span class="code-snippet_outer">  ,o.<span class="code-snippet__string">`delivery_center_op_id`</span></span></code><code><span class="code-snippet_outer">  ,o.<span class="code-snippet__string">`delivery_center_op_name`</span></span></code><code><span class="code-snippet_outer">  ,o.<span class="code-snippet__string">`sum_orderCount`</span></span></code><code><span class="code-snippet_outer">  ,TO_TIMESTAMP(<span class="code-snippet__keyword">CONVERT_TZ</span>(<span class="code-snippet__keyword">cast</span>(<span class="code-snippet__keyword">CURRENT_TIMESTAMP</span> <span class="code-snippet__keyword">as</span> <span class="code-snippet__built_in">varchar</span>), <span class="code-snippet__string">'UTC'</span>, <span class="code-snippet__string">'Asia/Shanghai'</span>)) <span class="code-snippet__keyword">AS</span> create_date</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">FROM</span></span></code><code><span class="code-snippet_outer">  dwm.<span class="code-snippet__string">`dwm_business_order_count`</span> o</span></code><code><span class="code-snippet_outer">;</span></code><code><span class="code-snippet_outer"><br  /></span></code></pre></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><span style=""></span></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink UI效果如下 dws_business_order_count_op数据写到dws_business_order_count_op：</span><o:p></o:p></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="3.296875" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/18_iaXjMicQCFvFSl09yiaufxyU44RtYg.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrO22KiaNN61CBu5dYKGsZWbdeoUfoiaXjMicQCFvFSl09yiaufxyU44RtYg/640?wx_fmt=png'" data-type="png" data-w="256" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">总体数据流转示例</span><o:p></o:p></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-backh="304" data-backw="578" data-galleryid="" data-ratio="0.5252525252525253" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/19_ibPt0hhia5Hn8Z9El6rDXTLGoSpiaw.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfricn9ic8fZrjWU3SGAg4S0tWxwHa4ZibPt0hhia5Hn8Z9El6rDXTLGoSpiaw/640?wx_fmt=png'" data-type="png" data-w="792" style="width: 100%;height: auto;"  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">源表：</span><o:p></o:p></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.09343434343434344" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/20_ashMN6oQYQ3pr1WHFpQQJiaMFbc5lQ.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfr3F7stTpPNHqkZGPl5p5cGSn0wiashMN6oQYQ3pr1WHFpQQJiaMFbc5lQ/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">paimon-ods:</span><o:p></o:p></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.08838383838383838" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/21_iatj1OE8oNx2DMkMBPzFNjppqxZWJA.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrPwjZibxnH75vJU26iaLrFgb9zL3iatj1OE8oNx2DMkMBPzFNjppqxZWJA/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">paimon-dwd:</span><o:p></o:p></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.08838383838383838" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/22_tRJFnGS2VzzBWuhnlPDAuObExR2Sfw.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrA9XvhqHnRJwqHYtibo1IDeib8OtRJFnGS2VzzBWuhnlPDAuObExR2Sfw/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">paimon-dwm:</span><o:p></o:p></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.03787878787878788" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/23_iaAZJpOv44ibCiatSxTmpICxSdCUjg.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrlJ4jFKACJZwERMH8yibLmeLloguTiaAZJpOv44ibCiatSxTmpICxSdCUjg/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">paimon-dws:</span><o:p></o:p></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.05303030303030303" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/24_eVuQB9MT6N4Lqf9DkMoRKRetBySojg.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfribh348f5FVbMyogV5iasXHKddoeVuQB9MT6N4Lqf9DkMoRKRetBySojg/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">特别提醒sqlserver数据库抽取时如果源表数据量过大全量抽取会锁表，建议在业务允许的情况下采用增量抽取。对于全量抽取sqlserver可以采用中转的方式sqlserver全量数据导入到mysql，从mysql再到paimon-ods,后面再通过sqlserever做增量抽取。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><section style="font-size: 16px;"><section style="text-align: center;justify-content: center;margin: 10px 0% -35px;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><section style="display: inline-block;width: auto;vertical-align: top;min-width: 10%;flex: 0 0 auto;height: auto;padding: 17px 10px;align-self: flex-start;"><section style="justify-content: center;transform: translate3d(-1px, 0px, 0px);display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><section style="display: inline-block;width: 100%;vertical-align: top;box-shadow: rgb(0, 0, 0) 0px 0px 0px;align-self: flex-start;flex: 0 0 auto;"><section style="transform: translate3d(1px, 0px, 0px);" powered-by="xiumi.us"><section style="color: rgb(0, 0, 0);font-size: 26px;line-height: 1;letter-spacing: 0px;padding-right: 10px;padding-left: 10px;"><p><span style="background-color: rgba(255, 255, 255, 0);"><strong>04</strong></span></p></section></section></section></section></section></section><section style="margin: 15px 0% 20px;display: flex;flex-flow: row nowrap;text-align: center;justify-content: center;" powered-by="xiumi.us"><section style="display: inline-block;width: auto;vertical-align: top;border-style: solid;border-width: 0px 2px;border-color: rgb(0, 0, 0);padding-right: 10px;padding-left: 10px;align-self: flex-start;flex: 0 0 auto;min-width: 10%;height: auto;z-index: auto;"><section style="margin: -6px 0% 8px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section><section style="font-size: 17px;color: rgb(0, 0, 0);line-height: 1.8;letter-spacing: 0px;text-align: justify;" powered-by="xiumi.us"><p style="text-wrap: wrap;"><strong>问题排查分析</strong></p></section><section style="margin: 8px 0% -6px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section></section></section></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;font-size: 16px;color: rgb(216, 78, 106);">1. 聚合数据计算不准</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">sqlserver cdc 采集数据到 paimon 表</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">说明：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">dwd 表：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">'changelog-producer' = 'input'</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">ads 表：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">'merge-engine' = 'aggregation', &nbsp; -- 使用 aggregation 聚合计算 sum</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">'fields.sum_amount.aggregate-function' = 'sum'</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">ADS 层聚合表采用 agg sum 会出现 dwd 数据流不产生 update_before，产生错误数据流 update_after &nbsp;比如上游源表 update 10 到 30&nbsp; dwd 层数据会变更为 30，ads 聚合层数据也会变更为 30，但是现在变为了 append 数据变成了 10+30=40 的错误数据。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">解决办法：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">By specifying 'changelog-producer' = 'full-compaction', Table Store will compare the results between full compactions and produce the differences as changelog. The latency of changelog is affected by the frequency of full compactions.</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">By specifying changelog-producer.compaction-interval table property (default value 30min), users can define the maximum interval between two full compactions to ensure latency. This table property does not affect normal compactions and they may still be performed once in a while by writers to reduce reader costs.</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">这样能解决上述问题。但是随之而来出现了新的问题。默认 changelog-producer.compaction-interval 是 30min，意味着 上游的改动到 ads 查询要间隔 30min，生产过程中发现将压缩间隔时间改成 1min 或者 2 分钟的情况下，又会出现上述 ADS 层聚合数据不准的情况。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">'changelog-producer.compaction-interval' = '2m'</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">需要在写入 Flink Table Store 时需要配置 table.exec.sink.upsert-materialize= none，避免产生 Upsert 流，以保证 Flink Table Store 中能够保存完整的 changelog，为后续的流读操作做准备。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">set 'table.exec.sink.upsert-materialize' = 'none'</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;font-size: 16px;color: rgb(216, 78, 106);">2. 相同 sequence.field 导致 dwd 明细宽表无法收到 update 数据更新</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;font-size: 16px;color: rgb(216, 78, 106);">mysql cdc 采集数据到 paimon 表</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">说明：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在 MySQL 源端执行 update</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">数据修改成功后，dwd_orders 表数据能同步成功</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5176767676767676" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/25_8ib13DHJ3hNQpvzd4WJuHrv8LOP33w.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfr5siaBOADKJ70NkPRsyG2SNB7zd8ib13DHJ3hNQpvzd4WJuHrv8LOP33w/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">但是查看 dwd_enriched_orders 表数据无法同步，启动流模式查看数据，发现没有数据流向</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.33080808080808083" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/26_R7xW1aNKSTCUCaJibS1C8bjxgYaXQA.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrcZAUnic24AW8saoqMEEYt2nPrER7xW1aNKSTCUCaJibS1C8bjxgYaXQA/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">解决：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">排查发现是由于配置了参数&nbsp;'sequence.field' = 'o_orderdate'（使用 o_orderdate 生成 sequence id，相同主键合并时选择 sequence id 更大的记录）导致的，因为在修改价格的时候 o_orderdate 字段时间不变，&nbsp;继而'sequence.field' 是相同的，导致顺序不确定，所以 ROW1 和 ROW2，它们的 o_orderdate 是一样的，所以在更新时会随机选择，所有将该参数去掉即可，去掉后正常按照输入的先后顺序，自动生成一个 sequence number，不会影响同步结果。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;font-size: 16px;color: rgb(216, 78, 106);">3. Aggregate function 'last_non_null_value' does not support retraction</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">报错：Caused by: java.lang.UnsupportedOperationException: Aggregate function 'last_non_null_value' does not support retraction, If you allow this function to ignore retraction messages, you can configure 'fields.${field_name}.ignore-retract'='true'.</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">可以在官方文档找到解释：</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Only sum supports retraction (UPDATE_BEFORE and DELETE), others aggregate functions do not support retraction.</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">可以理解为：除了 SUM 函数，其他的 Agg 函数都不支持 Retraction，为了避免接收到 DELETE 和 UPDATEBEFORE 消息报错，需要通过给指定字段配'fields.${field_name}.ignore-retract'='true' 忽略，解决这个报错</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">WITH (</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"> 'merge-engine' = 'aggregation', -- 使用 aggregation 聚合计算 sum</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"> 'fields.sum_orderCount.aggregate-function' = 'sum',</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"> 'fields.create_date.ignore-retract'='true'&nbsp; #create_date 字段</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">);</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;font-size: 16px;color: rgb(216, 78, 106);">4. paimon任务中断失败</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">任务异常中断 导致pod挂掉</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">查看loki日志显示akka.pattern.AskTimeoutException: Ask timed out on</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.2676767676767677" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/27_L9TEFxibfpibwkQeZuVPMLH1iaMUKA.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrefpNVE6an5gtMib5WOpmNu0DkK1BL9TEFxibfpibwkQeZuVPMLH1iaMUKA/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">java.util.concurrent.TimeoutException: Invocation of [RemoteRpcInvocation(JobMasterGateway.updateTaskExecutionState(TaskExecutionState))] at recipient [akka.tcp://flink@fts-business-order-count.streamx:6123/user/rpc/jobmanager_2] timed out. This is usually caused by: 1) Akka failed sending the message silently, due to problems like oversized payload or serialization failures. In that case, you should find detailed error information in the logs. 2) The recipient needs more time for responding, due to problems like slow machines or network jitters. In that case, you can try to increase akka.ask.timeout.\n"</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">初步判断应该是由于以上2个原因导致触发了akka的超时机制，那就调整集群的akka超时间配置和进行单个任务拆分或者调大资源配置。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">我们这边先看如何进行参数修改:</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><table cellspacing="0" cellpadding="0" width="550"><tbody><tr style="height: 22.5pt;"><td width="138" valign="top" style="border-width: 1pt;border-color: windowtext;padding: 0cm 0.5pt;" height="22"><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">key</span><o:p></o:p></p></td><td width="137" valign="top" style="border-top-width: 1pt;border-top-color: windowtext;border-right-width: 1pt;border-right-color: windowtext;border-bottom-width: 1pt;border-bottom-color: windowtext;border-left: none;padding: 0cm 0.5pt;" height="22"><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">default</span><o:p></o:p></p></td><td width="137" valign="top" style="border-top-width: 1pt;border-top-color: windowtext;border-right-width: 1pt;border-right-color: windowtext;border-bottom-width: 1pt;border-bottom-color: windowtext;border-left: none;padding: 0cm 0.5pt;" height="22"><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">describe</span><o:p></o:p></p></td></tr><tr style="height: 22.5pt;"><td width="138" valign="top" style="border-right-width: 1pt;border-right-color: windowtext;border-bottom-width: 1pt;border-bottom-color: windowtext;border-left-width: 1pt;border-left-color: windowtext;border-top: none;padding: 0cm 0.5pt;" height="22"><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">akka.ask.timeout</span><o:p></o:p></p></td><td width="137" valign="top" style="border-top: none;border-left: none;border-bottom-width: 1pt;border-bottom-color: windowtext;border-right-width: 1pt;border-right-color: windowtext;padding: 0cm 0.5pt;" height="22"><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">10s</span><o:p></o:p></p></td><td width="137" valign="top" style="border-top: none;border-left: none;border-bottom-width: 1pt;border-bottom-color: windowtext;border-right-width: 1pt;border-right-color: windowtext;padding: 0cm 0.5pt;" height="22"><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Timeout used for all futures and blocking Akka calls. If Flink fails due to timeouts then you should try to increase this value. Timeouts can be caused by slow machines or a congested network. The timeout value requires a time-unit specifier (ms/s/min/h/d).</span><o:p></o:p></p></td></tr><tr style="height: 22.5pt;"><td width="138" valign="top" style="border-right-width: 1pt;border-right-color: windowtext;border-bottom-width: 1pt;border-bottom-color: windowtext;border-left-width: 1pt;border-left-color: windowtext;border-top: none;padding: 0cm 0.5pt;" height="22"><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">web.timeout</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">&nbsp;</span></p></td><td width="137" valign="top" style="border-top: none;border-left: none;border-bottom-width: 1pt;border-bottom-color: windowtext;border-right-width: 1pt;border-right-color: windowtext;padding: 0cm 0.5pt;" height="22"><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">600000</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">&nbsp;</span></p></td><td width="137" valign="top" style="border-top: none;border-left: none;border-bottom-width: 1pt;border-bottom-color: windowtext;border-right-width: 1pt;border-right-color: windowtext;padding: 0cm 0.5pt;" height="22"><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Timeout for asynchronous operations by the web monitor in milliseconds.</span><o:p></o:p></p></td></tr></tbody></table><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在conf/flink-conf.yaml最后增加下面参数</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">akka.ask.timeout: 100s</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">web.timeout:1000000</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">然后在streampark手动刷新下flink-conf.yaml验证参数是否同步成功。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="letter-spacing: 0.5px;font-size: 16px;color: rgb(216, 78, 106);">5. sn</span><span style="letter-spacing: 0.5px;font-size: 16px;color: rgb(216, 78, 106);">apshot no such file or director</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">发现cp出现失败情况</span><o:p></o:p></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.6136363636363636" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/28_SdoSzszURo116bq45BPe7YyEexho3g.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrMI3zkiaZCNt2ia4AFUU5S6BbIJSdoSzszURo116bq45BPe7YyEexho3g/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.29292929292929293" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/29_PEpiavZPq6w5R6CMeAZNqq7sXa6eyg.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfriaIg6yIBzlooCfhibaZXicro6c6TPEpiavZPq6w5R6CMeAZNqq7sXa6eyg/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">对应时间点日志显示Snapshot丢失，任务显示为running状态，但是源表mysql数据无法写入paimon ods表</span><o:p></o:p></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.3333333333333333" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/30_bwiazQiaS6sxiaNzt0QiagMAicdbWQ.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrvOmhKicvchAk1Lt7eKNHv4SslLEJ79bwiazQiaS6sxiaNzt0QiagMAicdbWQ/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">定位cp失败原因为：计算量大，CPU密集性，导致TM内线程一直在processElement，而没有时间做CP</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">无法读取Snapshot原因为：flink集群资源不够，Writer和Committer产生竞争，Full-Compaction时读到了已过期部分的不完整的Snapshot，目前官方针对这个问题已经修复</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">https://github.com/apache/incubator-paimon/pull/1308</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.40404040404040403" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/31_ibkwZpSLSNtVotViakfGrBicZEYS2A.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrBoadibfTlVFRUA2Rt7DQCD5b4khUibkwZpSLSNtVotViakfGrBicZEYS2A/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><br  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">而解决cp失败的解决办法增加并行度，增加deploymenttaskmanager slot和jobmanager cpu</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">-D kubernetes.jobmanager.cpu=0.8</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">-D kubernetes.jobmanager.cpu.limit-factor=1</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">-D taskmanager.numberOfTaskSlots=8</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">-D jobmanager.adaptive-batch-scheduler.default-source-parallelism=2</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.22474747474747475" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/32_cekAiaxJ2V6R54DqhTlrk4SymyJp0g.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrJWUZPIQCC8ibTJD61JTa34FRNXcekAiaxJ2V6R54DqhTlrk4SymyJp0g/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.45202020202020204" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/33_HAicnAOIoPZvV0ynzFevXtjAicphCA.png" onerror="this.src='https://mmbiz.qpic.cn/sz_mmbiz_png/Tu25q5CsmvbZibK5ofFZFy2iaOLo9ichicfrYTDOlaEGLhDxXibJ7eAk0zCyPJnHAicnAOIoPZvV0ynzFevXtjAicphCA/640?wx_fmt=png'" data-type="png" data-w="792" style=""  /></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在复杂的实时任务中，可以通过修改动态参数的方式，增加资源。</span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><section style="font-size: 16px;"><section style="text-align: center;justify-content: center;margin: 10px 0% -35px;display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><section style="display: inline-block;width: auto;vertical-align: top;min-width: 10%;flex: 0 0 auto;height: auto;padding: 17px 10px;align-self: flex-start;"><section style="justify-content: center;transform: translate3d(-1px, 0px, 0px);display: flex;flex-flow: row nowrap;" powered-by="xiumi.us"><section style="display: inline-block;width: 100%;vertical-align: top;box-shadow: rgb(0, 0, 0) 0px 0px 0px;align-self: flex-start;flex: 0 0 auto;"><section style="transform: translate3d(1px, 0px, 0px);" powered-by="xiumi.us"><section style="color: rgb(0, 0, 0);font-size: 26px;line-height: 1;letter-spacing: 0px;padding-right: 10px;padding-left: 10px;"><p><span style="background-color: rgba(255, 255, 255, 0);"><strong>05</strong></span></p></section></section></section></section></section></section><section style="margin: 15px 0% 20px;display: flex;flex-flow: row nowrap;text-align: center;justify-content: center;" powered-by="xiumi.us"><section style="display: inline-block;width: auto;vertical-align: top;border-style: solid;border-width: 0px 2px;border-color: rgb(0, 0, 0);padding-right: 10px;padding-left: 10px;align-self: flex-start;flex: 0 0 auto;min-width: 10%;height: auto;z-index: auto;"><section style="margin: -6px 0% 8px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section><section style="font-size: 17px;color: rgb(0, 0, 0);line-height: 1.8;letter-spacing: 0px;text-align: justify;" powered-by="xiumi.us"><p style="text-wrap: wrap;"><strong>未来规划</strong></p></section><section style="margin: 8px 0% -6px;" powered-by="xiumi.us"><section style="background-color: rgb(0, 0, 0);height: 2px;"><svg viewbox="0 0 1 1" style="float:left;line-height:0;width:0;vertical-align:top;"></svg></section></section></section></section></section><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"></span><o:p></o:p></p><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">自建的数据平台bondata正在集成paimon的元数据信息、数据指标体系、血缘、一键pipline等功能，形成海程邦达的数据资产，并将在此基础上展开一站式数据治理</span></p></li><li><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">后面将基于trino Catalog接入Doris，实现真正的离线数据和实时数据的one service</span></p></li><li><p style="text-align: left;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;">采用doris+paimon的架构方案继续推进集团内部流批一体数仓建设的步伐</span></p></li></ul><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="margin: 0px;padding: 0px 10px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;line-height: 1.6;letter-spacing: 0.034em;color: rgb(63, 63, 63);font-size: 16px;"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0.476px;text-indent: 0px;text-transform: none;white-space: normal;word-spacing: 0px;text-size-adjust: auto;-webkit-text-stroke: 0px rgb(178, 178, 178);font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.25px;font-family: &quot;Helvetica Neue&quot;;text-align: center;color: rgb(178, 178, 178);background-color: rgb(255, 255, 255);line-height: 21.4375px;visibility: visible;"><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0.476px;text-indent: 0px;text-transform: none;white-space: normal;word-spacing: 0px;text-size-adjust: auto;-webkit-text-stroke: 0px rgb(178, 178, 178);font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.25px;font-family: &quot;Helvetica Neue&quot;;text-align: center;color: rgb(178, 178, 178);background-color: rgb(255, 255, 255);line-height: 21.4375px;visibility: visible;"><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;color: rgb(74, 74, 74);font-size: 15px;">如果这个文章对你有帮助，不要忘记&nbsp;</span><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;outline: 0px;font-size: 15px;color: rgb(255, 104, 39);"><strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「在看」</strong>&nbsp;<strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「点赞」</strong>&nbsp;<strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「收藏」</strong></span><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;color: rgb(74, 74, 74);font-size: 15px;">&nbsp;三连啊喂！</span><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="1.215625" data-s="300,640" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/34_jNJdvwuULcOtMEU3DFFESPHpbU8Hdg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PDwSDUx452DKyaUxtxDoz47He3aCnMeSE9wLtZJwcdOFU6jNJdvwuULcOtMEU3DFFESPHpbU8Hdg/640?wx_fmt=png'" data-type="png" data-w="640" style="width: 241px;height: 293px;"  /></p><p style="margin: 0px 0px 0em;padding: 0px;clear: both;min-height: 1em;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;text-align: center;"><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;background-color: rgb(255, 255, 255);color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;"></span></p></section></section><section style="margin: 0px;padding: 0px;max-width: 100%;color: rgb(51, 51, 51);font-family: mp-quote, -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: normal;orphans: 2;text-align: justify;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.10979228486646884" src="图片/大数据技术与架构_2023-07-04_「转」基于Apache Paimon实现流式数仓实践/35_zrkyKUN5kNeUFicVC3bMP1GEqKz1OQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/BSBqCXrZtzAicMToibKuIysLrB62M5A5YaLhZg6z86tI7ZeEZqTLLYyNrmlzrkyKUN5kNeUFicVC3bMP1GEqKz1OQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1011" style="margin: 0px;padding: 0px;max-width: 100%;height: 42px;overflow-wrap: break-word !important;vertical-align: bottom;color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);box-sizing: border-box;width: 384px;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247510040&amp;idx=1&amp;sn=aa335f25965975731173916f012d56f4&amp;chksm=fd3eee8dca49679b82f632048fb64d21fac01497d1a0fe33917edb01e194caf0f9a1930a55ce&amp;scene=21#wechat_redirect" textvalue="2022年全网首发|大数据专家级技能模型与学习指南(胜天半子篇)" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">2022年全网首发|大数据专家级技能模型与学习指南(胜天半子篇)</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247508317&amp;idx=1&amp;sn=0bcb7fb6997b42306994b890eaa0d47f&amp;chksm=fd3ee7c8ca496ede347a2971002c6ea68dcfd70abeeb90b43c8b02a2a60ebc7cec3a87ef7d52&amp;scene=21#wechat_redirect" textvalue="互联网最坏的时代可能真的来了" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">互联网最坏的时代可能真的来了</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247507860&amp;idx=1&amp;sn=807ac5003762f29c127bc4071dcebe33&amp;chksm=fd3e9901ca4910178cfc816043ea86c29f881f70cd943d252de9ae2e21cb7e8ba80bff162e1b&amp;scene=21#wechat_redirect" textvalue="我在B站读大学，大数据专业" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">我在B站读大学，大数据专业</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247499604&amp;idx=1&amp;sn=d938dfb30d221774704982d2938b30c1&amp;chksm=fd3eb9c1ca4930d76a391241333de461ca22d2aa27472eab3cffab1564872ae37f1b48fe2d3c&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我们在学习Flink的时候，到底在学习什么？</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504856&amp;idx=2&amp;sn=6f62e2a0c756ce56773eed253d2f41ee&amp;chksm=fd3e954dca491c5b732b7e2aa46db32efbc3f690e528522098659bb3c6e78e1582ab4529b5dc&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">193篇文章暴揍Flink，这个合集你需要关注一下</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504742&amp;idx=1&amp;sn=8765c198d8ad66219a7bcabb221e4a23&amp;chksm=fd3e95f3ca491ce52d0724b9e4154a47af0f5ea349e1e184c8fbc65aa17c0000242aa9b58429&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">Flink生产环境TOP难题与优化，阿里巴巴藏经阁YYDS</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504813&amp;idx=1&amp;sn=f5cd6ae2aa2b1e30f87a5ae55971c514&amp;chksm=fd3e9538ca491c2eb191677d070f2c7e4f1098eece00e256d6205b8a5d21b21c1e74f875f16f&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">Flink CDC我吃定了耶稣也留不住他！| Flink CDC线上问题小盘点</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=1&amp;sn=1f693e549f76622725b936041ff8896e&amp;chksm=e9bff2fbdec87bedecbdeed4547d7d612c72fc8d4918614a26a4e31666cf0128fd57b537f347&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我们在学习Spark的时候，到底在学习什么？</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504834&amp;idx=1&amp;sn=46ca1a3924b8fdb89ac1c2acb0319d6c&amp;chksm=fd3e9557ca491c41d837b917639ea62007ea16d3c2cc6c0c02d1f8a8c6e44318f5183b787c46&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">在所有Spark模块中，我愿称SparkSQL为最强！</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247502750&amp;idx=1&amp;sn=bd9a9173d060dc4e4ebd49c8efc6acfe&amp;chksm=fd3e8d0bca49041dea84da93910e5efdc4935e520525c09887c986691377aeb48e5cf7fb5667&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">硬刚Hive | 4万字基础调优面试小总结</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504382&amp;idx=2&amp;sn=550b78802acfe727e0e77cd9195f8784&amp;chksm=fd3e976bca491e7db2b8b2446d231736df01bbf13653804d680ac4390597ec17fa466ad4ae83&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">数据治理方法论和实践小百科全书</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503741&amp;idx=1&amp;sn=e5039be93123f2e337013756a818bfc3&amp;chksm=fd3e89e8ca4900fe603b63c5722a6fb8a32bd63d6ba23e0028851948a71b877eb1f742d95087&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">标签体系下的用户画像建设小指南</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503675&amp;idx=1&amp;sn=3ee6af64d0126c78b48cad219308f81e&amp;chksm=fd3e89aeca4900b8b8954e9569ee3c0877881fac8c792bfafc22e7e9d3e8524da8eb860d33d8&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">4万字长文 | ClickHouse基础&amp;实践&amp;调优全视角解析</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=2&amp;sn=57ecc77718f1b6f2f262d62e8318dcc9&amp;chksm=e9bff2fbdec87bedb1986765bfae7dbabb9aece45b0b2af147bbad1ac5d79ebc934c64df40ea&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">【面试&amp;个人成长】2021年过半，社招和校招的经验之谈</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504478&amp;idx=1&amp;sn=14efef3868ba42bd044f9618745a7fdc&amp;chksm=fd3e94cbca491dddb961b7b8b93105b2869c5bcf4c03f9f0dc83ad62be0dce4c124b52ed0ba3&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">大数据方向另一个十年开启 |《硬刚系列》第一版完结</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504410&amp;idx=1&amp;sn=7e81ab5a324395eb0f12397c40247ca1&amp;chksm=fd3e948fca491d9946456acbd93b2d651ae4d7a7d0127a211981e08f50f377e60d1b7c0d7b3a&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我写过的关于成长/面试/职场进阶的文章</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504783&amp;idx=1&amp;sn=72aed147a459368ed934a007a2df3bc9&amp;chksm=fd3e951aca491c0cade212390011eca7d8a68951fee6aa2844b8f4d14bcbd5b3ed26305d69dc&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">当我们在学习Hive的时候在学习什么？「硬刚Hive续集」</a></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p></content>
</div>
</body>
</html>