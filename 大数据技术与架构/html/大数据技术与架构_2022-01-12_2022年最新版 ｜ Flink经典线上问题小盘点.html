<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"大数据技术与架构","title":"2022年最新版 | Flink经典线上问题小盘点","time":"2022-01-12 23:25:37","timeStamp":"1642001137"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&mid=2247510155&idx=1&sn=7b6da7b924921f0d355f93a58330d7e0&chksm=fd3eee1eca496708dd9c73ee279c801c615d59cb3a9d31bca326be9b472ff2fa1d19dc31e541#rd" target="_blank">2022年最新版 | Flink经典线上问题小盘点</a></h1><div id="meta_content" class="rich_media_meta_list"><span id="copyright_logo" class="wx_tap_link js_wx_tap_highlight rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_text">群主王知无&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">大数据技术与架构&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2022-01-12 23:25:37</em></div><content><div class="topic"><p>收录于话题</p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU3MzgwNTU2Mg==&action=getalbum&album_id=1369031183400747008#wechat_redirect" title="大数据成神之路" target="_blank">#大数据成神之路</a><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU3MzgwNTU2Mg==&action=getalbum&album_id=1689254476517294082#wechat_redirect" title="Flink" target="_blank">#Flink</a></p></div><section style="max-width: 100%;color: rgb(178, 178, 178);outline: 0px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 14px;line-height: normal;font-family: &quot;Helvetica Neue&quot;;-webkit-text-stroke-color: rgb(178, 178, 178);text-align: center;background-color: rgb(255, 255, 255);margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;" data-mpa-powered-by="yiban.io"><span style="max-width: 100%;outline: 0px;font-kerning: none;overflow-wrap: break-word !important;box-sizing: border-box !important;">点击上方</span><strong style="max-width: 100%;outline: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 100%;outline: 0px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 15px;line-height: normal;font-kerning: none;color: rgb(87, 107, 148);-webkit-text-stroke-color: rgb(87, 107, 148);overflow-wrap: break-word !important;box-sizing: border-box !important;">蓝色字体</span></strong><span style="max-width: 100%;outline: 0px;font-kerning: none;overflow-wrap: break-word !important;box-sizing: border-box !important;">，选择“设为星标”</span></section><section style="max-width: 100%;color: rgb(178, 178, 178);outline: 0px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 14px;line-height: normal;font-family: &quot;Helvetica Neue&quot;;-webkit-text-stroke-color: rgb(178, 178, 178);text-align: center;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 100%;outline: 0px;font-kerning: none;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;box-sizing: border-box !important;">回复”</span><strong style="max-width: 100%;outline: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 100%;outline: 0px;font-kerning: none;background-color: rgb(255, 255, 255);color: rgb(255, 0, 0);overflow-wrap: break-word !important;box-sizing: border-box !important;">面试</span></strong><span style="max-width: 100%;outline: 0px;font-kerning: none;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;box-sizing: border-box !important;">“获取更多惊喜</span></section><section style="max-width: 100%;color: rgb(178, 178, 178);outline: 0px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 14px;line-height: normal;font-family: &quot;Helvetica Neue&quot;;-webkit-text-stroke-color: rgb(178, 178, 178);text-align: center;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 100%;outline: 0px;font-kerning: none;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.0625" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/1_TMnLIpBq96wT1ibdccSSd3LVdSE3LQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/sq2uE6cicHYxoldXibjHyWbvjJfI6ibEm5Kw715uVJTBLdX1gkVpExwlFh22TMnLIpBq96wT1ibdccSSd3LVdSE3LQ/640?wx_fmt=png'" data-type="png" data-w="640" style="outline: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;width: 640px !important;visibility: visible !important;"  /></span></section><blockquote style="margin-top: 20px;margin-bottom: 20px;padding: 15px 20px;border-left-color: rgb(53, 179, 120);color: rgb(106, 115, 125);line-height: 27px;font-size: 0.9em;max-width: 100%;border-top: none;border-right: none;border-bottom: none;overflow: auto;background: rgb(251, 249, 253);letter-spacing: 0.544px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;font-size: 15px;line-height: 26px;color: rgb(89, 89, 89);margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;text-align: left;"><span style="max-width: 100%;font-size: 14px;overflow-wrap: break-word !important;box-sizing: border-box !important;">本文已经加入「大数据成神之路PDF版」中提供下载。<br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /><strong>你可以关注公众号，后台回复：</strong></span><span style="color: rgb(255, 76, 65);max-width: 100%;font-size: 14px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><strong style="max-width: 100%;color: rgb(74, 74, 74);line-height: 1.75em;overflow-wrap: break-word !important;box-sizing: border-box !important;">「</strong><strong>PDF</strong><strong style="max-width: 100%;color: rgb(74, 74, 74);line-height: 1.75em;overflow-wrap: break-word !important;box-sizing: border-box !important;">」</strong>&nbsp;</span><strong><span style="max-width: 100%;font-size: 14px;overflow-wrap: break-word !important;box-sizing: border-box !important;">即可获取。</span></strong></section></blockquote><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="padding-right: 10px;padding-left: 10px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;line-height: 1.6;letter-spacing: 0.034em;color: rgb(63, 63, 63);font-size: 16px;"><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">2020年和2021年分别写了很多篇类似的文章，这篇文章是关于Flink生产环境中遇到的各种问题的汇总。</p><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;background: rgb(251, 249, 253);color: rgb(106, 115, 125);margin-bottom: 20px;margin-top: 20px;padding: 15px 20px;line-height: 27px;border-left-color: rgb(53, 179, 120);"><p style="line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);">这个版本在Flink新版本的基础上梳理了一个更加完整的版本。</p><p style="line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);">新增了一些Flink CDC和大作业的启停已经数据缺失的问题。</p></blockquote><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果你遇到过一些共性的问题，希望对你有帮助。<span style="letter-spacing: 0.034em;">本文参考了我在查问题中找到的网上的资源和一些博客。</span></p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>如何规划生产中的集群大小？<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">第一步是仔细考虑应用程序的运维指标，以达到所需资源的基线。需要考虑的关键指标是：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">每秒记录数和每条记录的大小</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">已有的不同键（key）的数量和每个键对应的状态大小</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">状态更新的次数和状态后端的访问模式</section></li></ul><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">最后，一个更实际的问题是与客户之间围绕停机时间、延迟和最大吞吐量的服务级别协议(SLA)，因为这些直接影响容量规划。接下来，根据预算，看看有什么可用的资源。例如：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">网络容量，同时把使用网络的外部服务也纳入考虑，如 Kafka、HDFS 等。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">磁盘带宽，如果您依赖于基于磁盘的状态后端，如 RocksDB（并考虑其他磁
盘使用，如 Kafka 或 HDFS）</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">可用的机器数量、CPU 和内存</section></li></ul><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>Flink CheckPoint问题如何排查？<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Flink 的 Checkpoint 包括如下几个部分：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.5462962962962963" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/2_ic9vgLNQxKV4EM2CUe0dDDgKp13Sjg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCu9bIW8QCHxI4x5ibicLIZyxuIaiaMic9vgLNQxKV4EM2CUe0dDDgKp13Sjg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">JM trigger checkpoint</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Source 收到 trigger checkpoint 的 PRC，自己开始做 snapshot，并往下游发送 barrier</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">下游接收 barrier（需要 barrier 都到齐才会开始做 checkpoint）</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Task 开始同步阶段 snapshot</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Task 开始异步阶段 snapshot</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Task snapshot 完成，汇报给 JM</section></li></ul><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">上面的任何一个步骤不成功，整个 checkpoint 都会失败。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Checkpoint问题可以分为下面几个大类：</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">Checkpoint失败</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">假如我们在 Checkpoint 界面看到如下图所示，下图中 Checkpoint 10423 失败了。点击Checkpoint10423 的详情，我们可以看到类系下图所示的表格。</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.30277777777777776" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/3_GsvmRB5I2Wh3nSyGUkoBicjrvHicAA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuNQrwAguf0f3JKIekOiapT62ibBZQGsvmRB5I2Wh3nSyGUkoBicjrvHicAA/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.8444444444444444" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/4_r84d0n5WJAFNib20vrBqXP2TI3kJtg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuibQ1MLh6mXlqEq9YpQe6Q9YibSQr84d0n5WJAFNib20vrBqXP2TI3kJtg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Checkpoint 失败大致分为两种情况：Checkpoint Decline 和 CheckpointExpire。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Checkpoint Decline发生时我们可以在日志汇总发现类似下面这样的日志：</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Decline checkpoint 10423 by task 0b60f08bf8984085b59f8d9bc74ce2e1 of job 85d268e6fbc19411185f7e4868a44178. 其中 10423 是 checkpointID，0b60f08bf8984085b59f8d9bc74ce2e1 是 execution id，85d268e6fbc19411185f7e4868a44178 是 job id，我们可以在 jobmanager.log 中查找 execution id，找到被调度到哪个 taskmanager 上，类似如下所示：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.32884615384615384" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/5_kDPIIzIDrEW3iaLcxbxtNEyQavbhzA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuBKeEPCccuBlH0iaLM1Bkib6FJibRkDPIIzIDrEW3iaLcxbxtNEyQavbhzA/640?wx_fmt=png'" data-type="png" data-w="1040" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">从上面的日志我们知道该 execution 被调度到 hostnameABCDE 的 container_e24_1566836790522_8088_04_013155_1 slot 上，接下来我们就可以到 container container_e24_1566836790522_8088_04_013155 的 taskmanager.log 中查找Checkpoint 失败的具体原因了。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">Checkpoint Expire</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果 Checkpoint 做的非常慢，超过了 timeout 还没有完成，则整个 Checkpoint 也会失败。当一个 Checkpoint 由于超时而失败是，会在 jobmanager.log 中看到如下的日志：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Checkpoint&nbsp;1&nbsp;of&nbsp;job&nbsp;85d268e6fbc19411185f7e4868a44178&nbsp;expired&nbsp;before&nbsp;completing.<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">表示 Chekpoint 1 由于超时而失败，这个时候可以可以看这个日志后面是否有类似下面的日志：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Received&nbsp;late&nbsp;message&nbsp;<span style="font-weight: bold;line-height: 26px;">for</span>&nbsp;now&nbsp;expired&nbsp;checkpoint&nbsp;attempt&nbsp;1&nbsp;from&nbsp;0b60f08bf8984085b59f8d9bc74ce2e1&nbsp;of&nbsp;job&nbsp;85d268e6fbc19411185f7e4868a44178.<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">我们就可以按照上面的方法找到对应的 taskmanager.log 查看具体信息。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">Checkpoint 慢</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Checkpoint 慢的情况如下：比如 Checkpoint interval 1 分钟，超时 10 分钟，Checkpoint 经常需要做 9 分钟（我们希望 1 分钟左右就能够做完），而且我们预期
state size 不是非常大。对于 Checkpoint 慢的情况，我们可以按照下面的顺序逐一检查。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Source Trigger Checkpoint 慢</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">使用增量 Checkpoint</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">作业存在反压或者数据倾斜</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Barrier 对齐慢</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">主线程太忙，导致没机会做 snapshot</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">同步阶段做的慢</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">异步阶段做的慢</section></li></ul><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>反压问题如何排查？<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">反压（backpressure）是实时计算应用开发中，特别是流式计算中，十分常见的问题。反压意味着数据管道中某个节点成为瓶颈，处理速率跟不上上游发送数据的速率，而需要对上游进行限速。由于实时计算应用通常使用消息队列来进行生产端和消费端的解耦，消费端数据源是 pull-based 的，所以反压通常是从某个节点传导至数据源并降低数据源（比如 Kafka consumer）的摄入速率。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">要解决反压首先要做的是定位到造成反压的节点，这主要有两种办法 :</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">通过 Flink Web UI 自带的反压监控面板</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">通过 Flink Task Metrics</section></li></ol><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Flink Web UI 的反压监控提供了 SubTask 级别的反压监控，原理是通过周期性对 Task 线程的栈信息采样，得到线程被阻塞在请求 Buffer（意味着被下游队列阻塞）的频率来判断该节点是否处于反压状态。默认配置下，这个频率在 0.1 以下则为OK，0.1 至 0.5 为 LOW，而超过 0.5 则为 HIGH。</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.7935185185185185" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/6_vPnH5GKfCiaX6SR98S8N4f2QXP4bLA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuMOPic9BAXHLLmsXeVyc2qViaz5avPnH5GKfCiaX6SR98S8N4f2QXP4bLA/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果处于反压状态，那么有两种可能性：</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">该节点的发送速率跟不上它的产生数据速率。这一般会发生在一条输入多条
输出的 Operator（比如 flatmap）。</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">下游的节点接受速率较慢，通过反压机制限制了该节点的发送速率。</p></section></li></ol><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果是第一种状况，那么该节点则为反压的根源节点，它是从 Source Task 到Sink Task 的第一个出现反压的节点。如果是第二种情况，则需要继续排查下游节点。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">值得注意的是，反压的根源节点并不一定会在反压面板体现出高反压，因为反压面板监控的是发送端，如果某个节点是性能瓶颈并不会导致它本身出现高反压，而是导致它的上游出现高反压。总体来看，如果我们找到第一个出现反压的节点，那么反压根源要么是就这个节点，要么是它紧接着的下游节点。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">此外，Flink 提供的 Task Metrics 是更好的反压监控手段，我们在监控反压时会用到的 Metrics 主要和 Channel 接受端的 Buffer 使用率有关，最为有用的是以下几个 Metrics:</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.2916666666666667" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/7_YkywDvWia2CNIHZ4YqNo2Bb6yu1c1g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuWKle74QZX2P144wZ6q6aIUfSYYkywDvWia2CNIHZ4YqNo2Bb6yu1c1g/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">分析反压的大致思路是：如果一个 Subtask 的发送端 Buffer 占用率很高，则表明它被下游反压限速了；如果一个 Subtask 的接受端 Buffer 占用很高，则表明它将反压传导至上游。反压情况可以根据以下表格进行对号入座：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.36018518518518516" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/8_DWtUZd7toe2PImxr6YoApiapU9Zn7Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuHJx0tvAm93dkhoic8tyL2Bb2oLDWtUZd7toe2PImxr6YoApiapU9Zn7Q/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">outPoolUsage 和 inPoolUsage 同为低或同为高分别表明当前 Subtask 正常或处于被下游反压，这应该没有太多疑问。而比较有趣的是当 outPoolUsage 和
inPoolUsage 表现不同时，这可能是出于反压传导的中间状态或者表明该 Subtask就是反压的根源。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果一个 Subtask 的 outPoolUsage 是高，通常是被下游 Task 所影响，所以可以排查它本身是反压根源的可能性。如果一个 Subtask 的 outPoolUsage 是低，但其 inPoolUsage 是高，则表明它有可能是反压的根源。因为通常反压会传导至其上游，导致上游某些 Subtask 的 outPoolUsage 为高，我们可以根据这点来进一步判断。值得注意的是，反压有时是短暂的且影响不大，比如来自某个 Channel 的短暂网络延迟或者 TaskManager 的正常 GC，这种情况下我们可以不用处理。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在实践中，<strong style="line-height: 1.75em;">很多情况下的反压是由于数据倾斜造成的</strong>，这点我们可以通过 Web UI 各个 SubTask 的 Records Sent 和 Record Received 来确认，另外 Checkpoint detail 里不同 SubTask 的 State size 也是一个分析数据倾斜的有用指标。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">此外，<strong style="line-height: 1.75em;">最常见的问题可能是用户代码的执行效率问题（频繁被阻塞或者性能问题）</strong>。最有用的办法就是对 TaskManager 进行 CPU profile，从中我们可以分析到Task Thread 是否跑满一个 CPU 核：如果是的话要分析 CPU 主要花费在哪些函数里面，比如我们生产环境中就偶尔遇到卡在 Regex 的用户函数（ReDoS）；如果不是的话要看 Task Thread 阻塞在哪里，可能是用户函数本身有些同步的调用，可能是checkpoint 或者 GC 等系统活动导致的暂时系统暂停。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">另外 TaskManager 的内存以及 GC 问题也可能会导致反压</strong>，包括 TaskManager JVM 各区内存不合理导致的频繁 Full GC 甚至失联。推荐可以通过给TaskManager 启用 G1 垃圾回收器来优化 GC，并加上 -XX:+PrintGCDetails 来打印 GC 日志的方式来观察 GC 的问题。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>客户端常见问题<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">应用提交控制台异常信息：Could not build the program from JAR file.</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">这个问题的迷惑性较大，很多时候并非指定运行的 JAR 文件问题，而是提交过程中发生了异常，需要根据日志信息进一步排查。最常见原因是未将依赖的 Hadoop JAR 文件加到 CLASSPATH，找不到依赖类（例如：ClassNotFoundException:org.apache.hadoop.yarn.exceptions.YarnException）导致加载客户端入口类(FlinkYarnSessionCli)失败。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">用户应用和框架 JAR 包版本冲突问题</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">该问题通常会抛出 NoSuchMethodError/ClassNotFoundException/IncompatibleClassChangeError 等异常，要解决此类问题：</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">首先需要根据异常类定位依赖库，然后可以在项目中执行 mvn dependency:tree 以树形结构展示全部依赖链，再从中定位冲突的依赖库，也可以增加参数 -Dincludes 指定要显示的包，格式为 [groupId]:[artifactId]:[-type]:[version]，支持匹配，多个用逗号分隔，例如：mvn dependency:tree-Dincludes=power,javaassist。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">定位冲突包后就要考虑如何排包，简单的方案是用 exclusion 来排除掉其从他依赖项目中传递过来的依赖，不过有的应用场景需要多版本共存，不同组件依赖不同版本，就要考虑用 Maven Shade 插件来解决，详情请参考Maven Shade Plugin。</section></li></ol><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">Flink 应用资源分配问题排查思路</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果 Flink 应用不能正常启动达到 RUNNING 状态，可以按以下步骤进行排查：</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">步骤1. 需要先检查应用当前状态</strong>，根据上述对启动流程的说明，我们知道：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">处于 NEW_SAVING 状态时正在进行应用信息持久化，如果持续处于这个状态我们需要检查 RM 状态存储服务（通常是 ZooKeeper 集群）是否正常；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">如果处于 SUBMITTED 状态，可能是 RM 内部发生一些 hold 读写锁的耗时操作导致事件堆积，需要根据 YARN 集群日志进一步定位.</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">如果处于 ACCEPTED 状态，需要先检查 AM 是否正常，跳转到步骤 2；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">如果已经是 RUNNING 状态，但是资源没有全部拿到导致 JOB 无法正常运行，跳转到步骤 3；</section></li></ul><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">步骤2. 检查 AM 是否正常</strong>，可以从 YARN 应用展示界面（http:// /cluster/app/）或YARN 应用 REST API（http:///ws/v1/cluster/apps/）查看 diagnostics 信
息，根据关键字信息明确问题原因与解决方案：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Queue’s AM resource limit exceeded. 原因是达到了队列 AM 可用资源上限，即队列的 AM 已使用资源和 AM 新申请资源之和超出了队列的AM 资源上限，可以适当调整队列 AM 可用资源百分比的配置项：yarn.scheduler.capacity..maximum-am-resource-percent。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">User’s AM resource limit exceeded. 原因是达到了应用所属用户在该队列的 AM 可用资源上限，即应用所属用户在该队列的 AM 已使用资源和 AM新申请资源之和超出了应用所属用户在该队列的 AM 资源上限，可以适当提高用户可用 AM 资源比例来解决该问题，相关配置项：yarn.scheduler.capacity..user-limit-factor 与 yarn.scheduler.capacity..minimum-user-limit-percent。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">AM container is launched, waiting for AM container to Register with RM. 大致原因是 AM 已启动，但内部初始化未完成，可能有 ZK 连接超时等问题，具体原因需排查 AM 日志，根据具体问题来解决。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Application is Activated, waiting for resources to be assigned for AM.该信息表示应用 AM 检查已经通过，正在等待调度器分配，此时需要进行调度器层面的资源检查，跳转到步骤 4。</section></li></ul><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">步骤3. 确认应用确实有 YARN 未能满足的资源请求</strong>：从应用列表页点击问题应用ID 进入应用页面，再点击下方列表的应用实例 ID 进入应用实例页面，看
Total Outstanding Resource Requests 列表中是否有 Pending 资源，如果没有，说明 YARN 已分配完毕，退出该检查流程，转去检查 AM；如果有，说明调度器未能完成分配，跳转到步骤 4。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">步骤4.调度器分配问题排查</strong>YARN-9050 支持在 WebUI 上或通过 REST API 自动诊断应用问题，将在 Hadoop3.3.0 发布，之前的版本仍需进行人工排查：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">检查集群或 queue 资源，scheduler 页面树状图叶子队列展开查看资源信息：Effective Max Resource、Used Resources：（1）检查集群资源或所在队列资源或其父队列资源是否已用完；（2）检查叶子队列某维度资源是否接近或达到上限；</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">检查是否存在资源碎片</strong>：（1）检查集群 Used 资源和 Reserved 资源之和占总资源的比例，当集群资源接近用满时（例如 90% 以上），可能存在资源碎片的情况，应用的分配速度就会受影响变慢，因为大部分机器都没有资源了，机器可用资源不足会被 reserve，reserved 资源达到一定规模后可能导致大部分机器资源被锁定，后续分配可能就会变慢；（2）检查 NM 可用资源分布情况，即使集群资源使用率不高，也有可能是因为各维度资源分布不同造成，例如 1/2 节点上的内存资源接近用满 CPU 资源剩余较多，1/2 节点上的 CPU 资源接近用满内存资源剩余较多，申请资源中某一维度资源值配置过大也可能造成无法申请到资源；</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">检查是否有高优先级的问题应用频繁申请并立即释放资源的问题</strong>，这种情况会造成调度器忙于满足这一个应用的资源请求而无暇顾及其他应用；</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">检查是否存在 Container 启动失败或刚启动就自动退出的情况</strong>，可以查看Container 日志 ( 包括 localize 日志、launch 日志等 )、YARN NM 日志或YARN RM 日志进行排查。</p></section></li></ul><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">TaskManager 启动异常</strong></p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">org.apache.hadoop.yarn.exceptions.YarnException:&nbsp;Unauthorized&nbsp;request&nbsp;to&nbsp;start&nbsp;container.&nbsp;This&nbsp;token&nbsp;is&nbsp;expired.&nbsp;current&nbsp;time&nbsp;is&nbsp;...&nbsp;found&nbsp;...<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">该异常在 Flink AM 向 YARN NM 申请启动 token 已超时的 Container 时抛出，通常原因是 Flink AM 从 YARN RM 收到这个 Container 很久之后（超过了Container 有效时间，默认 10 分钟，该 Container 已经被释放）才去启动它，进一步原因是 Flink 内部在收到 YARN RM 返回的 Container 资源后串行启动。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">当待启动的 Container 数量较多且分布式文件存储如 HDFS 性能较慢（启动前需上传 TaskManager配置）时 Container启动请求容易堆积在内部，FLINK-13184 对这个问题进行了优化，一是在启动前增加了有效性检查，避免了无意义的配置上传流程，二是进行了异步多线程优化，加快启动速度。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>PyFlink如何定义UDF<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在 Apache Flink 1.10 中我们有多种方式进行 UDF 的定义，比如：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Extend ScalarFunction, e.g.:</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">class&nbsp;HashCodeMean(ScalarFunction):<br  />&nbsp;def&nbsp;<span style="color: #0086b3;line-height: 26px;">eval</span>(self,&nbsp;i,&nbsp;j):<br  />&nbsp;<span style="color: #0086b3;line-height: 26px;">return</span>&nbsp;(<span style="color: #0086b3;line-height: 26px;">hash</span>(i)&nbsp;+&nbsp;<span style="color: #0086b3;line-height: 26px;">hash</span>(j))&nbsp;/&nbsp;2<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Lambda Functio</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">lambda&nbsp;i,&nbsp;j:&nbsp;(<span style="color: #0086b3;line-height: 26px;">hash</span>(i)&nbsp;+&nbsp;<span style="color: #0086b3;line-height: 26px;">hash</span>(j))&nbsp;/&nbsp;2<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Named Function</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">def&nbsp;hash_code_mean(i,&nbsp;j):<br  />&nbsp;<span style="color: #0086b3;line-height: 26px;">return</span>&nbsp;(<span style="color: #0086b3;line-height: 26px;">hash</span>(i)&nbsp;+&nbsp;<span style="color: #0086b3;line-height: 26px;">hash</span>(j))&nbsp;/&nbsp;2<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Callable Function</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">class&nbsp;CallableHashCodeMean(object):<br  />&nbsp;def&nbsp;__call__(self,&nbsp;i,&nbsp;j):<br  />&nbsp;<span style="color: #0086b3;line-height: 26px;">return</span>&nbsp;(<span style="color: #0086b3;line-height: 26px;">hash</span>(i)&nbsp;+&nbsp;<span style="color: #0086b3;line-height: 26px;">hash</span>(j))&nbsp;/&nbsp;2<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">现上面定义函数除了第一个扩展 ScalaFunction 的方式是 PyFlink 特有的，其他方式都是 Python 语言本身就支持的，也就是说，在 Apache Flink 1.10中PyFlink 允许以任何 Python 语言所支持的方式定义 UDF。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">那么定义完 UDF 我们应该怎样使用呢？Apache Flink 1.10 中提供了2种Decorators，如下：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Decorators - udf(), e.g. :</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">udf(lambda&nbsp;i,&nbsp;j:&nbsp;(<span style="color: #0086b3;line-height: 26px;">hash</span>(i)&nbsp;+&nbsp;<span style="color: #0086b3;line-height: 26px;">hash</span>(j))&nbsp;/&nbsp;2,<br  />&nbsp;[<span style="font-weight: bold;line-height: 26px;">for</span>&nbsp;input&nbsp;types],&nbsp;[<span style="font-weight: bold;line-height: 26px;">for</span>&nbsp;result&nbsp;types])<br  /></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Decorators&nbsp;-&nbsp;@udf,&nbsp;e.g.&nbsp;:<br  />@udf(input_types=...,&nbsp;result_type=...)<br  />&nbsp;def&nbsp;hash_code_mean(…):<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">然后在使用之前进行注册，如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">st_env.register_function(<span style="color: #d14;line-height: 26px;">"hash_code"</span>,&nbsp;hash_code_mean)<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">接下来就可以在 Table API/SQL 中进行使用了，如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">my_table.select(<span style="color: #d14;line-height: 26px;">"hash_code_mean(a,&nbsp;b)"</span>).insert_into(<span style="color: #d14;line-height: 26px;">"Results"</span>)<br  /></code></pre><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>数据倾斜导致子任务积压<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">业务背景</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">一个流程中，有两个重要子任务：一是数据迁移，将kafka实时数据落Es，二是将kafka数据做窗口聚合落hbase，两个子任务接的是同一个Topic GroupId。上游 Topic 的 tps 高峰达到5-6w。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">问题描述</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">给 24个 TaskManager(CPU) 都会出现来不及消费的情况</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">问题原因</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">做窗口聚合的任务的分组字段，分组粒度太小，hash不能打散，数据倾斜严重，导致少数 TaskManager 上压力过大，从而影响落Es的效率，导致背压。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">解决方式</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">将两个任务独立开来，作为不同的流程。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">结果</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">修改之前 24个 TaskManager(CPU) 来不及消费，改完之后 20 个 CPU 可完成任务。Kafka实时数据落Es的16个TaskManager，将kafka数据做窗口聚合落hbase的4个TaskManager。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">另：</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">同样的数据、同样的Tps作为数据输入，Hbase的输出能力远超过Es，考虑实时任务落数据进Es要慎重。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Flink任务落Es时要考虑设置微批落数据，设置 bulk.flush.max.actions 和 bulk.flush.interval.ms至合适值，否则影响吞吐量。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>Kafka 消息大小默认配置太小，导致数据未处理<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">业务背景</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">正常的Flink任务消费 Topic 数据，但是Topic中的数据为 XML 以及 JSON，单条数据较大</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">问题描述</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Flink各项metrics指标正常，但是没处理到数据</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">问题原因</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Topic中单条数据 &gt; 1M，超过 Kafka Consumer 处理单条数据的默认最大值。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">解决方式</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">有三种可选方式：扩大kafka consumer 单条数据的数据大小：fetch.message.max.bytes。对消息进行压缩：上游 kafka producer 设置 compression.codec 和 commpressed.topics。业务上对数据切片，在上游 kafka producer 端将数据切片为 10K，使用分区主键确保同一条数据发送到同一Partition，consumer对消息重组。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">结果</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">方式一：按业务要求扩大 Kafka Consumer 可处理的单条数据字节数即可正常处理业务
方式二：Kafka Consumer 需先解码，再进行业务处理。方式三：Kafka Consumer 需先重组数据，再进行业务处理。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>Tps 很大，Kafka Ack 默认配置 拖慢消息处理速度<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">业务背景</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">实时任务，上游接流量页面点击事件的数据，下游输出Kafka，输出tps很大。流量数据不重要，可接受丢失的情况</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">问题描述</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">CPU资源耗费较多的情况下，才能正常消费，考虑如果缩减资源。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">问题原因</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Kafka Producer 默认 acks=1，即Partition Leader接收到消息而且写入本地磁盘了，就认为成功了</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">解决方式</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Kafka Producer 设置 ：props.put(“acks”, “0”);
将 acks=0，即KafkaProducer在客户端，只要把消息发送出去，不管那条数据有没有在哪怕Partition Leader上落到磁盘，直接就认为这个消息发送成功了。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="line-height: 1.75em;">结果</strong></p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">资源降低三分之一。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>The assigned slot container_e08_1539148828017_15937_01_003564_0 was removed.<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">org.apache.flink.util.FlinkException: The assigned slot container_e08_1539148828017_15937_01_003564_0 was removed.
at org.apache.flink.runtime.resourcemanager.slotmanager.SlotManager.removeSlot(SlotManager.java:786)
at org.apache.flink.runtime.resourcemanager.slotmanager.SlotManager.removeSlots(SlotManager.java:756)
at org.apache.flink.runtime.resourcemanager.slotmanager.SlotManager.internalUnregisterTaskManager(SlotManager.java:948)
at org.apache.flink.runtime.resourcemanager.slotmanager.SlotManager.unregisterTaskManager(SlotManager.java:372)
at org.apache.flink.runtime.resourcemanager.ResourceManager.closeTaskManagerConnection(ResourceManager.java:803)
at org.apache.flink.yarn.YarnResourceManager.lambda<span style="cursor:pointer;"><span role="presentation" data-formula="onContainersCompleted" data-formula-type="inline-equation" style=""><embed style="vertical-align: -0.439ex;width: 24.633ex;height: auto;" src="https://mmbiz.qlogo.cn/mmbiz_svg/I1YzhXxW8YDUEFrFh05SLibDJj19O63QQNV72RClex1ldTfibpFT7hY83tFqrJWFNrlmzNvIyLTZicUGJ7Vfmg5CG09SuibA0JibC/0?wx_fmt=svg" data-type="svg+xml"></embed></span></span>0(YarnResourceManager.java:340)
at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRunAsync(AkkaRpcActor.java:332)
at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:158)
at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.handleRpcMessage(FencedAkkaRpcActor.java:70)
at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.onReceive(AkkaRpcActor.java:142)</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">程序内存占用过大，导致TaskManager在yarn上kill了，分析原因应该是资源不够，可以将程序放在资源更大的集群上，再不行就设置减少Slot中共享的task的个数，也可能是内存泄露或内存资源配置不合理造成，需要进行合理分配。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>The heartbeat of TaskManager with id container ....... timed out<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">此错误是container心跳超时，出现此种错误一般有两种可能：</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">1、分布式物理机网络失联，这种原因一般情况下failover后作业能正常恢复，如果出现的不频繁可以不用关注；2、failover的节点对应TM的内存设置太小，GC严重导致心跳超时，建议调大对应节点的内存值。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>Caused by: java.util.concurrent.CompletionException: akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka.tcp://flink@flink88:15265/user/taskmanager_0#6643546564]] after [10000 ms]. Sender[null] sent message of type "org.apache.flink.runtime.rpc.messages.RemoteRpcInvocation".<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在flink-conf.yaml中添加或修改：akka.ask.timeout: 100s
web.timeout: 100000</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>Checkpoint：Checkpoint expired before completing<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">checkpointConf.setCheckpointTimeout(5000L)这个值设置过小，默认是10min，需要进行调大测试。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>Kafka partition leader切换导致Flink重启<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Flink重启，查看日志，显示：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">java.lang.Exception:&nbsp;Failed&nbsp;to&nbsp;send&nbsp;data&nbsp;to&nbsp;Kafka:&nbsp;This&nbsp;server&nbsp;is&nbsp;not&nbsp;the&nbsp;leader&nbsp;<span style="font-weight: bold;line-height: 26px;">for</span>&nbsp;that&nbsp;topic-partition.<br  />&nbsp;&nbsp;at&nbsp;org.apache.flink.streaming.connectors.kafka.FlinkKafkaProducerBase.checkErroneous(FlinkKafkaProducerBase.java:373)<br  />&nbsp;&nbsp;at&nbsp;org.apache.flink.streaming.connectors.kafka.FlinkKafkaProducerBase.invoke(FlinkKafkaProducerBase.java:280)<br  />&nbsp;&nbsp;at&nbsp;org.apache.flink.streaming.api.operators.StreamSink.processElement(StreamSink.java:41)<br  />&nbsp;&nbsp;at&nbsp;org.apache.flink.streaming.runtime.io.StreamInputProcessor.processInput(StreamInputProcessor.java:206)<br  />&nbsp;&nbsp;at&nbsp;org.apache.flink.streaming.runtime.tasks.OneInputStreamTask.run(OneInputStreamTask.java:69)<br  />&nbsp;&nbsp;at&nbsp;org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:263)<br  />&nbsp;&nbsp;at&nbsp;org.apache.flink.runtime.taskmanager.Task.run(Task.java:702)<br  />&nbsp;&nbsp;at&nbsp;java.lang.Thread.run(Thread.java:748)<br  />Caused&nbsp;by:&nbsp;org.apache.kafka.common.errors.NotLeaderForPartitionException:&nbsp;This&nbsp;server&nbsp;is&nbsp;not&nbsp;the&nbsp;leader&nbsp;<span style="font-weight: bold;line-height: 26px;">for</span>&nbsp;that&nbsp;topic-partition.<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">查看Kafka的Controller日志，显示：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">&nbsp;INFO&nbsp;[SessionExpirationListener&nbsp;on&nbsp;10],&nbsp;ZK&nbsp;expired;&nbsp;shut&nbsp;down&nbsp;all&nbsp;controller&nbsp;components&nbsp;and&nbsp;<br  />try&nbsp;to&nbsp;re-elect&nbsp;(kafka.controller.KafkaController<span style="color: #008080;line-height: 26px;">$SessionExpirationListener</span>)<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">关于producer参数设置，设置retries参数，可以在Kafka的Partition发生leader切换时，Flink不重启，而是做3次尝试：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">kafkaProducerConfig<br  />&nbsp;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"bootstrap.servers"</span>:&nbsp;<span style="color: #d14;line-height: 26px;">"192.169.2.20:9093,192.169.2.21:9093,192.169.2.22:9093"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"retries"</span>:3<br  />&nbsp;&nbsp;}<br  /></code></pre><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>注意 mapWithState &amp; TTL 的重要性<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在处理包含无限多键的数据时，要考虑到 keyed 状态保留策略（通过 TTL 定时器来在给定的时间之后清理未使用的数据）是很重要的。术语『无限』在这里有点误导，因为如果你要处理的 key 以 128 位编码，则 key 的最大数量将会有个限制（等于 2 的 128 次方）。但这是一个巨大的数字！你可能无法在状态中存储那么多值，所以最好考虑你的键空间是无界的，同时新键会随着时间不断出现。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果你的 keyed 状态包含在某个 Flink 的默认窗口中，则将是安全的：即使未使用 &nbsp;TTL，在处理窗口的元素时也会注册一个清除计时器，该计时器将调用 clearAllState 函数，并删除与该窗口关联的状态及其元数据。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果要使用 Keyed State Descriptor 来管理状态，可以很方便地添加 TTL 配置，以确保在状态中的键数量不会无限制地增加。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">但是，你可能会想使用更简便的 mapWithState 方法，该方法可让你访问 valueState 并隐藏操作的复杂性。虽然这对于测试和少量键的数据来说是很好的选择，但如果在生产环境中遇到无限多键值时，会引发问题。由于状态是对你隐藏的，因此你无法设置 TTL，并且默认情况下未配置任何 TTL。这就是为什么值得考虑做一些额外工作的原因，如声明诸如 RichMapFunction 之类的东西，这将使你能更好的控制状态的生命周期。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>部署和资源问题<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(0) JDK版本过低</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">这不是个显式错误，但是JDK版本过低很有可能会导致Flink作业出现各种莫名其妙的问题，因此在生产环境中建议采用JDK 8的较高update（我们使用的是181）。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(1) Could not build the program from JAR file</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">该信息不甚准确，因为绝大多数情况下都不是JAR包本身有毛病，而是在作业提交过程中出现异常退出了。因此需要查看本次提交产生的客户端日志（默认位于$FLINK_HOME/logs目录下），再根据其中的信息定位并解决问题。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(2) ClassNotFoundException/NoSuchMethodError/IncompatibleClassChangeError/...</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">一般都是因为用户依赖第三方包的版本与Flink框架依赖的版本有冲突导致。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(3) Deployment took more than 60 seconds. Please check if the requested resources are available in the YARN cluster</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">就是字面意思，YARN集群内没有足够的资源启动Flink作业。检查一下当前YARN集群的状态、正在运行的YARN App以及Flink作业所处的队列，释放一些资源或者加入新的资源。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(4) java.util.concurrent.TimeoutException: Slot allocation request timed out</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">slot分配请求超时，是因为TaskManager申请资源时无法正常获得，按照上一条的思路检查即可。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(5) org.apache.flink.util.FlinkException: The assigned slot &lt; container_id&gt; was removed</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">TaskManager的Container因为使用资源超限被kill掉了。首先需要保证每个slot分配到的内存量足够，特殊情况下可以手动配置SlotSharingGroup来减少单个slot中共享Task的数量。如果资源没问题，那么多半就是程序内部发生了内存泄露。建议仔细查看TaskManager日志，并按处理JVM OOM问题的常规操作来排查。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(6) java.util.concurrent.TimeoutException: Heartbeat of TaskManager with id &lt; tm_id&gt;timed out</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">TaskManager心跳超时。有可能是TaskManager已经失败，如果没有失败，那么有可能是因为网络不好导致JobManager没能收到心跳信号，或者TaskManager忙于GC，无法发送心跳信号。JobManager会重启心跳超时的TaskManager，如果频繁出现此异常，应该通过日志进一步定位问题所在。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在Flink中，资源的隔离是通过Slot进行的，也就是说多个Slot会运行在同一个JVM中，这种隔离很弱，尤其对于生产环境。Flink App上线之前要在一个单独的Flink集群上进行测试，否则一个不稳定、存在问题的Flink App上线，很可能影响整个Flink集群上的App。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(7)资源不足导致 container 被 kill</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(40, 202, 113);">The assigned slot container_container编号 was removed.</code>Flink App 抛出此类异常，通过查看日志，一般就是某一个 Flink App 内存占用大，导致 TaskManager（在 Yarn 上就是 Container ）被Kill 掉。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">但是并不是所有的情况都是这个原因，还需要进一步看 yarn 的日志（ 查看 yarn 任务日志：yarn logs -applicationId &nbsp;-appOwner），如果代码写的没问题，就确实是资源不够了，其实 1G Slot 跑多个Task（ Slot Group Share ）其实挺容易出现的。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">因此有两种选择，可以根据具体情况，权衡选择一个。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">将该 Flink App 调度在 Per Slot 内存更大的集群上。通过 slotSharingGroup("xxx") ，减少 Slot 中共享 Task 的个数</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(8)启动报错，提示找不到 jersey 的类</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">java.lang.NoClassDefFoundError: com/sun/jersey/core/util/FeaturesAndProperties
解决办法进入 yarn中 把 lib 目中的一下两个问价拷贝到flink的lib中
hadoop/share/hadoop/yarn/lib/jersey-client-1.9.jar /hadoop/share/hadoop/yarn/lib/jersey-core-1.9.jar</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(9)Scala版本冲突</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">java.lang.NoSuchMethodError:scala.collection.immutable.HashSet$.empty()Lscala/collection/<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">解决办法，添加:
import org.apache.flink.api.scala._</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(10)没有使用回撤流报错</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Table&nbsp;is&nbsp;not&nbsp;an&nbsp;append一only&nbsp;table.&nbsp;Use&nbsp;the&nbsp;toRetractStream()&nbsp;<span style="font-weight: bold;line-height: 26px;">in</span>&nbsp;order&nbsp;to&nbsp;handle&nbsp;add&nbsp;and&nbsp;retract&nbsp;messages.<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">这个是因为动态表不是 append-only 模式的，需要用 toRetractStream (回撤流) 处理就好了.</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">tableEnv.toRetractStream[Person](result).<span style="color: #0086b3;line-height: 26px;">print</span>()<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(11)OOM 问题解决思路</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">java.lang.OutOfMemoryError:&nbsp;GC&nbsp;overhead&nbsp;<span style="color: #0086b3;line-height: 26px;">limit</span>&nbsp;exceeded<br  />java.lang.OutOfMemoryError:&nbsp;GC&nbsp;overhead&nbsp;<span style="color: #0086b3;line-height: 26px;">limit</span>&nbsp;exceeded<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.util.Arrays.copyOfRange(Arrays.java:3664)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;java.lang.String.&lt;init&gt;(String.java:207)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.esotericsoftware.kryo.io.Input.readString(Input.java:466)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;com.esotericsoftware.kryo.serializers.DefaultSerializers<span style="color: #008080;line-height: 26px;">$StringSerializer</span>.<span style="color: #0086b3;line-height: 26px;">read</span>(DefaultSerializers.java:177)<br  />......<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.apache.flink.streaming.runtime.tasks.OperatorChain<span style="color: #008080;line-height: 26px;">$CopyingChainingOutput</span>.collect(OperatorChain.java:524)<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">解决方案：</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">检查 slot 槽位够不够或者 slot 分配的数量有没有生效。程序起的并行是否都正常分配了(会有这样的情况出现,假如 5 个并行,但是只有 2 个在几点上生效了,另外 3 个没有数据流动)。检查flink程序有没有数据倾斜，可以通过 flink 的 ui 界面查看每个分区子节点处理的数据量。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(12)解析返回值类型失败报错</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">The&nbsp;<span style="color: #0086b3;line-height: 26px;">return</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">type</span>&nbsp;of&nbsp;<span style="font-weight: bold;line-height: 26px;">function</span>&nbsp;could&nbsp;not&nbsp;be&nbsp;determined&nbsp;automatically<br  />Exception&nbsp;<span style="font-weight: bold;line-height: 26px;">in</span>&nbsp;thread&nbsp;<span style="color: #d14;line-height: 26px;">"main"</span>&nbsp;org.apache.flink.api.common.functions.InvalidTypesException:&nbsp;The&nbsp;<span style="color: #0086b3;line-height: 26px;">return</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">type</span>&nbsp;of&nbsp;<span style="font-weight: bold;line-height: 26px;">function</span>&nbsp;<span style="color: #d14;line-height: 26px;">'main(RemoteEnvironmentTest.java:27)'</span>&nbsp;could&nbsp;not&nbsp;be&nbsp;determined&nbsp;automatically,&nbsp;due&nbsp;to&nbsp;<span style="color: #0086b3;line-height: 26px;">type</span>&nbsp;erasure.&nbsp;You&nbsp;can&nbsp;give&nbsp;<span style="color: #0086b3;line-height: 26px;">type</span>&nbsp;information&nbsp;hints&nbsp;by&nbsp;using&nbsp;the&nbsp;returns(...)&nbsp;method&nbsp;on&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;transformation&nbsp;call,&nbsp;or&nbsp;by&nbsp;letting&nbsp;your&nbsp;<span style="font-weight: bold;line-height: 26px;">function</span>&nbsp;implement&nbsp;the&nbsp;<span style="color: #d14;line-height: 26px;">'ResultTypeQueryable'</span>&nbsp;interface.<br  />&nbsp;at&nbsp;org.apache.flink.api.java.DataSet.getType(DataSet.java:178)<br  />&nbsp;at&nbsp;org.apache.flink.api.java.DataSet.collect(DataSet.java:410)<br  />&nbsp;at&nbsp;org.apache.flink.api.java.DataSet.print(DataSet.java:1652)<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">解决方案：产生这种现象的原因一般是使用 lambda 表达式没有明确返回值类型，或者使用特使的数据结构 flink 无法解析其类型，这时候我们需要在方法的后面添加返回值类型，比如字符串。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">input.flatMap((Integer&nbsp;number,&nbsp;Collector&lt;&nbsp;String&gt;&nbsp;out)&nbsp;-&gt;&nbsp;{<br  />&nbsp;......<br  />})<br  />//&nbsp;提供返回值类型<br  />.returns(Types.STRING)<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(13)Hadoop jar 包冲突</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Caused&nbsp;by:&nbsp;java.io.IOException:&nbsp;The&nbsp;given&nbsp;file&nbsp;system&nbsp;URI&nbsp;(hdfs:///data/checkpoint-data/abtest)&nbsp;did&nbsp;not&nbsp;describe&nbsp;the&nbsp;authority&nbsp;(like&nbsp;<span style="font-weight: bold;line-height: 26px;">for</span>&nbsp;example&nbsp;HDFS&nbsp;NameNode&nbsp;address/port&nbsp;or&nbsp;S3&nbsp;host).&nbsp;The&nbsp;attempt&nbsp;to&nbsp;use&nbsp;a&nbsp;configured&nbsp;default&nbsp;authority&nbsp;failed:&nbsp;Hadoop&nbsp;configuration&nbsp;did&nbsp;not&nbsp;contain&nbsp;an&nbsp;entry&nbsp;<span style="font-weight: bold;line-height: 26px;">for</span>&nbsp;the&nbsp;default&nbsp;file&nbsp;system&nbsp;(<span style="color: #d14;line-height: 26px;">'fs.defaultFS'</span>).<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.apache.flink.runtime.fs.hdfs.HadoopFsFactory.create(HadoopFsFactory.java:135)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.apache.flink.core.fs.FileSystem.getUnguardedFileSystem(FileSystem.java:399)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.apache.flink.core.fs.FileSystem.get(FileSystem.java:318)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;org.apache.flink.core.fs.Path.getFileSystem(Path.java:298)<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">解决：pom 文件中去掉和 hadoop 相关的依赖就好了</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>作业问题<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(1)org.apache.flink.streaming.runtime.tasks.ExceptionInChainedOperatorException: Could not forward element to next operator</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">该异常几乎都是由于程序业务逻辑有误，或者数据流里存在未处理好的脏数据导致的，继续向下追溯异常栈一般就可以看到具体的出错原因，比较常见的如POJO内有空字段，或者抽取事件时间的时间戳为null等。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(2) java.lang.IllegalStateException: Buffer pool is destroyed || Memory manager has been shut down</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">很多童鞋拿着这两条异常信息来求助，但实际上它们只是表示BufferPool、MemoryManager这些Flink运行时组件被销毁，亦即作业已经失败。具体的原因多种多样，根据经验，一般是上一条描述的情况居多（即Could not forward element to next operator错误会伴随出现），其次是JDK版本问题。具体情况还是要根据TaskManager日志具体分析。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(3) akka.pattern.AskTimeoutException: Ask timed out on [Actor[akka://...]] after [10000 ms]</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Akka超时导致，一般有两种原因：一是集群负载比较大或者网络比较拥塞，二是业务逻辑同步调用耗时的外部服务。如果负载或网络问题无法彻底缓解，需考虑调大akka.ask.timeout参数的值（默认只有10秒）；另外，调用外部服务时尽量异步操作（Async I/O）。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(4) java.io.IOException: Too many open files</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">这个异常我们应该都不陌生，首先检查系统ulimit -n的文件描述符限制，再注意检查程序内是否有资源（如各种连接池的连接）未及时释放。值得注意的是，Flink使用RocksDB状态后端也有可能会抛出这个异常，此时需修改flink-conf.yaml中的state.backend.rocksdb.files.open参数，如果不限制，可以改为-1。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(5) org.apache.flink.api.common.function.InvalidTypesException: The generic type parameters of '&lt; class&gt;' are missing</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在Flink内使用Java Lambda表达式时，由于类型擦除造成的副作用，注意调用returns()方法指定被擦除的类型。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(6)Checkpoint失败：Checkpoint expired before completing</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">原因是因为checkpointConf.setCheckpointTimeout(8000L)。设置的太小了，默认是10min，这里只设置了8sec。当一个Flink App背压的时候（例如由外部组件异常引起），Barrier会流动的非常缓慢，导致Checkpoint时长飙升。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>检查点和状态问题<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(1) Received checkpoint barrier for checkpoint &lt; cp_id&gt; before completing current checkpoint &lt; cp_id&gt;. Skipping current checkpoint</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在当前检查点还未做完时，收到了更新的检查点的barrier，表示当前检查点不再需要而被取消掉，一般不需要特殊处理。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(2) Checkpoint &lt; cp_id&gt; expired before completing</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">首先应检查CheckpointConfig.setCheckpointTimeout()方法设定的检查点超时，如果设的太短，适当改长一点。另外就是考虑发生了反压或数据倾斜，或者barrier对齐太慢。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(3) org.apache.flink.util.StateMigrationException: The new state serializer cannot be incompatible</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">我们知道Flink的状态是按key组织并保存的，如果程序逻辑内改了keyBy()逻辑或者key的序列化逻辑，就会导致检查点/保存点的数据无法正确恢复。所以如果必须要改key相关的东西，就弃用之前的状态数据吧。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(4) org.apache.flink.util.StateMigrationException: The new serializer for a MapState requires state migration in order for the job to proceed. However, migration for MapState currently isn't supported</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在1.9之前的Flink版本中，如果我们使用RocksDB状态后端，并且更改了自用MapState的schema，恢复作业时会抛出此异常，表示不支持更改schema。这个问题已经在FLINK-11947解决，升级版本即可。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">(5)时钟不同步导致无法启动</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">启动Flink任务的时候报错
Caused by: java.lang.RuntimeException: Couldn't deploy Yarn cluster。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">然后仔细看发现：system times on machines may be out of sync。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">意思说是机器上的系统时间可能不同步。同步集群机器时间即可。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>不同的kafka版本依赖冲突<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">不同的kafka版本依赖冲突会造成cdc报错，参考这个issue：</p><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;background: rgb(251, 249, 253);color: rgb(106, 115, 125);margin-bottom: 20px;margin-top: 20px;padding: 15px 20px;line-height: 27px;border-left-color: rgb(53, 179, 120);"><p style="line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);">http://apache-flink.147419.n8.nabble.com/cdc-td8357.html#a8393</p></blockquote><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">2020-11-04&nbsp;16:39:10.972&nbsp;[Source:&nbsp;Custom&nbsp;Source&nbsp;-&gt;&nbsp;Sink:&nbsp;Print&nbsp;to&nbsp;Std.&nbsp;Out&nbsp;(1/1)]&nbsp;WARN&nbsp;&nbsp;org.apache.flink.runtime.taskmanager.Task&nbsp;&nbsp;-&nbsp;Source:&nbsp;Custom&nbsp;Source&nbsp;-&gt;&nbsp;Sink:&nbsp;Print&nbsp;to&nbsp;Std.&nbsp;Out&nbsp;(1/1)&nbsp;(7c3ccf7686ccfb33254e8cb785cd339d)&nbsp;switched&nbsp;from&nbsp;RUNNING&nbsp;to&nbsp;FAILED.<br  />java.lang.AbstractMethodError:&nbsp;org.apache.kafka.connect.json.JsonSerializer.configure(Ljava/util/Map;Z)V<br  />at&nbsp;org.apache.kafka.connect.json.JsonConverter.configure(JsonConverter.java:300)<br  />at&nbsp;org.apache.kafka.connect.json.JsonConverter.configure(JsonConverter.java:311)<br  />at&nbsp;io.debezium.embedded.EmbeddedEngine.&lt;init&gt;(EmbeddedEngine.java:583)<br  />at&nbsp;io.debezium.embedded.EmbeddedEngine.&lt;init&gt;(EmbeddedEngine.java:80)<br  />at&nbsp;io.debezium.embedded.EmbeddedEngine<span style="color: #008080;line-height: 26px;">$BuilderImpl</span>.build(EmbeddedEngine.java:301)<br  />at&nbsp;io.debezium.embedded.EmbeddedEngine<span style="color: #008080;line-height: 26px;">$BuilderImpl</span>.build(EmbeddedEngine.java:217)<br  />at&nbsp;io.debezium.embedded.ConvertingEngineBuilder.build(ConvertingEngineBuilder.java:139)<br  />at&nbsp;com.alibaba.ververica.cdc.debezium.DebeziumSourceFunction.run(DebeziumSourceFunction.java:299)<br  />at&nbsp;org.apache.flink.streaming.api.operators.StreamSource.run(StreamSource.java:100)<br  />at&nbsp;org.apache.flink.streaming.api.operators.StreamSource.run(StreamSource.java:63)<br  />at&nbsp;org.apache.flink.streaming.runtime.tasks.SourceStreamTask<span style="color: #008080;line-height: 26px;">$LegacySourceFunctionThread</span>.run(SourceStreamTask.java:213)<br  /><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">源码如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">public&nbsp;class&nbsp;CdcTest&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;main(String[]&nbsp;args)&nbsp;throws&nbsp;Exception&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SourceFunction&lt;String&gt;&nbsp;sourceFunction&nbsp;=&nbsp;MySQLSource.&lt;String&gt;builder()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.hostname(<span style="color: #d14;line-height: 26px;">"localhost"</span>)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.port(3306)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.databaseList(<span style="color: #d14;line-height: 26px;">"sohay"</span>)&nbsp;//&nbsp;monitor&nbsp;all&nbsp;tables&nbsp;under&nbsp;inventory&nbsp;database<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.username(<span style="color: #d14;line-height: 26px;">"root"</span>)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.password(<span style="color: #d14;line-height: 26px;">"123456"</span>)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.deserializer(new&nbsp;StringDebeziumDeserializationSchema())&nbsp;//&nbsp;converts&nbsp;SourceRecord&nbsp;to&nbsp;String<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StreamExecutionEnvironment&nbsp;env&nbsp;=&nbsp;StreamExecutionEnvironment.getExecutionEnvironment();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env.addSource(sourceFunction).<span style="color: #0086b3;line-height: 26px;">print</span>().setParallelism(1);&nbsp;//&nbsp;use&nbsp;parallelism&nbsp;1&nbsp;<span style="font-weight: bold;line-height: 26px;">for</span>&nbsp;sink&nbsp;to&nbsp;keep&nbsp;message&nbsp;ordering<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env.execute();<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">确实是pom中存在一个Kafka的依赖包，导致冲突，去掉后问题解决。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>MySQL CDC源等待超时<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">在扫描表期间，由于没有可恢复的位置，因此无法执行checkpoints。为了不执行检查点，MySQL CDC源将保持检查点等待超时。超时检查点将被识别为失败的检查点，默认情况下，这将触发Flink作业的故障转移。因此，如果数据库表很大，则建议添加以下Flink配置，以避免由于超时检查点而导致故障转移：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.387037037037037" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/9_AfYy6Xn2Tb8dtrG04Bb868hhwPROyw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCupYDSc8wia1M21A43tuQ0nclstAfYy6Xn2Tb8dtrG04Bb868hhwPROyw/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">execution.checkpointing.interval:&nbsp;10min<br  />execution.checkpointing.tolerable-failed-checkpoints:&nbsp;100<br  />restart-strategy:&nbsp;fixed-delay<br  />restart-strategy.fixed-delay.attempts:&nbsp;2147483647<br  /></code></pre><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>数据库切换，重新开启binlog，Mysql全局锁无法释放<span style="display: none;"></span></h4><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.13240740740740742" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/10_cY1z7RZ6jVI8cicjW5iaR0vZGbsf9g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuHG0OQJ1FMOCNkaztoicyjWGxQ8OcY1z7RZ6jVI8cicjW5iaR0vZGbsf9g/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">原因是因为切换了数据库环境，重新开启binlog,所有的作业都重新同步binlog的全量数据，导致了全局锁一直在等待，所有作业都无法执行。解决方法：记录checkpoint的地址，取消作业，然后根据checkpoint重启作业。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>使用Flink SQL CDC模式创建维表异常<span style="display: none;"></span></h4><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">CREATE&nbsp;TABLE&nbsp;cdc_test<br  />(<br  />&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;&nbsp;STRING,<br  />&nbsp;&nbsp;&nbsp;&nbsp;ip&nbsp;&nbsp;STRING,<br  />&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;STRING,<br  />&nbsp;&nbsp;&nbsp;&nbsp;PRIMARY&nbsp;KEY&nbsp;(id)&nbsp;NOT&nbsp;ENFORCED<br  />)&nbsp;WITH&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'mysql-cdc'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'hostname'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'127.0.0.1'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'port'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'3306'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'database-name'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'xx'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'table-name'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'xx'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'username'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'xx'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'password'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'xx'</span><br  />);<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">执行查询：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">SELECT&nbsp;*&nbsp;FROM&nbsp;cdc_test;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">任务无法运行，抛出异常</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">User&nbsp;does&nbsp;not&nbsp;have&nbsp;the&nbsp;<span style="color: #d14;line-height: 26px;">'LOCK&nbsp;TABLES'</span>&nbsp;privilege&nbsp;required&nbsp;to&nbsp;obtain&nbsp;a&nbsp;consistent&nbsp;snapshot&nbsp;by&nbsp;preventing&nbsp;concurrent&nbsp;writes&nbsp;to&nbsp;tables.<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">原因是连接MySQL的用户缺乏必要的CDC权限。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Flink SQL CDC基于Debezium实现。当启动MySQL CDC源时，它将获取一个全局读取锁（FLUSH TABLES WITH READ LOCK），该锁将阻止其他数据库的写入，然后读取当前binlog位置以及数据库和表的schema，之后将释放全局读取锁。然后它扫描数据库表并从先前记录的位置读取binlog，Flink将定期执行checkpoints以记录binlog位置。如果发生故障，作业将重新启动并从checkpoint完成的binlog位置恢复，因此它保证了仅一次的语义。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">解决办法：创建一个新的MySQL用户并授予其必要的权限。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">mysql&gt;&nbsp;CREATE&nbsp;USER&nbsp;<span style="color: #d14;line-height: 26px;">'user'</span>@<span style="color: #d14;line-height: 26px;">'localhost'</span>&nbsp;IDENTIFIED&nbsp;BY&nbsp;<span style="color: #d14;line-height: 26px;">'password'</span>;<br  />mysql&gt;&nbsp;GRANT&nbsp;SELECT,&nbsp;RELOAD,&nbsp;SHOW&nbsp;DATABASES,&nbsp;REPLICATION&nbsp;SLAVE,&nbsp;REPLICATION&nbsp;CLIENT&nbsp;ON&nbsp;*.*&nbsp;TO&nbsp;<span style="color: #d14;line-height: 26px;">'user'</span>&nbsp;IDENTIFIED&nbsp;BY&nbsp;<span style="color: #d14;line-height: 26px;">'password'</span>;<br  />mysql&gt;&nbsp;FLUSH&nbsp;PRIVILEGES;<br  /></code></pre><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>Flink作业扫描MySQL全量数据出现fail-over<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Flink 作业在扫描 MySQL 全量数据时，checkpoint 超时，出现作业 failover，如下图：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.48055555555555557" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/11_ibZFIGG0OicxxY3CQvIrk4NHJwwakg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuVnVE4bLqziafyPd5cUiauTjicKmnAibZFIGG0OicxxY3CQvIrk4NHJwwakg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">原因：Flink CDC 在 scan 全表数据（我们的实收表有千万级数据）需要小时级的时间（受下游聚合反压影响），而在 scan 全表过程中是没有 offset 可以记录的（意味着没法做 checkpoint），但是 Flink 框架任何时候都会按照固定间隔时间做 checkpoint，所以此处 mysql-cdc source 做了比较取巧的方式，即在 scan 全表的过程中，会让执行中的 checkpoint 一直等待甚至超时。超时的 checkpoint 会被仍未认为是 failed checkpoint，默认配置下，这会触发 Flink 的 failover 机制，而默认的 failover 机制是不重启。所以会造成上面的现象。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">解决办法：在 flink-conf.yaml 配置 failed checkpoint 容忍次数，以及失败重启策略，如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">execution.checkpointing.interval:&nbsp;10min&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">#&nbsp;checkpoint间隔时间</span><br  />execution.checkpointing.tolerable-failed-checkpoints:&nbsp;100&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">#&nbsp;checkpoint&nbsp;失败容忍次数</span><br  />restart-strategy:&nbsp;fixed-delay&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">#&nbsp;重试策略</span><br  />restart-strategy.fixed-delay.attempts:&nbsp;2147483647&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">#&nbsp;重试次数</span><br  /></code></pre><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>作业在运行时 mysql cdc source 报 no viable alternative at input 'alter table std'<span style="display: none;"></span></h4><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.3472222222222222" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/12_XnHdl6wAPeoBn9ZI7QPIL0fVXtibIA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuDfFSib1mCwf8GPUkNH4ia5tTkq4XnHdl6wAPeoBn9ZI7QPIL0fVXtibIA/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">原因：因为数据库中别的表做了字段修改，CDC source 同步到了 ALTER DDL 语句，但是解析失败抛出的异常。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">解决方法：在 flink-cdc-connectors 最新版本中已经修复该问题（跳过了无法解析的 DDL）。升级 connector jar 包到最新版本 1.1.0：flink-sql-connector-mysql-cdc-1.1.0.jar，替换 flink/lib 下的旧包。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>多个作业共用同一张 source table 时，没有修改 server id 导致读取出来的数据有丢失。<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">原因：MySQL binlog 数据同步的原理是，CDC source 会伪装成 MySQL 集群的一个 slave（使用指定的 server id 作为唯一 id），然后从 MySQL 拉取 binlog 数据。如果一个 MySQL 集群中有多个 slave 有同样的 id，就会导致拉取数据错乱的问题。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">解决方法：默认会随机生成一个 server id，容易有碰撞的风险。所以建议使用动态参数（table hint）在 query 中覆盖 server id。如下所示：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">FROM&nbsp;bill_info&nbsp;/*+&nbsp;OPTIONS(<span style="color: #d14;line-height: 26px;">'server-id'</span>=<span style="color: #d14;line-height: 26px;">'123456'</span>)&nbsp;*/&nbsp;;<br  /></code></pre><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>CDC source 扫描 MySQL 表期间，发现无法往该表 insert 数据<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">原因：由于使用的 MySQL 用户未授权 RELOAD 权限，导致无法获取全局读锁（FLUSH TABLES WITH READ LOCK）， CDC source 就会退化成表级读锁，而使用表级读锁需要等到全表 scan 完，才能释放锁，所以会发现持锁时间过长的现象，影响其他业务写入数据。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">解决方法：给使用的 MySQL 用户授予 RELOAD 权限即可。所需的权限列表详见文档：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">https://github.com/ververica/flink-cdc-connectors/wiki/mysql-cdc-connector<span style="color: #998;font-style: italic;line-height: 26px;">#setup-mysql-server</span><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果出于某些原因无法授予 RELOAD 权限，也可以显式配上 'debezium.snapshot.locking.mode' = 'none'来避免所有锁的获取，但要注意只有当快照期间表的 schema 不会变更才安全。</p><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;background: rgb(251, 249, 253);color: rgb(106, 115, 125);margin-bottom: 20px;margin-top: 20px;padding: 15px 20px;line-height: 27px;border-left-color: rgb(53, 179, 120);"><p style="line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);">下面这些问题来自腾讯云大数据官方博客，供大家参考。</p></blockquote><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>Flink 作业自动停止<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">现象：本应长期运行的作业，突然停止运行，且再也不恢复。</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.38796296296296295" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/13_HBSLLo0Hh6oraaCGbwlDTiaYdgBYgA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuWYjAMr5cWLq2Hu5RuE8P5F0uiaHBSLLo0Hh6oraaCGbwlDTiaYdgBYgA/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果 Flink 作业在编程时，源算子实现不当，则可能造成源算子处理完数据以后进入 FINISHED 状态。如果所有源算子都进入了 FINISHED 状态，那整个 Flink 作业也会跟着结束。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">Flink 作业默认的容错次数是 2，即发生两次崩溃后，作业就自动退出了，不再进行重试。当出现此种场景时，TaskManager 的日志中会有“restart strategy prevented it”字样。我们首先要找到作业崩溃的原因，其次可以适当调大 RestartStrategy 中容错的最大次数，毕竟节点异常等外部风险始终存在，作业不会在理想的环境中运行。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">此外，旧版Flink（低于 1.11.0）的 RocksDB 内存使用不受管控，造成很容易由于超量使用而被外界（YARN、Kubernetes 等）KILL 掉。如果经常受此困扰，可以考虑升级 Flink 版本到最新，其默认开启自动内存管理功能。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>Flink作业频繁重启<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">现象：作业频繁重启又自行恢复，陷入无尽循环，无法正常处理数据。</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.4064814814814815" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/14_Exic100mAv7gvBDyX7Q8Z7ibk6JTSw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuN5FdWicecAHKXNBXYEx2A6nh9MZExic100mAv7gvBDyX7Q8Z7ibk6JTSw/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">作业频繁重启的成因非常多，例如异常数据造成的作业崩溃，可以在 TaskManager 的日志中找到报错。数据源或者数据目的等上下游系统超时也会造成作业无法启动而一直在重启。此外 TaskManager Full GC 太久造成心跳包超时而被 JobManager 踢掉也是常见的作业重启原因。如果系统内存严重匮乏，那么 Linux 自带的 OOM Killer 也可能把 TaskManager 所在的 JVM 进程 kill 了。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">当一个正常运行的作业失败时，日志里会有 from RUNNING to FAILED 的关键字，我们以此为着手点，查看它后面的 Exception 原因，通常最下面的 caused by 即是直接原因。当然，直接原因不一定等于根本原因，后者需要借助下文提到的多项技术进行分析。</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.4648148148148148" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/15_BwnffmETyapSkR7ynNgcXUkja2JypQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCuGZE6XBd6zzX5GDa6tuXpzjNfBwnffmETyapSkR7ynNgcXUkja2JypQ/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">如果 JVM 的内存容量超出了平台方（例如 YARN 或 Kubernetes 等）的容器限制，则可能被 KILL。问题的确认方式也是查看作业日志以及平台组件的运行状态。值得一提的是，在最新的 Flink 版本中，只要设置 taskmanager.memory.process.size 参数，基本可以保证内存用量不会超过该值（前提是用户没有使用 JNI 等方式申请 native 内存）。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">作业的崩溃重启还有一些原因，例如使用了不成熟的第三方 so 库，或者连接数过多等，都可以从日志中找到端倪。</p><h4 data-tool="mdnice编辑器" style="margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;margin-top: 30px;"><span style="display: none;"></span>作业输出整体稳定，但是个别数据缺失<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">现象：作业输出整体稳定，但是个别数据缺失，造成结果的精度下降，甚至结果完全错乱。</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.4527777777777778" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/16_a5GbC7ojdZcWA5eF2qytICjue6ucRA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2M5AaDrJZibTZVLhvMTbdUCun6jxNAGkuRjRQYQ9rcboicgnXa5GbC7ojdZcWA5eF2qytICjue6ucRA/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;border-radius: 4px;margin-bottom: 25px;"  /></figure><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">当遇到怀疑数据缺失造成的计算结果不正确时，首先需要检查作业逻辑是否不小心过滤了一些正常数据。检查方法可以在本地运行一个 Mini Cluster，也可以在远端的调试环境进行远程调试或者采样等。具体技巧后文也会提到。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">另外还有一种情况是，如果用户定义了批量存取的算子（通常用于与外部系统进行交互），则有可能出现一批数据中有一条异常数据，导致整批次都失败而被丢弃的情况。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;">对于数据源 Source 和数据目的Sink，请务必保证 Flink 作业运行期间不要对其进行任何改动（例如新增 Kafka 分区、调整 MySQL 表结构等），否则可能造成正在运行的作业无法感知新增的分区或者读写失败。尽管 Flink 可以开启 Kafka 分区自动发现机制（在 Configuration 里设置 flink.partition-discovery.interval-millis 值），但分区发现仍然需要一定时间，数据的精度可能会稍有影响。</p><p data-tool="mdnice编辑器" style="padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;"><br  /></p></section><hr data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;max-width: 100%;height: 1px;border-right: none;border-bottom: none;border-left: none;border-top-style: solid;border-top-color: black;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /><section style="padding-top: 8px;padding-bottom: 8px;max-width: 100%;line-height: 26px;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 100%;font-size: 14px;overflow-wrap: break-word !important;box-sizing: border-box !important;">《大数据成神之路》正在全面PDF化。</span></section><section style="padding-top: 8px;padding-bottom: 8px;max-width: 100%;line-height: 26px;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 100%;font-size: 14px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><strong style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">你只需要关注并在后台回复</strong><strong style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><code style="margin-right: 2px;margin-left: 2px;padding: 2px 4px;max-width: 100%;font-size: 14px;border-radius: 4px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 100%;color: rgb(255, 104, 39);overflow-wrap: break-word !important;box-sizing: border-box !important;">「PDF」</span></code></strong><strong style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">就可以看到阿里云盘下载链接了！</strong></span></section><section style="padding-top: 8px;padding-bottom: 8px;max-width: 100%;line-height: 26px;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 100%;font-size: 14px;overflow-wrap: break-word !important;box-sizing: border-box !important;">另外我把发表过的文章按照体系全部整理好了。现在你可以在后台方便的进行查找：</span></section><section style="padding-right: 10px;padding-left: 10px;max-width: 100%;color: black;line-height: 1.6;letter-spacing: 0px;word-break: break-word;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;padding-right: 0.5em;padding-left: 0.5em;max-width: 100%;display: flex;flex-direction: column;justify-content: center;align-items: center;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.6712962962962963" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/17_yPb94gicvelDmiaGhnMem0cs9p9LLw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PM7nI3CL3Oy36gcxKeHdodXia8jHXrOPpe2ZePDiaoCeLFvdKbyPb94gicvelDmiaGhnMem0cs9p9LLw/640?wx_fmt=png'" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;display: block;border-radius: 6px;box-shadow: rgb(180, 180, 180) 0em 0em 0.5em 0px;font-size: 17px;overflow-wrap: break-word !important;"  /></figure><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;padding-right: 0.5em;padding-left: 0.5em;max-width: 100%;display: flex;flex-direction: column;justify-content: center;align-items: center;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.6574074074074074" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/18_ibqM9S3BOIOicTSNuqbIw29KGsTIPw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PM7nI3CL3Oy36gcxKeHdodsDazT1XgoDW32ye4TAd3fnOhDSibqM9S3BOIOicTSNuqbIw29KGsTIPw/640?wx_fmt=png'" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;display: block;border-radius: 6px;box-shadow: rgb(180, 180, 180) 0em 0em 0.5em 0px;font-size: 17px;overflow-wrap: break-word !important;"  /></figure></section><section style="padding-top: 8px;padding-bottom: 8px;max-width: 100%;line-height: 26px;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="font-size: 14px;">电子版把他们分类做成了下面这个样子，并且放在了阿里云盘提供下载。</span></section><section style="padding-right: 10px;padding-left: 10px;max-width: 100%;line-height: 1.6;letter-spacing: 0.034em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;padding-right: 0.5em;padding-left: 0.5em;max-width: 100%;display: flex;flex-direction: column;justify-content: center;align-items: center;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.42314814814814816" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/19_aSS56bw8SAal18vVZXoAccvxJ1ZEog.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PM7nI3CL3Oy36gcxKeHdodduk3T8FicKOfOTaks0WNX5EKJiaSS56bw8SAal18vVZXoAccvxJ1ZEog/640?wx_fmt=png'" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;display: block;border-radius: 6px;box-shadow: rgb(180, 180, 180) 0em 0em 0.5em 0px;font-size: 17px;overflow-wrap: break-word !important;"  /></figure></section><section style="padding-top: 8px;padding-bottom: 8px;max-width: 100%;line-height: 26px;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="font-size: 14px;">我们点开一个文件夹后:</span></section><section style="padding-right: 10px;padding-left: 10px;max-width: 100%;white-space: normal;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;line-height: 1.6;letter-spacing: 0.034em;font-size: 16px;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;padding-right: 0.5em;padding-left: 0.5em;max-width: 100%;display: flex;flex-direction: column;justify-content: center;align-items: center;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.7435185185185185" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/20_mHztuezIg8YLzqrHmnaLaW2M5iaEmg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PM7nI3CL3Oy36gcxKeHdodxsrfAZf18GhJRbPZWqTzlUoUumHztuezIg8YLzqrHmnaLaW2M5iaEmg/640?wx_fmt=png'" data-type="png" data-w="1080" style="margin-right: auto;margin-left: auto;display: block;border-radius: 6px;box-shadow: rgb(180, 180, 180) 0em 0em 0.5em 0px;font-size: 17px;overflow-wrap: break-word !important;"  /></figure></section><section style="padding-top: 1em;padding-bottom: 8px;max-width: 100%;color: rgb(74, 74, 74);line-height: 1.75em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="font-size: 14px;"><span style="font-size: 14px;max-width: 100%;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;box-sizing: border-box !important;">如果这个文章对你有帮助，不要忘记&nbsp;</span><span style="font-size: 14px;max-width: 100%;outline: 0px;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);color: rgb(255, 104, 39);overflow-wrap: break-word !important;box-sizing: border-box !important;"><strong style="max-width: 100%;outline: 0px;line-height: 1.75em;overflow-wrap: break-word !important;box-sizing: border-box !important;">「在看」</strong>&nbsp;<strong style="max-width: 100%;outline: 0px;line-height: 1.75em;overflow-wrap: break-word !important;box-sizing: border-box !important;">「点赞」</strong>&nbsp;<strong style="max-width: 100%;outline: 0px;line-height: 1.75em;overflow-wrap: break-word !important;box-sizing: border-box !important;">「收藏」</strong></span><span style="font-size: 14px;max-width: 100%;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;box-sizing: border-box !important;">&nbsp;三连啊喂！</span></span></section><blockquote data-tool="mdnice编辑器" style="margin-top: 20px;margin-bottom: 20px;padding: 15px 20px;border-left-color: rgb(53, 179, 120);color: rgb(106, 115, 125);line-height: 27px;font-size: 0.9em;max-width: 100%;border-top: none;border-right: none;border-bottom: none;overflow: auto;background: rgb(251, 249, 253);overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="font-size: 14px;">Hi，我是王知无，一个大数据领域的原创作者。&nbsp;</span></section><section style="max-width: 100%;line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="font-size: 14px;">放心关注我，获取更多行业的一手消息。</span></section></blockquote><section style="max-width: 100%;white-space: normal;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;line-height: normal;font-family: &quot;Helvetica Neue&quot;;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.4662576687116564" data-s="300,640" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/21_T7huEHTT4z45Jibay1ZebmsSSqiaeA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MPL7m13Yrluz8WJicNiaVRsiaCqArkyO99exPDGicFIH6AF7ZWRpT7huEHTT4z45Jibay1ZebmsSSqiaeA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="978" style="height: 241px;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;widows: 1;color: rgb(255, 97, 149);font-size: 15px;letter-spacing: 1px;border-radius: 30px;box-shadow: rgb(150, 150, 150) 0em 0em 0.5em 0px;width: 518px;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="padding-right: 0.5em;padding-left: 0.5em;max-width: 100%;text-align: left;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;line-height: normal;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><br  /></section><section style="padding-right: 0.5em;padding-left: 0.5em;max-width: 100%;text-align: left;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;line-height: normal;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><br  /></section><section style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.10979228486646884" src="图片/大数据技术与架构_2022-01-12_2022年最新版 ｜ Flink经典线上问题小盘点/22_zrkyKUN5kNeUFicVC3bMP1GEqKz1OQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/BSBqCXrZtzAicMToibKuIysLrB62M5A5YaLhZg6z86tI7ZeEZqTLLYyNrmlzrkyKUN5kNeUFicVC3bMP1GEqKz1OQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1011" style="height: 42px;color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);box-sizing: border-box;width: 384px;overflow-wrap: break-word !important;"  /></section><section style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247510040&amp;idx=1&amp;sn=aa335f25965975731173916f012d56f4&amp;chksm=fd3eee8dca49679b82f632048fb64d21fac01497d1a0fe33917edb01e194caf0f9a1930a55ce&amp;scene=21#wechat_redirect" textvalue="2022年全网首发|大数据专家级技能模型与学习指南(胜天半子篇)" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2">2022年全网首发|大数据专家级技能模型与学习指南(胜天半子篇)</a><br  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247508317&amp;idx=1&amp;sn=0bcb7fb6997b42306994b890eaa0d47f&amp;chksm=fd3ee7c8ca496ede347a2971002c6ea68dcfd70abeeb90b43c8b02a2a60ebc7cec3a87ef7d52&amp;scene=21#wechat_redirect" textvalue="互联网最坏的时代可能真的来了" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">互联网最坏的时代可能真的来了</a><br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247507860&amp;idx=1&amp;sn=807ac5003762f29c127bc4071dcebe33&amp;chksm=fd3e9901ca4910178cfc816043ea86c29f881f70cd943d252de9ae2e21cb7e8ba80bff162e1b&amp;scene=21#wechat_redirect" textvalue="我在B站读大学，大数据专业" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">我在B站读大学，大数据专业</a><br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247499604&amp;idx=1&amp;sn=d938dfb30d221774704982d2938b30c1&amp;chksm=fd3eb9c1ca4930d76a391241333de461ca22d2aa27472eab3cffab1564872ae37f1b48fe2d3c&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">我们在学习Flink的时候，到底在学习什么？</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504856&amp;idx=2&amp;sn=6f62e2a0c756ce56773eed253d2f41ee&amp;chksm=fd3e954dca491c5b732b7e2aa46db32efbc3f690e528522098659bb3c6e78e1582ab4529b5dc&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">193篇文章暴揍Flink，这个合集你需要关注一下</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504742&amp;idx=1&amp;sn=8765c198d8ad66219a7bcabb221e4a23&amp;chksm=fd3e95f3ca491ce52d0724b9e4154a47af0f5ea349e1e184c8fbc65aa17c0000242aa9b58429&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;letter-spacing: 0.544px;overflow-wrap: break-word !important;box-sizing: border-box !important;">Flink生产环境TOP难题与优化，阿里巴巴藏经阁YYDS</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504813&amp;idx=1&amp;sn=f5cd6ae2aa2b1e30f87a5ae55971c514&amp;chksm=fd3e9538ca491c2eb191677d070f2c7e4f1098eece00e256d6205b8a5d21b21c1e74f875f16f&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">Flink CDC我吃定了耶稣也留不住他！| Flink CDC线上问题小盘点</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=1&amp;sn=1f693e549f76622725b936041ff8896e&amp;chksm=e9bff2fbdec87bedecbdeed4547d7d612c72fc8d4918614a26a4e31666cf0128fd57b537f347&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">我们在学习Spark的时候，到底在学习什么？</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504834&amp;idx=1&amp;sn=46ca1a3924b8fdb89ac1c2acb0319d6c&amp;chksm=fd3e9557ca491c41d837b917639ea62007ea16d3c2cc6c0c02d1f8a8c6e44318f5183b787c46&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;letter-spacing: 0.544px;overflow-wrap: break-word !important;box-sizing: border-box !important;">在所有Spark模块中，我愿称SparkSQL为最强！</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247502750&amp;idx=1&amp;sn=bd9a9173d060dc4e4ebd49c8efc6acfe&amp;chksm=fd3e8d0bca49041dea84da93910e5efdc4935e520525c09887c986691377aeb48e5cf7fb5667&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">硬刚Hive | 4万字基础调优面试小总结</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504382&amp;idx=2&amp;sn=550b78802acfe727e0e77cd9195f8784&amp;chksm=fd3e976bca491e7db2b8b2446d231736df01bbf13653804d680ac4390597ec17fa466ad4ae83&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">数据治理方法论和实践小百科全书</a><br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503741&amp;idx=1&amp;sn=e5039be93123f2e337013756a818bfc3&amp;chksm=fd3e89e8ca4900fe603b63c5722a6fb8a32bd63d6ba23e0028851948a71b877eb1f742d95087&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">标签体系下的用户画像建设小指南</a><br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503675&amp;idx=1&amp;sn=3ee6af64d0126c78b48cad219308f81e&amp;chksm=fd3e89aeca4900b8b8954e9569ee3c0877881fac8c792bfafc22e7e9d3e8524da8eb860d33d8&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">4万字长文 | ClickHouse基础&amp;实践&amp;调优全视角解析</a><br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=2&amp;sn=57ecc77718f1b6f2f262d62e8318dcc9&amp;chksm=e9bff2fbdec87bedb1986765bfae7dbabb9aece45b0b2af147bbad1ac5d79ebc934c64df40ea&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">【面试&amp;个人成长】2021年过半，社招和校招的经验之谈</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504478&amp;idx=1&amp;sn=14efef3868ba42bd044f9618745a7fdc&amp;chksm=fd3e94cbca491dddb961b7b8b93105b2869c5bcf4c03f9f0dc83ad62be0dce4c124b52ed0ba3&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">大数据方向另一个十年开启 |《硬刚系列》第一版完结</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504410&amp;idx=1&amp;sn=7e81ab5a324395eb0f12397c40247ca1&amp;chksm=fd3e948fca491d9946456acbd93b2d651ae4d7a7d0127a211981e08f50f377e60d1b7c0d7b3a&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">我写过的关于成长/面试/职场进阶的文章</a></section><section style="max-width: 100%;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504783&amp;idx=1&amp;sn=72aed147a459368ed934a007a2df3bc9&amp;chksm=fd3e951aca491c0cade212390011eca7d8a68951fee6aa2844b8f4d14bcbd5b3ed26305d69dc&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">当我们在学习Hive的时候在学习什么？「硬刚Hive续集」</a></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></content>
</div>
</body>
</html>