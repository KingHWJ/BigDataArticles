<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"大数据技术与架构","title":"Flink SQL 在美团实时数仓中的增强与实践","time":"2023-04-10 17:45:11","timeStamp":"1681119911"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&mid=2247517991&idx=1&sn=50cc1013a59c6dcfada1a85a68e95137&chksm=fd3ec1b2ca4948a4aa3687eb6c114140623bb2cef89ba979214007e1bcaf285905ce932a8c6a#rd" target="_blank">Flink SQL 在美团实时数仓中的增强与实践</a></h1><div id="meta_content" class="rich_media_meta_list"><span class="rich_media_meta rich_media_meta_text">董剑辉&amp;张彬&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">大数据技术与架构&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2023-04-10 17:45:11</em></div><content><div class="reprint"><p>转自公众号：Apache Flink<br><a href="http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&mid=2247505034&idx=1&sn=85c5625ba31b88eb28c16386941e1d04" target="_blank" title="阅读原文">http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&mid=2247505034&idx=1&sn=85c5625ba31b88eb28c16386941e1d04</a></p></div><section powered-by="xiumi.us" data-mpa-powered-by="yiban.io"><section powered-by="xiumi.us"><section powered-by="xiumi.us"><section donone="shifuMouseDownCard(&#39;shifu_c_008&#39;)" label="Copyright Reserved by PLAYHUDONG."><section mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: normal;orphans: 2;text-align: justify;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;outline: 0px;color: rgb(34, 34, 34);font-size: 14.875px;text-size-adjust: auto;letter-spacing: 0.544px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;background-color: rgb(255, 255, 255);line-height: 23.625px;visibility: visible;"><section powered-by="xiumi.us" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section powered-by="xiumi.us" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-role="outer" label="Powered by 135editor.com" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-tools="135编辑器" data-id="98469" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" mp-original-font-size="16" mp-original-line-height="25" style="margin: 0px;padding: 0px 10px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-size: 14px;color: black;line-height: 21.875px;letter-spacing: 0px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;visibility: visible;"><blockquote data-tool="mdnice编辑器" mp-original-font-size="14.399999618530273" mp-original-line-height="23" style="margin: 20px 0px;padding: 10px 10px 10px 20px;border-left: 3px solid rgb(239, 112, 96);color: rgb(106, 115, 125);line-height: 20.125px;font-size: 12.6px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;border-top-style: none;border-right-style: none;border-bottom-style: none;overflow: auto;background-color: rgb(255, 249, 249);visibility: visible;"><p mp-original-font-size="16" mp-original-line-height="26" style="margin: 0px;padding: 8px 0px;clear: both;min-height: 1em;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-size: 14px;color: black;line-height: 22.75px;visibility: visible;"><span mp-original-font-size="14" mp-original-line-height="26" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: normal;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;color: rgb(89, 89, 89);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;letter-spacing: 0.544px;text-align: left;font-size: 12.25px;visibility: visible;line-height: 22.75px;"><strong mp-original-font-size="14" mp-original-line-height="26" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;visibility: visible;font-size: 12.25px;line-height: 22.75px;"><img class="rich_pages wxw-img" data-ratio="1" data-type="png" data-w="64" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/1_6VyhjNCMic3DGmPLZocTtEmtWBJKsQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2OP8CL6Mmrc9shxR4OiamrPMlRCKiaicf2n4JLNDRcyH1jfEKxo6VyhjNCMic3DGmPLZocTtEmtWBJKsQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1'" style="margin: 0px;padding: 0px;max-width: 100%;height: auto !important;overflow-wrap: break-word !important;vertical-align: text-bottom;outline: 0px;display: inline-block;font-size: 10.7188px;line-height: 19.9062px;box-sizing: border-box !important;visibility: visible !important;width: 20px !important;"  /><strong style="margin: 0px;padding: 0px;color: rgb(255, 41, 65);text-decoration: none;max-width: 100%;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: normal;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 249, 249);font-size: 14px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-size: 14px;color: rgb(255, 41, 65);"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247514568&amp;idx=1&amp;sn=659d7464a3b61ebf8397d2597069f4ab&amp;chksm=fd3eff5dca49764beef9ab14400e96715b86b3394f05e161181c03424fa579cdbc242a401411&amp;scene=21#wechat_redirect" textvalue="全网最全大数据面试提升手册！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" mp-original-font-size="14" mp-original-line-height="26" style="margin: 0px;padding: 0px;color: rgb(255, 41, 65);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: normal;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 249, 249);font-size: 14px;">全网最全大数据面试提升手册！</a></span></strong></strong></span></p></blockquote></section></section></section></section></section></section></section></section></section></section></section><section style="box-sizing: border-box;font-size: 16px;margin-bottom: 24px;"><section style="will-change: transform;box-sizing: border-box;" powered-by="xiumi.us"><section style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;"><section style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;"><section style="text-align: center;opacity: 1;box-sizing: border-box;" powered-by="xiumi.us"><section style="display: inline-block;width: 300px;height: 60px;vertical-align: top;overflow: hidden;padding-right: 10px;padding-left: 10px;box-sizing: border-box;"><section style="margin-top: -12px;margin-bottom: -12px;transform: scale(0.8);-webkit-transform: scale(0.8);-moz-transform: scale(0.8);-o-transform: scale(0.8);transform-origin: center center;-webkit-transform-origin: center center;-moz-transform-origin: center center;-o-transform-origin: center center;box-sizing: border-box;" powered-by="xiumi.us"><section style="opacity: 0.5;box-sizing: border-box;"><section style="font-size: 120px;color: rgb(216, 78, 106);line-height: 1;box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">01</strong></p></section></section></section></section></section><section style="transform-origin: center center;box-sizing: border-box;" powered-by="xiumi.us"><section style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;opacity: 1;box-sizing: border-box;"><section style="display: inline-block;width: auto;vertical-align: top;border-top: 1px solid rgb(229, 229, 229);border-top-left-radius: 0px;border-bottom: 1px solid rgb(229, 229, 229);border-bottom-right-radius: 0px;box-shadow: rgb(0, 0, 0) 0px 0px 0px;padding: 15px;align-self: flex-start;flex: 100 100 0%;height: auto;box-sizing: border-box;"><section style="opacity: 1;box-sizing: border-box;" powered-by="xiumi.us"><section style="font-size: 18px;color: rgb(62, 62, 62);letter-spacing: 0.5px;line-height: 1.7;box-sizing: border-box;"><p cid="n18" mdtype="heading" style="box-sizing: border-box;"><strong style="box-sizing: border-box;">Flink SQL 在美团</strong></p></section></section></section></section></section></section></section></section></section><h2 cid="n18" mdtype="heading" style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"></h2><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n20" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="253" data-backw="572" data-ratio="0.44166666666666665" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/2_n9kfzpDKxXSUpbHibd8Y1loZ6QpMBg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC321tvNqqVVkR5NygsrZnTVWiaoK8n9kfzpDKxXSUpbHibd8Y1loZ6QpMBg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">目前 Flink SQL 在美团已有 100+业务方接入使用，SQL 作业数也已达到了 5000+，在整个 Flink 作业中占比 35%，同比增速达到了 115%。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n24" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="226" data-backw="572" data-ratio="0.39537037037037037" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/3_ZeZKvAdCz5hfw91GCWDYNcT0D7ibBA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32hqC7mIHRnltwTTib5bUI0ennkVZeZKvAdCz5hfw91GCWDYNcT0D7ibBA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">SQL 作业的快速增长给我们带来了许多新的问题和挑战，主要包括以下几点：</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;">SQL 作业无法细粒度修改 StateTTL、并发等配置导致资源浪费。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;">SQL 修改逻辑无法从原先状态恢复。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-bottom: 0px;margin-top: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;">SQL 作业出现数据正确性问题难以排查。</span></section></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><br  /></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">下面将一一介绍这些问题以及如何解决。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="box-sizing: border-box;font-size: 16px;margin-bottom: 24px;"><section style="will-change: transform;box-sizing: border-box;" powered-by="xiumi.us"><section style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;"><section style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;"><section style="text-align: center;opacity: 1;box-sizing: border-box;" powered-by="xiumi.us"><section style="display: inline-block;width: 300px;height: 60px;vertical-align: top;overflow: hidden;padding-right: 10px;padding-left: 10px;box-sizing: border-box;"><section style="margin-top: -12px;margin-bottom: -12px;transform: scale(0.8);-webkit-transform: scale(0.8);-moz-transform: scale(0.8);-o-transform: scale(0.8);transform-origin: center center;-webkit-transform-origin: center center;-moz-transform-origin: center center;-o-transform-origin: center center;box-sizing: border-box;" powered-by="xiumi.us"><section style="opacity: 0.5;box-sizing: border-box;"><section style="font-size: 120px;color: rgb(216, 78, 106);line-height: 1;box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">02</strong></p></section></section></section></section></section><section style="transform-origin: center center;box-sizing: border-box;" powered-by="xiumi.us"><section style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;opacity: 1;box-sizing: border-box;"><section style="display: inline-block;width: auto;vertical-align: top;border-top: 1px solid rgb(229, 229, 229);border-top-left-radius: 0px;border-bottom: 1px solid rgb(229, 229, 229);border-bottom-right-radius: 0px;box-shadow: rgb(0, 0, 0) 0px 0px 0px;padding: 15px;align-self: flex-start;flex: 100 100 0%;height: auto;box-sizing: border-box;"><section style="opacity: 1;box-sizing: border-box;" powered-by="xiumi.us"><section style="font-size: 18px;color: rgb(62, 62, 62);letter-spacing: 0.5px;line-height: 1.7;box-sizing: border-box;"><p cid="n38" mdtype="heading" style="box-sizing: border-box;"><strong style="box-sizing: border-box;">SQL 作业细粒度配置</strong></p></section></section></section></section></section></section></section></section></section><h2 cid="n38" mdtype="heading" style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"></h2><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n40" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="287" data-backw="572" data-ratio="0.5009259259259259" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/4_1xdh8AibvnMPc6ibNlWgYaiaTS5l1w.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32T2h859lxoAhucqpRBeEzPRfRicg21xdh8AibvnMPc6ibNlWgYaiaTS5l1w/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">目前 Flink 不支持细粒度设置 TTL、算子间分区关系以及并发等配置。尤其是 TTL，在 DataStream 作业中，用户可以根据需求自定义决定状态保留的 TTL 时长，而 Flink SQL 作业目前 TTL 的设置只支持作业粒度，这会造成一定程度的资源浪费，下面我们来看两个具体的业务示例。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n44" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="310" data-backw="572" data-ratio="0.5416666666666666" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/5_zcOlpHSNjXw8vo3oCQdh33Ec7nTg8w.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32BWPE5yg4gO7icbvDCT8AjibwgIzcOlpHSNjXw8vo3oCQdh33Ec7nTg8w/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">第一个场景，不同算子对状态的保留时长不同。比如该作业的逻辑是去重后进行关联聚合，去重算子只需要设置 1h 的 TTL，而聚合算子要求 1 整天的数据，目前的解决方式只能是全部设置为 1 天，造成资源浪费。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n48" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="271" data-backw="572" data-ratio="0.4740740740740741" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/6_JoHzt7UjwwRj1ae6kbdryXBib6VJYA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32ovsVup2XFZearYXa9V9GdqiaJuJoHzt7UjwwRj1ae6kbdryXBib6VJYA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">第二个场景，Join 算子左右流的业务周期不一致，以及一些非公用的维表需要使用 Regular Join 感知维表的回撤。针对这类场景，目前只能将数据做冷热分离，分别和实时流以及维表做关联，并做数据去重，大大提高开发运维成本。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n52" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="316" data-backw="572" data-ratio="0.5518518518518518" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/7_Sh0a8buMLqhFic2piajzFAqMaxBzzQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32zVOqHJDJWEpB6piaSoB6mQPFgwdSh0a8buMLqhFic2piajzFAqMaxBzzQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">这个问题的难点在于 SQL 作业使用的状态对于用户都是黑盒，因此我们的目标是让用户低门槛地感知并修改 TTL。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">我们最终采取的解决方案是提供一套外置服务 graph-service，也叫可编辑执行计划。在上线前，我们利用这个服务静态分析用户作业的拓扑图，并采集展示 TTL，将其开放给用户编辑。当用户修改某算子或某流 TTL，再将新的 TTL 配置作为引擎参数传递给 Flink 引擎，增强执行计划。这里面涉及的两个核心流程是采集 TTL 和增强执行计划。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n58" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="307" data-backw="572" data-ratio="0.5361111111111111" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/8_TxibPOjFuiajYbUyuqFNBBKhKknYKA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32NWooAY3LbNiawOiaSXC9mGdicReb5TxibPOjFuiajYbUyuqFNBBKhKknYKA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">首先来看采集 TTL，需要考虑两个问题。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">第一个问题是在哪个阶段采集 TTL 信息。因为 Flink 的 TTL 信息与状态绑定，只有在创建具体的状态描述符时才能知晓，而 Transformation 层无法得知作业的状态情况，因此我们最终决定在 ExecNode 到 Transformation 的转换过程中采集 TTL 信息。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">第二个问题是怎么标识 TTL。我们给 ExecNode 增加了如 Transformation ID 一样的标识，并引入了一个工作栈，存储正在被翻译的 ExecNode。每次 ExecNode 在调用 translateToPlanInternal 方法前，我们获取自增的 ExecNode ID，并将其插入到工作栈中。当 ExecNode 的翻译结束后，从栈顶移除，再建立 Transformation 到 ExecNode，再到 TTL 的映射关系。</span></section></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n68" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="311" data-backw="572" data-ratio="0.5435185185185185" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/9_XiaYw9yLLRBkTMzztFRpzAFcwScZEA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32qmmKOPMszeiacpVBdCBDjEU8ymXiaYw9yLLRBkTMzztFRpzAFcwScZEA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">其次我们来看如何增强执行计划，上面是一个模拟的作业拓扑图，通过分析我们能采集到 Join 算子和聚合算子的 TTL 信息，以及 Transformation ID 和 ExecNode ID，然后我们开放给用户编辑，假设用户将 Join 算子的 TTL 从 1 天设置为 1 小时。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">之后我们将新的 TTL 配置传入到引擎的 TableConfig 中。当 Join 算子调用 TranslateToPlanInternal 时，它在创建状态读取 TTL 配置的过程中读取工作栈栈顶获取当前正在被翻译的 ExecNode，从而得到 ExecNode ID，再从 TableConfig 中读取对应的 TTL 配置，覆盖默认配置。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n74" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="314" data-backw="572" data-ratio="0.5481481481481482" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/10_Z9O9qxCbS0FSA46zQcbyJOPYG5lOjg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC323BO0m4SfibkwiaiapbwucVk37fgZ9O9qxCbS0FSA46zQcbyJOPYG5lOjg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">上图是第一个场景的作业测试效果。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">首先不使用我们的能力，默认将作业整体的 TTL 设置为 1 天。可以发现在高峰期平均每小时的 Container CPU 使用率上升到了 107%，即使在低峰期也有 67.3%，且过程中算子出现了几次反压。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">之后我们使用精细化设置 TTL 能力，将去重算子设置为 1 小时，其他有状态算子 TTL 仍保留 1 天，在高峰期平均每小时的 Container CPU 使用率仅有 14.8%，而在低峰期则为 7.54%，且过程中无任何反压。除此之外，Checkpoint 大小也从 8.54G 降低到了 1.8G。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n82" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="318" data-backw="572" data-ratio="0.5555555555555556" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/11_9NxqrrWQ9M9OVDnXbcyDyV7dkOcKNg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32VOFmJPkNXPibKZJcC1dic1h9Fu9NxqrrWQ9M9OVDnXbcyDyV7dkOcKNg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">接下来是可编辑执行计划提供的其他能力优化。首先是分区关系，作业内上下游算子连接数过多，会占用较大的 Network buffer 内存，从而影响作业的正常启停，基于可编辑执行计划能力，我们可以手动将 Rebalance 边修改为 Rescale。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">比如上图的示例，左边上游算子有 2000 个并发，而下游的 Sink 算子只有 1000 个并发。在这种场景下，Flink SQL 会默认生成 Rebalance 的连接方式，共需 2000*1000，共 200 万个逻辑连接。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">通过可编辑执行计划能力，我们手动将 Rebalance 设置为 Rescale 后，它只需要 2000 个连接，大大降低了 Network buffer 的内存需求。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">除此之外，我们基于可编辑执行计划还提供了以下三种能力：</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">支持单独修改算子并发并从状态恢复。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;margin-bottom: 8px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">支持单独修改算子的 slotSharingGroup。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 0px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">支持修改 ChainStrategy 并从状态恢复。</span></section></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="box-sizing: border-box;font-size: 16px;margin-bottom: 24px;"><section style="will-change: transform;box-sizing: border-box;" powered-by="xiumi.us"><section style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;"><section style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;"><section style="text-align: center;opacity: 1;box-sizing: border-box;" powered-by="xiumi.us"><section style="display: inline-block;width: 300px;height: 60px;vertical-align: top;overflow: hidden;padding-right: 10px;padding-left: 10px;box-sizing: border-box;"><section style="margin-top: -12px;margin-bottom: -12px;transform: scale(0.8);-webkit-transform: scale(0.8);-moz-transform: scale(0.8);-o-transform: scale(0.8);transform-origin: center center;-webkit-transform-origin: center center;-moz-transform-origin: center center;-o-transform-origin: center center;box-sizing: border-box;" powered-by="xiumi.us"><section style="opacity: 0.5;box-sizing: border-box;"><section style="font-size: 120px;color: rgb(216, 78, 106);line-height: 1;box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">03</strong></p></section></section></section></section></section><section style="transform-origin: center center;box-sizing: border-box;" powered-by="xiumi.us"><section style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;opacity: 1;box-sizing: border-box;"><section style="display: inline-block;width: auto;vertical-align: top;border-top: 1px solid rgb(229, 229, 229);border-top-left-radius: 0px;border-bottom: 1px solid rgb(229, 229, 229);border-bottom-right-radius: 0px;box-shadow: rgb(0, 0, 0) 0px 0px 0px;padding: 15px;align-self: flex-start;flex: 100 100 0%;height: auto;box-sizing: border-box;"><section style="opacity: 1;box-sizing: border-box;" powered-by="xiumi.us"><section style="font-size: 18px;color: rgb(62, 62, 62);letter-spacing: 0.5px;line-height: 1.7;box-sizing: border-box;"><p cid="n101" mdtype="heading" style="box-sizing: border-box;"><strong style="box-sizing: border-box;">SQL 作业变更支持从状态恢复</strong></p></section></section></section></section></section></section></section></section></section><h2 cid="n101" mdtype="heading" style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"></h2><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n103" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="296" data-backw="572" data-ratio="0.5175925925925926" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/12_SjnNUp0WazkLL8hiaoOayo5vOjKdMw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC327dGHKZnBlFLRfxDrjmn74eVZKSjnNUp0WazkLL8hiaoOayo5vOjKdMw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">目前 Flink SQL 的状态恢复机制较为严苛，在很多场景下，作业变更无法从原先状态恢复，造成了大量的资源浪费和运维成本。针对这个问题，我们对状态迁移这个问题域做了详细的场景分析。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink SQL 作业变更可以分为两类场景，版本升级（Upgrade）和同版本内的作业升级（Migration）。进一步地，我们聚焦实时数仓下的 Migration 场景，大致可以分为三种，Graph Migration、Operator Migration、SavepointMigration。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;"><section style="text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 0px;"><span style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;">Graph Migration：作业的变更仅发生在 Pipleline 的拓扑结构层面，即节点与边的属性发生变化。这类场景我们可以通过分享的第一个工作可编辑执行计划来解决。</span></section></li><li style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;"><section style="text-align: left;line-height: 1.75em;margin-bottom: 8px;margin-top: 0px;"><span style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;">Operator Migration：作业变更仅发生在算子状态层级，DAG 不发生变化。这类场景包括新增了一些聚合指标、关联新增属性等等。</span></section></li><li style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;"><p style="text-align: left;line-height: 1.75em;margin-top: 0px;margin-bottom: 0px;"><span style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;">SavepointMigration：作业在 DAG 层面和算子状态同时发生变更。对应的场景是用离线数据为新任务初始化状态。</span></p></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">我们可以看到 SavepointMigration 主要是 Graph Migration 和 Operator Migration 的复合场景。因此我们本次分享主要聚焦 Operator Migration 场景。通过我们针对 Graph Migration 和 Operator Migration 实现的能力的组合，我们计划在后续的工作中再去完善 SavepointMigration。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n119" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="300" data-backw="572" data-ratio="0.524074074074074" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/13_tsgwSOL8aprOtsia5fmLCnljXxkPDA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32aSnX051mUfNfaLKPEfPvEyPrGtsgwSOL8aprOtsia5fmLCnljXxkPDA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">结合美团目前的业务需求，当前最为迫切的场景是用户在 DWD 层关于宽表加工场景对事实表关联需要加属性，以及 DWS 层需要增加聚合指标，即前文所讨论的 Operator Migration 场景。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n123" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="306" data-backw="572" data-ratio="0.5351851851851852" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/14_1AROmczYdKTbyHZD5U5DJL0aeDWWUQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC3208UloVibjBYcpkbvaNNa9zrL71AROmczYdKTbyHZD5U5DJL0aeDWWUQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">首先，我们定义了一个名为 KeyedStateMetadata 的数据结构用来标识每个 KeyedState 的元数据，在创建算子时我们将状态元数据信息（KeyedStateMetatda）注入到静态的上下文中，并在解析用户作业执行图时获取。在之后的迁移状态过程中，我们结合状态元数据和 State-Process-API 来创建一个新的 Savepoint，完成状态迁移。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">上图是一个迁移聚合算子的示例。首先我们收集聚合算子的 KeyedStateMetadata，然后读取老的 Savepoint，利用 State-Process-API 将当中的状态进行转换。最后我们将新的状态 dump 到新的 Savepoint 中，并让这个作业从新的 Savepoint 中恢复。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n129" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="312" data-backw="572" data-ratio="0.5462962962962963" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/15_bEUubUsWy3FUMXapiaVCsc4BoaCQOg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32BXHibTYibib1xtzZgs4MonicrtD9gbEUubUsWy3FUMXapiaVCsc4BoaCQOg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">下面我们来介绍一下 KeyedStateMetadata 的结构。首先一个算子可能有一个或多个 Keyed State，而每个 Keyed State 都会对应一个 KeyedStateMetadata，针对每个 KeyedStateMetadata 我们会存储的状态元数据信息包括状态名、状态的数据类型、TTL 配置、自定义的 StateContext 接口。其中 StateContext 是用来检测两个状态 Schema 是否兼容的一个接口设计。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">上图右侧是一个具体的示例。首先看 AppendOnlyTopNFunction，我们会采集到它的状态名 data-state-with-append、它的两个数据类型以及它的 TTL 是 1 天，最终我们会为它建立一个叫做 RankStateContext 的上下文结构，用来在状态兼容性校验中检测它的状态 Schema 是否与其他状态兼容。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n135" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="283" data-backw="572" data-ratio="0.49537037037037035" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/16_zMBlY9YQHCibmHeYeGAOicOnQxte3Q.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32Qf2jtVOekhVfArGTDAvl7bjWsPzMBlY9YQHCibmHeYeGAOicOnQxte3Q/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">通过采取状态元数据信息和 State-Process-API，我们解决了状态迁移的技术难点，但为了定义清晰的状态迁移能力边界以及避免用户在未支持的场景下使用状态迁移能力失败，造成的资源浪费、运维成本，我们提供了事前分析的能力。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">事前分析能力可以分为以下三层校验：</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;"><p style="text-align: left;line-height: 1.75em;margin-top: 0px;margin-bottom: 8px;"><span style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;">SQL 层使用 AST 做业务逻辑兼容性校验。</span></p></li><li style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;"><p style="text-align: left;line-height: 1.75em;margin-top: 0px;margin-bottom: 8px;"><span style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;">基于可编辑执行计划做拓扑逻辑兼容性校验。</span></p></li><li style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;"><section style="text-align: left;line-height: 1.75em;margin-bottom: 0px;margin-top: 0px;"><span style="letter-spacing: 0.5px;color: rgb(89, 89, 89);font-size: 15px;">状态 Schema 兼容性校验。</span></section></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">这里补充一下为什么我们需要业务逻辑兼容性校验，因为状态 Schema 的兼容校验更多是基于底层的技术能力的视角，它本身不具有可识别业务语义的特征，比如 sum 和 max 对应到状态上的数据类型是一样的，但在业务语义上这两者是完全无法兼容的，因此我们在这里增加了对业务逻辑进行兼容性校验的补充，确保用户会用、用对状态迁移能力。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n151" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="313" data-backw="572" data-ratio="0.5472222222222223" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/17_bpCmvUUlAfgfFeNXLgjKReXZPicjag.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32Lz84VOaE0OsIA9kF1nhYPxjAMbpCmvUUlAfgfFeNXLgjKReXZPicjag/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">那么基于前面的三层校验，我们一共会有四种分析结果，分别对应的技术语义和业务语义如下：</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">COMPATIBLE_AS_IS，指作业可以直接从老状态恢复，对应的含义是新老作业是没有发生任何变化。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="orphans: 4;text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">COMPATIBLE_AFTER_RENAME，指作业通过调整 Operator ID 后可从老状态恢复。它对应的业务场景是修改算子并发或者调整作业的 chain 逻辑等。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">COMPATIBLE_AFTER_MIGRATION，指作业不可直接从老状态恢复，必须通过状态迁移制作新状态后，可从新状态恢复。对应的场景是新增聚合、去重以及 Join 等算子指标或者字段，也是我们本次分享重点所解决的场景。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">INCOMPATIBLE，指作业的新老状态完全不兼容，且无法通过迁移制作任何新状态。对应的场景是其他 SQL 逻辑改动，如交换指标顺序，增减算子以及一些我们可能仍未支持状态迁移的场景。这个也是我们后续对状态迁移需要完善的工作方向之一。</span></section></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n165" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="313" data-backw="572" data-ratio="0.5472222222222223" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/18_t7ylAcwHJaG5XdIU8kvI5tJgflOLRA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32dic31CQb4KtsvJfGYKHjrF688t7ylAcwHJaG5XdIU8kvI5tJgflOLRA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">下面我们来具体介绍一下事前分析的检验流程。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">首先新老作业的 SQL，我们将它解析得到 AST。然后需要确保新作业的指标业务语义是向后兼容老作业的，比如指标顺序调换，这个就是在这一层进行校验。如果发现不兼容，会直接返回 INCOMPATIBLE 的校验结果。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">之后利用 graph-service 将它翻译成 MTJsonPlan，然后校验算子个数是否不一致，以及作业拓扑图是否发生了变化。如果这两个有任意条件没有通过，都会返回 INCOMPATIBLE 的检验结果。如果这两个结果都通过，我们会计算得到新老算子的映射 Map，并对这个映射 Map 中的每一对新老算子检查是否都有状态或是否都有 TTL，以及是否可以通过状态迁移的能力进行恢复。如果当中任意条件不满足，都会返回 INCOMPATIBLE 的检验结果。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">当以上条件都满足后，我们会检验它的新老算子状态是否需要迁移。如果需要迁移，我们会返回 COMPATIBLE_AFTER_MIGRATION 的结果。而如果新老算子的状态不需要迁移就可以恢复的话，我们会再进一步校验它的 Operate ID 是否发生了变化。如果发生了变化，我们会返回 COMPATIBLE_AFTER_RENAME 的校验结果。如果没有发生变化，我们会认为这个作业的分析结果是 COMPATIBLE_AS_IS，即这个作业和老作业没有任何变化。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n175" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="288" data-backw="572" data-ratio="0.5037037037037037" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/19_QP42OiabEVpdicuNeqxN9OkKRbDEXw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32rMreYn4YLTLTagm5FWwZGYxCiaRQP42OiabEVpdicuNeqxN9OkKRbDEXw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">上图是我们的产品示例，在选择制作新的 Savepoint 迁移时会进行事前分析进行校验，以上是校验结果不一致的情况，因为我对新老作业做了交换指标顺序的修改。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n179" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="289" data-backw="572" data-ratio="0.5055555555555555" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/20_XpyUawricbNjI4pNVXRSb8LxV0MX4g.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32PcI3j1Jib5PbDW8gGQWF2jOdXiaXpyUawricbNjI4pNVXRSb8LxV0MX4g/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">最后总结一下针对状态迁移该问题域我们所做的工作。首先我们遇到了什么问题呢？</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">我们遇到的问题是 Flink SQL 原生提供的状态恢复能力较弱，无法支持作业变更。在美团实时数仓场景下，SQL 作业需要增加聚合指标或去重关联字段时无法从原先状态恢复，给用户的作业迭代造成了许多困难。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">针对这个问题，首先我们对状态迁移的问题域进行了详细的分析，细分了场景，并结合美团现状聚焦于 Migration 场景，支持了聚合增加指标、事实表关联以及去重、排序等场景下增加字段的状态迁移能力。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在此基础上，我们针对生产环境提供了事前分析能力，确保用户会用且用对状态迁移能力，避免无意义的资源浪费和运维成本。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="box-sizing: border-box;font-size: 16px;margin-bottom: 24px;"><section style="will-change: transform;box-sizing: border-box;" powered-by="xiumi.us"><section style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;"><section style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;"><section style="text-align: center;opacity: 1;box-sizing: border-box;" powered-by="xiumi.us"><section style="display: inline-block;width: 300px;height: 60px;vertical-align: top;overflow: hidden;padding-right: 10px;padding-left: 10px;box-sizing: border-box;"><section style="margin-top: -12px;margin-bottom: -12px;transform: scale(0.8);-webkit-transform: scale(0.8);-moz-transform: scale(0.8);-o-transform: scale(0.8);transform-origin: center center;-webkit-transform-origin: center center;-moz-transform-origin: center center;-o-transform-origin: center center;box-sizing: border-box;" powered-by="xiumi.us"><section style="opacity: 0.5;box-sizing: border-box;"><section style="font-size: 120px;color: rgb(216, 78, 106);line-height: 1;box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">04</strong></p></section></section></section></section></section><section style="transform-origin: center center;box-sizing: border-box;" powered-by="xiumi.us"><section style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;opacity: 1;box-sizing: border-box;"><section style="display: inline-block;width: auto;vertical-align: top;border-top: 1px solid rgb(229, 229, 229);border-top-left-radius: 0px;border-bottom: 1px solid rgb(229, 229, 229);border-bottom-right-radius: 0px;box-shadow: rgb(0, 0, 0) 0px 0px 0px;padding: 15px;align-self: flex-start;flex: 100 100 0%;height: auto;box-sizing: border-box;"><section style="opacity: 1;box-sizing: border-box;" powered-by="xiumi.us"><section style="font-size: 18px;color: rgb(62, 62, 62);letter-spacing: 0.5px;line-height: 1.7;box-sizing: border-box;"><p cid="n189" mdtype="heading" style="box-sizing: border-box;"><strong style="box-sizing: border-box;">SQL 正确性问题排查能力建设</strong></p></section></section></section></section></section></section></section></section></section><h2 cid="n189" mdtype="heading" style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"></h2><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n191" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="300" data-backw="572" data-ratio="0.524074074074074" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/21_yyuJALrlNl2zu0b2XjGCBpUcETy74g.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32DpicYMtiaJAQyILEib4b0mrZSY4yyuJALrlNl2zu0b2XjGCBpUcETy74g/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">美团在大力推广 Flink 作业 SQL 化，我们在运维业务 Flink SQL 作业时遇到了三类问题，分别为丢数问题、乱序问题及 FlinkSQL 使用不当导致的正确性问题。因缺少辅助工具，无法快速定位出问题，影响线上业务无法正常数据生产，阻碍 Flink 作业 SQL 化进程。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">对于业务的同学来讲是如何验证 Flink SQL 作业正确性的问题呢？有以下三种途径：</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="orphans: 4;text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink SQL 作业与已有的自研系统结果对比。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">通过实时作业与离线的作业结果对比。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink SQL 作业主备链路双跑结果对比。</span></section></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);letter-spacing: 0.5px;font-size: 15px;">通过以上三种方式，当业务发现 Flink SQL 作业有正确性的问题时，又面临了以下三大痛点问题。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">排查门槛很高，对于业务同学来讲不了解 Flink SQL 底层原理，对于平台同学来讲不了解用户业务。出现正确性的问题后，无从下手。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">排查定位周期长，由于没有可借助的工具，所以需要花费几天甚至更长时间定位问题。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">严重影响线上业务数据正常产出，用户不得不将 SQL 作业重新迁回到原来的作业上，这大大阻碍了 Flink 作业 SQL 化的进程。</span></section></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">为了解决用户的痛点问题，我们需要一套辅助系统。由于 Flink SQL 的作业只有最终结果，缺少中间记录过程。所以如果能记录下每一条数据在 Flink SQL 各个算子中的流转过程，对于排查定位问题是非常有帮助的，就像监控设备一样，可以通过回放监控录像来排查定位问题，基于这样的思路，我们就开发了一套辅助系统。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n217" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="290" data-backw="572" data-ratio="0.5074074074074074" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/22_YHSNHZEFTNLiaX8aWicrNnNvXSKPXQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32iajiavDgibLRK06g07XTicGc9SGT0icYHSNHZEFTNLiaX8aWicrNnNvXSKPXQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在开发这套系统之前，我们对业界相关的产品做了简单的调研。发现目前在分布式场景下故障排查有成熟的 Trace 系统，与我们要定位排查 Flink SQL 正确性问题非常类似。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">接下来我们先来简单了解下 Trace 系统的原理。如左上图所示，通过一次完整的 rpc 调用，经过 A、B、C、D、E 五个微服务中的访问，将服务依赖调用的 16 条记录都保存下来。Trace 系统会给每条完整的链路一个唯一 Trace ID 作为标记。通过 Trace ID 这个标记就可以关联起一条完整的调用链路。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">上图中左下角部分表示是一个完整的 Trace 系统所需要的三个重要环节，分别是数据埋点上报，数据收集分析，数据结果展示，这也是 Flink SQL 排查工具所需要的三个环节。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n225" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="236" data-backw="572" data-ratio="0.41203703703703703" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/23_jjTxIredQGVJHtFwC9icXmPYuLVtIw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC324iawPYNubuUcMOtcVsty9ZeCN7jjTxIredQGVJHtFwC9icXmPYuLVtIw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">简单了解了 Trace 系统之后，接下来我们将 Trace 系统与 Flink SQL 排查工具所需要的能力做下对比。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);letter-spacing: 0.5px;font-size: 15px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(89, 89, 89);letter-spacing: 0.5px;font-size: 15px;">Trace 系统的一次 rpc 调用具备全局关联性，而对于 Flink SQL 来说只能做到同一个 Task 间局部关联性。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(89, 89, 89);letter-spacing: 0.5px;font-size: 15px;">Trace 系统中数据上报需要业务在关键方法中手动埋点，但是对于 Flink SQL 来说手动埋点代价极高，我们期望与 Flink 引擎解耦，方便以后 Flink 版本升级维护。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="color: rgb(89, 89, 89);letter-spacing: 0.5px;font-size: 15px;">Trace 系统中数据量大，允许部分数据丢失，而 Flink SQL 排查工具是不允许数据丢失的，希望能支持打印部分算子的输入输出。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="color: rgb(89, 89, 89);letter-spacing: 0.5px;font-size: 15px;">Trace 系统中的数据有全局关联性可以做到自动归因，在 Flink 中数据没有全局关联性，只能手动分析不能做到自动归因。</span></section></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">通过对比发现 Trace 系统不适用于 Flink SQL 正确性问题排查，需要基于以上内容定制开发。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n241" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="320" data-backw="572" data-ratio="0.5592592592592592" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/24_mrcwibLdVjsUAgEdq84tHGxYzlw3Ng.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32iaKaHoiauIPTTQIYHFmmR2LvvD1mrcwibLdVjsUAgEdq84tHGxYzlw3Ng/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在讲解 Flink SQL 排查系统之前，我们简单回顾下 Flink 相关的知识点。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">首先是 Flink SQL 算子摸底 ，Flink SQL 涉及到的算子有 30+个，篇幅的原因我这里只列出了部分算子，算子非常多而且有些算子是通过 codegen 代码生成技术实现的。很显然我们要在 Flink SQL 算子埋点，开发成本很高。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">我们注意到这些算子有一个共同的特点就是都继承与 AbstractStreamOperator，而该类中有对 record 及 watermark 处理的关键方法，比如 setKeyContextElement1/2 与 processWatermark1/2。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n249" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="276" data-backw="572" data-ratio="0.4824074074074074" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/25_POImmKwpPib5zk7NKmSxn7jLxFvhaQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32YCwzGLAzNribKibfB6pWzsLxgc6POImmKwpPib5zk7NKmSxn7jLxFvhaQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">这部分是 Task 启动后数据是如何流转到 Operator 的过程。通过 MailboxProcessor 循环调用获取数据并将数据最终传递 OperatorChain，OperatorChain 将数据交由第一个 Operator 处理，也就是由 mainoperator 处理，这里就开始调用上面介绍 setKeyContextElement 及 processWatermark1 那几个方法，接下来我们看下这几个方法是如何在 OperatorChain 调用的。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n253" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="319" data-backw="572" data-ratio="0.5574074074074075" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/26_pmvJXWVANKU6bjd85JlqdFny9ZqQjw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC327MPS6J82qhmAVwFUe91BPOBkpmvJXWVANKU6bjd85JlqdFny9ZqQjw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">通过上面这张流程图我们发现，数据被处理之前都要经过 setKeyContextElement1/2 方法，数据流转到下一个 OperatorChain 时要调用 pushToRecordWriter 方法，对于 watermark 处理也类似。所以对这几个关键的方法进行监听，就能控制算子的输入输出了。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n257" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="300" data-backw="572" data-ratio="0.524074074074074" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/27_P7o9y4YcxROZfM27ibjEu1ibotXg2A.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32AzCX5XOSYUs8wMKMGPmw5nT08aP7o9y4YcxROZfM27ibjEu1ibotXg2A/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">有了上面的几个关键方法还不够，还需要解决数据解析的问题。这里可以看到 SQL 转换成 StreamGraph 后，StreamGraph 中的每个 StreamNode 都记录该算子的输入及输出类型信息。对于 Flink SQL 来说，数据传输类型都是序列化后的 rowdata。有了数据的类型信息，算子间传输的数据能正常解析出来吗？答案是肯定的，我这里先留一个疑问，后面在整体架构中会重点讲这部分的内容。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n261" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="288" data-backw="572" data-ratio="0.5037037037037037" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/28_1FkiczWb2onJ1PxwZdPZggBXhabVOg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32oRO53wxzFnmuEgKg1oxddMNUp1FkiczWb2onJ1PxwZdPZggBXhabVOg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">通过以上的技术分析，我们更加坚定使用字节码增强技术将数据解析过程与 Flink 引擎分离开，以方便后面 Flink 版本的维护升级，接下来详细介绍下整体架构及实现细节。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n265" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="294" data-backw="572" data-ratio="0.5148148148148148" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/29_VEgXMxyS81RsKgjkicialp62PsleSA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC320tnwJ2CIfu1n1NTcxYNIsoW226VEgXMxyS81RsKgjkicialp62PsleSA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">接下来看下整体架构，有五个部分组成。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">平台入口，用户在平台开启 Flink SQL Debug 功能调试作业，选择要输出数据的算子 ID 后，然后提交作业。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">TM 启动时，数据监听程序监听 Flink SQL 关键方法，解析算子的输入输出数据，图中的小齿轮代表着解析数据的 javaagent 程序。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">将解析后的数据同步发送到 Kafka 中。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">通过工具将 Kafka 中的数据同步到 OLAP 引擎中。</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">最后通过查询分析 OLAP 引擎 中的数据 ，排查定位问题。</span></section></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n281" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="303" data-backw="572" data-ratio="0.5296296296296297" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/30_aaRU7BCRwIzANJmpKr46WsAmGEvenA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32o5pfu9NHERdia3PdfbaoJUu82aaRU7BCRwIzANJmpKr46WsAmGEvenA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">首先是平台入口。从上图左侧可以看到，需要打开输入算子粒度的明细开关。另外，需要选择要在哪些算子上打印它的输入输出数据，有了这部分内容之后提交作业。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n285" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="253" data-backw="572" data-ratio="0.44166666666666665" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/31_5Qf6mWu2nYSclaCib4eoH3DbzE1K8w.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32iaic8zXMjfnOXq4s8NX1V3DPLF45Qf6mWu2nYSclaCib4eoH3DbzE1K8w/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">作业提交到 Yarn 之后，怎么监听算子数据呢？我们采用是 Byte Buddy 字节码增强框架实现对 Flink 算子数据的解析，通过监听以上关键的方法达到与 Flink 引擎解耦的目的，右边的图是数据解析程序输出的内容。下面对 Value 及 input_order 详细介绍一下。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n289" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="290" data-backw="572" data-ratio="0.5074074074074074" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/32_TKeTH2gPnlp2otDfFmF3GsKjnPKjaQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32XzfCyZrAia6w9ZJKQV1QjKaickTKeTH2gPnlp2otDfFmF3GsKjnPKjaQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在前面介绍中我们留有一个疑问，streamnode 中保存了输入输出类型信息，如何解析出数据呢？对于 Flink SQL 来说算子间传输的是序列化后的 Rowdata，可以通过固定方法通过传递类型及字段索引参数，调用 getField 方法就可以解析出数据了。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">这里只有解析后的数据，只有值没有字段信息，为什么要与字段信息管理起来呢？因为解析后的数据中有可能有多个相同的值，为了精准检索结果，需要将字段与数值对应起来。怎么获取字段信息并将数据与字段信息关联起来呢？在 SQL 转换成 Transformation 过程中，ExecNode 类中有个重要的 TranslateToPlan 方法，需要在该方法上增强，将算子的输入输出字段解析后保存在 StreamConfig 中，在解析程序中就可以将字段与数据关联起来了。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">这里有一个难点，对于普通 Flink SQL 是 OK 的，但对于数据湖场景的 Flink SQL 算子之间的数据传递不仅仅有序列化后的 RowData，还有 Kryo 类型的数据，如 HoodieRecord，HoodieRecord 的解析需要依赖 Hudi Schema 信息。这里在解析程序中是无法获取到的，有一个简单巧妙的办法，就是调用 HoodieRecord 的 toString 方法，在 toString 方法中让 Hudi 自身去解析，就可以高效灵活的解决数据湖场景下的数据解析的问题了。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n297" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="315" data-backw="572" data-ratio="0.55" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/33_DYAuyoib6yj2iaHyHViaiau1cXuJbA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32kJt7QwkTKXPEwNicg43RGUbpmhqEqDYAuyoib6yj2iaHyHViaiau1cXuJbA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">介绍完数据解析，接下来介绍的是数据在 Task 中关联性的问题，我们在字段中通过 input_order 记录了某个 sub_task 粒度的 record 输入顺序编号，用于标记数据在一个 Subtask 中的关联性。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">为什么要设计这个字段，是因为 chain 在一起的算子的字段可能不一样，比如 chain 在一起的有五个 Operator 前两个 Operator 都有 ID 字段，后三个 Operator 没有 ID 字段，如果根据 ID 查询，后三个 Operator 就没有数据，为了展示一条数据在 Subtask 中完整链路，所以指定同一个 Subtask 同一个 input_order 就可以说筛选出完整的数据链。后面 Case 分析也有介绍 input_order。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">对于数据关联性有以下三种情况：</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">对于同步算子之前数据传输，当数据经过 Subtask 所有的 Operator 处理后才能处理下一条数据。当数据进入 Subtask 的第一个 Operator 时 input_order +1，后面的 Operator 使用第一个 Operator 的 input_order，这些 Operator 的 input_order 要么一样或者要么部分为空。&nbsp;</span></section></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">对于开启了 mini-batch 功能后的算子，算子会攒批后处理，这一批数据也有关联性。</span></section></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">对于 LookupJoin，在同步情况下跟第一种情况是一样的，异步情况下算子间有相同的字段，可以通过该字段来关联算子关系。</span></p></li></ul><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n313" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="319" data-backw="572" data-ratio="0.5583333333333333" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/34_PUEkSdiazlNApPOsxw0IBhU5OQiaQA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32aia0hLj4UOawBjKbRuBB1KKkmibXPUEkSdiazlNApPOsxw0IBhU5OQiaQA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">以上的内容是如何解析数据，接下来介绍如何输出数据到 Kafka 中。为了避免冗余数据输出，默认情况下只打印除 Source 以外的所有算子的输入数据，以及除了 Sink 以外的所有 Task 中 tailOperator 的输出数据（当下游算子出现乱序时，可以追溯到上游算子数据情况），用户也可以只选择输出部分算子的数据。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">有了算子的输入输出规范之后，下面介绍数据是如何收集到 Kafka 中的。第一种方案是，把数据输出到日志文件中，通过日志收集的方式输出到 Kafka，通过测试报告发现，写入速度高峰时可以达到 600-800Mb/s，目前 TM 日志采用 rolling 方式保存，写入速度远远高于收集速度，有数据丢失的风险。所以该收集日志的方式不符合要求。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">所以我们采用了第二种方案，将算子的数据直接通过 socket 方式同步输出到 Kafka 中，如果写入的数据很快，收集的慢就会对上游算子产生反压，限制上游算子的处理发送数据的速率，既能保证业务的 SQL 可以顺利执行又能保证算子输出的数据不丢失保证完整的数据收集到 Kafka 中。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n321" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="292" data-backw="572" data-ratio="0.5111111111111111" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/35_TcjEFrMC278Q5uqxf7ybJtyMFOeXBw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32EmBSHaUUC1IkVqibW9xpV73xqTcjEFrMC278Q5uqxf7ybJtyMFOeXBw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">下面介绍下我们使用 Flink SQL 排查工具帮助业务解决问题的三类 Case。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Case1：Flink SQL 自身 bug 导致的正确性问题。如上图所示，用户的 SQL 很简单就是个 Deduplicate 去重的 SQL 作业。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">现象：存在丢数现象，丢数的 ID 不固定且无规律，但是用户可以提供丢数的 ID。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">结论：通过排查发现，其实是 Flink bug 导致的，就是 localtimestamp 函数存在精度上的 bug，在使用 to_date(cast(localtimestamp as varchar)，‘yyyy-MM-hh HH:mm:ss.SSS’)时，当时间为整秒（2022-05-01 12:10:10.000）时 to_date 函数解析失败，不满足条件，导致数据丢失，Flink SQL 作业却正常运行。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n331" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="318" data-backw="572" data-ratio="0.5564814814814815" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/36_u9hoRVpiaYBY9fcKibCHEdbb8tRuWw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32eSLLtfSib4n29wS9Fcm5emHpoiaMu9hoRVpiaYBY9fcKibCHEdbb8tRuWw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">通过 Flink SQL 排查工具，指定 ID，输入下面的查询 SQL，发现 Calc 只有输入数据，没有输出数据，判定在 Calc 算子中将该 ID 的值过滤掉了。在对照 calc codegen 代码逻辑及 Flink 代码发现在整点时存在 bug，导致数据丢失。解决这个 bug 就很简单了，只需要在 Flink 中实现对整点的精度处理的逻辑就行了。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">上面的查询中 Calc 有 ID 字段，当不存在 ID 字段时，这个时候就需要用 input_order 来关联一条数据在整个 Subtask 中的数据链了。如上图左下角的 SQL，指定 subtask id operator id 及 input_order 来查询这条数据的完整数据链。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n337" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="319" data-backw="572" data-ratio="0.5583333333333333" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/37_bTVDGZLqvJ1USJLy2NC6UTicv0HNSw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32xSZEpjrTuAkvAv7pfqibXMBwddbTVDGZLqvJ1USJLy2NC6UTicv0HNSw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Case2：Flink SQL 设计缺陷导致的正确性问题（乱序）。与 Flink SQL 自身 bug 的区别是，Flink SQL 自身 bug 是指，Flink SQL 能解决某类问题，但是有 bug，Flink SQL 设计缺陷是指 Flink SQL 解决不了某类问题。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">现象：用户 SQL 作业结果乱序导致结果不对。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">结论：Flink SQL Join 左右流 一对多关系，右流使用的是 NoUniqueKey，NoUniqueKey 使用的是 MapState，而 MapState 无法保证数据顺序，所以查询这类结果会有乱序的情况。除了此类问题，Flink SQL 中如果存在多次 Keyby 并且 Key 字段不一致也会导致乱序问题。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n345" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="318" data-backw="572" data-ratio="0.5564814814814815" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/38_o5LzQQYFv6md2MGPyEqoaDn9nLibtg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32wQVicl7ArXQaHSpMBstqeDA4NIo5LzQQYFv6md2MGPyEqoaDn9nLibtg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Case3：Flink SQL 使用不当导致的正确性问题。这类 Case 也非常常见。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">现象：用户 SQL 作业丢数导致结果不对。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">结论：经过工具排查，发现用户设置 State TTL 是 2 个小时，实际有超过了 2 小时的数据过来，状态过期，数据关联不上，丢数导致结果不对。除了 State TTL 设置不对的情况，还有业务自身逻辑，SQL 表达等使用问题。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">通过使用这个工具之后，有时候也可以证明 Flink SQL 作业没有问题，而是对比作业有问题。有了该工具后排查问题时长从天级别降低到了小时，甚至分钟级别，大大缩短了排查故障时长，得到了用户的认可与信赖，为 Flink 作业 SQL 化进程保驾护航。</span></section><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><section style="box-sizing: border-box;font-size: 16px;margin-bottom: 24px;"><section style="will-change: transform;box-sizing: border-box;" powered-by="xiumi.us"><section style="text-align: left;justify-content: flex-start;display: flex;flex-flow: row nowrap;box-sizing: border-box;"><section style="display: inline-block;width: 100%;vertical-align: top;align-self: flex-start;flex: 0 0 auto;box-sizing: border-box;"><section style="text-align: center;opacity: 1;box-sizing: border-box;" powered-by="xiumi.us"><section style="display: inline-block;width: 300px;height: 60px;vertical-align: top;overflow: hidden;padding-right: 10px;padding-left: 10px;box-sizing: border-box;"><section style="margin-top: -12px;margin-bottom: -12px;transform: scale(0.8);-webkit-transform: scale(0.8);-moz-transform: scale(0.8);-o-transform: scale(0.8);transform-origin: center center;-webkit-transform-origin: center center;-moz-transform-origin: center center;-o-transform-origin: center center;box-sizing: border-box;" powered-by="xiumi.us"><section style="opacity: 0.5;box-sizing: border-box;"><section style="font-size: 120px;color: rgb(216, 78, 106);line-height: 1;box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">05</strong></p></section></section></section></section></section><section style="transform-origin: center center;box-sizing: border-box;" powered-by="xiumi.us"><section style="text-align: center;justify-content: center;display: flex;flex-flow: row nowrap;opacity: 1;box-sizing: border-box;"><section style="display: inline-block;width: auto;vertical-align: top;border-top: 1px solid rgb(229, 229, 229);border-top-left-radius: 0px;border-bottom: 1px solid rgb(229, 229, 229);border-bottom-right-radius: 0px;box-shadow: rgb(0, 0, 0) 0px 0px 0px;padding: 15px;align-self: flex-start;flex: 100 100 0%;height: auto;box-sizing: border-box;"><section style="opacity: 1;box-sizing: border-box;" powered-by="xiumi.us"><section style="font-size: 18px;color: rgb(62, 62, 62);letter-spacing: 0.5px;line-height: 1.7;box-sizing: border-box;"><p cid="n355" mdtype="heading" style="box-sizing: border-box;"><strong style="box-sizing: border-box;">未来展望</strong></p></section></section></section></section></section></section></section></section></section><h2 cid="n355" mdtype="heading" style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"></h2><section style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></section><p cid="n357" mdtype="paragraph" style="margin-bottom: 24px;"><img class="rich_pages wxw-img" data-backh="229" data-backw="572" data-ratio="0.4" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/39_xRs3AyTg8DMfic6EwrOCxFwaFAkuyg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu6Jwra2InFf1nCJI1kORC32BPLbakM81nfmRUnxn49WQZjDuxRs3AyTg8DMfic6EwrOCxFwaFAkuyg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;display: block;margin: auto;width: 100%;height: auto;"  /></p><p style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">未来展望主要分为以下三部分：</span></p><p style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><br  /></span></p><ul class="list-paddingleft-1" style="list-style-type: disc;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink SQL 细粒度配置</span></section></li><ul class="list-paddingleft-1" style="list-style-type: square;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">在细粒度资源管理上，目前细粒度资源管理只支持 API 设置，所以也需要在 SQL 场景通过 Flink SQL 灵活配置的功能支持细粒度的资源管理。</span></section></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink SQL 灵活配置结合 Flink autopilot 机制搭配使用，使得 SQL 作业能自动调整到比较理想状态。</span></section></li></ul><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink SQL State</span></section></li><ul class="list-paddingleft-1" style="list-style-type: square;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(89, 89, 89);letter-spacing: 0.5px;">希望 Flink SQL State 具备可查询的能力。</span></section></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">探索 SQL 改变后支持以懒迁移方式从状态恢复。</span></section></li></ul><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">Flink SQL 排查工具</span></section></li><ul class="list-paddingleft-1" style="list-style-type: square;"><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><section style="text-align: left;margin-top: 0px;line-height: 1.75em;margin-bottom: 8px;"><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;">希望根据积累的经验，对 Flink SQL 支持上线前风险提示。</span></section></li><li style="font-size: 15px;color: rgb(89, 89, 89);letter-spacing: 0.5px;"><p style="text-align: left;margin-top: 0px;margin-bottom: 0px;line-height: 1.75em;"><span style="font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(89, 89, 89);letter-spacing: 0.5px;">解决发现的已知乱序及性能问题。</span></p></li></ul></ul><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="margin: 0px;padding: 0px 10px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;line-height: 1.6;letter-spacing: 0.034em;color: rgb(63, 63, 63);font-size: 16px;"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0.476px;text-indent: 0px;text-transform: none;white-space: normal;word-spacing: 0px;text-size-adjust: auto;-webkit-text-stroke: 0px rgb(178, 178, 178);font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.25px;font-family: &quot;Helvetica Neue&quot;;text-align: center;color: rgb(178, 178, 178);background-color: rgb(255, 255, 255);line-height: 21.4375px;visibility: visible;"><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0.476px;text-indent: 0px;text-transform: none;white-space: normal;word-spacing: 0px;text-size-adjust: auto;-webkit-text-stroke: 0px rgb(178, 178, 178);font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.25px;font-family: &quot;Helvetica Neue&quot;;text-align: center;color: rgb(178, 178, 178);background-color: rgb(255, 255, 255);line-height: 21.4375px;visibility: visible;"><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;color: rgb(74, 74, 74);font-size: 15px;">如果这个文章对你有帮助，不要忘记&nbsp;</span><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;outline: 0px;font-size: 15px;color: rgb(255, 104, 39);"><strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「在看」</strong>&nbsp;<strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「点赞」</strong>&nbsp;<strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「收藏」</strong></span><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;color: rgb(74, 74, 74);font-size: 15px;">&nbsp;三连啊喂！</span><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><p style="margin: 0px 0px 0em;padding: 0px;clear: both;min-height: 1em;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;text-align: center;"><img class="rich_pages wxw-img" data-ratio="1.6527777777777777" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/40_Zfh1Rf8hPd3euzJlYyfJq4081VB6Rg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PuHq9qaJwJpGeRJBMqMloibzfcYl12AoR2v9kgqyZz4CYuKZfh1Rf8hPd3euzJlYyfJq4081VB6Rg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1'" data-w="576" style="margin: 0px;padding: 0px;max-width: 100%;height: 380px;overflow-wrap: break-word !important;vertical-align: bottom;width: 230px;"  /><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;background-color: rgb(255, 255, 255);color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;"></span></p></section></section><section style="margin: 0px;padding: 0px;max-width: 100%;color: rgb(51, 51, 51);font-family: mp-quote, -apple-system-font, &quot;system-ui&quot;, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: normal;orphans: 2;text-align: justify;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.10979228486646884" src="图片/大数据技术与架构_2023-04-10_「转」Flink SQL 在美团实时数仓中的增强与实践/41_zrkyKUN5kNeUFicVC3bMP1GEqKz1OQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/BSBqCXrZtzAicMToibKuIysLrB62M5A5YaLhZg6z86tI7ZeEZqTLLYyNrmlzrkyKUN5kNeUFicVC3bMP1GEqKz1OQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1011" style="margin: 0px;padding: 0px;max-width: 100%;height: 42px;overflow-wrap: break-word !important;vertical-align: bottom;color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);box-sizing: border-box;width: 384px;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247510040&amp;idx=1&amp;sn=aa335f25965975731173916f012d56f4&amp;chksm=fd3eee8dca49679b82f632048fb64d21fac01497d1a0fe33917edb01e194caf0f9a1930a55ce&amp;scene=21#wechat_redirect" textvalue="2022年全网首发|大数据专家级技能模型与学习指南(胜天半子篇)" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">2022年全网首发|大数据专家级技能模型与学习指南(胜天半子篇)</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247508317&amp;idx=1&amp;sn=0bcb7fb6997b42306994b890eaa0d47f&amp;chksm=fd3ee7c8ca496ede347a2971002c6ea68dcfd70abeeb90b43c8b02a2a60ebc7cec3a87ef7d52&amp;scene=21#wechat_redirect" textvalue="互联网最坏的时代可能真的来了" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">互联网最坏的时代可能真的来了</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247507860&amp;idx=1&amp;sn=807ac5003762f29c127bc4071dcebe33&amp;chksm=fd3e9901ca4910178cfc816043ea86c29f881f70cd943d252de9ae2e21cb7e8ba80bff162e1b&amp;scene=21#wechat_redirect" textvalue="我在B站读大学，大数据专业" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">我在B站读大学，大数据专业</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247499604&amp;idx=1&amp;sn=d938dfb30d221774704982d2938b30c1&amp;chksm=fd3eb9c1ca4930d76a391241333de461ca22d2aa27472eab3cffab1564872ae37f1b48fe2d3c&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我们在学习Flink的时候，到底在学习什么？</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504856&amp;idx=2&amp;sn=6f62e2a0c756ce56773eed253d2f41ee&amp;chksm=fd3e954dca491c5b732b7e2aa46db32efbc3f690e528522098659bb3c6e78e1582ab4529b5dc&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">193篇文章暴揍Flink，这个合集你需要关注一下</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504742&amp;idx=1&amp;sn=8765c198d8ad66219a7bcabb221e4a23&amp;chksm=fd3e95f3ca491ce52d0724b9e4154a47af0f5ea349e1e184c8fbc65aa17c0000242aa9b58429&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">Flink生产环境TOP难题与优化，阿里巴巴藏经阁YYDS</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504813&amp;idx=1&amp;sn=f5cd6ae2aa2b1e30f87a5ae55971c514&amp;chksm=fd3e9538ca491c2eb191677d070f2c7e4f1098eece00e256d6205b8a5d21b21c1e74f875f16f&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">Flink CDC我吃定了耶稣也留不住他！| Flink CDC线上问题小盘点</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=1&amp;sn=1f693e549f76622725b936041ff8896e&amp;chksm=e9bff2fbdec87bedecbdeed4547d7d612c72fc8d4918614a26a4e31666cf0128fd57b537f347&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我们在学习Spark的时候，到底在学习什么？</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504834&amp;idx=1&amp;sn=46ca1a3924b8fdb89ac1c2acb0319d6c&amp;chksm=fd3e9557ca491c41d837b917639ea62007ea16d3c2cc6c0c02d1f8a8c6e44318f5183b787c46&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">在所有Spark模块中，我愿称SparkSQL为最强！</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247502750&amp;idx=1&amp;sn=bd9a9173d060dc4e4ebd49c8efc6acfe&amp;chksm=fd3e8d0bca49041dea84da93910e5efdc4935e520525c09887c986691377aeb48e5cf7fb5667&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">硬刚Hive | 4万字基础调优面试小总结</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504382&amp;idx=2&amp;sn=550b78802acfe727e0e77cd9195f8784&amp;chksm=fd3e976bca491e7db2b8b2446d231736df01bbf13653804d680ac4390597ec17fa466ad4ae83&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">数据治理方法论和实践小百科全书</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503741&amp;idx=1&amp;sn=e5039be93123f2e337013756a818bfc3&amp;chksm=fd3e89e8ca4900fe603b63c5722a6fb8a32bd63d6ba23e0028851948a71b877eb1f742d95087&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">标签体系下的用户画像建设小指南</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503675&amp;idx=1&amp;sn=3ee6af64d0126c78b48cad219308f81e&amp;chksm=fd3e89aeca4900b8b8954e9569ee3c0877881fac8c792bfafc22e7e9d3e8524da8eb860d33d8&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">4万字长文 | ClickHouse基础&amp;实践&amp;调优全视角解析</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=2&amp;sn=57ecc77718f1b6f2f262d62e8318dcc9&amp;chksm=e9bff2fbdec87bedb1986765bfae7dbabb9aece45b0b2af147bbad1ac5d79ebc934c64df40ea&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">【面试&amp;个人成长】2021年过半，社招和校招的经验之谈</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504478&amp;idx=1&amp;sn=14efef3868ba42bd044f9618745a7fdc&amp;chksm=fd3e94cbca491dddb961b7b8b93105b2869c5bcf4c03f9f0dc83ad62be0dce4c124b52ed0ba3&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">大数据方向另一个十年开启 |《硬刚系列》第一版完结</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504410&amp;idx=1&amp;sn=7e81ab5a324395eb0f12397c40247ca1&amp;chksm=fd3e948fca491d9946456acbd93b2d651ae4d7a7d0127a211981e08f50f377e60d1b7c0d7b3a&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我写过的关于成长/面试/职场进阶的文章</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504783&amp;idx=1&amp;sn=72aed147a459368ed934a007a2df3bc9&amp;chksm=fd3e951aca491c0cade212390011eca7d8a68951fee6aa2844b8f4d14bcbd5b3ed26305d69dc&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">当我们在学习Hive的时候在学习什么？「硬刚Hive续集」</a></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><section style="margin-bottom: 0px;outline: 0px;max-width: 100%;color: rgb(34, 34, 34);letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);font-family: system-ui, -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 16px;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="outline: 0px;max-width: 100%;letter-spacing: 0.544px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="outline: 0px;max-width: 100%;color: rgb(217, 78, 106);font-family: &quot;Microsoft YaHei&quot;, &quot;Segoe UI&quot;, system-ui, Roboto, &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif, Tahoma, &quot;Segoe UI SymbolMyanmar Text&quot;, 微软雅黑;font-size: 12px;white-space: pre-wrap;letter-spacing: 0.5px;box-sizing: border-box !important;overflow-wrap: break-word !important;"></span></strong></section><p style="display: none;margin-bottom: 24px;"><mp-style-type data-value="3"></mp-style-type></p></content>
</div>
</body>
</html>