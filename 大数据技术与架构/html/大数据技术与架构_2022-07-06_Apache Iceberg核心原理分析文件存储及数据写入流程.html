<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„","title":"Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹","time":"2022-07-06 18:10:57","timeStamp":"1657102257"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&mid=2247514427&idx=1&sn=4116b24cb48d4c0b3a89292640df17e6&chksm=fd3effaeca4976b8ab8a23221ab70a45f290158105a3ca60ffbef0f09a144dc416556cf91d4b#rd" target="_blank">Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹</a></h1><div id="meta_content" class="rich_media_meta_list"><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2022-07-06 18:10:57</em></div><content><div class="topic"><p>æ”¶å½•äºè¯é¢˜</p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU3MzgwNTU2Mg==&action=getalbum&album_id=1369031183400747008#wechat_redirect" title="å¤§æ•°æ®æˆç¥ä¹‹è·¯" target="_blank">#å¤§æ•°æ®æˆç¥ä¹‹è·¯</a></p></div><section mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-style: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0.47600001096725464px;orphans: auto;text-indent: 0px;text-transform: none;white-space: normal;widows: auto;word-spacing: 0px;-webkit-text-size-adjust: auto;-webkit-text-stroke-width: 0px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.25px;font-family: &quot;Helvetica Neue&quot;;-webkit-text-stroke-color: rgb(178, 178, 178);text-align: center;color: rgb(178, 178, 178);background-color: rgb(255, 255, 255);line-height: 21.4375px;visibility: visible;overflow-wrap: break-word !important;" data-mpa-powered-by="yiban.io"><span style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;visibility: visible;line-height: 16.4131px;font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;">ç‚¹å‡»ä¸Šæ–¹<strong mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;visibility: visible;font-size: 12.25px;line-height: 21.4375px;overflow-wrap: break-word !important;"><span mp-original-font-size="14" mp-original-line-height="17" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;line-height: 14.875px;color: rgb(87, 107, 148);-webkit-text-stroke-color: rgb(87, 107, 148);visibility: visible;box-sizing: border-box !important;overflow-wrap: break-word !important;">è“è‰²å­—ä½“</span></strong>ï¼Œé€‰æ‹©â€œè®¾ä¸ºæ˜Ÿæ ‡â€</span></section><section mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-style: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0.47600001096725464px;orphans: auto;text-indent: 0px;text-transform: none;white-space: normal;widows: auto;word-spacing: 0px;-webkit-text-size-adjust: auto;-webkit-text-stroke-width: 0px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.25px;font-family: &quot;Helvetica Neue&quot;;-webkit-text-stroke-color: rgb(178, 178, 178);text-align: center;color: rgb(178, 178, 178);line-height: 21.4375px;visibility: visible;overflow-wrap: break-word !important;"><span style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;visibility: visible;line-height: 16.4131px;font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;background-color: rgb(255, 255, 255);visibility: visible;line-height: 21.4375px;">å›å¤"</span><strong mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;visibility: visible;font-size: 12.25px;line-height: 21.4375px;overflow-wrap: break-word !important;"><span mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;background-color: rgb(255, 255, 255);color: rgb(255, 0, 0);visibility: visible;line-height: 21.4375px;box-sizing: border-box !important;overflow-wrap: break-word !important;">é¢è¯•"</span></strong><span mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;background-color: rgb(255, 255, 255);visibility: visible;line-height: 21.4375px;">è·å–æ›´å¤šæƒŠå–œ</span></span></section><section mp-original-font-size="14" mp-original-line-height="16" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-style: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0.47600001096725464px;orphans: auto;text-indent: 0px;text-transform: none;white-space: normal;widows: auto;word-spacing: 0px;-webkit-text-size-adjust: auto;-webkit-text-stroke-width: 0px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.25px;line-height: 14px;font-family: &quot;Helvetica Neue&quot;;-webkit-text-stroke-color: rgb(178, 178, 178);text-align: center;color: rgb(178, 178, 178);visibility: visible;overflow-wrap: break-word !important;"><span style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;background-color: rgb(255, 255, 255);visibility: visible;line-height: 10.7188px;font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img class="rich_pages wxw-img" data-ratio="0.0625" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/1_TMnLIpBq96wT1ibdccSSd3LVdSE3LQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/sq2uE6cicHYxoldXibjHyWbvjJfI6ibEm5Kw715uVJTBLdX1gkVpExwlFh22TMnLIpBq96wT1ibdccSSd3LVdSE3LQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1'" data-type="png" data-w="640" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;vertical-align: bottom;height: auto !important;font-size: 9.37890625px;line-height: 10.71875px;visibility: visible !important;overflow-wrap: break-word !important;width: 638px !important;"  /></span></section><section mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;color: rgb(34, 34, 34);font-size: 14.875px;font-style: normal;font-variant-caps: normal;font-weight: normal;orphans: auto;text-align: justify;text-indent: 0px;text-transform: none;white-space: normal;widows: auto;word-spacing: 0px;-webkit-text-size-adjust: auto;-webkit-text-stroke-width: 0px;letter-spacing: 0.544px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;background-color: rgb(255, 255, 255);line-height: 23.625px;visibility: visible;"><section powered-by="xiumi.us" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section powered-by="xiumi.us" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-role="outer" label="Powered by 135editor.com" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-tools="135ç¼–è¾‘å™¨" data-id="98469" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com" mp-original-font-size="16" mp-original-line-height="25" style="margin: 0px;padding: 0px 10px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-size: 14px;color: black;line-height: 21.875px;letter-spacing: 0px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;visibility: visible;"><blockquote data-tool="mdniceç¼–è¾‘å™¨" mp-original-font-size="14.399999618530273" mp-original-line-height="23" style="margin: 20px 0px;padding: 10px 10px 10px 20px;outline: 0px;border-left-width: 3px;border-style: none none none solid;border-left-color: rgb(239, 112, 96);color: rgb(106, 115, 125);font-size: 12.59999966621399px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;line-height: 20.125px;overflow: auto;background-color: rgb(255, 249, 249);visibility: visible;"><p mp-original-font-size="16" mp-original-line-height="26" style="margin: 0px;padding: 8px 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;clear: both;min-height: 1em;font-size: 14px;color: black;line-height: 22.75px;visibility: visible;"><img class="rich_pages wxw-img" data-ratio="1" data-type="png" data-w="20" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/2_vBcv0y1XsD2G4eGzwpWDB5zJ7WsXTw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/sq2uE6cicHYx7hRPkpj6kFISkZddB66TXddALsPHrNIMH29kxdMKMeBDdvBcv0y1XsD2G4eGzwpWDB5zJ7WsXTw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1'" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;vertical-align: text-bottom;height: auto !important;-webkit-text-stroke-color: rgb(178, 178, 178);color: rgb(178, 178, 178);font-family: &quot;Helvetica Neue&quot;;font-size: 8.75px;letter-spacing: 0.544px;display: inline-block;line-height: 16.250001430511475px;visibility: visible !important;width: 20px !important;"  /><span style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;visibility: visible;line-height: 13.3356px;font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong mp-original-font-size="15" mp-original-line-height="42" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;-webkit-text-stroke-color: rgb(178, 178, 178);font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;text-align: center;visibility: visible;line-height: 36.75px;font-size: 13.125px;"><a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247512011&amp;idx=1&amp;sn=68aaa9c5c42e2087d56d170c442b30ba&amp;scene=21#wechat_redirect" textvalue="ğŸ˜„è½»æˆ³æœ‰æƒŠå–œï¼šå…«è‚¡æ–‡æ•™ç»™æˆ‘ï¼Œâ€ä½ ä»¬ä¸“å¿ƒåˆ·é¢˜å’Œé¢è¯•" linktype="text" imgurl="" imgdata="null" tab="innerlink" data-linktype="2" wah-hotarea="click" mp-original-font-size="14" mp-original-line-height="22.75" style="margin: 0px;padding: 0px;outline: 0px;color: rgb(87, 107, 149);text-decoration: none;cursor: pointer;max-width: 100%;visibility: visible;line-height: 19.9062px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span mp-original-font-size="13.125" mp-original-line-height="16.493200302124023" style="margin: 0px;padding: 0px;outline: 0px;max-width: 100%;cursor: pointer;visibility: visible;line-height: 14.4316px;letter-spacing: 0.544px;color: rgb(255, 76, 0);box-sizing: border-box !important;overflow-wrap: break-word !important;">å…¨ç½‘æœ€å…¨å¤§æ•°æ®é¢è¯•æå‡æ‰‹å†Œï¼</span></a></strong></span></p></blockquote></section></section></section></section></section></section></section><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com" style="font-size: 16px;color: black;padding: 0 10px;line-height: 1.6;word-spacing: 0px;letter-spacing: 0px;word-break: break-word;word-wrap: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &#39;PingFang SC&#39;, Cambria, Cochin, Georgia, Times, &#39;Times New Roman&#39;, serif;"><h2 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: inline-block;font-weight: bold;background: rgb(239, 112, 96);color: #ffffff;padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">ç¬¬ä¸€éƒ¨åˆ†ï¼šIcebergæ–‡ä»¶å­˜å‚¨æ ¼å¼</span></h2><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">Apache Icebergä½œä¸ºä¸€æ¬¾æ–°å…´çš„æ•°æ®æ¹–è§£å†³æ–¹æ¡ˆåœ¨å®ç°ä¸Šé«˜åº¦æŠ½è±¡ï¼Œåœ¨å­˜å‚¨ä¸Šèƒ½å¤Ÿå¯¹æ¥å½“å‰ä¸»æµçš„HDFSï¼ŒS3æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸”æ”¯æŒå¤šç§æ–‡ä»¶å­˜å‚¨æ ¼å¼ï¼Œä¾‹å¦‚Parquetã€ORCã€AVROã€‚ç›¸è¾ƒäºHudiã€Deltaä¸Sparkçš„å¼ºè€¦åˆï¼ŒIcebergå¯ä»¥ä¸å¤šç§è®¡ç®—å¼•æ“å¯¹æ¥ï¼Œç›®å‰ç¤¾åŒºå·²ç»æ”¯æŒSparkè¯»å†™Icebergã€Impala/HiveæŸ¥è¯¢Icebergã€‚æœ¬æ–‡åŸºäºApache Iceberg 0.10.0ï¼Œä»‹ç»Icebergæ–‡ä»¶çš„ç»„ç»‡æ–¹å¼ä»¥åŠä¸åŒæ–‡ä»¶çš„å­˜å‚¨æ ¼å¼ã€‚</p><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">Iceberg Table Format</h5><figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0;margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.7364864864864865" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/3_mlOkO9IDJOzlMBtCE995NRzh7ASG5w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MIAhHH1mPG6Tdsg33w3ia0LAARhBibSo47ib7IdXWNwy7zng7mlOkO9IDJOzlMBtCE995NRzh7ASG5w/640?wx_fmt=png'" data-type="png" data-w="888" style="display: block;margin: 0 auto;max-width: 100%;"  /></figure><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°icebergå°†æ•°æ®è¿›è¡Œåˆ†å±‚ç®¡ç†ï¼Œä¸»è¦åˆ†ä¸ºå…ƒæ•°æ®ç®¡ç†å±‚å’Œæ•°æ®å­˜å‚¨å±‚ã€‚å…ƒæ•°æ®ç®¡ç†å±‚åˆå¯ä»¥ç»†åˆ†ä¸ºä¸‰å±‚ï¼š</p><ul data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: disc;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">VersionMetadata</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">Snapshot</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">Manifest</section></li></ul><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">VersionMetadataå­˜å‚¨å½“å‰ç‰ˆæœ¬çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ˆæ‰€æœ‰snapshotä¿¡æ¯ï¼‰ï¼›Snapshotè¡¨ç¤ºå½“å‰æ“ä½œçš„ä¸€ä¸ªå¿«ç…§ï¼Œæ¯æ¬¡commitéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå¿«ç…§ï¼Œä¸€ä¸ªå¿«ç…§ä¸­åŒ…å«å¤šä¸ªManifestï¼Œæ¯ä¸ªManifestä¸­è®°å½•äº†å½“å‰æ“ä½œç”Ÿæˆæ•°æ®æ‰€å¯¹åº”çš„æ–‡ä»¶åœ°å€ï¼Œä¹Ÿå°±æ˜¯data filesçš„åœ°å€ã€‚åŸºäºsnapshotçš„ç®¡ç†æ–¹å¼ï¼Œicebergèƒ½å¤Ÿè¿›è¡Œtime travelï¼ˆå†å²ç‰ˆæœ¬è¯»å–ä»¥åŠå¢é‡è¯»å–ï¼‰ï¼Œå¹¶ä¸”æä¾›äº†serializable isolationã€‚</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">æ•°æ®å­˜å‚¨å±‚æ”¯æŒä¸åŒçš„æ–‡ä»¶æ ¼å¼ï¼Œç›®å‰æ”¯æŒParquetã€ORCã€AVROã€‚</p><figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0;margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.28622540250447226" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/4_lxdKgoUdSic9zuXVw0ODcWY5n0VEug.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2MIAhHH1mPG6Tdsg33w3ia0LicTcLrGZDjLLlmS57CcPMOeTtLlxdKgoUdSic9zuXVw0ODcWY5n0VEug/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1118" style="display: block;margin: 0 auto;max-width: 100%;"  /></figure><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">ä¸‹é¢ä»¥HadoopTableOperation commitç”Ÿæˆçš„æ•°æ®ä¸ºä¾‹ä»‹ç»å„å±‚çš„æ•°æ®æ ¼å¼ã€‚icebergç”Ÿæˆçš„æ•°æ®ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">â”œâ”€â”€&nbsp;data<br  />â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;id=1<br  />â”‚&nbsp;&nbsp;&nbsp;â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;00000-0-04ae60eb-657d-45cb-bb99-d1cb7fe0ad5a-00001.parquet<br  />â”‚&nbsp;&nbsp;&nbsp;â”‚&nbsp;&nbsp;&nbsp;â””â”€â”€&nbsp;00000-4-487b841b-13b4-4ae8-9238-f70674d5102e-00001.parquet<br  />â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;id=2<br  />â”‚&nbsp;&nbsp;&nbsp;â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;00001-1-e85b018b-e43a-44d7-9904-09c80a9b9c24-00001.parquet<br  />â”‚&nbsp;&nbsp;&nbsp;â”‚&nbsp;&nbsp;&nbsp;â””â”€â”€&nbsp;00001-5-0e2be766-c921-4269-8e1e-c3cff4b98a5a-00001.parquet<br  />â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;id=3<br  />â”‚&nbsp;&nbsp;&nbsp;â”‚&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;00002-2-097171c5-d810-4de9-aa07-58f3f8a3f52e-00001.parquet<br  />â”‚&nbsp;&nbsp;&nbsp;â”‚&nbsp;&nbsp;&nbsp;â””â”€â”€&nbsp;00002-6-9d738169-1dbe-4cc5-9a87-f79457a9ec0b-00001.parquet<br  />â”‚&nbsp;&nbsp;&nbsp;â””â”€â”€&nbsp;id=4<br  />â”‚&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;00003-3-b0c91d66-9e4e-4b7a-bcd5-db3dc1b847f2-00001.parquet<br  />â”‚&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â””â”€â”€&nbsp;00003-7-68c45a24-21a2-41e8-90f1-ef4be42f3002-00001.parquet<br  />â””â”€â”€&nbsp;metadata<br  />&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae-m0.avro<br  />&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae-m1.avro<br  />&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;f475511f-877e-4da5-90aa-efa5928a7759-m0.avro<br  />&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;snap-2080639593951710914-1-1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae.avro<br  />&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;snap-5178718682852547007-1-f475511f-877e-4da5-90aa-efa5928a7759.avro<br  />&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;v1.metadata.json<br  />&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;v2.metadata.json<br  />&nbsp;&nbsp;&nbsp;&nbsp;â”œâ”€â”€&nbsp;v3.metadata.json<br  />&nbsp;&nbsp;&nbsp;&nbsp;â””â”€â”€&nbsp;version-hint.text<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">å…¶ä¸­metadataç›®å½•å­˜æ”¾å…ƒæ•°æ®ç®¡ç†å±‚çš„æ•°æ®ï¼š</p><ul data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: disc;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">version-hint.textï¼šå­˜å‚¨version.metadata.jsonçš„ç‰ˆæœ¬å·ï¼Œå³ä¸‹æ–‡çš„number</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">version[number].metadata.json</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">snap-[snapshotID]-[attemptID]-[commitUUID].avro(snapshotæ–‡ä»¶)</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">[commitUUID]-m-[manifestCount].avr- o(manifestæ–‡ä»¶)</section></li></ul><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">dataç›®å½•ç»„ç»‡å½¢å¼ç±»ä¼¼äºhiveï¼Œéƒ½æ˜¯ä»¥åˆ†åŒºè¿›è¡Œç›®å½•ç»„ç»‡ï¼ˆä¸Šå›¾ä¸­idä¸ºåˆ†åŒºåˆ—ï¼‰ï¼Œæœ€ç»ˆæ•°æ®å¯ä»¥ä½¿ç”¨ä¸åŒæ–‡ä»¶æ ¼å¼è¿›è¡Œå­˜å‚¨ï¼š</p><ul data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: disc;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">[sparkPartitionID]-[sparkTaskID]-[UUID]-[fileCount].[parquet | avro | orc]</section></li></ul><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">VersionMetadata</h5><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">//&nbsp;<br  />{<br  />&nbsp;&nbsp;//&nbsp;å½“å‰æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬ä¿¡æ¯<br  />&nbsp;&nbsp;//&nbsp;ç›®å‰ä¸ºversion&nbsp;1<br  />&nbsp;&nbsp;//&nbsp;æ”¯æŒrow-level&nbsp;deleteç­‰åŠŸèƒ½çš„version&nbsp;2è¿˜åœ¨å¼€å‘ä¸­<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"format-version"</span>&nbsp;:&nbsp;1,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"table-uuid"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"a9114f94-911e-4acf-94cc-6d000b321812"</span>,<br  />&nbsp;&nbsp;//&nbsp;hadoopTable&nbsp;location<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"location"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item"</span>,<br  />&nbsp;&nbsp;//&nbsp;æœ€æ–°snapshotçš„åˆ›å»ºæ—¶é—´<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"last-updated-ms"</span>&nbsp;:&nbsp;1608810968725,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"last-column-id"</span>&nbsp;:&nbsp;6,<br  />&nbsp;&nbsp;//&nbsp;iceberg&nbsp;schema<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"schema"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"struct"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"fields"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;1,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,&nbsp;//&nbsp;ç±»ä¼¼probufä¸­çš„required<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;2,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"order_id"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;3,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"product_id"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;4,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"product_price"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"decimal(7,&nbsp;2)"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;5,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"product_quantity"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;6,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"product_name"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"string"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;]<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partition-spec"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"transform"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"identity"</span>,&nbsp;//&nbsp;transformç±»å‹<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"source-id"</span>&nbsp;:&nbsp;1,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"field-id"</span>&nbsp;:&nbsp;1000<br  />&nbsp;&nbsp;}&nbsp;],<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"default-spec-id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;//&nbsp;åˆ†åŒºä¿¡æ¯<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partition-specs"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"spec-id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"fields"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;transformç±»å‹ï¼šç›®å‰æ”¯æŒidentityï¼Œyearï¼Œbucketç­‰<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"transform"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"identity"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;å¯¹åº”schema.fieldsä¸­ç›¸åº”fieldçš„ID<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"source-id"</span>&nbsp;:&nbsp;1,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"field-id"</span>&nbsp;:&nbsp;1000<br  />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;]<br  />&nbsp;&nbsp;}&nbsp;],<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"default-sort-order-id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"sort-orders"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"order-id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"fields"</span>&nbsp;:&nbsp;[&nbsp;]<br  />&nbsp;&nbsp;}&nbsp;],<br  />&nbsp;&nbsp;//&nbsp;hiveåˆ›å»ºè¯¥è¡¨å­˜å‚¨çš„ä¸€äº›hive&nbsp;propertyä¿¡æ¯<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"properties"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"totalSize"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"rawDataSize"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"numRows"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"COLUMN_STATS_ACCURATE"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"{\"BASIC_STATS\":\"true\"}"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"numFiles"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span><br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;//&nbsp;å½“å‰snapshot&nbsp;id<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"current-snapshot-id"</span>&nbsp;:&nbsp;2080639593951710914,<br  />&nbsp;&nbsp;//&nbsp;snapshotä¿¡æ¯<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshots"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshot-id"</span>&nbsp;:&nbsp;5178718682852547007,<br  />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;åˆ›å»ºsnapshotæ—¶é—´<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608809818168,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"summary"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;sparkå†™å…¥æ–¹å¼ï¼Œç›®å‰æ”¯æŒoverwriteä»¥åŠappend<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"operation"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"overwrite"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"spark.app.id"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"local-1608809790982"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"replace-partitions"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"true"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æœ¬æ¬¡snapshotæ·»åŠ çš„æ–‡ä»¶æ•°é‡<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-data-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æœ¬æ¬¡snapshotæ·»åŠ çš„recordæ•°é‡<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-records"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æœ¬æ¬¡snapshotæ·»åŠ çš„æ–‡ä»¶å¤§å°<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-files-size"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"7217"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æœ¬æ¬¡snapshotä¿®æ”¹çš„åˆ†åŒºæ•°é‡<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"changed-partition-count"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æœ¬æ¬¡snapshotä¸­recordæ€»æ•°&nbsp;=&nbsp;lastSnapshotTotalRecord&nbsp;-&nbsp;currentSnapshotDeleteRecord&nbsp;+&nbsp;currentSnapshotAddRecord<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-records"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-data-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-delete-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-position-deletes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-equality-deletes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest-list"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/snap-5178718682852547007-1-f475511f-877e-4da5-90aa-efa5928a7759.avro"</span><br  />&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshot-id"</span>&nbsp;:&nbsp;2080639593951710914,<br  />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;ä¸Šæ¬¡snapshotID<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"parent-snapshot-id"</span>&nbsp;:&nbsp;5178718682852547007,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608810968725,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"summary"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"operation"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"overwrite"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"spark.app.id"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"local-1608809790982"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"replace-partitions"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"true"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-data-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted-data-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-records"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted-records"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-files-size"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"7217"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"removed-files-size"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"7217"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"changed-partition-count"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-records"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-data-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-delete-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-position-deletes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-equality-deletes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;snapshotæ–‡ä»¶è·¯å¾„<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest-list"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/snap-2080639593951710914-1-1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae.avro"</span><br  />&nbsp;&nbsp;}&nbsp;],<br  />&nbsp;&nbsp;//&nbsp;snapshotè®°å½•<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshot-log"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608809818168,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshot-id"</span>&nbsp;:&nbsp;5178718682852547007<br  />&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608810968725,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshot-id"</span>&nbsp;:&nbsp;2080639593951710914<br  />&nbsp;&nbsp;}&nbsp;],<br  />&nbsp;&nbsp;//&nbsp;metadaè®°å½•<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"metadata-log"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608809758229,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"metadata-file"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/v1.metadata.json"</span><br  />&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608809818168,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"metadata-file"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/v2.metadata.json"</span><br  />&nbsp;&nbsp;}&nbsp;]<br  />}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">ä¸Šä¾‹å±•ç¤ºçš„æ˜¯v3.metadata.jsonä¸­çš„æ•°æ®ï¼Œè¯¥æ–‡ä»¶ä¿å­˜äº†iceberg table schemaã€partitionã€snapshotä¿¡æ¯ï¼Œpartitionä¸­çš„transformä¿¡æ¯ä½¿å¾—icebergèƒ½å¤Ÿæ ¹æ®å­—æ®µè¿›è¡Œhidden partitionï¼Œè€Œæ— éœ€åƒhiveä¸€æ ·æ˜¾ç¤ºçš„æŒ‡å®šåˆ†åŒºå­—æ®µã€‚ç”±äºVersionMetadataä¸­è®°å½•äº†æ¯æ¬¡snapshotçš„idä»¥åŠcreate_timeï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ—¶é—´æˆ–snapshotIdæŸ¥è¯¢ç›¸åº”snapshotçš„æ•°æ®ï¼Œå®ç°Time Travelã€‚</p><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">Snapshot</h5><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">//&nbsp;Snapshot:&nbsp;2080639593951710914<br  />//&nbsp;Location:&nbsp;hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/snap-2080639593951710914-1-1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae.avro<br  /><br  />//&nbsp;manifest&nbsp;entry<br  />{<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest_path"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae-m1.avro"</span>,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest_length"</span>&nbsp;:&nbsp;5291,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partition_spec_id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;//&nbsp;è¯¥manifest&nbsp;entryæ‰€å±çš„snapshot<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_snapshot_id"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;2080639593951710914<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;//&nbsp;è¯¥manifestä¸­æ·»åŠ çš„æ–‡ä»¶æ•°é‡<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;4<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;//&nbsp;åˆ›å»ºè¯¥manifestæ—¶å·²ç»å­˜åœ¨ä¸”<br  />&nbsp;&nbsp;//&nbsp;æ²¡æœ‰è¢«è¿™æ¬¡åˆ›å»ºæ“ä½œåˆ é™¤çš„æ–‡ä»¶æ•°é‡<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"existing_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;//&nbsp;åˆ›å»ºmanifeståˆ é™¤çš„æ–‡ä»¶<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;//&nbsp;è¯¥manifestä¸­partitionå­—æ®µçš„èŒƒå›´<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partitions"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"array"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"contains_null"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"lower_bound"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"bytes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"\u0001\u0000\u0000\u0000\u0000\u0000\u0000\u0000"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"upper_bound"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"bytes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"\u0004\u0000\u0000\u0000\u0000\u0000\u0000\u0000"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;]<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;4<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"existing_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;}<br  />}<br  />//&nbsp;manifest&nbsp;entry<br  />{<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest_path"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae-m0.avro"</span>,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest_length"</span>&nbsp;:&nbsp;5289,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partition_spec_id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_snapshot_id"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;2080639593951710914<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"existing_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;4<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partitions"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"array"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"contains_null"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"lower_bound"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"bytes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"\u0001\u0000\u0000\u0000\u0000\u0000\u0000\u0000"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"upper_bound"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"bytes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"\u0004\u0000\u0000\u0000\u0000\u0000\u0000\u0000"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;]<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"existing_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;4<br  />&nbsp;&nbsp;}<br  />}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">ä¸€ä¸ªsnapshotä¸­å¯ä»¥åŒ…å«å¤šä¸ªmanifest entryï¼Œä¸€ä¸ªmanifest entryè¡¨ç¤ºä¸€ä¸ªmanifestï¼Œå…¶ä¸­é‡ç‚¹éœ€è¦å…³æ³¨çš„æ˜¯æ¯ä¸ªmanifestä¸­çš„partitionså­—æ®µï¼Œåœ¨æ ¹æ®filterè¿›è¡Œè¿‡æ»¤æ—¶å¯ä»¥é¦–å…ˆé€šè¿‡è¯¥å­—æ®µè¡¨ç¤ºçš„åˆ†åŒºèŒƒå›´å¯¹manifestè¿›è¡Œè¿‡æ»¤ï¼Œé¿å…æ— æ•ˆçš„æŸ¥è¯¢ã€‚</p><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">Manifest</h5><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">//&nbsp;<br  />{<br  />&nbsp;&nbsp;//&nbsp;å½“å‰æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬ä¿¡æ¯<br  />&nbsp;&nbsp;//&nbsp;ç›®å‰ä¸ºversion&nbsp;1<br  />&nbsp;&nbsp;//&nbsp;æ”¯æŒrow-level&nbsp;deleteç­‰åŠŸèƒ½çš„version&nbsp;2è¿˜åœ¨å¼€å‘ä¸­<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"format-version"</span>&nbsp;:&nbsp;1,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"table-uuid"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"a9114f94-911e-4acf-94cc-6d000b321812"</span>,<br  />&nbsp;&nbsp;//&nbsp;hadoopTable&nbsp;location<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"location"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item"</span>,<br  />&nbsp;&nbsp;//&nbsp;æœ€æ–°snapshotçš„åˆ›å»ºæ—¶é—´<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"last-updated-ms"</span>&nbsp;:&nbsp;1608810968725,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"last-column-id"</span>&nbsp;:&nbsp;6,<br  />&nbsp;&nbsp;//&nbsp;iceberg&nbsp;schema<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"schema"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"struct"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"fields"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;1,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,&nbsp;//&nbsp;ç±»ä¼¼probufä¸­çš„required<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;2,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"order_id"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;3,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"product_id"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;4,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"product_price"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"decimal(7,&nbsp;2)"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;5,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"product_quantity"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>&nbsp;:&nbsp;6,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"product_name"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"required"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"type"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"string"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;]<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partition-spec"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"transform"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"identity"</span>,&nbsp;//&nbsp;transformç±»å‹<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"source-id"</span>&nbsp;:&nbsp;1,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"field-id"</span>&nbsp;:&nbsp;1000<br  />&nbsp;&nbsp;}&nbsp;],<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"default-spec-id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;//&nbsp;åˆ†åŒºä¿¡æ¯<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partition-specs"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"spec-id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"fields"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"name"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;transformç±»å‹ï¼šç›®å‰æ”¯æŒidentityï¼Œyearï¼Œbucketç­‰<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"transform"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"identity"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;å¯¹åº”schema.fieldsä¸­ç›¸åº”fieldçš„ID<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"source-id"</span>&nbsp;:&nbsp;1,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"field-id"</span>&nbsp;:&nbsp;1000<br  />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;]<br  />&nbsp;&nbsp;}&nbsp;],<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"default-sort-order-id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"sort-orders"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"order-id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"fields"</span>&nbsp;:&nbsp;[&nbsp;]<br  />&nbsp;&nbsp;}&nbsp;],<br  />&nbsp;&nbsp;//&nbsp;hiveåˆ›å»ºè¯¥è¡¨å­˜å‚¨çš„ä¸€äº›hive&nbsp;propertyä¿¡æ¯<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"properties"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"totalSize"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"rawDataSize"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"numRows"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"COLUMN_STATS_ACCURATE"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"{\"BASIC_STATS\":\"true\"}"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"numFiles"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span><br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;//&nbsp;å½“å‰snapshot&nbsp;id<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"current-snapshot-id"</span>&nbsp;:&nbsp;2080639593951710914,<br  />&nbsp;&nbsp;//&nbsp;snapshotä¿¡æ¯<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshots"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshot-id"</span>&nbsp;:&nbsp;5178718682852547007,<br  />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;åˆ›å»ºsnapshotæ—¶é—´<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608809818168,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"summary"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;sparkå†™å…¥æ–¹å¼ï¼Œç›®å‰æ”¯æŒoverwriteä»¥åŠappend<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"operation"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"overwrite"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"spark.app.id"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"local-1608809790982"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"replace-partitions"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"true"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æœ¬æ¬¡snapshotæ·»åŠ çš„æ–‡ä»¶æ•°é‡<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-data-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æœ¬æ¬¡snapshotæ·»åŠ çš„recordæ•°é‡<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-records"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æœ¬æ¬¡snapshotæ·»åŠ çš„æ–‡ä»¶å¤§å°<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-files-size"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"7217"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æœ¬æ¬¡snapshotä¿®æ”¹çš„åˆ†åŒºæ•°é‡<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"changed-partition-count"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;æœ¬æ¬¡snapshotä¸­recordæ€»æ•°&nbsp;=&nbsp;lastSnapshotTotalRecord&nbsp;-&nbsp;currentSnapshotDeleteRecord&nbsp;+&nbsp;currentSnapshotAddRecord<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-records"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-data-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-delete-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-position-deletes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-equality-deletes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest-list"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/snap-5178718682852547007-1-f475511f-877e-4da5-90aa-efa5928a7759.avro"</span><br  />&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshot-id"</span>&nbsp;:&nbsp;2080639593951710914,<br  />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;ä¸Šæ¬¡snapshotID<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"parent-snapshot-id"</span>&nbsp;:&nbsp;5178718682852547007,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608810968725,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"summary"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"operation"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"overwrite"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"spark.app.id"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"local-1608809790982"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"replace-partitions"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"true"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-data-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted-data-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-records"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted-records"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added-files-size"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"7217"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"removed-files-size"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"7217"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"changed-partition-count"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-records"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-data-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-delete-files"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-position-deletes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"total-equality-deletes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"0"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;snapshotæ–‡ä»¶è·¯å¾„<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest-list"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/snap-2080639593951710914-1-1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae.avro"</span><br  />&nbsp;&nbsp;}&nbsp;],<br  />&nbsp;&nbsp;//&nbsp;snapshotè®°å½•<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshot-log"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608809818168,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshot-id"</span>&nbsp;:&nbsp;5178718682852547007<br  />&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608810968725,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"snapshot-id"</span>&nbsp;:&nbsp;2080639593951710914<br  />&nbsp;&nbsp;}&nbsp;],<br  />&nbsp;&nbsp;//&nbsp;metadaè®°å½•<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"metadata-log"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608809758229,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"metadata-file"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/v1.metadata.json"</span><br  />&nbsp;&nbsp;},&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"timestamp-ms"</span>&nbsp;:&nbsp;1608809818168,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"metadata-file"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/v2.metadata.json"</span><br  />&nbsp;&nbsp;}&nbsp;]<br  />}<br  /><br  />ä¸Šä¾‹å±•ç¤ºçš„æ˜¯v3.metadata.jsonä¸­çš„æ•°æ®ï¼Œè¯¥æ–‡ä»¶ä¿å­˜äº†iceberg&nbsp;table&nbsp;schemaã€partitionã€snapshotä¿¡æ¯ï¼Œpartitionä¸­çš„transformä¿¡æ¯ä½¿å¾—icebergèƒ½å¤Ÿæ ¹æ®å­—æ®µè¿›è¡Œhidden&nbsp;partitionï¼Œè€Œæ— éœ€åƒhiveä¸€æ ·æ˜¾ç¤ºçš„æŒ‡å®šåˆ†åŒºå­—æ®µã€‚ç”±äºVersionMetadataä¸­è®°å½•äº†æ¯æ¬¡snapshotçš„idä»¥åŠcreate_timeï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ—¶é—´æˆ–snapshotIdæŸ¥è¯¢ç›¸åº”snapshotçš„æ•°æ®ï¼Œå®ç°Time&nbsp;Travelã€‚<br  /><br  />Snapshot<br  /><br  />//&nbsp;Snapshot:&nbsp;2080639593951710914<br  />//&nbsp;Location:&nbsp;hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/snap-2080639593951710914-1-1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae.avro<br  /><br  />//&nbsp;manifest&nbsp;entry<br  />{<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest_path"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae-m1.avro"</span>,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest_length"</span>&nbsp;:&nbsp;5291,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partition_spec_id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;//&nbsp;è¯¥manifest&nbsp;entryæ‰€å±çš„snapshot<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_snapshot_id"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;2080639593951710914<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;//&nbsp;è¯¥manifestä¸­æ·»åŠ çš„æ–‡ä»¶æ•°é‡<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;4<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;//&nbsp;åˆ›å»ºè¯¥manifestæ—¶å·²ç»å­˜åœ¨ä¸”<br  />&nbsp;&nbsp;//&nbsp;æ²¡æœ‰è¢«è¿™æ¬¡åˆ›å»ºæ“ä½œåˆ é™¤çš„æ–‡ä»¶æ•°é‡<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"existing_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;//&nbsp;åˆ›å»ºmanifeståˆ é™¤çš„æ–‡ä»¶<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;//&nbsp;è¯¥manifestä¸­partitionå­—æ®µçš„èŒƒå›´<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partitions"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"array"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"contains_null"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"lower_bound"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"bytes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"\u0001\u0000\u0000\u0000\u0000\u0000\u0000\u0000"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"upper_bound"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"bytes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"\u0004\u0000\u0000\u0000\u0000\u0000\u0000\u0000"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;]<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;4<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"existing_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;}<br  />}<br  />//&nbsp;manifest&nbsp;entry<br  />{<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest_path"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item/metadata/1f8279fb-5b2d-464c-af12-d9d6fbe9b5ae-m0.avro"</span>,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"manifest_length"</span>&nbsp;:&nbsp;5289,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partition_spec_id"</span>&nbsp;:&nbsp;0,<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_snapshot_id"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;2080639593951710914<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"existing_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted_data_files_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"int"</span>&nbsp;:&nbsp;4<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"partitions"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"array"</span>&nbsp;:&nbsp;[&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"contains_null"</span>&nbsp;:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"lower_bound"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"bytes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"\u0001\u0000\u0000\u0000\u0000\u0000\u0000\u0000"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"upper_bound"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"bytes"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"\u0004\u0000\u0000\u0000\u0000\u0000\u0000\u0000"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;]<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"added_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"existing_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;0<br  />&nbsp;&nbsp;},<br  />&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"deleted_rows_count"</span>&nbsp;:&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"long"</span>&nbsp;:&nbsp;4<br  />&nbsp;&nbsp;}<br  />}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">Manifestç®¡ç†å¤šä¸ªdataæ–‡ä»¶ï¼Œä¸€æ¡DataFileEntryå¯¹åº”ä¸€ä¸ªdataæ–‡ä»¶ï¼ŒDataFileEntryä¸­è®°å½•äº†æ‰€å±partitionï¼Œvalue boundsç­‰ä¿¡æ¯ï¼Œvalue_countså’Œnull_value_countså¯ä»¥ç”¨äºè¿‡æ»¤nullåˆ—ï¼Œä¾‹ï¼šcolumn aæ‰€å¯¹åº”çš„value_countä¸º3ï¼Œä¸”å¯¹åº”çš„null_value_countä¹Ÿä¸º3ï¼Œæ­¤æ—¶å¦‚æœselect aï¼Œåˆ™å¯ä»¥æ ¹æ®value_count-null_value_count=0åˆ¤æ–­aå…¨ä¸ºnullç›´æ¥è¿”å›è€Œæ— éœ€å†è¿›è¡Œparquetæ–‡ä»¶çš„æŸ¥è¯¢ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥æ ¹æ®value boundsè¿›è¡Œè¿‡æ»¤ï¼ŒåŠ é€ŸæŸ¥è¯¢ã€‚</p><h2 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: inline-block;font-weight: bold;background: rgb(239, 112, 96);color: #ffffff;padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">ç¬¬äºŒéƒ¨åˆ†ï¼šSparkå†™Icebergæµç¨‹åˆ†æ</span></h2><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">sparkå†™å…¥ç¤ºä¾‹</h5><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">import&nbsp;org.apache.iceberg.hadoop.HadoopTables<br  />import&nbsp;org.apache.hadoop.conf.Configuration<br  />import&nbsp;org.apache.iceberg.catalog.TableIdentifier<br  />import&nbsp;org.apache.iceberg.Schema<br  />import&nbsp;org.apache.iceberg.types._<br  />import&nbsp;org.apache.spark.sql.types._<br  />import&nbsp;org.apache.iceberg.PartitionSpec<br  />import&nbsp;org.apache.iceberg.spark.SparkSchemaUtil<br  />import&nbsp;org.apache.spark.sql._<br  />import&nbsp;spark.implicits._<br  /><br  />val&nbsp;order_item_schema&nbsp;=&nbsp;StructType(List(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StructField(<span style="color: #98c379;line-height: 26px;">"id"</span>,&nbsp;LongType,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StructField(<span style="color: #98c379;line-height: 26px;">"order_id"</span>,&nbsp;LongType,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StructField(<span style="color: #98c379;line-height: 26px;">"product_id"</span>,&nbsp;LongType,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StructField(<span style="color: #98c379;line-height: 26px;">"product_price"</span>,&nbsp;DecimalType(7,2),&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StructField(<span style="color: #98c379;line-height: 26px;">"product_quantity"</span>,&nbsp;IntegerType,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StructField(<span style="color: #98c379;line-height: 26px;">"product_name"</span>,&nbsp;StringType,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>)<br  />&nbsp;&nbsp;&nbsp;&nbsp;))<br  /><br  />val&nbsp;order_item_action&nbsp;=&nbsp;Seq(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Row(1L,&nbsp;1L,&nbsp;1L,&nbsp;Decimal.apply(50.00,&nbsp;7,&nbsp;2),&nbsp;2,&nbsp;<span style="color: #98c379;line-height: 26px;">"table&nbsp;lamp"</span>),&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Row(2L,&nbsp;1L,&nbsp;2L,&nbsp;Decimal.apply(100.5,&nbsp;7,&nbsp;2),&nbsp;1,&nbsp;<span style="color: #98c379;line-height: 26px;">"skirt"</span>),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Row(3L,&nbsp;2L,&nbsp;1L,&nbsp;Decimal.apply(50.00,&nbsp;7,&nbsp;2),&nbsp;1,&nbsp;<span style="color: #98c379;line-height: 26px;">"table&nbsp;lamp"</span>),&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Row(4L,&nbsp;3L,&nbsp;3L,&nbsp;Decimal.apply(0.99,&nbsp;7,&nbsp;2),&nbsp;1,&nbsp;<span style="color: #98c379;line-height: 26px;">"match"</span>)<br  />&nbsp;&nbsp;&nbsp;&nbsp;)<br  /><br  />val&nbsp;iceberg_schema&nbsp;=&nbsp;new&nbsp;Schema(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Types.NestedField.optional(1,&nbsp;<span style="color: #98c379;line-height: 26px;">"id"</span>,&nbsp;Types.LongType.get()),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Types.NestedField.optional(2,&nbsp;<span style="color: #98c379;line-height: 26px;">"order_id"</span>,&nbsp;Types.LongType.get()),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Types.NestedField.optional(3,&nbsp;<span style="color: #98c379;line-height: 26px;">"product_id"</span>,&nbsp;Types.LongType.get()),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Types.NestedField.optional(4,&nbsp;<span style="color: #98c379;line-height: 26px;">"product_price"</span>,&nbsp;Types.DecimalType.of(7,&nbsp;2)),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Types.NestedField.optional(5,&nbsp;<span style="color: #98c379;line-height: 26px;">"product_quantity"</span>,&nbsp;Types.IntegerType.get()),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Types.NestedField.optional(6,&nbsp;<span style="color: #98c379;line-height: 26px;">"product_name"</span>,&nbsp;Types.StringType.get())<br  />&nbsp;&nbsp;&nbsp;&nbsp;)<br  /><br  />val&nbsp;iceberg_partition&nbsp;=&nbsp;PartitionSpec.builderFor(iceberg_schema).identity(<span style="color: #98c379;line-height: 26px;">"id"</span>).build()&nbsp;&nbsp;<br  /><br  />val&nbsp;hadoopTable&nbsp;=&nbsp;new&nbsp;HadoopTables(sc.hadoopConfiguration);<br  />val&nbsp;location&nbsp;=&nbsp;<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item"</span>;<br  /><br  />hadoopTable.create(iceberg_schema,&nbsp;iceberg_partition,&nbsp;location)<br  /><br  />val&nbsp;df&nbsp;=&nbsp;spark.createDataFrame(sc.makeRDD(order_item_action),&nbsp;order_item_schema)<br  /><br  />df.write.format(<span style="color: #98c379;line-height: 26px;">"iceberg"</span>).mode(<span style="color: #98c379;line-height: 26px;">"overwrite"</span>).save(<span style="color: #98c379;line-height: 26px;">"hdfs://10.242.199.202:9000/hive/empty_order_item"</span>)<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">sparkå†™å…¥icebergä¸»è¦åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ul data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: disc;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">Executorå†™å…¥æ•°æ®</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">Driver commitç”Ÿæˆå…ƒæ•°æ®</section></li></ul><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">Executorå†™å…¥é€»è¾‘</h5><figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0;margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.7922297297297297" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/5_cFhQ8UTRR9LIChdzwUo3SnYU6hprkQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MIAhHH1mPG6Tdsg33w3ia0LicP8Mgk0303vd0blyOhUZN4KuicFhQ8UTRR9LIChdzwUo3SnYU6hprkQ/640?wx_fmt=png'" data-type="png" data-w="1184" style="display: block;margin: 0 auto;max-width: 100%;"  /></figure><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">ç”±ä¸Šå›¾å¯ä»¥çœ‹åˆ°IcebergSourceå®ç°äº†spark ReadSupportã€WriteSupportã€StreamWriteSupportç­‰æ¥å£ï¼ŒWriteFactoryæ ¹æ®å†™å…¥è¡¨çš„ç±»å‹ï¼š(1) åˆ†åŒºè¡¨ (2) éåˆ†åŒºè¡¨ï¼Œç”Ÿæˆä¸åŒçš„writerï¼Œæœ€åé€šè¿‡writeæ–¹æ³•å†™å…¥æ•°æ®ã€‚</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">æˆ‘ä»¬ä»¥å†™å…¥åˆ†åŒºè¡¨ä¸ºä¾‹ç®€å•ä»‹ç»ä¸€ä¸‹executorç«¯icebergå†™å…¥æ•°æ®çš„æµç¨‹:</p><ul data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: disc;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">æ ¹æ®file formatç”Ÿæˆå¯¹åº”çš„FileAppenderï¼ŒFileAppenderå®Œæˆå®é™…çš„å†™æ–‡ä»¶æ“ä½œã€‚ç›®å‰æ”¯æŒ3ç§æ–‡ä»¶æ ¼å¼çš„å†™å…¥ï¼šParquetã€Avroä»¥åŠOrc</section></li></ul><figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0;margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.5772357723577236" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/6_A6PGnf2IfuicJSib1jxZgAibTeYIGQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MIAhHH1mPG6Tdsg33w3ia0L6fic9GA5viatEXYAlvPly6S8jqXkPA6PGnf2IfuicJSib1jxZgAibTeYIGQ/640?wx_fmt=png'" data-type="png" data-w="984" style="display: block;margin: 0 auto;max-width: 100%;"  /></figure><ul data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: disc;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">icebergåˆ†åŒºæ•°æ®ä¸ç›´æ¥å†™å…¥æ•°æ®æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯é€šè¿‡ç›®å½•æ ‘ç»“æ„æ¥è¿›è¡Œå­˜å‚¨ï¼Œåˆ†åŒºç›®å½•ç»“æ„ä¸hiveç±»å‹ï¼Œéƒ½æ˜¯ä»¥key1=value1/key2=value2çš„å½¢å¼è¿›è¡Œç»„ç»‡ã€‚åœ¨å†™å…¥æ•°æ®ä¹‹å‰ï¼ŒpartitionWriteré¦–å…ˆæ ¹æ®partition transformå‡½æ•°å¾—åˆ°å¯¹åº”çš„partition valueï¼Œç„¶ååˆ›å»ºå¯¹åº”çš„åˆ†åŒºç›®å½•</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">fileAppenderé€šè¿‡è°ƒç”¨ä¸åŒçš„file formatç»„ä»¶å°†æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚icebergå†™å…¥æ—¶å¯ä»¥é€šè¿‡è®¾ç½®write.target-file-size-bytes table propertyè°ƒæ•´å†™å…¥æ–‡ä»¶targetå¤§å°ï¼Œé»˜è®¤ä¸ºLONG_MAX</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">å½“æ‰€æœ‰æ•°æ®å†™å…¥å®Œæˆåï¼Œicebergä¼šæ”¶é›†å†™å…¥çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¾‹å¦‚record_count, lower_bound, upper_bound, value_countç­‰ç”¨äºdriverç«¯ç”Ÿæˆå¯¹åº”çš„manifestæ–‡ä»¶ï¼Œæœ€åexecutorç«¯å°†è¿™äº›ä¿¡æ¯ä¼ å›driverç«¯ã€‚</section></li></ul><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">Driver commité€»è¾‘</h5><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">iceberg snapshotä¸­çš„ç»Ÿè®¡ä¿¡æ¯å®é™…æ˜¯ç´¯è®¡æ›´æ–°çš„ç»“æœï¼Œç›¸è¾ƒäºä¸Šæ¬¡commitï¼Œæœ¬æ¬¡commitå‘ç”Ÿäº†å“ªäº›å˜åŒ–ï¼Œä¾‹æ–°å¢äº†å¤šå°‘æ¡è®°å½•ï¼Œåˆ é™¤äº†å¤šå°‘æ¡è®°å½•ï¼Œæ–°å¢äº†å¤šå°‘æ–‡ä»¶ï¼Œåˆ é™¤äº†å¤šå°‘æ–‡ä»¶ç­‰ç­‰ã€‚æ—¢ç„¶æ˜¯ç´¯è®¡æ›´æ–°ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“ä¸Šæ¬¡snapshotçš„ä¿¡æ¯ï¼Œç„¶åè®¡ç®—æœ€åçš„ç»“æœã€‚icebergè¯»å–å½“å‰æœ€æ–°snapshotæ•°æ®è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: decimal;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">è¯»å–version.hintä¸­è®°å½•çš„æœ€æ–°metadataç‰ˆæœ¬å·versionNumber</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">è¯»å–version[versionNumber].metadata.jsonæ–‡ä»¶ï¼Œæ ¹æ®metadataä¸­è®°å½•çš„snpshotsä¿¡æ¯ä»¥åŠcurrent snapshot idå¾—åˆ°æœ€æ–°snapshotçš„location</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">æœ€åæ ¹æ®è·å¾—çš„locationè¯»å–å¯¹åº”çš„snapshotæ–‡ä»¶å¾—åˆ°æœ€æ–°çš„snapshotæ•°æ®</section></li></ol><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">overwriteå®é™…ä¸Šå¯ä»¥ç­‰ä»·åˆ’åˆ†æˆä¸¤ä¸ªæ­¥éª¤:</p><ul data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: disc;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">delete</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">insert</section></li></ul><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•çŸ¥é“éœ€è¦åˆ é™¤å“ªäº›æ•°æ®å‘¢ï¼Ÿè¿™é‡Œå°±è¦ç”¨åˆ°åˆšåˆšè¯»å–çš„current snapshotæ•°æ®ä»¥åŠexecutorä¼ å›çš„ä¿¡æ¯ï¼Œæ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å¾—åˆ°å“ªäº›åˆ†åŒºæ–‡ä»¶æ˜¯éœ€è¦é€šè¿‡è¦†ç›–åˆ é™¤çš„ï¼Œå®é™…ä¸Šæ˜¯å°†manifestä¸­çš„å¯¹åº”DataFileEntryæ ‡è®°æˆåˆ é™¤å†™å…¥åˆ°æ–°çš„manifestæ–‡ä»¶ä¸­ï¼Œæ²¡æœ‰è¢«åˆ é™¤çš„DataFileEntryåˆ™æ ‡è®°æˆExistingå†™å…¥åˆ°manifestæ–‡ä»¶ä¸­</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">åœ¨å®Œæˆäº†deleteæ“ä½œä¹‹åï¼Œinsertæ“ä½œå°±ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œåªè¦å°†GenericDataFileå…¨éƒ¨å†™å…¥åˆ°æ–°çš„manifestä¸­å³å¯</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">icebergé»˜è®¤å¼€å¯merge manifeståŠŸèƒ½ï¼Œå½“manifestæ–‡ä»¶æ•°é‡è¶…è¿‡commit.manifest.min-count-to-mergeæ—¶(é»˜è®¤100)ï¼Œå°†å¤šä¸ªsmall manifestæ–‡ä»¶åˆå¹¶æˆlarge manifest(large manifestæ–‡ä»¶å¤§å°ç”±commit.manifest.target-size-bytesæŒ‡å®šï¼Œé»˜è®¤ä¸º8Mï¼‰</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">æœ€åicebergæ ¹æ®è¿™äº›Added/Deleted/Existing DataFileEntryå¾—åˆ°æœ¬æ¬¡commitçš„å·®å€¼ç»Ÿè®¡ä¿¡æ¯ï¼Œä¸å‰ä¸€æ¬¡snapshotç»Ÿè®¡ä¿¡æ¯ç´¯åŠ æœ€ç»ˆå¾—åˆ°æœ¬æ¬¡snapshotçš„ç»Ÿè®¡ä¿¡æ¯(added_data_files_count, added_rows_countç­‰ï¼‰ã€‚ç”Ÿæˆsnapshotçš„æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0;margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.6915887850467289" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/7_sGDLoKVfbGtUsxGGxvhxce1xAQycrg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MIAhHH1mPG6Tdsg33w3ia0LX9TLNj23fmlsXRRUJbT2H1iaKsGDLoKVfbGtUsxGGxvhxce1xAQycrg/640?wx_fmt=png'" data-type="png" data-w="1284" style="display: block;margin: 0 auto;max-width: 100%;"  /></figure><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">åœ¨ç”Ÿæˆæ–°çš„snapshotåï¼Œåªå‰©æœ€åä¸€æ­¥é‚£å°±æ˜¯ç”Ÿæˆæ–°ç‰ˆæœ¬çš„version.metadata.jsonæ–‡ä»¶ï¼ŒåŒæ—¶å°†ç‰ˆæœ¬å·å†™å…¥åˆ°version.hintä¸­ï¼Œè‡³æ­¤å®Œæˆäº†æ‰€æœ‰icebergæ•°æ®çš„å†™å…¥ã€‚</p><h2 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: inline-block;font-weight: bold;background: rgb(239, 112, 96);color: #ffffff;padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">ç¬¬ä¸‰éƒ¨åˆ†ï¼šFlinkå†™Icebergæµç¨‹åˆ†æ</span></h2><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">å¼€å§‹å®ä¾‹</h5><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">flinkæ”¯æŒDataStreamå’ŒDataStreamå†™å…¥iceberg</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">StreamExecutionEnvironment&nbsp;env&nbsp;=&nbsp;...;<br  /><br  />DataStream&lt;RowData&gt;&nbsp;input&nbsp;=&nbsp;...&nbsp;;<br  />Configuration&nbsp;hadoopConf&nbsp;=&nbsp;new&nbsp;Configuration();<br  />TableLoader&nbsp;tableLoader&nbsp;=&nbsp;TableLoader.fromHadoopTable(<span style="color: #98c379;line-height: 26px;">"hdfs://nn:8020/warehouse/path"</span>,&nbsp;hadoopConf);<br  />FlinkSink.forRowData(input,&nbsp;FLINK_SCHEMA)<br  />&nbsp;&nbsp;&nbsp;&nbsp;.tableLoader(tableLoader)<br  />&nbsp;&nbsp;&nbsp;&nbsp;.writeParallelism(1)<br  />&nbsp;&nbsp;&nbsp;&nbsp;.build();<br  />env.execute(<span style="color: #98c379;line-height: 26px;">"Test&nbsp;Iceberg&nbsp;DataStream"</span>);<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">inputä¸ºDataStreamå’ŒDataStreamå½¢å¼çš„è¾“å…¥æµï¼ŒFLINK_SCHEMAä¸ºTableSchemaï¼›</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">é¦–å…ˆçœ‹build()æ–¹æ³•ï¼š</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;DataStreamSink&lt;RowData&gt;&nbsp;<span style="color: rgb(97, 174, 238);line-height: 26px;">build</span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Preconditions.checkArgument(this.rowDataInput&nbsp;!=&nbsp;null,&nbsp;<span style="color: #98c379;line-height: 26px;">"Please&nbsp;use&nbsp;forRowData()&nbsp;to&nbsp;initialize&nbsp;the&nbsp;input&nbsp;DataStream."</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Preconditions.checkNotNull(this.tableLoader,&nbsp;<span style="color: #98c379;line-height: 26px;">"Table&nbsp;loader&nbsp;shouldn't&nbsp;be&nbsp;null"</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(this.table&nbsp;==&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.tableLoader.open();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TableLoader&nbsp;loader&nbsp;=&nbsp;this.tableLoader;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;var2&nbsp;=&nbsp;null;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.table&nbsp;=&nbsp;loader.loadTable();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Throwable&nbsp;var12)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var2&nbsp;=&nbsp;var12;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;var12;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(loader&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(var2&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loader.close();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Throwable&nbsp;var11)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var2.addSuppressed(var11);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loader.close();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;var14)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;UncheckedIOException(<span style="color: #98c379;line-height: 26px;">"Failed&nbsp;to&nbsp;load&nbsp;iceberg&nbsp;table&nbsp;from&nbsp;table&nbsp;loader:&nbsp;"</span>&nbsp;+&nbsp;this.tableLoader,&nbsp;var14);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Integer&gt;&nbsp;equalityFieldIds&nbsp;=&nbsp;Lists.newArrayList();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(this.equalityFieldColumns&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;this.equalityFieldColumns.size()&nbsp;&gt;&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iterator&nbsp;var16&nbsp;=&nbsp;this.equalityFieldColumns.iterator();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">while</span>(var16.hasNext())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;column&nbsp;=&nbsp;(String)var16.next();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NestedField&nbsp;field&nbsp;=&nbsp;this.table.schema().findField(column);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Preconditions.checkNotNull(field,&nbsp;<span style="color: #98c379;line-height: 26px;">"Missing&nbsp;required&nbsp;equality&nbsp;field&nbsp;column&nbsp;'%s'&nbsp;in&nbsp;table&nbsp;schema&nbsp;%s"</span>,&nbsp;column,&nbsp;this.table.schema());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equalityFieldIds.add(field.fieldId());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RowType&nbsp;flinkRowType&nbsp;=&nbsp;FlinkSink.toFlinkRowType(this.table.schema(),&nbsp;this.tableSchema);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.rowDataInput&nbsp;=&nbsp;this.distributeDataStream(this.rowDataInput,&nbsp;this.table.properties(),&nbsp;this.table.spec(),&nbsp;this.table.schema(),&nbsp;flinkRowType);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IcebergStreamWriter&lt;RowData&gt;&nbsp;streamWriter&nbsp;=&nbsp;FlinkSink.createStreamWriter(this.table,&nbsp;flinkRowType,&nbsp;equalityFieldIds);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IcebergFilesCommitter&nbsp;filesCommitter&nbsp;=&nbsp;new&nbsp;IcebergFilesCommitter(this.tableLoader,&nbsp;this.overwrite);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.writeParallelism&nbsp;=&nbsp;this.writeParallelism&nbsp;==&nbsp;null&nbsp;?&nbsp;this.rowDataInput.getParallelism()&nbsp;:&nbsp;this.writeParallelism;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataStream&lt;Void&gt;&nbsp;returnStream&nbsp;=&nbsp;this.rowDataInput.transform(FlinkSink.ICEBERG_STREAM_WRITER_NAME,&nbsp;TypeInformation.of(WriteResult.class),&nbsp;streamWriter).setParallelism(this.writeParallelism).transform(FlinkSink.ICEBERG_FILES_COMMITTER_NAME,&nbsp;Types.VOID,&nbsp;filesCommitter).setParallelism(1).setMaxParallelism(1);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;returnStream.addSink(new&nbsp;DiscardingSink()).name(String.format(<span style="color: #98c379;line-height: 26px;">"IcebergSink&nbsp;%s"</span>,&nbsp;this.table.name())).setParallelism(1);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">æ­¤å¤„åˆ›å»ºå†™çš„icebergæ ¸å¿ƒç®—å­IcebergStreamWriterå’ŒIcebergFilesCommitter</p><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">IcebergStreamWriter</h5><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">IcebergStreamWriter&lt;RowData&gt;&nbsp;streamWriter&nbsp;=&nbsp;FlinkSink.createStreamWriter(this.table,&nbsp;flinkRowType,&nbsp;equalityFieldIds);<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">build()æ–¹æ³•ä¸­ï¼Œè°ƒç”¨createStreamWriter()åˆ›å»ºIcebergStreamWriter</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">static&nbsp;IcebergStreamWriter&lt;RowData&gt;&nbsp;createStreamWriter(Table&nbsp;table,&nbsp;RowType&nbsp;flinkRowType,&nbsp;List&lt;Integer&gt;&nbsp;equalityFieldIds)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&lt;String,&nbsp;String&gt;&nbsp;props&nbsp;=&nbsp;table.properties();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;targetFileSize&nbsp;=&nbsp;getTargetFileSizeBytes(props);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileFormat&nbsp;fileFormat&nbsp;=&nbsp;getFileFormat(props);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TaskWriterFactory&lt;RowData&gt;&nbsp;taskWriterFactory&nbsp;=&nbsp;new&nbsp;RowDataTaskWriterFactory(table.schema(),&nbsp;flinkRowType,&nbsp;table.spec(),&nbsp;table.locationProvider(),&nbsp;table.io(),&nbsp;table.encryption(),&nbsp;targetFileSize,&nbsp;fileFormat,&nbsp;props,&nbsp;equalityFieldIds);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;new&nbsp;IcebergStreamWriter(table.name(),&nbsp;taskWriterFactory);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">æ ¹æ®è¡¨ä¿¡æ¯æ„å»ºTaskWriterFactoryï¼Œå¹¶ä¼ å…¥åˆ°IcebergStreamWriter</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">class&nbsp;IcebergStreamWriter&lt;T&gt;&nbsp;extends&nbsp;AbstractStreamOperator&lt;WriteResult&gt;&nbsp;implements&nbsp;OneInputStreamOperator&lt;T,&nbsp;WriteResult&gt;,&nbsp;BoundedOneInput&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;final&nbsp;long&nbsp;serialVersionUID&nbsp;=&nbsp;1L;<br  />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;String&nbsp;fullTableName;<br  />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;TaskWriterFactory&lt;T&gt;&nbsp;taskWriterFactory;<br  />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;transient&nbsp;TaskWriter&lt;T&gt;&nbsp;writer;<br  />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;transient&nbsp;int&nbsp;subTaskId;<br  />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;transient&nbsp;int&nbsp;attemptId;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;IcebergStreamWriter(String&nbsp;fullTableName,&nbsp;TaskWriterFactory&lt;T&gt;&nbsp;taskWriterFactory)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.fullTableName&nbsp;=&nbsp;fullTableName;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.taskWriterFactory&nbsp;=&nbsp;taskWriterFactory;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.setChainingStrategy(ChainingStrategy.ALWAYS);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;<span style="color: rgb(97, 174, 238);line-height: 26px;">open</span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.subTaskId&nbsp;=&nbsp;this.getRuntimeContext().getIndexOfThisSubtask();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.attemptId&nbsp;=&nbsp;this.getRuntimeContext().getAttemptNumber();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.taskWriterFactory.initialize(this.subTaskId,&nbsp;this.attemptId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.writer&nbsp;=&nbsp;this.taskWriterFactory.create();<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;prepareSnapshotPreBarrier(long&nbsp;checkpointId)&nbsp;throws&nbsp;Exception&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.emit(this.writer.complete());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.writer&nbsp;=&nbsp;this.taskWriterFactory.create();<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;processElement(StreamRecord&lt;T&gt;&nbsp;element)&nbsp;throws&nbsp;Exception&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.writer.write(element.getValue());<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">åœ¨openä¸­é€šè¿‡ä¼ å…¥çš„taskWriterFactoryæ„å»ºTaskWriter</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;TaskWriter&lt;RowData&gt;&nbsp;<span style="color: rgb(97, 174, 238);line-height: 26px;">create</span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Preconditions.checkNotNull(this.outputFileFactory,&nbsp;<span style="color: #98c379;line-height: 26px;">"The&nbsp;outputFileFactory&nbsp;shouldn't&nbsp;be&nbsp;null&nbsp;if&nbsp;we&nbsp;have&nbsp;invoked&nbsp;the&nbsp;initialize()."</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(this.equalityFieldIds&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;!this.equalityFieldIds.isEmpty())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;(TaskWriter)(this.spec.isUnpartitioned()&nbsp;?&nbsp;new&nbsp;UnpartitionedDeltaWriter(this.spec,&nbsp;this.format,&nbsp;this.appenderFactory,&nbsp;this.outputFileFactory,&nbsp;this.io,&nbsp;this.targetFileSizeBytes,&nbsp;this.schema,&nbsp;this.flinkSchema,&nbsp;this.equalityFieldIds)&nbsp;:&nbsp;new&nbsp;PartitionedDeltaWriter(this.spec,&nbsp;this.format,&nbsp;this.appenderFactory,&nbsp;this.outputFileFactory,&nbsp;this.io,&nbsp;this.targetFileSizeBytes,&nbsp;this.schema,&nbsp;this.flinkSchema,&nbsp;this.equalityFieldIds));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;(TaskWriter)(this.spec.isUnpartitioned()&nbsp;?&nbsp;new&nbsp;UnpartitionedWriter(this.spec,&nbsp;this.format,&nbsp;this.appenderFactory,&nbsp;this.outputFileFactory,&nbsp;this.io,&nbsp;this.targetFileSizeBytes)&nbsp;:&nbsp;new&nbsp;RowDataTaskWriterFactory.RowDataPartitionedFanoutWriter(this.spec,&nbsp;this.format,&nbsp;this.appenderFactory,&nbsp;this.outputFileFactory,&nbsp;this.io,&nbsp;this.targetFileSizeBytes,&nbsp;this.schema,&nbsp;this.flinkSchema));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">æ­¤æ–¹æ³•ä¸­æ ¹æ®æ˜¯å¦æŒ‡å®šå­—æ®µï¼Œæ„é€ åˆ†åŒºå†™(PartitionedDeltaWriter/RowDataPartitionedFanoutWriter)å’Œéåˆ†åŒºå†™å®ä¾‹(UnpartitionedDeltaWriter/UnpartitionedWriter)
å››ä¸ªç±»çš„è°ƒç”¨å…³ç³»ï¼š</p><blockquote data-tool="mdniceç¼–è¾‘å™¨" style="border-top: none;border-right: none;border-bottom: none;display: block;font-size: 0.9em;overflow: auto;border-left: 3px solid rgb(239, 112, 96);color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0px;color: black;line-height: 26px;">æŒ‡å®šå­—æ®µï¼š</p></blockquote><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">UnpartitionedDeltaWriter -&gt; BaseEqualityDeltaWriter.write() -&gt; RollingFileWriter.write() -&gt; appender.add()
PartitionedDeltaWriter -&gt; BaseDeltaTaskWriter.write() -&gt; RollingFileWriter.write() -&gt; appender.add()</p><blockquote data-tool="mdniceç¼–è¾‘å™¨" style="border-top: none;border-right: none;border-bottom: none;display: block;font-size: 0.9em;overflow: auto;border-left: 3px solid rgb(239, 112, 96);color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0px;color: black;line-height: 26px;">æœªæŒ‡å®šå­—æ®µï¼š</p></blockquote><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">UnpartitionedWriter -&gt; RollingFileWriter.write() -&gt; appender.add()</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">RowDataPartitionedFanoutWriter -&gt; BaseRollingWriter.write -&gt; RollingFileWriter.write() -&gt; appender.add()</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">åº•å±‚è°ƒç”¨çš„appenderä¸ºåˆ›å»ºTaskWriterä¼ å…¥çš„FlinkAppenderFactoryåˆ›å»ºçš„</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">åœ¨processElement()ä¸­è°ƒç”¨write(element.getValue())æ–¹æ³•ï¼Œå°†æ•°æ®å†™å…¥ï¼Œæœ€ååœ¨checkpointæ—¶æäº¤ã€‚</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">æç¤ºï¼štaskæ‰§è¡Œä¸‰éƒ¨æ›²ï¼šbeforeInvoke() -&gt; runMailboxLoop() -&gt; afterInvoke()
beforeInvokeè°ƒç”¨open()å’ŒinitializeState()ï¼ŒrunMailboxLoopè°ƒç”¨processElement()å¤„ç†æ•°æ®</p><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">IcebergFilesCommitter</h5><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">IcebergFilesCommitter&nbsp;filesCommitter&nbsp;=&nbsp;new&nbsp;IcebergFilesCommitter(this.tableLoader,&nbsp;this.overwrite);<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">build()æ–¹æ³•ä¸­ï¼Œä¼ å…¥tableLoaderå’Œoverwriteç›´æ¥åˆ›å»ºIcebergFilesCommitterã€‚</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">checkpointåˆå§‹åŒ–æ“ä½œåœ¨IcebergFilesCommitterçš„initializeState()</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;void&nbsp;initializeState(StateInitializationContext&nbsp;context)&nbsp;throws&nbsp;Exception&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.initializeState(context);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.flinkJobId&nbsp;=&nbsp;this.getContainingTask().getEnvironment().getJobID().toString();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.tableLoader.open();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.table&nbsp;=&nbsp;this.tableLoader.loadTable();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;subTaskId&nbsp;=&nbsp;this.getRuntimeContext().getIndexOfThisSubtask();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;attemptId&nbsp;=&nbsp;this.getRuntimeContext().getAttemptNumber();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.manifestOutputFileFactory&nbsp;=&nbsp;FlinkManifestUtil.createOutputFileFactory(this.table,&nbsp;this.flinkJobId,&nbsp;subTaskId,&nbsp;(long)attemptId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.maxCommittedCheckpointId&nbsp;=&nbsp;-1L;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.checkpointsState&nbsp;=&nbsp;context.getOperatorStateStore().getListState(STATE_DESCRIPTOR);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.jobIdState&nbsp;=&nbsp;context.getOperatorStateStore().getListState(JOB_ID_DESCRIPTOR);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(context.isRestored())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;restoredFlinkJobId&nbsp;=&nbsp;(String)((Iterable)this.jobIdState.get()).iterator().next();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Preconditions.checkState(!Strings.isNullOrEmpty(restoredFlinkJobId),&nbsp;<span style="color: #98c379;line-height: 26px;">"Flink&nbsp;job&nbsp;id&nbsp;parsed&nbsp;from&nbsp;checkpoint&nbsp;snapshot&nbsp;shouldn't&nbsp;be&nbsp;null&nbsp;or&nbsp;empty"</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.maxCommittedCheckpointId&nbsp;=&nbsp;getMaxCommittedCheckpointId(this.table,&nbsp;restoredFlinkJobId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NavigableMap&lt;Long,&nbsp;byte[]&gt;&nbsp;uncommittedDataFiles&nbsp;=&nbsp;Maps.newTreeMap((SortedMap)((Iterable)this.checkpointsState.get()).iterator().next()).tailMap(this.maxCommittedCheckpointId,&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(!uncommittedDataFiles.isEmpty())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;maxUncommittedCheckpointId&nbsp;=&nbsp;(Long)uncommittedDataFiles.lastKey();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.commitUpToCheckpoint(uncommittedDataFiles,&nbsp;restoredFlinkJobId,&nbsp;maxUncommittedCheckpointId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">checkpointæäº¤æµç¨‹åœ¨IcebergFilesCommitterçš„snapshotStateä¸­</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;void&nbsp;snapshotState(StateSnapshotContext&nbsp;context)&nbsp;throws&nbsp;Exception&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.snapshotState(context);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;checkpointId&nbsp;=&nbsp;context.getCheckpointId();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.info(<span style="color: #98c379;line-height: 26px;">"Start&nbsp;to&nbsp;flush&nbsp;snapshot&nbsp;state&nbsp;to&nbsp;state&nbsp;backend,&nbsp;table:&nbsp;{},&nbsp;checkpointId:&nbsp;{}"</span>,&nbsp;this.table,&nbsp;checkpointId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.dataFilesPerCheckpoint.put(checkpointId,&nbsp;this.writeToManifest(checkpointId));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.checkpointsState.clear();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.checkpointsState.add(this.dataFilesPerCheckpoint);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.jobIdState.clear();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.jobIdState.add(this.flinkJobId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.writeResultsOfCurrentCkpt.clear();<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">this.dataFilesPerCheckpoint.put(checkpointId, this.writeToManifest(checkpointId));
ä¸ºæ›´æ–°å½“å‰çš„checkpointIdå’Œmanifestå…ƒæ–‡ä»¶ä¿¡æ¯</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">dataFilesPerCheckpointä¸è°ƒç”¨å…³ç³»å¦‚ä¸‹ï¼š</p><figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0;margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.3619361936193619" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/8_MiaZPLNeUj2IKvon3BuI6uEdiahicA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2MIAhHH1mPG6Tdsg33w3ia0Lx6lNicMlibC8zVJoQwZKh9NibNiczThMiaZPLNeUj2IKvon3BuI6uEdiahicA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1818" style="display: block;margin: 0 auto;max-width: 100%;"  /></figure><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">private&nbsp;byte[]&nbsp;writeToManifest(long&nbsp;checkpointId)&nbsp;throws&nbsp;IOException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(this.writeResultsOfCurrentCkpt.isEmpty())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;EMPTY_MANIFEST_DATA;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteResult&nbsp;result&nbsp;=&nbsp;WriteResult.builder().addAll(this.writeResultsOfCurrentCkpt).build();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeltaManifests&nbsp;deltaManifests&nbsp;=&nbsp;FlinkManifestUtil.writeCompletedFiles(result,&nbsp;()&nbsp;-&gt;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;this.manifestOutputFileFactory.create(checkpointId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;this.table.spec());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;SimpleVersionedSerialization.writeVersionAndSerialize(DeltaManifestsSerializer.INSTANCE,&nbsp;deltaManifests);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">writeResultsOfCurrentCkptä¸­åŒ…å«äº†datafileæ–‡ä»¶ã€deletefileæ–‡ä»¶å’Œreferencedæ•°æ®æ–‡ä»¶ã€‚ç„¶åï¼Œæ ¹æ®resultåˆ›å»ºdeltaManifests ï¼Œå¹¶ä¸”è¿”å›åºåˆ—åŒ–åçš„manifestä¿¡æ¯ã€‚</p><figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0;margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.176759410801964" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/9_xAC5HFMQDCTwOiauibs27svrB7zf5A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MIAhHH1mPG6Tdsg33w3ia0L0tOnD4kGib7KeZmibBhMibkjuZbbQxAC5HFMQDCTwOiauibs27svrB7zf5A/640?wx_fmt=png'" data-type="png" data-w="1833" style="display: block;margin: 0 auto;max-width: 100%;"  /></figure><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">deltaManifests å€¼å¦‚ä¸‹ï¼š</p><figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0;margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.35075431034482757" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/10_NvT4Zy3PNHOnDfKSXS4ictkPotzOAg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MIAhHH1mPG6Tdsg33w3ia0LVovrSpv89OiaEtJPXswfkwZiaaSNvT4Zy3PNHOnDfKSXS4ictkPotzOAg/640?wx_fmt=png'" data-type="png" data-w="1856" style="display: block;margin: 0 auto;max-width: 100%;"  /></figure><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">static&nbsp;DeltaManifests&nbsp;writeCompletedFiles(WriteResult&nbsp;result,&nbsp;Supplier&lt;OutputFile&gt;&nbsp;outputFileSupplier,&nbsp;PartitionSpec&nbsp;spec)&nbsp;throws&nbsp;IOException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ManifestFile&nbsp;dataManifest&nbsp;=&nbsp;null;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ManifestFile&nbsp;deleteManifest&nbsp;=&nbsp;null;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(result.dataFiles()&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;result.dataFiles().length&nbsp;&gt;&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dataManifest&nbsp;=&nbsp;writeDataFiles((OutputFile)outputFileSupplier.get(),&nbsp;spec,&nbsp;Lists.newArrayList(result.dataFiles()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(result.deleteFiles()&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;result.deleteFiles().length&nbsp;&gt;&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutputFile&nbsp;deleteManifestFile&nbsp;=&nbsp;(OutputFile)outputFileSupplier.get();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ManifestWriter&lt;DeleteFile&gt;&nbsp;deleteManifestWriter&nbsp;=&nbsp;ManifestFiles.writeDeleteManifest(2,&nbsp;spec,&nbsp;deleteManifestFile,&nbsp;DUMMY_SNAPSHOT_ID);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ManifestWriter&lt;DeleteFile&gt;&nbsp;writer&nbsp;=&nbsp;deleteManifestWriter;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;var8&nbsp;=&nbsp;null;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteFile[]&nbsp;var9&nbsp;=&nbsp;result.deleteFiles();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;var10&nbsp;=&nbsp;var9.length;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>(int&nbsp;var11&nbsp;=&nbsp;0;&nbsp;var11&nbsp;&lt;&nbsp;var10;&nbsp;++var11)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeleteFile&nbsp;deleteFile&nbsp;=&nbsp;var9[var11];<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writer.add(deleteFile);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Throwable&nbsp;var16)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var8&nbsp;=&nbsp;var16;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;var16;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(writer&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d19a66;line-height: 26px;">$closeResource</span>(var8,&nbsp;writer);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deleteManifest&nbsp;=&nbsp;deleteManifestWriter.toManifestFile();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;new&nbsp;DeltaManifests(dataManifest,&nbsp;deleteManifest,&nbsp;result.referencedDataFiles());<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">ä»ä¸Šé¢å†™å…¥è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œdatafileå’Œdeletefileå†™å…¥åï¼Œåˆ†åˆ«ç”Ÿæˆå„è‡ªçš„Manifestæ–‡ä»¶ï¼Œæœ€ååˆ›å»ºDeltaManifestsè¿”å›ã€‚</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">æœ€åé€šçŸ¥checkpointå®Œæˆï¼Œæäº¤checkpoint</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;void&nbsp;notifyCheckpointComplete(long&nbsp;checkpointId)&nbsp;throws&nbsp;Exception&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super.notifyCheckpointComplete(checkpointId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(checkpointId&nbsp;&gt;&nbsp;this.maxCommittedCheckpointId)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.commitUpToCheckpoint(this.dataFilesPerCheckpoint,&nbsp;this.flinkJobId,&nbsp;checkpointId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.maxCommittedCheckpointId&nbsp;=&nbsp;checkpointId;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">private&nbsp;void&nbsp;commitUpToCheckpoint(NavigableMap&lt;Long,&nbsp;byte[]&gt;&nbsp;deltaManifestsMap,&nbsp;String&nbsp;newFlinkJobId,&nbsp;long&nbsp;checkpointId)&nbsp;throws&nbsp;IOException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NavigableMap&lt;Long,&nbsp;byte[]&gt;&nbsp;pendingMap&nbsp;=&nbsp;deltaManifestsMap.headMap(checkpointId,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;ManifestFile&gt;&nbsp;manifests&nbsp;=&nbsp;Lists.newArrayList();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NavigableMap&lt;Long,&nbsp;WriteResult&gt;&nbsp;pendingResults&nbsp;=&nbsp;Maps.newTreeMap();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iterator&nbsp;var8&nbsp;=&nbsp;pendingMap.entrySet().iterator();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">while</span>(var8.hasNext())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry&lt;Long,&nbsp;byte[]&gt;&nbsp;e&nbsp;=&nbsp;(Entry)var8.next();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(!Arrays.equals(EMPTY_MANIFEST_DATA,&nbsp;(byte[])e.getValue()))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DeltaManifests&nbsp;deltaManifests&nbsp;=&nbsp;(DeltaManifests)SimpleVersionedSerialization.readVersionAndDeSerialize(DeltaManifestsSerializer.INSTANCE,&nbsp;(byte[])e.getValue());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pendingResults.put((Long)e.getKey(),&nbsp;FlinkManifestUtil.readCompletedFiles(deltaManifests,&nbsp;this.table.io()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;manifests.addAll(deltaManifests.manifests());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(this.replacePartitions)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.replacePartitions(pendingResults,&nbsp;newFlinkJobId,&nbsp;checkpointId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.commitDeltaTxn(pendingResults,&nbsp;newFlinkJobId,&nbsp;checkpointId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pendingMap.clear();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var8&nbsp;=&nbsp;manifests.iterator();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">while</span>(var8.hasNext())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ManifestFile&nbsp;manifest&nbsp;=&nbsp;(ManifestFile)var8.next();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.table.io().deleteFile(manifest.path());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;var12)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;details&nbsp;=&nbsp;MoreObjects.toStringHelper(this).add(<span style="color: #98c379;line-height: 26px;">"flinkJobId"</span>,&nbsp;newFlinkJobId).add(<span style="color: #98c379;line-height: 26px;">"checkpointId"</span>,&nbsp;checkpointId).add(<span style="color: #98c379;line-height: 26px;">"manifestPath"</span>,&nbsp;manifest.path()).toString();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.warn(<span style="color: #98c379;line-height: 26px;">"The&nbsp;iceberg&nbsp;transaction&nbsp;has&nbsp;been&nbsp;committed,&nbsp;but&nbsp;we&nbsp;failed&nbsp;to&nbsp;clean&nbsp;the&nbsp;temporary&nbsp;flink&nbsp;manifests:&nbsp;{}"</span>,&nbsp;details,&nbsp;var12);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">è¿™é‡Œä¼šååºåˆ—åŒ–ä¹‹å‰åºåˆ—åŒ–çš„å€¼ï¼Œç”ŸæˆdeltaManifestsï¼Œæ·»åŠ åˆ°manifestsåˆ—è¡¨ä¸­ï¼Œmanifestså€¼ï¼š</p><figure data-tool="mdniceç¼–è¾‘å™¨" style="margin: 0;margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.4477033757609297" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/11_uY1rEFb7MQrE2ruSOkraroC7icDcmA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2MIAhHH1mPG6Tdsg33w3ia0LNMg64I9kHwDJnIBicAmOBF1NquuY1rEFb7MQrE2ruSOkraroC7icDcmA/640?wx_fmt=png'" data-type="png" data-w="1807" style="display: block;margin: 0 auto;max-width: 100%;"  /></figure><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">ç„¶åæ ¹æ®replacePartitionsï¼ˆåˆ›å»ºæ—¶ä¼ å…¥çš„overwriteå€¼ï¼Œé»˜è®¤ä¸ºfalseï¼‰å€¼æäº¤äº‹åŠ¡ï¼Œé»˜è®¤æƒ…å†µä¸‹è°ƒç”¨commitDeltaTxn()</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;commitDeltaTxn(NavigableMap&lt;Long,&nbsp;WriteResult&gt;&nbsp;pendingResults,&nbsp;String&nbsp;newFlinkJobId,&nbsp;long&nbsp;checkpointId)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;deleteFilesNum&nbsp;=&nbsp;pendingResults.values().stream().mapToInt((r)&nbsp;-&gt;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;r.deleteFiles().length;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}).sum();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stream&nbsp;var10000;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(deleteFilesNum&nbsp;==&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AppendFiles&nbsp;appendFiles&nbsp;=&nbsp;this.table.newAppend();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;numFiles&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iterator&nbsp;var8&nbsp;=&nbsp;pendingResults.values().iterator();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">while</span>(var8.hasNext())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteResult&nbsp;result&nbsp;=&nbsp;(WriteResult)var8.next();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Preconditions.checkState(result.referencedDataFiles().length&nbsp;==&nbsp;0,&nbsp;<span style="color: #98c379;line-height: 26px;">"Should&nbsp;have&nbsp;no&nbsp;referenced&nbsp;data&nbsp;files."</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numFiles&nbsp;+=&nbsp;result.dataFiles().length;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var10000&nbsp;=&nbsp;Arrays.stream(result.dataFiles());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Objects.requireNonNull(appendFiles);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var10000.forEach(appendFiles::appendFile);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.commitOperation(appendFiles,&nbsp;numFiles,&nbsp;0,&nbsp;<span style="color: #98c379;line-height: 26px;">"append"</span>,&nbsp;newFlinkJobId,&nbsp;checkpointId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iterator&nbsp;var12&nbsp;=&nbsp;pendingResults.entrySet().iterator();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">while</span>(var12.hasNext())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry&lt;Long,&nbsp;WriteResult&gt;&nbsp;e&nbsp;=&nbsp;(Entry)var12.next();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WriteResult&nbsp;result&nbsp;=&nbsp;(WriteResult)e.getValue();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RowDelta&nbsp;rowDelta&nbsp;=&nbsp;this.table.newRowDelta().validateDataFilesExist(ImmutableList.copyOf(result.referencedDataFiles())).validateDeletedFiles();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;numDataFiles&nbsp;=&nbsp;result.dataFiles().length;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var10000&nbsp;=&nbsp;Arrays.stream(result.dataFiles());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Objects.requireNonNull(rowDelta);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var10000.forEach(rowDelta::addRows);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;numDeleteFiles&nbsp;=&nbsp;result.deleteFiles().length;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var10000&nbsp;=&nbsp;Arrays.stream(result.deleteFiles());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Objects.requireNonNull(rowDelta);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var10000.forEach(rowDelta::addDeletes);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.commitOperation(rowDelta,&nbsp;numDataFiles,&nbsp;numDeleteFiles,&nbsp;<span style="color: #98c379;line-height: 26px;">"rowDelta"</span>,&nbsp;newFlinkJobId,&nbsp;(Long)e.getKey());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">åˆ›å»ºä¸€ä¸ªRowDeltaçš„å¯¹è±¡rowDeltaæˆ–MergeAppendçš„appendFilesï¼ŒrowDeltaçš„å®ç°ç±»ä¸ºBaseRowDeltaç»§æ‰¿è‡ªMergingSnapshotProducerä½œä¸ºä¸€ä¸ªæ–°çš„snapshotæäº¤ï¼›appendFilesçš„å®ç°ç±»MergeAppendï¼ŒåŒæ ·ç»§æ‰¿MergingSnapshotProducerã€‚</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">private&nbsp;void&nbsp;commitOperation(SnapshotUpdate&lt;?&gt;&nbsp;operation,&nbsp;int&nbsp;numDataFiles,&nbsp;int&nbsp;numDeleteFiles,&nbsp;String&nbsp;description,&nbsp;String&nbsp;newFlinkJobId,&nbsp;long&nbsp;checkpointId)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.info(<span style="color: #98c379;line-height: 26px;">"Committing&nbsp;{}&nbsp;with&nbsp;{}&nbsp;data&nbsp;files&nbsp;and&nbsp;{}&nbsp;delete&nbsp;files&nbsp;to&nbsp;table&nbsp;{}"</span>,&nbsp;new&nbsp;Object[]{description,&nbsp;numDataFiles,&nbsp;numDeleteFiles,&nbsp;this.table});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operation.set(<span style="color: #98c379;line-height: 26px;">"flink.max-committed-checkpoint-id"</span>,&nbsp;Long.toString(checkpointId));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operation.set(<span style="color: #98c379;line-height: 26px;">"flink.job-id"</span>,&nbsp;newFlinkJobId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;start&nbsp;=&nbsp;System.currentTimeMillis();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operation.commit();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;duration&nbsp;=&nbsp;System.currentTimeMillis()&nbsp;-&nbsp;start;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.info(<span style="color: #98c379;line-height: 26px;">"Committed&nbsp;in&nbsp;{}&nbsp;ms"</span>,&nbsp;duration);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">operation.commit()ä¼šè°ƒç”¨SnapshotProducerä¸­çš„commit()æ–¹æ³•</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;void&nbsp;<span style="color: rgb(97, 174, 238);line-height: 26px;">commit</span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AtomicLong&nbsp;newSnapshotId&nbsp;=&nbsp;new&nbsp;AtomicLong(-1L);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tasks.foreach(new&nbsp;TableOperations[]{this.ops}).retry(this.base.propertyAsInt(<span style="color: #98c379;line-height: 26px;">"commit.retry.num-retries"</span>,&nbsp;4)).exponentialBackoff((long)this.base.propertyAsInt(<span style="color: #98c379;line-height: 26px;">"commit.retry.min-wait-ms"</span>,&nbsp;100),&nbsp;(long)this.base.propertyAsInt(<span style="color: #98c379;line-height: 26px;">"commit.retry.max-wait-ms"</span>,&nbsp;60000),&nbsp;(long)this.base.propertyAsInt(<span style="color: #98c379;line-height: 26px;">"commit.retry.total-timeout-ms"</span>,&nbsp;1800000),&nbsp;2.0D).onlyRetryOn(CommitFailedException.class).run((taskOps)&nbsp;-&gt;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Snapshot&nbsp;newSnapshot&nbsp;=&nbsp;this.apply();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newSnapshotId.set(newSnapshot.snapshotId());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TableMetadata&nbsp;updated;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(this.stageOnly)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updated&nbsp;=&nbsp;this.base.addStagedSnapshot(newSnapshot);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updated&nbsp;=&nbsp;this.base.replaceCurrentSnapshot(newSnapshot);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(updated&nbsp;!=&nbsp;this.base)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskOps.commit(this.base,&nbsp;updated.withUUID());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(RuntimeException&nbsp;var5)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exceptions.suppressAndThrow(var5,&nbsp;this::cleanAll);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.info(<span style="color: #98c379;line-height: 26px;">"Committed&nbsp;snapshot&nbsp;{}&nbsp;({})"</span>,&nbsp;newSnapshotId.get(),&nbsp;this.getClass().getSimpleName());<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Snapshot&nbsp;saved&nbsp;=&nbsp;this.ops.refresh().snapshot(newSnapshotId.get());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(saved&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.cleanUncommitted(Sets.newHashSet(saved.allManifests()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Iterator&nbsp;var3&nbsp;=&nbsp;this.manifestLists.iterator();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">while</span>(var3.hasNext())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;manifestList&nbsp;=&nbsp;(String)var3.next();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(!saved.manifestListLocation().equals(manifestList))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.deleteFile(manifestList);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.warn(<span style="color: #98c379;line-height: 26px;">"Failed&nbsp;to&nbsp;load&nbsp;committed&nbsp;snapshot,&nbsp;skipping&nbsp;manifest&nbsp;clean-up"</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(RuntimeException&nbsp;var6)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.warn(<span style="color: #98c379;line-height: 26px;">"Failed&nbsp;to&nbsp;load&nbsp;committed&nbsp;table&nbsp;metadata,&nbsp;skipping&nbsp;manifest&nbsp;clean-up"</span>,&nbsp;var6);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.notifyListeners();<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">SnapshotProducer.apply() æ–¹æ³•æ‰§è¡Œå†™å…¥manifestFilesæ•°æ®ï¼Œè¿”å›å¿«ç…§æ•°æ®ï¼›</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;Snapshot&nbsp;<span style="color: rgb(97, 174, 238);line-height: 26px;">apply</span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.base&nbsp;=&nbsp;this.refresh();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Long&nbsp;parentSnapshotId&nbsp;=&nbsp;this.base.currentSnapshot()&nbsp;!=&nbsp;null&nbsp;?&nbsp;this.base.currentSnapshot().snapshotId()&nbsp;:&nbsp;null;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;sequenceNumber&nbsp;=&nbsp;this.base.nextSequenceNumber();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.validate(this.base);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;ManifestFile&gt;&nbsp;manifests&nbsp;=&nbsp;this.apply(this.base);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(this.base.formatVersion()&nbsp;&lt;=&nbsp;1&nbsp;&amp;&amp;&nbsp;!this.base.propertyAsBoolean(<span style="color: #98c379;line-height: 26px;">"write.manifest-lists.enabled"</span>,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;new&nbsp;BaseSnapshot(this.ops.io(),&nbsp;this.snapshotId(),&nbsp;parentSnapshotId,&nbsp;System.currentTimeMillis(),&nbsp;this.operation(),&nbsp;this.summary(this.base),&nbsp;manifests);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutputFile&nbsp;manifestList&nbsp;=&nbsp;this.manifestListPath();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ManifestListWriter&nbsp;writer&nbsp;=&nbsp;ManifestLists.write(this.ops.current().formatVersion(),&nbsp;manifestList,&nbsp;this.snapshotId(),&nbsp;parentSnapshotId,&nbsp;sequenceNumber);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Throwable&nbsp;var7&nbsp;=&nbsp;null;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.manifestLists.add(manifestList.location());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ManifestFile[]&nbsp;manifestFiles&nbsp;=&nbsp;new&nbsp;ManifestFile[manifests.size()];<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tasks.range(manifestFiles.length).stopOnFailure().throwFailureWhenFinished().executeWith(ThreadPools.getWorkerPool()).run((index)&nbsp;-&gt;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;manifestFiles[index]&nbsp;=&nbsp;(ManifestFile)this.manifestsWithMetadata.get((ManifestFile)manifests.get(index));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writer.addAll(Arrays.asList(manifestFiles));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Throwable&nbsp;var13)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var7&nbsp;=&nbsp;var13;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;var13;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(writer&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d19a66;line-height: 26px;">$closeResource</span>(var7,&nbsp;writer);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(IOException&nbsp;var15)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RuntimeIOException(var15,&nbsp;<span style="color: #98c379;line-height: 26px;">"Failed&nbsp;to&nbsp;write&nbsp;manifest&nbsp;list&nbsp;file"</span>,&nbsp;new&nbsp;Object[0]);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;new&nbsp;BaseSnapshot(this.ops.io(),&nbsp;sequenceNumber,&nbsp;this.snapshotId(),&nbsp;parentSnapshotId,&nbsp;System.currentTimeMillis(),&nbsp;this.operation(),&nbsp;this.summary(this.base),&nbsp;manifestList.location());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">ç„¶åç”Ÿæˆè¡¨çš„å…ƒæ•°æ®updated</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;TableMetadata&nbsp;replaceCurrentSnapshot(Snapshot&nbsp;snapshot)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(this.snapshotsById.containsKey(snapshot.snapshotId()))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;this.setCurrentSnapshotTo(snapshot);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ValidationException.check(this.formatVersion&nbsp;==&nbsp;1&nbsp;||&nbsp;snapshot.sequenceNumber()&nbsp;&gt;&nbsp;this.lastSequenceNumber,&nbsp;<span style="color: #98c379;line-height: 26px;">"Cannot&nbsp;add&nbsp;snapshot&nbsp;with&nbsp;sequence&nbsp;number&nbsp;%s&nbsp;older&nbsp;than&nbsp;last&nbsp;sequence&nbsp;number&nbsp;%s"</span>,&nbsp;new&nbsp;Object[]{snapshot.sequenceNumber(),&nbsp;this.lastSequenceNumber});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Snapshot&gt;&nbsp;newSnapshots&nbsp;=&nbsp;ImmutableList.builder().addAll(this.snapshots).add(snapshot).build();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;HistoryEntry&gt;&nbsp;newSnapshotLog&nbsp;=&nbsp;ImmutableList.builder().addAll(this.snapshotLog).add(new&nbsp;TableMetadata.SnapshotLogEntry(snapshot.timestampMillis(),&nbsp;snapshot.snapshotId())).build();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;new&nbsp;TableMetadata((InputFile)null,&nbsp;this.formatVersion,&nbsp;this.uuid,&nbsp;this.location,&nbsp;snapshot.sequenceNumber(),&nbsp;snapshot.timestampMillis(),&nbsp;this.lastColumnId,&nbsp;this.schema,&nbsp;this.defaultSpecId,&nbsp;this.specs,&nbsp;this.defaultSortOrderId,&nbsp;this.sortOrders,&nbsp;this.properties,&nbsp;snapshot.snapshotId(),&nbsp;newSnapshots,&nbsp;newSnapshotLog,&nbsp;this.addPreviousFile(this.file,&nbsp;this.lastUpdatedMillis));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">è°ƒç”¨BaseMetastoreTableOperationsç®—å­çš„commit()æ–¹æ³•</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;void&nbsp;commit(TableMetadata&nbsp;base,&nbsp;TableMetadata&nbsp;metadata)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(base&nbsp;!=&nbsp;this.current())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;CommitFailedException(<span style="color: #98c379;line-height: 26px;">"Cannot&nbsp;commit:&nbsp;stale&nbsp;table&nbsp;metadata"</span>,&nbsp;new&nbsp;Object[0]);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(base&nbsp;==&nbsp;metadata)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.info(<span style="color: #98c379;line-height: 26px;">"Nothing&nbsp;to&nbsp;commit."</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;start&nbsp;=&nbsp;System.currentTimeMillis();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.doCommit(base,&nbsp;metadata);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.deleteRemovedMetadataFiles(base,&nbsp;metadata);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.requestRefresh();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.info(<span style="color: #98c379;line-height: 26px;">"Successfully&nbsp;committed&nbsp;to&nbsp;table&nbsp;{}&nbsp;in&nbsp;{}&nbsp;ms"</span>,&nbsp;this.tableName(),&nbsp;System.currentTimeMillis()&nbsp;-&nbsp;start);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">æœ€åè°ƒç”¨HiveTableOperationsçš„doCommit()ï¼Œæ‰§è¡Œæäº¤æ“ä½œã€‚</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">protected&nbsp;void&nbsp;doCommit(TableMetadata&nbsp;base,&nbsp;TableMetadata&nbsp;metadata)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;newMetadataLocation&nbsp;=&nbsp;this.writeNewMetadata(metadata,&nbsp;this.currentVersion()&nbsp;+&nbsp;1);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;hiveEngineEnabled&nbsp;=&nbsp;hiveEngineEnabled(metadata,&nbsp;this.conf);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;threw&nbsp;=&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;updateHiveTable&nbsp;=&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Optional&nbsp;lockId&nbsp;=&nbsp;Optional.empty();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lockId&nbsp;=&nbsp;Optional.of(this.acquireLock());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Table&nbsp;tbl&nbsp;=&nbsp;this.loadHmsTable();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(tbl&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(base&nbsp;==&nbsp;null&nbsp;&amp;&amp;&nbsp;tbl.getParameters().get(<span style="color: #98c379;line-height: 26px;">"metadata_location"</span>)&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AlreadyExistsException(<span style="color: #98c379;line-height: 26px;">"Table&nbsp;already&nbsp;exists:&nbsp;%s.%s"</span>,&nbsp;new&nbsp;Object[]{this.database,&nbsp;this.tableName});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateHiveTable&nbsp;=&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.debug(<span style="color: #98c379;line-height: 26px;">"Committing&nbsp;existing&nbsp;table:&nbsp;{}"</span>,&nbsp;this.fullName);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl&nbsp;=&nbsp;this.newHmsTable();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOG.debug(<span style="color: #98c379;line-height: 26px;">"Committing&nbsp;new&nbsp;table:&nbsp;{}"</span>,&nbsp;this.fullName);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tbl.setSd(this.storageDescriptor(metadata,&nbsp;hiveEngineEnabled));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;metadataLocation&nbsp;=&nbsp;(String)tbl.getParameters().get(<span style="color: #98c379;line-height: 26px;">"metadata_location"</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;baseMetadataLocation&nbsp;=&nbsp;base&nbsp;!=&nbsp;null&nbsp;?&nbsp;base.metadataFileLocation()&nbsp;:&nbsp;null;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(!Objects.equals(baseMetadataLocation,&nbsp;metadataLocation))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;CommitFailedException(<span style="color: #98c379;line-height: 26px;">"Base&nbsp;metadata&nbsp;location&nbsp;'%s'&nbsp;is&nbsp;not&nbsp;same&nbsp;as&nbsp;the&nbsp;current&nbsp;table&nbsp;metadata&nbsp;location&nbsp;'%s'&nbsp;for&nbsp;%s.%s"</span>,&nbsp;new&nbsp;Object[]{baseMetadataLocation,&nbsp;metadataLocation,&nbsp;this.database,&nbsp;this.tableName});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.setParameters(newMetadataLocation,&nbsp;tbl,&nbsp;hiveEngineEnabled);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.persistTable(tbl,&nbsp;updateHiveTable);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;threw&nbsp;=&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(org.apache.hadoop.hive.metastore.api.AlreadyExistsException&nbsp;var16)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;AlreadyExistsException(<span style="color: #98c379;line-height: 26px;">"Table&nbsp;already&nbsp;exists:&nbsp;%s.%s"</span>,&nbsp;new&nbsp;Object[]{this.database,&nbsp;this.tableName});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(UnknownHostException&nbsp;|&nbsp;TException&nbsp;var17)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(var17.getMessage()&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;var17.getMessage().contains(<span style="color: #98c379;line-height: 26px;">"Table/View&nbsp;'HIVE_LOCKS'&nbsp;does&nbsp;not&nbsp;exist"</span>))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RuntimeException(<span style="color: #98c379;line-height: 26px;">"Failed&nbsp;to&nbsp;acquire&nbsp;locks&nbsp;from&nbsp;metastore&nbsp;because&nbsp;'HIVE_LOCKS'&nbsp;doesn't&nbsp;exist,&nbsp;this&nbsp;probably&nbsp;happened&nbsp;when&nbsp;using&nbsp;embedded&nbsp;metastore&nbsp;or&nbsp;doesn't&nbsp;create&nbsp;a&nbsp;transactional&nbsp;meta&nbsp;table.&nbsp;To&nbsp;fix&nbsp;this,&nbsp;use&nbsp;an&nbsp;alternative&nbsp;metastore"</span>,&nbsp;var17);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RuntimeException(String.format(<span style="color: #98c379;line-height: 26px;">"Metastore&nbsp;operation&nbsp;failed&nbsp;for&nbsp;%s.%s"</span>,&nbsp;this.database,&nbsp;this.tableName),&nbsp;var17);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(InterruptedException&nbsp;var18)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.currentThread().interrupt();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RuntimeException(<span style="color: #98c379;line-height: 26px;">"Interrupted&nbsp;during&nbsp;commit"</span>,&nbsp;var18);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.cleanupMetadataAndUnlock(threw,&nbsp;newMetadataLocation,&nbsp;lockId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><h5 data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 30px;margin-bottom: 15px;padding: 0px;font-weight: bold;color: black;font-size: 16px;">é™„ï¼šflink taskæ‰§è¡Œæµç¨‹</h5><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">taskçš„ç”Ÿå‘½å‘¨æœŸï¼š</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">StreamTaskæ˜¯æ‰€æœ‰stream taskçš„åŸºæœ¬ç±»ã€‚ä¸€ä¸ªtask è¿è¡Œä¸€ä¸ªæˆ–è€…å¤šä¸ªStreamOperatorï¼ˆå¦‚æœæˆchainï¼‰ã€‚æˆchainçš„ç®—å­åœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…åŒæ­¥è¿è¡Œã€‚</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">æ‰§è¡Œè¿‡ç¨‹ï¼š</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">@Override<br  />&nbsp;public&nbsp;final&nbsp;void&nbsp;invoke()&nbsp;throws&nbsp;Exception&nbsp;{<br  />&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;beforeInvoke();<br  /><br  />&nbsp;&nbsp;&nbsp;//&nbsp;final&nbsp;check&nbsp;to&nbsp;<span style="color: #e6c07b;line-height: 26px;">exit</span>&nbsp;early&nbsp;before&nbsp;starting&nbsp;to&nbsp;run<br  />&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(canceled)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;CancelTaskException();<br  />&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;//&nbsp;<span style="color: #e6c07b;line-height: 26px;">let</span>&nbsp;the&nbsp;task&nbsp;<span style="color: #c678dd;line-height: 26px;">do</span>&nbsp;its&nbsp;work<br  />&nbsp;&nbsp;&nbsp;runMailboxLoop();<br  /><br  />&nbsp;&nbsp;&nbsp;//&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;this&nbsp;left&nbsp;the&nbsp;run()&nbsp;method&nbsp;cleanly&nbsp;despite&nbsp;the&nbsp;fact&nbsp;that&nbsp;this&nbsp;was&nbsp;canceled,<br  />&nbsp;&nbsp;&nbsp;//&nbsp;make&nbsp;sure&nbsp;the&nbsp;<span style="color: #98c379;line-height: 26px;">"clean&nbsp;shutdown"</span>&nbsp;is&nbsp;not&nbsp;attempted<br  />&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(canceled)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;CancelTaskException();<br  />&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;afterInvoke();<br  />&nbsp;&nbsp;}<br  />&nbsp;&nbsp;catch&nbsp;(Exception&nbsp;invokeException)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;cleanUpInvoke();<br  />&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;catch&nbsp;(Throwable&nbsp;cleanUpException)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;(Exception)&nbsp;ExceptionUtils.firstOrSuppressed(cleanUpException,&nbsp;invokeException);<br  />&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;throw&nbsp;invokeException;<br  />&nbsp;&nbsp;}<br  />&nbsp;&nbsp;cleanUpInvoke();<br  />&nbsp;}<br  /></code></pre><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">åœ¨beforeInvokeä¸­ä¼šåšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬æå–å‡ºæ‰€æœ‰çš„operatorç­‰ã€‚
åœ¨runMailboxLoopä¸­è°ƒç”¨taskè¿è¡Œ
åœ¨afterInvokeä¸­ç»“æŸ</p><p data-tool="mdniceç¼–è¾‘å™¨" style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;margin: 0;line-height: 26px;color: black;">è°ƒç”¨å…³ç³»ï¼š</p><pre data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">--&nbsp;invoke()<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----&gt;&nbsp;Create&nbsp;basic&nbsp;utils&nbsp;(config,&nbsp;etc)&nbsp;and&nbsp;load&nbsp;the&nbsp;chain&nbsp;of&nbsp;operators<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----&gt;&nbsp;operators.setup()<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----&gt;&nbsp;task&nbsp;specific&nbsp;init()<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----&gt;&nbsp;initialize-operator-states()<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----&gt;&nbsp;open-operators()<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----&gt;&nbsp;run()<br  />*&nbsp;--------------&gt;&nbsp;mailboxProcessor.runMailboxLoop();<br  />*&nbsp;--------------&gt;&nbsp;StreamTask.processInput()<br  />*&nbsp;--------------&gt;&nbsp;StreamTask.inputProcessor.processInput()<br  />*&nbsp;--------------&gt;&nbsp;é—´æ¥è°ƒç”¨&nbsp;operatorçš„processElement()å’ŒprocessWatermark()æ–¹æ³•<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----&gt;&nbsp;close-operators()<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----&gt;&nbsp;dispose-operators()<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----&gt;&nbsp;common&nbsp;cleanup<br  />*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+----&gt;&nbsp;task&nbsp;specific&nbsp;cleanup()<br  /></code></pre><ol data-tool="mdniceç¼–è¾‘å™¨" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: decimal;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">åˆ›å»ºçŠ¶æ€å­˜å‚¨åç«¯ï¼Œä¸º OperatorChain ä¸­çš„æ‰€æœ‰ç®—å­æä¾›çŠ¶æ€</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">åŠ è½½ OperatorChain ä¸­çš„æ‰€æœ‰ç®—å­</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">æ‰€æœ‰çš„ operator è°ƒç”¨ setup</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">task ç›¸å…³çš„åˆå§‹åŒ–æ“ä½œ</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">æ‰€æœ‰ operator è°ƒç”¨ initializeState åˆå§‹åŒ–çŠ¶æ€</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">æ‰€æœ‰çš„ operator è°ƒç”¨ open</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">run æ–¹æ³•å¾ªç¯å¤„ç†æ•°æ®</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">æ‰€æœ‰ operator è°ƒç”¨ close</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">æ‰€æœ‰ operator è°ƒç”¨ dispose</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">é€šç”¨çš„ cleanup æ“ä½œ</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;text-align: left;color: rgb(1,1,1);font-weight: 500;">task ç›¸å…³çš„ cleanup æ“ä½œ</section></li></ol></section><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com" style="padding-right: 10px;padding-left: 10px;max-width: 100%;white-space: normal;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;line-height: 1.6;letter-spacing: 0.034em;color: rgb(63, 63, 63);font-size: 16px;overflow-wrap: break-word !important;box-sizing: border-box !important;margin-bottom: 0px;"><section data-tool="mdniceç¼–è¾‘å™¨" data-website="https://www.mdnice.com" style="padding-right: 10px;padding-left: 10px;max-width: 100%;line-height: 1.6;letter-spacing: 0.034em;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 5px 0px;max-width: 100%;line-height: 26px;color: rgb(1, 1, 1);text-align: left;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="letter-spacing: 0.544px;color: rgb(74, 74, 74);max-width: 100%;font-size: 15px;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;box-sizing: border-box !important;">å¦‚æœè¿™ä¸ªæ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸è¦å¿˜è®°&nbsp;</span><span style="letter-spacing: 0.544px;max-width: 100%;outline: 0px;font-size: 15px;background-color: rgb(255, 255, 255);color: rgb(255, 104, 39);overflow-wrap: break-word !important;box-sizing: border-box !important;"><strong style="max-width: 100%;outline: 0px;line-height: 1.75em;overflow-wrap: break-word !important;box-sizing: border-box !important;">ã€Œåœ¨çœ‹ã€</strong>&nbsp;<strong style="max-width: 100%;outline: 0px;line-height: 1.75em;overflow-wrap: break-word !important;box-sizing: border-box !important;">ã€Œç‚¹èµã€</strong>&nbsp;<strong style="max-width: 100%;outline: 0px;line-height: 1.75em;overflow-wrap: break-word !important;box-sizing: border-box !important;">ã€Œæ”¶è—ã€</strong></span><span style="letter-spacing: 0.544px;color: rgb(74, 74, 74);max-width: 100%;font-size: 15px;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;box-sizing: border-box !important;">&nbsp;ä¸‰è¿å•Šå–‚ï¼</span></section><p style="text-align: center;margin-bottom: 0em;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="1.4586206896551723" data-s="300,640" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/12_Meiaf8u6goR03VhhyJkpXN9iaibnIg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2NCHC0dw9dMYMR2DBvGh04aE6bIbNHCDKIOQeDpQ2aIGYWlTogMeiaf8u6goR03VhhyJkpXN9iaibnIg/640?wx_fmt=jpeg'" data-type="png" data-w="580" style="width: 260px;height: 379px;"  /><span style="background-color: rgb(255, 255, 255);color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;"></span></p></section></section><section style="max-width: 100%;white-space: normal;margin-bottom: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135ç¼–è¾‘å™¨" data-id="98469" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.10979228486646884" src="å›¾ç‰‡/å¤§æ•°æ®æŠ€æœ¯ä¸æ¶æ„_2022-07-06_Apache Icebergæ ¸å¿ƒåŸç†åˆ†ææ–‡ä»¶å­˜å‚¨åŠæ•°æ®å†™å…¥æµç¨‹/13_zrkyKUN5kNeUFicVC3bMP1GEqKz1OQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/BSBqCXrZtzAicMToibKuIysLrB62M5A5YaLhZg6z86tI7ZeEZqTLLYyNrmlzrkyKUN5kNeUFicVC3bMP1GEqKz1OQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1011" style="height: 42px;color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);box-sizing: border-box;width: 384px;overflow-wrap: break-word !important;"  /></section><section style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135ç¼–è¾‘å™¨" data-id="98469" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247510040&amp;idx=1&amp;sn=aa335f25965975731173916f012d56f4&amp;chksm=fd3eee8dca49679b82f632048fb64d21fac01497d1a0fe33917edb01e194caf0f9a1930a55ce&amp;scene=21#wechat_redirect" textvalue="2022å¹´å…¨ç½‘é¦–å‘|å¤§æ•°æ®ä¸“å®¶çº§æŠ€èƒ½æ¨¡å‹ä¸å­¦ä¹ æŒ‡å—(èƒœå¤©åŠå­ç¯‡)" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;letter-spacing: 0.544px;overflow-wrap: break-word !important;box-sizing: border-box !important;">2022å¹´å…¨ç½‘é¦–å‘|å¤§æ•°æ®ä¸“å®¶çº§æŠ€èƒ½æ¨¡å‹ä¸å­¦ä¹ æŒ‡å—(èƒœå¤©åŠå­ç¯‡)</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247508317&amp;idx=1&amp;sn=0bcb7fb6997b42306994b890eaa0d47f&amp;chksm=fd3ee7c8ca496ede347a2971002c6ea68dcfd70abeeb90b43c8b02a2a60ebc7cec3a87ef7d52&amp;scene=21#wechat_redirect" textvalue="äº’è”ç½‘æœ€åçš„æ—¶ä»£å¯èƒ½çœŸçš„æ¥äº†" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">äº’è”ç½‘æœ€åçš„æ—¶ä»£å¯èƒ½çœŸçš„æ¥äº†</a><br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247507860&amp;idx=1&amp;sn=807ac5003762f29c127bc4071dcebe33&amp;chksm=fd3e9901ca4910178cfc816043ea86c29f881f70cd943d252de9ae2e21cb7e8ba80bff162e1b&amp;scene=21#wechat_redirect" textvalue="æˆ‘åœ¨Bç«™è¯»å¤§å­¦ï¼Œå¤§æ•°æ®ä¸“ä¸š" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">æˆ‘åœ¨Bç«™è¯»å¤§å­¦ï¼Œå¤§æ•°æ®ä¸“ä¸š</a><br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247499604&amp;idx=1&amp;sn=d938dfb30d221774704982d2938b30c1&amp;chksm=fd3eb9c1ca4930d76a391241333de461ca22d2aa27472eab3cffab1564872ae37f1b48fe2d3c&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">æˆ‘ä»¬åœ¨å­¦ä¹ Flinkçš„æ—¶å€™ï¼Œåˆ°åº•åœ¨å­¦ä¹ ä»€ä¹ˆï¼Ÿ</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504856&amp;idx=2&amp;sn=6f62e2a0c756ce56773eed253d2f41ee&amp;chksm=fd3e954dca491c5b732b7e2aa46db32efbc3f690e528522098659bb3c6e78e1582ab4529b5dc&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">193ç¯‡æ–‡ç« æš´æFlinkï¼Œè¿™ä¸ªåˆé›†ä½ éœ€è¦å…³æ³¨ä¸€ä¸‹</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504742&amp;idx=1&amp;sn=8765c198d8ad66219a7bcabb221e4a23&amp;chksm=fd3e95f3ca491ce52d0724b9e4154a47af0f5ea349e1e184c8fbc65aa17c0000242aa9b58429&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;letter-spacing: 0.544px;overflow-wrap: break-word !important;box-sizing: border-box !important;">Flinkç”Ÿäº§ç¯å¢ƒTOPéš¾é¢˜ä¸ä¼˜åŒ–ï¼Œé˜¿é‡Œå·´å·´è—ç»é˜YYDS</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504813&amp;idx=1&amp;sn=f5cd6ae2aa2b1e30f87a5ae55971c514&amp;chksm=fd3e9538ca491c2eb191677d070f2c7e4f1098eece00e256d6205b8a5d21b21c1e74f875f16f&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">Flink CDCæˆ‘åƒå®šäº†è€¶ç¨£ä¹Ÿç•™ä¸ä½ä»–ï¼| Flink CDCçº¿ä¸Šé—®é¢˜å°ç›˜ç‚¹</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=1&amp;sn=1f693e549f76622725b936041ff8896e&amp;chksm=e9bff2fbdec87bedecbdeed4547d7d612c72fc8d4918614a26a4e31666cf0128fd57b537f347&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">æˆ‘ä»¬åœ¨å­¦ä¹ Sparkçš„æ—¶å€™ï¼Œåˆ°åº•åœ¨å­¦ä¹ ä»€ä¹ˆï¼Ÿ</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504834&amp;idx=1&amp;sn=46ca1a3924b8fdb89ac1c2acb0319d6c&amp;chksm=fd3e9557ca491c41d837b917639ea62007ea16d3c2cc6c0c02d1f8a8c6e44318f5183b787c46&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;letter-spacing: 0.544px;overflow-wrap: break-word !important;box-sizing: border-box !important;">åœ¨æ‰€æœ‰Sparkæ¨¡å—ä¸­ï¼Œæˆ‘æ„¿ç§°SparkSQLä¸ºæœ€å¼ºï¼</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247502750&amp;idx=1&amp;sn=bd9a9173d060dc4e4ebd49c8efc6acfe&amp;chksm=fd3e8d0bca49041dea84da93910e5efdc4935e520525c09887c986691377aeb48e5cf7fb5667&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">ç¡¬åˆšHive | 4ä¸‡å­—åŸºç¡€è°ƒä¼˜é¢è¯•å°æ€»ç»“</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504382&amp;idx=2&amp;sn=550b78802acfe727e0e77cd9195f8784&amp;chksm=fd3e976bca491e7db2b8b2446d231736df01bbf13653804d680ac4390597ec17fa466ad4ae83&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">æ•°æ®æ²»ç†æ–¹æ³•è®ºå’Œå®è·µå°ç™¾ç§‘å…¨ä¹¦</a><br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503741&amp;idx=1&amp;sn=e5039be93123f2e337013756a818bfc3&amp;chksm=fd3e89e8ca4900fe603b63c5722a6fb8a32bd63d6ba23e0028851948a71b877eb1f742d95087&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">æ ‡ç­¾ä½“ç³»ä¸‹çš„ç”¨æˆ·ç”»åƒå»ºè®¾å°æŒ‡å—</a><br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503675&amp;idx=1&amp;sn=3ee6af64d0126c78b48cad219308f81e&amp;chksm=fd3e89aeca4900b8b8954e9569ee3c0877881fac8c792bfafc22e7e9d3e8524da8eb860d33d8&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">4ä¸‡å­—é•¿æ–‡ | ClickHouseåŸºç¡€&amp;å®è·µ&amp;è°ƒä¼˜å…¨è§†è§’è§£æ</a><br style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=2&amp;sn=57ecc77718f1b6f2f262d62e8318dcc9&amp;chksm=e9bff2fbdec87bedb1986765bfae7dbabb9aece45b0b2af147bbad1ac5d79ebc934c64df40ea&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">ã€é¢è¯•&amp;ä¸ªäººæˆé•¿ã€‘2021å¹´è¿‡åŠï¼Œç¤¾æ‹›å’Œæ ¡æ‹›çš„ç»éªŒä¹‹è°ˆ</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504478&amp;idx=1&amp;sn=14efef3868ba42bd044f9618745a7fdc&amp;chksm=fd3e94cbca491dddb961b7b8b93105b2869c5bcf4c03f9f0dc83ad62be0dce4c124b52ed0ba3&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">å¤§æ•°æ®æ–¹å‘å¦ä¸€ä¸ªåå¹´å¼€å¯ |ã€Šç¡¬åˆšç³»åˆ—ã€‹ç¬¬ä¸€ç‰ˆå®Œç»“</a></section><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504410&amp;idx=1&amp;sn=7e81ab5a324395eb0f12397c40247ca1&amp;chksm=fd3e948fca491d9946456acbd93b2d651ae4d7a7d0127a211981e08f50f377e60d1b7c0d7b3a&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">æˆ‘å†™è¿‡çš„å…³äºæˆé•¿/é¢è¯•/èŒåœºè¿›é˜¶çš„æ–‡ç« </a></section><section style="max-width: 100%;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135ç¼–è¾‘å™¨" data-id="98469" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="max-width: 100%;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);line-height: 3em;margin-left: 0px;margin-right: 0px;overflow-wrap: break-word !important;box-sizing: border-box !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504783&amp;idx=1&amp;sn=72aed147a459368ed934a007a2df3bc9&amp;chksm=fd3e951aca491c0cade212390011eca7d8a68951fee6aa2844b8f4d14bcbd5b3ed26305d69dc&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="max-width: 100%;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;overflow-wrap: break-word !important;box-sizing: border-box !important;">å½“æˆ‘ä»¬åœ¨å­¦ä¹ Hiveçš„æ—¶å€™åœ¨å­¦ä¹ ä»€ä¹ˆï¼Ÿã€Œç¡¬åˆšHiveç»­é›†ã€</a></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></content>
</div>
</body>
</html>