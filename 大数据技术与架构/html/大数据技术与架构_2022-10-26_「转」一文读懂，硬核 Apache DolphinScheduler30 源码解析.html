<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"大数据技术与架构","title":"一文读懂，硬核 Apache DolphinScheduler3.0 源码解析","time":"2022-10-26 17:45:07","timeStamp":"1666777507"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&mid=2247516083&idx=1&sn=121dc54797beea96cd94721fd6ef683b&chksm=fd3ef926ca497030ddd015a428643103be2bd1ab83877e13a552f9e3e04f0851e03c5598c140#rd" target="_blank">一文读懂，硬核 Apache DolphinScheduler3.0 源码解析</a></h1><div id="meta_content" class="rich_media_meta_list"><span class="rich_media_meta rich_media_meta_text">周旺&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">大数据技术与架构&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2022-10-26 17:45:07</em></div><content><div class="reprint"><p>转自公众号：海豚调度<br><a href="http://mp.weixin.qq.com/s?__biz=MzA4NDYxNTc2NA==&mid=2247513971&idx=1&sn=29459517ad3b4d94d5bf7e0cba0b7536" target="_blank" title="阅读原文">http://mp.weixin.qq.com/s?__biz=MzA4NDYxNTc2NA==&mid=2247513971&idx=1&sn=29459517ad3b4d94d5bf7e0cba0b7536</a></p></div><section mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: normal;orphans: 2;text-align: justify;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;outline: 0px;color: rgb(34, 34, 34);font-size: 14.875px;text-size-adjust: auto;letter-spacing: 0.544px;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;background-color: rgb(255, 255, 255);line-height: 23.625px;visibility: visible;" data-mpa-powered-by="yiban.io"><section powered-by="xiumi.us" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section powered-by="xiumi.us" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-role="outer" label="Powered by 135editor.com" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-tools="135编辑器" data-id="98469" mp-original-font-size="17" mp-original-line-height="27" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 23.625px;visibility: visible;font-size: 14.875px;"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" mp-original-font-size="16" mp-original-line-height="25" style="margin: 0px;padding: 0px 10px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-size: 14px;color: black;line-height: 21.875px;letter-spacing: 0px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;visibility: visible;"><blockquote data-tool="mdnice编辑器" mp-original-font-size="14.399999618530273" mp-original-line-height="23" style="margin: 20px 0px;padding: 10px 10px 10px 20px;border-left: 3px solid rgb(239, 112, 96);color: rgb(106, 115, 125);line-height: 20.125px;font-size: 12.6px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;border-top-style: none;border-right-style: none;border-bottom-style: none;overflow: auto;background-color: rgb(255, 249, 249);visibility: visible;"><p mp-original-font-size="16" mp-original-line-height="26" style="margin: 0px;padding: 8px 0px;clear: both;min-height: 1em;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-size: 14px;color: black;line-height: 22.75px;visibility: visible;"><span mp-original-font-size="14" mp-original-line-height="26" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: normal;orphans: 2;text-indent: 0px;text-transform: none;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;color: rgb(89, 89, 89);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;letter-spacing: 0.544px;text-align: left;font-size: 12.25px;visibility: visible;line-height: 22.75px;"><strong mp-original-font-size="14" mp-original-line-height="26" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;visibility: visible;font-size: 12.25px;line-height: 22.75px;"><img class="rich_pages wxw-img" data-ratio="1" data-type="png" data-w="20" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/1_6VyhjNCMic3DGmPLZocTtEmtWBJKsQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2OP8CL6Mmrc9shxR4OiamrPMlRCKiaicf2n4JLNDRcyH1jfEKxo6VyhjNCMic3DGmPLZocTtEmtWBJKsQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1'" style="margin: 0px;padding: 0px;max-width: 100%;height: auto !important;overflow-wrap: break-word !important;vertical-align: text-bottom;outline: 0px;display: inline-block;font-size: 10.7188px;line-height: 19.9062px;box-sizing: border-box !important;visibility: visible !important;width: 20px !important;"  /><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247514568&amp;idx=1&amp;sn=659d7464a3b61ebf8397d2597069f4ab&amp;chksm=fd3eff5dca49764beef9ab14400e96715b86b3394f05e161181c03424fa579cdbc242a401411&amp;scene=21#wechat_redirect" textvalue="全网最全大数据面试提升手册！" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" mp-original-font-size="14" mp-original-line-height="26" style="margin: 0px;padding: 0px;color: rgb(255, 41, 65);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: normal;orphans: 2;text-align: left;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;background-color: rgb(255, 249, 249);font-size: 14px;"><strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-size: 14px;color: rgb(255, 41, 65);">全网最全大数据面试提升手册！</span></strong></a></strong></span></p></blockquote></section></section></section></section></section></section></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px;color: black;padding-right: 10px;padding-left: 10px;line-height: 1.6;letter-spacing: 0px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;"><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>本文目录<span style="display: none;"></span></h5><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">DolphinScheduler的设计与策略<br  />1.1 分布式设计<br  />1.1.1 中心化<br  />1.1.2 去中心化<br  />1.2 DophinScheduler架构设计<br  />1.3 容错问题<br  />1.3.1 宕机容错<br  />1.3.2 失败重试<br  />1.4 远程日志访问</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">DolphinScheduler源码分析<br  />2.1 工程模块介绍与配置文件<br  />2.1.1 工程模块介绍<br  />2.1.2 配置文件<br  />2.2 Api主要任务操作接口<br  />2.3 Quaterz架构与运行流程<br  />2.3.1 概念与架构<br  />2.3.2 初始化与执行流程<br  />2.3.3 集群运转<br  />2.4 Master启动与执行流程<br  />2.4.1 概念与执行逻辑<br  />2.4.2 集群与槽（slot）<br  />2.4.3 代码执行流程<br  />2.5 Work启动与执行流程<br  />2.5.1 概念与执行逻辑<br  />2.5.2 代码执行流程<br  />2.6 rpc交互<br  />2.6.1 Master与Worker交互<br  />2.6.2 其他服务与Master交互<br  />2.7 负载均衡算法<br  />2.7.1 加权随机<br  />2.7.2 线性负载<br  />2.7.3 平滑轮询<br  />2.8 日志服务<br  />2.9 报警</p></section></li></ol><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">1. DolphinScheduler的设计与策略</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">大家能关注DolphinScheduler那么一定对调度系统有了一定的了解，对于调度所涉及的到一些专有名词在这里就不做过多的介绍，重点介绍一下流程定义，流程实例，任务定义，任务实例。（没有作业这个概念确实也很新奇，可能是不想和Quartz的JobDetail重叠）。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">任务定义：各种类型的任务，是流程定义的关键组成，如sql,shell,spark,mr，python等；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">任务实例：任务的实例化，标识着具体的任务执行状态；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">流程定义：一组任务节点通过依赖关系建立的起来的有向无环图（DAG）；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">流程实例：通过手动或者定时调度生成的流程实例；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">定时调度：系统采用Quartz 分布式调度器，并同时支持cron表达式可视化的生成；</section></li></ul><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>1.1 分布式设计<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">分布式系统的架构设计基本分为中心化和去中心化两种，各有优劣，凭借各自的业务选择。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>1.1.1 中心化<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">中心化设计比较简单，集群中的节点安装角色可以分为Master和Slave两种，如下图：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.3483009708737864" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/2_4gDU2JHsbIicyNdNicTWfRCmRawaUQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn68BoibyAZqFsIQKwiaIiaDnTow0FtEk4gDU2JHsbIicyNdNicTWfRCmRawaUQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="824" style="display: block;margin-right: auto;margin-left: auto;"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Master: Master的角色主要负责任务分发并监督Slave的健康状态，可以动态的将任务均衡到Slave上，以致Slave节点不至于“忙死”或”闲死”的状态。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">中心化设计存在一些问题。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">第一点，一旦Master出现了问题，则群龙无首，整个集群就会崩溃。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">为了解决这个问题，大多数Master/Slave架构模式都采用了主备Master的设计方案，可以是热备或者冷备，也可以是自动切换或手动切换，而且越来越多的新系统都开始具备自动选举切换Master的能力,以提升系统的可用性。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">第二点，如果Scheduler在Master上，虽然可以支持一个DAG中不同的任务运行在不同的机器上，但是会产生Master的过负载。如果Scheduler在Slave上，一个DAG中所有的任务都只能在某一台机器上进行作业提交，在并行任务比较多的时候，Slave的压力可能会比较大。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">xxl-job就是采用这种设计方式，但是存在相应的问题。管理器(admin)宕机集群会崩溃，Scheduler在管理器上，管理器负责所有任务的校验和分发，管理器存在过载的风险,需要开发者想方案解决。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>1.1.2 去中心化<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.46064814814814814" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/3_iasp8E6Sf43cRviczuRSI6GSJHo8Yg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn68a3laGAIAf25ddLyhWZtm98Dw4xiasp8E6Sf43cRviczuRSI6GSJHo8Yg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="864" style="display: block;margin-right: auto;margin-left: auto;"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在去中心化设计里，通常没有Master/Slave的概念，所有的角色都是一样的，地位是平等的，去中心化设计的核心设计在于整个分布式系统中不存在一个区别于其他节点的“管理者”，因此不存在单点故障问题。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">但由于不存在“管理者”节点所以每个节点都需要跟其他节点通信才得到必须要的机器信息，而分布式系统通信的不可靠性，则大大增加了上述功能的实现难度。实际上，真正去中心化的分布式系统并不多见。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">反而动态中心化分布式系统正在不断涌出。在这种架构下，集群中的管理者是被动态选择出来的，而不是预置的，并且集群在发生故障的时候，集群的节点会自发的举行会议来选举新的管理者去主持工作。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">一般都是基于Raft算法实现的选举策略。Raft算法，目前社区也有相应的PR，还没合并。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">PR链接：https://github.com/apache/dolphinscheduler/issues/10874</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">动态展示见链接：http://thesecretlivesofdata.com/</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">DolphinScheduler的去中心化是Master/Worker注册到注册中心，实现Master集群和Worker集群无中心。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>1.2 DophinScheduler架构设计<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">随手盗用一张官网的系统架构图，可以看到调度系统采用去中心化设计，由UI，API，MasterServer，Zookeeper，WorkServer，Alert等几部分组成。</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.625" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/4_6LN8msN36ALcnFqoX9bkOZ7S6ZBLxw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn68FFicicfVR7aRBnZqD0wfEL3iamU6LN8msN36ALcnFqoX9bkOZ7S6ZBLxw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>API</strong>: API接口层，主要负责处理前端UI层的请求。该服务统一提供RESTful api向外部提供请求服务。接口包括工作流的创建、定义、查询、修改、发布、下线、手工启动、停止、暂停、恢复、从该节点开始执行等等。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>MasterServer</strong>: MasterServer采用分布式无中心设计理念，MasterServer集成了Quartz，主要负责 DAG 任务切分、任务提交监控，并同时监听其它MasterServer和WorkerServer的健康状态。MasterServer服务启动时向Zookeeper注册临时节点，通过监听Zookeeper临时节点变化来进行容错处理。<br  />WorkServer:WorkerServer也采用分布式无中心设计理念，WorkerServer主要负责任务的执行和提供日志服务。WorkerServer服务启动时向Zookeeper注册临时节点，并维持心跳。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>ZooKeeper</strong>: ZooKeeper服务，系统中的MasterServer和WorkerServer节点都通过ZooKeeper来进行集群管理和容错。另外系统还基于ZooKeeper进行事件监听和分布式锁。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>Alert</strong>:提供告警相关接口，接口主要包括两种类型的告警数据的存储、查询和通知功能，支持丰富的告警插件自由拓展配置。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>1.3 容错问题<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">容错分为服务宕机容错和任务重试，服务宕机容错又分为Master容错和Worker容错两种情况;</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>1.3.1 宕机容错<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">服务容错设计依赖于ZooKeeper的Watcher机制，实现原理如图：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.7677119628339141" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/5_VxEfF1Siau0fq4JKcDvJELSh9DzPoQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn68GqJVcYYj1vnsfHrL1iamd5qIdhVxEfF1Siau0fq4JKcDvJELSh9DzPoQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="861" style="display: block;margin-right: auto;margin-left: auto;"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">其中Master监控其他Master和Worker的目录，如果监听到remove事件，则会根据具体的业务逻辑进行流程实例容错或者任务实例容错，容错流程图相对官方文档里面的流程图，人性化了些，大家可以参考一下，具体如下所示。</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="1.0790378006872852" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/6_W8dkNLKXTTk27lD7eIicibpWTbAjmQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn68CsH8GomB7Hic5Eh4iaq52khxNXYsW8dkNLKXTTk27lD7eIicibpWTbAjmQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="582" style="display: block;margin-right: auto;margin-left: auto;"><figcaption style="margin-top: 5px;text-align: center;color: #888;font-size: 14px;">Master容错流程图</figcaption></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">ZooKeeper Master容错完成之后则重新由DolphinScheduler中Scheduler线程调度，遍历 DAG 找到“正在运行”和“提交成功”的任务，对“正在运行”的任务监控其任务实例的状态，对“提交成功”的任务需要判断Task Queue中是否已经存在，如果存在则同样监控任务实例的状态，如果不存在则重新提交任务实例。</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="1.2903225806451613" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/7_Gje9I4RUXVayQmp1sdudlu6F96dtdw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn68ibz0z7DMwu4xam2CnhMhj2XdOGje9I4RUXVayQmp1sdudlu6F96dtdw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="837" style="display: block;margin-right: auto;margin-left: auto;"><figcaption style="margin-top: 5px;text-align: center;color: #888;font-size: 14px;">Worker容错流程图</figcaption></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Master Scheduler线程一旦发现任务实例为” 需要容错”状态，则接管任务并进行重新提交。注意由于” 网络抖动”可能会使得节点短时间内失去和ZooKeeper的心跳，从而发生节点的remove事件。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">对于这种情况，我们使用最简单的方式，那就是节点一旦和ZooKeeper发生超时连接，则直接将Master或Worker服务停掉。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>1.3.2 失败重试<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">这里首先要区分任务失败重试、流程失败恢复、流程失败重跑的概念：</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">任务失败重试是任务级别的，是调度系统自动进行的，比如一个Shell任务设置重试次数为3次，那么在Shell任务运行失败后会自己再最多尝试运行3次。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">流程失败恢复是流程级别的，是手动进行的，恢复是从只能从失败的节点开始执行或从当前节点开始执行。<br  />流程失败重跑也是流程级别的，是手动进行的，重跑是从开始节点进行。</section></li></ol><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">接下来说正题，我们将工作流中的任务节点分了两种类型。</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">一种是业务节点，这种节点都对应一个实际的脚本或者处理语句，比如Shell节点、MR节点、Spark节点、依赖节点等。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">还有一种是逻辑节点，这种节点不做实际的脚本或语句处理，只是整个流程流转的逻辑处理，比如子流程节等。</section></li></ol><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">每一个业务节点都可以配置失败重试的次数，当该任务节点失败，会自动重试，直到成功或者超过配置的重试次数。逻辑节点不支持失败重试。但是逻辑节点里的任务支持重试。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果工作流中有任务失败达到最大重试次数，工作流就会失败停止，失败的工作流可以手动进行重跑操作或者流程恢复操作。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>1.4 远程日志访问<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">由于Web(UI)和Worker不一定在同一台机器上，所以查看日志不能像查询本地文件那样。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">有两种方案：</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">将日志放到ES搜索引擎上；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">通过netty通信获取远程日志信息；</section></li></ol><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">介于考虑到尽可能的DolphinScheduler的轻量级性，所以选择了RPC实现远程访问日志信息，具体代码的实践见2.8章节。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">2. DolphinScheduler源码分析</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">本章的主要目的是从代码层面一一介绍第一张讲解的功能。关于系统的安装在这里并不会涉及，安装运行请大家自行探索。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2.1 工程模块介绍与配置文件<span style="display: none;"></span></h3><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.1.1 工程模块介绍<span style="display: none;"></span></h5><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">dolphinscheduler-alert 告警模块，提供告警服务;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">dolphinscheduler-api web应用模块，提供 Rest Api 服务，供 UI 进行调用;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">dolphinscheduler-common 通用的常量枚举、工具类、数据结构或者基类 dolphinscheduler-dao 提供数据库访问等操作;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">dolphinscheduler-remote 基于netty的客户端、服务端 ;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">dolphinscheduler-server 日志与心跳服务 ;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">dolphinscheduler-log-server LoggerServer 用于Rest Api通过RPC查看日志;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">dolphinscheduler-master MasterServer服务，主要负责 DAG 的切分和任务状态的监控 ;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">dolphinscheduler-worker WorkerServer服务，主要负责任务的提交、执行和任务状态的更新;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">dolphinscheduler-service service模块，包含Quartz、Zookeeper、日志客户端访问服务，便于server模块和api模块调用 ;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">dolphinscheduler-ui 前端模块;</section></li></ul><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.1.2 配置文件<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">dolphinscheduler-common common.properties</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;"><span style="color: #5c6370;font-style: italic;line-height: 26px;">#本地工作目录,用于存放临时文件</span><br  />data.basedir.path=/tmp/dolphinscheduler<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#资源文件存储类型:&nbsp;HDFS,S3,NONE</span><br  />resource.storage.type=NONE<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#资源文件存储路径</span><br  />resource.upload.path=/dolphinscheduler<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#hadoop是否开启kerberos权限</span><br  />hadoop.security.authentication.startup.state=<span style="color: #56b6c2;line-height: 26px;">false</span><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#kerberos配置目录</span><br  />java.security.krb5.conf.path=/opt/krb5.conf<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#kerberos登录用户</span><br  />login.user.keytab.username=hdfs-mycluster@ESZ.COM<br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#kerberos登录用户keytab</span><br  />login.user.keytab.path=/opt/hdfs.headless.keytab<br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#kerberos过期时间,整数,单位为小时</span><br  />kerberos.expire.time=2<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;如果存储类型为HDFS,需要配置拥有对应操作权限的用户</span><br  />hdfs.root.user=hdfs<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#请求地址如果resource.storage.type=S3,该值类似为:&nbsp;s3a://dolphinscheduler.&nbsp;如果resource.storage.type=HDFS,&nbsp;如果&nbsp;hadoop&nbsp;配置了&nbsp;HA,需要复制core-site.xml&nbsp;和&nbsp;hdfs-site.xml&nbsp;文件到conf目录</span><br  />fs.defaultFS=hdfs://mycluster:8020<br  />aws.access.key.id=minioadmin<br  />aws.secret.access.key=minioadmin<br  />aws.region=us-east-1<br  />aws.endpoint=http://localhost:9000<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;resourcemanager&nbsp;port,&nbsp;the&nbsp;default&nbsp;value&nbsp;is&nbsp;8088&nbsp;if&nbsp;not&nbsp;specified</span><br  />resource.manager.httpaddress.port=8088<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#yarn&nbsp;resourcemanager&nbsp;地址,&nbsp;如果resourcemanager开启了HA,&nbsp;输入HA的IP地址(以逗号分隔),如果resourcemanager为单节点,&nbsp;该值为空即可</span><br  />yarn.resourcemanager.ha.rm.ids=192.168.xx.xx,192.168.xx.xx<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#如果resourcemanager开启了HA或者没有使用resourcemanager,保持默认值即可.&nbsp;如果resourcemanager为单节点,你需要将ds1&nbsp;配置为resourcemanager对应的hostname</span><br  />yarn.application.status.address=http://ds1:%s/ws/v1/cluster/apps/%s<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;job&nbsp;history&nbsp;status&nbsp;url&nbsp;when&nbsp;application&nbsp;number&nbsp;threshold&nbsp;is&nbsp;reached(default&nbsp;10000,&nbsp;maybe&nbsp;it&nbsp;was&nbsp;set&nbsp;to&nbsp;1000)</span><br  />yarn.job.history.status.address=http://ds1:19888/ws/v1/<span style="color: #e6c07b;line-height: 26px;">history</span>/mapreduce/<span style="color: #e6c07b;line-height: 26px;">jobs</span>/%s<br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;datasource&nbsp;encryption&nbsp;enable</span><br  />datasource.encryption.enable=<span style="color: #56b6c2;line-height: 26px;">false</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;datasource&nbsp;encryption&nbsp;salt</span><br  />datasource.encryption.salt=!@<span style="color: #5c6370;font-style: italic;line-height: 26px;">#$%^&amp;*</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;data&nbsp;quality&nbsp;option</span><br  />data-quality.jar.name=dolphinscheduler-data-quality-dev-SNAPSHOT.jar<br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#data-quality.error.output.path=/tmp/data-quality-error-data</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;Network&nbsp;IP&nbsp;gets&nbsp;priority,&nbsp;default&nbsp;inner&nbsp;outer</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;Whether&nbsp;hive&nbsp;SQL&nbsp;is&nbsp;executed&nbsp;in&nbsp;the&nbsp;same&nbsp;session</span><br  />support.hive.oneSession=<span style="color: #56b6c2;line-height: 26px;">false</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;use&nbsp;sudo&nbsp;or&nbsp;not,&nbsp;if&nbsp;set&nbsp;true,&nbsp;executing&nbsp;user&nbsp;is&nbsp;tenant&nbsp;user&nbsp;and&nbsp;deploy&nbsp;user&nbsp;needs&nbsp;sudo&nbsp;permissions;&nbsp;if&nbsp;set&nbsp;false,&nbsp;executing&nbsp;user&nbsp;is&nbsp;the&nbsp;deploy&nbsp;user&nbsp;and&nbsp;doesn't&nbsp;need&nbsp;sudo&nbsp;permissions</span><br  />sudo.enable=<span style="color: #56b6c2;line-height: 26px;">true</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;network&nbsp;interface&nbsp;preferred&nbsp;like&nbsp;eth0,&nbsp;default:&nbsp;empty</span><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#dolphin.scheduler.network.interface.preferred=</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;network&nbsp;IP&nbsp;gets&nbsp;priority,&nbsp;default:&nbsp;inner&nbsp;outer</span><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#dolphin.scheduler.network.priority.strategy=default</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;system&nbsp;env&nbsp;path</span><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#dolphinscheduler.env.path=dolphinscheduler_env.sh</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#是否处于开发模式</span><br  />development.state=<span style="color: #56b6c2;line-height: 26px;">false</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;rpc&nbsp;port</span><br  />alert.rpc.port=50052<br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;Url&nbsp;endpoint&nbsp;for&nbsp;zeppelin&nbsp;RESTful&nbsp;API</span><br  />zeppelin.rest.url=http://localhost:8080<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">dolphinscheduler-api &nbsp;application.yaml</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">server:<br  />&nbsp;&nbsp;port:&nbsp;12345<br  />&nbsp;&nbsp;servlet:<br  />&nbsp;&nbsp;&nbsp;&nbsp;session:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timeout:&nbsp;120m<br  />&nbsp;&nbsp;&nbsp;&nbsp;context-path:&nbsp;/dolphinscheduler/<br  />&nbsp;&nbsp;compression:<br  />&nbsp;&nbsp;&nbsp;&nbsp;enabled:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;mime-types:&nbsp;text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml<br  />&nbsp;&nbsp;jetty:<br  />&nbsp;&nbsp;&nbsp;&nbsp;max-http-form-post-size:&nbsp;5000000<br  /><br  />spring:<br  />&nbsp;&nbsp;application:<br  />&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;api-server<br  />&nbsp;&nbsp;banner:<br  />&nbsp;&nbsp;&nbsp;&nbsp;charset:&nbsp;UTF-8<br  />&nbsp;&nbsp;jackson:<br  />&nbsp;&nbsp;&nbsp;&nbsp;time-zone:&nbsp;UTC<br  />&nbsp;&nbsp;&nbsp;&nbsp;date-format:&nbsp;<span style="color: #98c379;line-height: 26px;">"yyyy-MM-dd&nbsp;HH:mm:ss"</span><br  />&nbsp;&nbsp;servlet:<br  />&nbsp;&nbsp;&nbsp;&nbsp;multipart:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max-file-size:&nbsp;1024MB<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max-request-size:&nbsp;1024MB<br  />&nbsp;&nbsp;messages:<br  />&nbsp;&nbsp;&nbsp;&nbsp;basename:&nbsp;i18n/messages<br  />&nbsp;&nbsp;datasource:<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;&nbsp;&nbsp;&nbsp;driver-class-name:&nbsp;org.postgresql.Driver</span><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;jdbc:postgresql://127.0.0.1:5432/dolphinscheduler</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;driver-class-name:&nbsp;com.mysql.jdbc.Driver<br  />&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;jdbc:mysql://127.0.0.1:3306/dolphinscheduler?useUnicode=<span style="color: #56b6c2;line-height: 26px;">true</span>&amp;serverTimezone=UTC&amp;characterEncoding=UTF-8&amp;autoReconnect=<span style="color: #56b6c2;line-height: 26px;">true</span>&amp;useSSL=<span style="color: #56b6c2;line-height: 26px;">false</span>&amp;zeroDateTimeBehavior=convertToNull<br  />&nbsp;&nbsp;&nbsp;&nbsp;username:&nbsp;root<br  />&nbsp;&nbsp;&nbsp;&nbsp;password:&nbsp;root<br  />&nbsp;&nbsp;&nbsp;&nbsp;hikari:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection-test-query:&nbsp;select&nbsp;1<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;minimum-idle:&nbsp;5<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto-commit:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validation-timeout:&nbsp;3000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool-name:&nbsp;DolphinScheduler<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum-pool-size:&nbsp;50<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection-timeout:&nbsp;30000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idle-timeout:&nbsp;600000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;leak-detection-threshold:&nbsp;0<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialization-fail-timeout:&nbsp;1<br  />&nbsp;&nbsp;quartz:<br  />&nbsp;&nbsp;&nbsp;&nbsp;auto-startup:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;job-store-type:&nbsp;jdbc<br  />&nbsp;&nbsp;&nbsp;&nbsp;jdbc:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialize-schema:&nbsp;never<br  />&nbsp;&nbsp;&nbsp;&nbsp;properties:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.threadPool:threadPriority:&nbsp;5<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.isClustered:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.class:&nbsp;org.quartz.impl.jdbcjobstore.JobStoreTX<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.scheduler.instanceId:&nbsp;AUTO<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.tablePrefix:&nbsp;QRTZ_<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.acquireTriggersWithinLock:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.scheduler.instanceName:&nbsp;DolphinScheduler<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.threadPool.class:&nbsp;org.quartz.simpl.SimpleThreadPool<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.useProperties:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.threadPool.makeThreadsDaemons:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.threadPool.threadCount:&nbsp;25<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.misfireThreshold:&nbsp;60000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.scheduler.makeSchedulerThreadDaemon:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.driverDelegateClass:&nbsp;org.quartz.impl.jdbcjobstore.PostgreSQLDelegate</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.driverDelegateClass:&nbsp;org.quartz.impl.jdbcjobstore.StdJDBCDelegate<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.clusterCheckinInterval:&nbsp;5000<br  /><br  />management:<br  />&nbsp;&nbsp;endpoints:<br  />&nbsp;&nbsp;&nbsp;&nbsp;web:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exposure:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include:&nbsp;<span style="color: #98c379;line-height: 26px;">'*'</span><br  />&nbsp;&nbsp;metrics:<br  />&nbsp;&nbsp;&nbsp;&nbsp;tags:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;application:&nbsp;<span style="color: #d19a66;line-height: 26px;">${spring.application.name}</span><br  /><br  />registry:<br  />&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">type</span>:&nbsp;zookeeper<br  />&nbsp;&nbsp;zookeeper:<br  />&nbsp;&nbsp;&nbsp;&nbsp;namespace:&nbsp;dolphinscheduler<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;&nbsp;&nbsp;&nbsp;connect-string:&nbsp;localhost:2181</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;connect-string:&nbsp;10.255.158.70:2181<br  />&nbsp;&nbsp;&nbsp;&nbsp;retry-policy:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base-sleep-time:&nbsp;60ms<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max-sleep:&nbsp;300ms<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max-retries:&nbsp;5<br  />&nbsp;&nbsp;&nbsp;&nbsp;session-timeout:&nbsp;30s<br  />&nbsp;&nbsp;&nbsp;&nbsp;connection-timeout:&nbsp;9s<br  />&nbsp;&nbsp;&nbsp;&nbsp;block-until-connected:&nbsp;600ms<br  />&nbsp;&nbsp;&nbsp;&nbsp;digest:&nbsp;~<br  /><br  />audit:<br  />&nbsp;&nbsp;enabled:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span><br  /><br  />metrics:<br  />&nbsp;&nbsp;enabled:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  /><br  />python-gateway:<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;Weather&nbsp;enable&nbsp;python&nbsp;gateway&nbsp;server&nbsp;or&nbsp;not.&nbsp;The&nbsp;default&nbsp;value&nbsp;is&nbsp;true.</span><br  />&nbsp;&nbsp;enabled:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;The&nbsp;address&nbsp;of&nbsp;Python&nbsp;gateway&nbsp;server&nbsp;start.&nbsp;Set&nbsp;its&nbsp;value&nbsp;to&nbsp;`0.0.0.0`&nbsp;if&nbsp;your&nbsp;Python&nbsp;API&nbsp;run&nbsp;in&nbsp;different</span><br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;between&nbsp;Python&nbsp;gateway&nbsp;server.&nbsp;It&nbsp;could&nbsp;be&nbsp;be&nbsp;specific&nbsp;to&nbsp;other&nbsp;address&nbsp;like&nbsp;`127.0.0.1`&nbsp;or&nbsp;`localhost`</span><br  />&nbsp;&nbsp;gateway-server-address:&nbsp;0.0.0.0<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;The&nbsp;port&nbsp;of&nbsp;Python&nbsp;gateway&nbsp;server&nbsp;start.&nbsp;Define&nbsp;which&nbsp;port&nbsp;you&nbsp;could&nbsp;connect&nbsp;to&nbsp;Python&nbsp;gateway&nbsp;server&nbsp;from</span><br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;Python&nbsp;API&nbsp;side.</span><br  />&nbsp;&nbsp;gateway-server-port:&nbsp;25333<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;The&nbsp;address&nbsp;of&nbsp;Python&nbsp;callback&nbsp;client.</span><br  />&nbsp;&nbsp;python-address:&nbsp;127.0.0.1<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;The&nbsp;port&nbsp;of&nbsp;Python&nbsp;callback&nbsp;client.</span><br  />&nbsp;&nbsp;python-port:&nbsp;25334<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;Close&nbsp;connection&nbsp;of&nbsp;socket&nbsp;server&nbsp;if&nbsp;no&nbsp;other&nbsp;request&nbsp;accept&nbsp;after&nbsp;x&nbsp;milliseconds.&nbsp;Define&nbsp;value&nbsp;is&nbsp;(0&nbsp;=&nbsp;infinite),</span><br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;and&nbsp;socket&nbsp;server&nbsp;would&nbsp;never&nbsp;close&nbsp;even&nbsp;though&nbsp;no&nbsp;requests&nbsp;accept</span><br  />&nbsp;&nbsp;connect-timeout:&nbsp;0<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;Close&nbsp;each&nbsp;active&nbsp;connection&nbsp;of&nbsp;socket&nbsp;server&nbsp;if&nbsp;python&nbsp;program&nbsp;not&nbsp;active&nbsp;after&nbsp;x&nbsp;milliseconds.&nbsp;Define&nbsp;value&nbsp;is</span><br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;(0&nbsp;=&nbsp;infinite),&nbsp;and&nbsp;socket&nbsp;server&nbsp;would&nbsp;never&nbsp;close&nbsp;even&nbsp;though&nbsp;no&nbsp;requests&nbsp;accept</span><br  />&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">read</span>-timeout:&nbsp;0<br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;Override&nbsp;by&nbsp;profile</span><br  /><br  />---<br  />spring:<br  />&nbsp;&nbsp;config:<br  />&nbsp;&nbsp;&nbsp;&nbsp;activate:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on-profile:&nbsp;mysql<br  />&nbsp;&nbsp;datasource:<br  />&nbsp;&nbsp;&nbsp;&nbsp;driver-class-name:&nbsp;com.mysql.jdbc.Driver<br  />&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;jdbc:mysql://127.0.0.1:3306/dolphinscheduler?useUnicode=<span style="color: #56b6c2;line-height: 26px;">true</span>&amp;characterEncoding=UTF-8<br  />&nbsp;&nbsp;quartz:<br  />&nbsp;&nbsp;&nbsp;&nbsp;properties:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.driverDelegateClass:&nbsp;org.quartz.impl.jdbcjobstore.StdJDBCDelegate<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">dolphinscheduler-master application.yaml</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">spring:<br  />&nbsp;&nbsp;banner:<br  />&nbsp;&nbsp;&nbsp;&nbsp;charset:&nbsp;UTF-8<br  />&nbsp;&nbsp;application:<br  />&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;master-server<br  />&nbsp;&nbsp;jackson:<br  />&nbsp;&nbsp;&nbsp;&nbsp;time-zone:&nbsp;UTC<br  />&nbsp;&nbsp;&nbsp;&nbsp;date-format:&nbsp;<span style="color: #98c379;line-height: 26px;">"yyyy-MM-dd&nbsp;HH:mm:ss"</span><br  />&nbsp;&nbsp;cache:<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;default&nbsp;enable&nbsp;cache,&nbsp;you&nbsp;can&nbsp;disable&nbsp;by&nbsp;`type:&nbsp;none`</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">type</span>:&nbsp;none<br  />&nbsp;&nbsp;&nbsp;&nbsp;cache-names:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;tenant<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;user<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;processDefinition<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;processTaskRelation<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;taskDefinition<br  />&nbsp;&nbsp;&nbsp;&nbsp;caffeine:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;spec:&nbsp;maximumSize=100,expireAfterWrite=300s,recordStats<br  />&nbsp;&nbsp;datasource:<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#driver-class-name:&nbsp;org.postgresql.Driver</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#url:&nbsp;jdbc:postgresql://127.0.0.1:5432/dolphinscheduler</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;driver-class-name:&nbsp;com.mysql.jdbc.Driver<br  />&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;jdbc:mysql://127.0.0.1:3306/dolphinscheduler?useUnicode=<span style="color: #56b6c2;line-height: 26px;">true</span>&amp;serverTimezone=UTC&amp;characterEncoding=UTF-8&amp;autoReconnect=<span style="color: #56b6c2;line-height: 26px;">true</span>&amp;useSSL=<span style="color: #56b6c2;line-height: 26px;">false</span>&amp;zeroDateTimeBehavior=convertToNull<br  />&nbsp;&nbsp;&nbsp;&nbsp;username:&nbsp;root<br  />&nbsp;&nbsp;&nbsp;&nbsp;password:<br  />&nbsp;&nbsp;&nbsp;&nbsp;hikari:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection-test-query:&nbsp;select&nbsp;1<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;minimum-idle:&nbsp;5<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto-commit:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validation-timeout:&nbsp;3000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool-name:&nbsp;DolphinScheduler<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum-pool-size:&nbsp;50<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection-timeout:&nbsp;30000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idle-timeout:&nbsp;600000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;leak-detection-threshold:&nbsp;0<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialization-fail-timeout:&nbsp;1<br  />&nbsp;&nbsp;quartz:<br  />&nbsp;&nbsp;&nbsp;&nbsp;job-store-type:&nbsp;jdbc<br  />&nbsp;&nbsp;&nbsp;&nbsp;jdbc:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialize-schema:&nbsp;never<br  />&nbsp;&nbsp;&nbsp;&nbsp;properties:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.threadPool:threadPriority:&nbsp;5<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.isClustered:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.class:&nbsp;org.quartz.impl.jdbcjobstore.JobStoreTX<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.scheduler.instanceId:&nbsp;AUTO<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.tablePrefix:&nbsp;QRTZ_<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.acquireTriggersWithinLock:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.scheduler.instanceName:&nbsp;DolphinScheduler<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.threadPool.class:&nbsp;org.quartz.simpl.SimpleThreadPool<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.useProperties:&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.threadPool.makeThreadsDaemons:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.threadPool.threadCount:&nbsp;25<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.misfireThreshold:&nbsp;60000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.scheduler.makeSchedulerThreadDaemon:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.driverDelegateClass:&nbsp;org.quartz.impl.jdbcjobstore.PostgreSQLDelegate</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.driverDelegateClass:&nbsp;org.quartz.impl.jdbcjobstore.StdJDBCDelegate<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.clusterCheckinInterval:&nbsp;5000<br  /><br  />registry:<br  />&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">type</span>:&nbsp;zookeeper<br  />&nbsp;&nbsp;zookeeper:<br  />&nbsp;&nbsp;&nbsp;&nbsp;namespace:&nbsp;dolphinscheduler<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;&nbsp;&nbsp;&nbsp;connect-string:&nbsp;localhost:2181</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;connect-string:&nbsp;10.255.158.70:2181<br  />&nbsp;&nbsp;&nbsp;&nbsp;retry-policy:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base-sleep-time:&nbsp;60ms<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max-sleep:&nbsp;300ms<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max-retries:&nbsp;5<br  />&nbsp;&nbsp;&nbsp;&nbsp;session-timeout:&nbsp;30s<br  />&nbsp;&nbsp;&nbsp;&nbsp;connection-timeout:&nbsp;9s<br  />&nbsp;&nbsp;&nbsp;&nbsp;block-until-connected:&nbsp;600ms<br  />&nbsp;&nbsp;&nbsp;&nbsp;digest:&nbsp;~<br  /><br  />master:<br  />&nbsp;&nbsp;listen-port:&nbsp;5678<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;master&nbsp;fetch&nbsp;command&nbsp;num</span><br  />&nbsp;&nbsp;fetch-command-num:&nbsp;10<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;master&nbsp;prepare&nbsp;execute&nbsp;thread&nbsp;number&nbsp;to&nbsp;limit&nbsp;handle&nbsp;commands&nbsp;in&nbsp;parallel</span><br  />&nbsp;&nbsp;pre-exec-threads:&nbsp;10<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;master&nbsp;execute&nbsp;thread&nbsp;number&nbsp;to&nbsp;limit&nbsp;process&nbsp;instances&nbsp;in&nbsp;parallel</span><br  />&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">exec</span>-threads:&nbsp;100<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;master&nbsp;dispatch&nbsp;task&nbsp;number&nbsp;per&nbsp;batch</span><br  />&nbsp;&nbsp;dispatch-task-number:&nbsp;3<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;master&nbsp;host&nbsp;selector&nbsp;to&nbsp;select&nbsp;a&nbsp;suitable&nbsp;worker,&nbsp;default&nbsp;value:&nbsp;LowerWeight.&nbsp;Optional&nbsp;values&nbsp;include&nbsp;random,&nbsp;round_robin,&nbsp;lower_weight</span><br  />&nbsp;&nbsp;host-selector:&nbsp;lower_weight<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;master&nbsp;heartbeat&nbsp;interval,&nbsp;the&nbsp;unit&nbsp;is&nbsp;second</span><br  />&nbsp;&nbsp;heartbeat-interval:&nbsp;10<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;master&nbsp;commit&nbsp;task&nbsp;retry&nbsp;times</span><br  />&nbsp;&nbsp;task-commit-retry-times:&nbsp;5<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;master&nbsp;commit&nbsp;task&nbsp;interval,&nbsp;the&nbsp;unit&nbsp;is&nbsp;millisecond</span><br  />&nbsp;&nbsp;task-commit-interval:&nbsp;1000<br  />&nbsp;&nbsp;state-wheel-interval:&nbsp;5<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;master&nbsp;max&nbsp;cpuload&nbsp;avg,&nbsp;only&nbsp;higher&nbsp;than&nbsp;the&nbsp;system&nbsp;cpu&nbsp;load&nbsp;average,&nbsp;master&nbsp;server&nbsp;can&nbsp;schedule.&nbsp;default&nbsp;value&nbsp;-1:&nbsp;the&nbsp;number&nbsp;of&nbsp;cpu&nbsp;cores&nbsp;*&nbsp;2</span><br  />&nbsp;&nbsp;max-cpu-load-avg:&nbsp;-1<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;master&nbsp;reserved&nbsp;memory,&nbsp;only&nbsp;lower&nbsp;than&nbsp;system&nbsp;available&nbsp;memory,&nbsp;master&nbsp;server&nbsp;can&nbsp;schedule.&nbsp;default&nbsp;value&nbsp;0.3,&nbsp;the&nbsp;unit&nbsp;is&nbsp;G</span><br  />&nbsp;&nbsp;reserved-memory:&nbsp;0.3<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;failover&nbsp;interval,&nbsp;the&nbsp;unit&nbsp;is&nbsp;minute</span><br  />&nbsp;&nbsp;failover-interval:&nbsp;10<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;kill&nbsp;yarn&nbsp;jon&nbsp;when&nbsp;failover&nbsp;taskInstance,&nbsp;default&nbsp;true</span><br  />&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">kill</span>-yarn-job-when-task-failover:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  /><br  />server:<br  />&nbsp;&nbsp;port:&nbsp;5679<br  /><br  />management:<br  />&nbsp;&nbsp;endpoints:<br  />&nbsp;&nbsp;&nbsp;&nbsp;web:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exposure:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include:&nbsp;<span style="color: #98c379;line-height: 26px;">'*'</span><br  />&nbsp;&nbsp;metrics:<br  />&nbsp;&nbsp;&nbsp;&nbsp;tags:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;application:&nbsp;<span style="color: #d19a66;line-height: 26px;">${spring.application.name}</span><br  /><br  />metrics:<br  />&nbsp;&nbsp;enabled:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;Override&nbsp;by&nbsp;profile</span><br  /><br  />---<br  />spring:<br  />&nbsp;&nbsp;config:<br  />&nbsp;&nbsp;&nbsp;&nbsp;activate:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on-profile:&nbsp;mysql<br  />&nbsp;&nbsp;datasource:<br  />&nbsp;&nbsp;&nbsp;&nbsp;driver-class-name:&nbsp;com.mysql.jdbc.Driver<br  />&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;jdbc:mysql://127.0.0.1:3306/dolphinscheduler?useUnicode=<span style="color: #56b6c2;line-height: 26px;">true</span>&amp;serverTimezone=UTC&amp;characterEncoding=UTF-8&amp;autoReconnect=<span style="color: #56b6c2;line-height: 26px;">true</span>&amp;useSSL=<span style="color: #56b6c2;line-height: 26px;">false</span>&amp;zeroDateTimeBehavior=convertToNull<br  />&nbsp;&nbsp;quartz:<br  />&nbsp;&nbsp;&nbsp;&nbsp;properties:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.quartz.jobStore.driverDelegateClass:&nbsp;org.quartz.impl.jdbcjobstore.StdJDBCDelegate<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">dolphinscheduler-worker &nbsp;application.yaml</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">spring:<br  />&nbsp;&nbsp;banner:<br  />&nbsp;&nbsp;&nbsp;&nbsp;charset:&nbsp;UTF-8<br  />&nbsp;&nbsp;application:<br  />&nbsp;&nbsp;&nbsp;&nbsp;name:&nbsp;worker-server<br  />&nbsp;&nbsp;jackson:<br  />&nbsp;&nbsp;&nbsp;&nbsp;time-zone:&nbsp;UTC<br  />&nbsp;&nbsp;&nbsp;&nbsp;date-format:&nbsp;<span style="color: #98c379;line-height: 26px;">"yyyy-MM-dd&nbsp;HH:mm:ss"</span><br  />&nbsp;&nbsp;datasource:<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#driver-class-name:&nbsp;org.postgresql.Driver</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#url:&nbsp;jdbc:postgresql://127.0.0.1:5432/dolphinscheduler</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;driver-class-name:&nbsp;com.mysql.jdbc.Driver<br  />&nbsp;&nbsp;&nbsp;&nbsp;url:&nbsp;jdbc:mysql://127.0.0.1:3306/dolphinscheduler?useUnicode=<span style="color: #56b6c2;line-height: 26px;">true</span>&amp;serverTimezone=UTC&amp;characterEncoding=UTF-8&amp;autoReconnect=<span style="color: #56b6c2;line-height: 26px;">true</span>&amp;useSSL=<span style="color: #56b6c2;line-height: 26px;">false</span>&amp;zeroDateTimeBehavior=convertToNull<br  />&nbsp;&nbsp;&nbsp;&nbsp;username:&nbsp;root<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#password:&nbsp;root</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;password:<br  />&nbsp;&nbsp;&nbsp;&nbsp;hikari:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection-test-query:&nbsp;select&nbsp;1<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;minimum-idle:&nbsp;5<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto-commit:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validation-timeout:&nbsp;3000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pool-name:&nbsp;DolphinScheduler<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maximum-pool-size:&nbsp;50<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection-timeout:&nbsp;30000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;idle-timeout:&nbsp;600000<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;leak-detection-threshold:&nbsp;0<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initialization-fail-timeout:&nbsp;1<br  /><br  />registry:<br  />&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">type</span>:&nbsp;zookeeper<br  />&nbsp;&nbsp;zookeeper:<br  />&nbsp;&nbsp;&nbsp;&nbsp;namespace:&nbsp;dolphinscheduler<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;&nbsp;&nbsp;&nbsp;connect-string:&nbsp;localhost:2181</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;connect-string:&nbsp;10.255.158.70:2181<br  />&nbsp;&nbsp;&nbsp;&nbsp;retry-policy:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base-sleep-time:&nbsp;60ms<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max-sleep:&nbsp;300ms<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max-retries:&nbsp;5<br  />&nbsp;&nbsp;&nbsp;&nbsp;session-timeout:&nbsp;30s<br  />&nbsp;&nbsp;&nbsp;&nbsp;connection-timeout:&nbsp;9s<br  />&nbsp;&nbsp;&nbsp;&nbsp;block-until-connected:&nbsp;600ms<br  />&nbsp;&nbsp;&nbsp;&nbsp;digest:&nbsp;~<br  /><br  />worker:<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;worker&nbsp;listener&nbsp;port</span><br  />&nbsp;&nbsp;listen-port:&nbsp;1234<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;worker&nbsp;execute&nbsp;thread&nbsp;number&nbsp;to&nbsp;limit&nbsp;task&nbsp;instances&nbsp;in&nbsp;parallel</span><br  />&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">exec</span>-threads:&nbsp;100<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;worker&nbsp;heartbeat&nbsp;interval,&nbsp;the&nbsp;unit&nbsp;is&nbsp;second</span><br  />&nbsp;&nbsp;heartbeat-interval:&nbsp;10<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;worker&nbsp;host&nbsp;weight&nbsp;to&nbsp;dispatch&nbsp;tasks,&nbsp;default&nbsp;value&nbsp;100</span><br  />&nbsp;&nbsp;host-weight:&nbsp;100<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;worker&nbsp;tenant&nbsp;auto&nbsp;create</span><br  />&nbsp;&nbsp;tenant-auto-create:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;worker&nbsp;max&nbsp;cpuload&nbsp;avg,&nbsp;only&nbsp;higher&nbsp;than&nbsp;the&nbsp;system&nbsp;cpu&nbsp;load&nbsp;average,&nbsp;worker&nbsp;server&nbsp;can&nbsp;be&nbsp;dispatched&nbsp;tasks.&nbsp;default&nbsp;value&nbsp;-1:&nbsp;the&nbsp;number&nbsp;of&nbsp;cpu&nbsp;cores&nbsp;*&nbsp;2</span><br  />&nbsp;&nbsp;max-cpu-load-avg:&nbsp;-1<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;worker&nbsp;reserved&nbsp;memory,&nbsp;only&nbsp;lower&nbsp;than&nbsp;system&nbsp;available&nbsp;memory,&nbsp;worker&nbsp;server&nbsp;can&nbsp;be&nbsp;dispatched&nbsp;tasks.&nbsp;default&nbsp;value&nbsp;0.3,&nbsp;the&nbsp;unit&nbsp;is&nbsp;G</span><br  />&nbsp;&nbsp;reserved-memory:&nbsp;0.3<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;default&nbsp;worker&nbsp;groups&nbsp;separated&nbsp;by&nbsp;comma,&nbsp;like&nbsp;'worker.groups=default,test'</span><br  />&nbsp;&nbsp;groups:<br  />&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;default<br  />&nbsp;&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#&nbsp;alert&nbsp;server&nbsp;listen&nbsp;host</span><br  />&nbsp;&nbsp;alert-listen-host:&nbsp;localhost<br  />&nbsp;&nbsp;alert-listen-port:&nbsp;50052<br  /><br  />server:<br  />&nbsp;&nbsp;port:&nbsp;1235<br  /><br  />management:<br  />&nbsp;&nbsp;endpoints:<br  />&nbsp;&nbsp;&nbsp;&nbsp;web:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exposure:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include:&nbsp;<span style="color: #98c379;line-height: 26px;">'*'</span><br  />&nbsp;&nbsp;metrics:<br  />&nbsp;&nbsp;&nbsp;&nbsp;tags:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;application:&nbsp;<span style="color: #d19a66;line-height: 26px;">${spring.application.name}</span><br  /><br  />metrics:<br  />&nbsp;&nbsp;enabled:&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span><br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2.2 API主要任务操作接口<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">其他业务接口可以不用关注，只需要关注最最主要的流程上线功能接口，此接口可以发散出所有的任务调度相关的代码。</p><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">接口：<br  />/dolphinscheduler/projects/{projectCode}/schedules/{id}/online；</p></blockquote><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">此接口会将定义的流程提交到Quartz调度框架；</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;Map&lt;String,&nbsp;Object&gt;&nbsp;setScheduleState(User&nbsp;loginUser,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;projectCode,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Integer&nbsp;id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ReleaseState&nbsp;scheduleStatus)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&lt;String,&nbsp;Object&gt;&nbsp;result&nbsp;=&nbsp;new&nbsp;HashMap&lt;&gt;();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Project&nbsp;project&nbsp;=&nbsp;projectMapper.queryByCode(projectCode);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;check&nbsp;project&nbsp;auth<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;hasProjectAndPerm&nbsp;=&nbsp;projectService.hasProjectAndPerm(loginUser,&nbsp;project,&nbsp;result);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(!hasProjectAndPerm)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;check&nbsp;schedule&nbsp;exists<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Schedule&nbsp;scheduleObj&nbsp;=&nbsp;scheduleMapper.selectById(id);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(scheduleObj&nbsp;==&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putMsg(result,&nbsp;Status.SCHEDULE_CRON_NOT_EXISTS,&nbsp;id);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;check&nbsp;schedule&nbsp;release&nbsp;state<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(scheduleObj.getReleaseState()&nbsp;==&nbsp;scheduleStatus)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"schedule&nbsp;release&nbsp;is&nbsp;already&nbsp;{},needn't&nbsp;to&nbsp;change&nbsp;schedule&nbsp;id:&nbsp;{}&nbsp;from&nbsp;{}&nbsp;to&nbsp;{}"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scheduleObj.getReleaseState(),&nbsp;scheduleObj.getId(),&nbsp;scheduleObj.getReleaseState(),&nbsp;scheduleStatus);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putMsg(result,&nbsp;Status.SCHEDULE_CRON_REALEASE_NEED_NOT_CHANGE,&nbsp;scheduleStatus);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProcessDefinition&nbsp;processDefinition&nbsp;=&nbsp;processDefinitionMapper.queryByCode(scheduleObj.getProcessDefinitionCode());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(processDefinition&nbsp;==&nbsp;null&nbsp;||&nbsp;projectCode&nbsp;!=&nbsp;processDefinition.getProjectCode())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putMsg(result,&nbsp;Status.PROCESS_DEFINE_NOT_EXIST,&nbsp;String.valueOf(scheduleObj.getProcessDefinitionCode()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;ProcessTaskRelation&gt;&nbsp;processTaskRelations&nbsp;=&nbsp;processTaskRelationMapper.queryByProcessCode(projectCode,&nbsp;scheduleObj.getProcessDefinitionCode());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(processTaskRelations.isEmpty())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putMsg(result,&nbsp;Status.PROCESS_DAG_IS_EMPTY);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(scheduleStatus&nbsp;==&nbsp;ReleaseState.ONLINE)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;check&nbsp;process&nbsp;definition&nbsp;release&nbsp;state<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(processDefinition.getReleaseState()&nbsp;!=&nbsp;ReleaseState.ONLINE)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"not&nbsp;release&nbsp;process&nbsp;definition&nbsp;id:&nbsp;{}&nbsp;,&nbsp;name&nbsp;:&nbsp;{}"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processDefinition.getId(),&nbsp;processDefinition.getName());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putMsg(result,&nbsp;Status.PROCESS_DEFINE_NOT_RELEASE,&nbsp;processDefinition.getName());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;check&nbsp;sub&nbsp;process&nbsp;definition&nbsp;release&nbsp;state<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Long&gt;&nbsp;subProcessDefineCodes&nbsp;=&nbsp;new&nbsp;ArrayList&lt;&gt;();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processService.recurseFindSubProcess(processDefinition.getCode(),&nbsp;subProcessDefineCodes);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(!subProcessDefineCodes.isEmpty())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;ProcessDefinition&gt;&nbsp;subProcessDefinitionList&nbsp;=<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processDefinitionMapper.queryByCodes(subProcessDefineCodes);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(subProcessDefinitionList&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;!subProcessDefinitionList.isEmpty())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(ProcessDefinition&nbsp;subProcessDefinition&nbsp;:&nbsp;subProcessDefinitionList)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;there&nbsp;is&nbsp;no&nbsp;online&nbsp;process,&nbsp;<span style="color: #e6c07b;line-height: 26px;">exit</span>&nbsp;directly<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(subProcessDefinition.getReleaseState()&nbsp;!=&nbsp;ReleaseState.ONLINE)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"not&nbsp;release&nbsp;process&nbsp;definition&nbsp;id:&nbsp;{}&nbsp;,&nbsp;name&nbsp;:&nbsp;{}"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subProcessDefinition.getId(),&nbsp;subProcessDefinition.getName());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putMsg(result,&nbsp;Status.PROCESS_DEFINE_NOT_RELEASE,&nbsp;String.valueOf(subProcessDefinition.getId()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;check&nbsp;master&nbsp;server&nbsp;exists<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Server&gt;&nbsp;masterServers&nbsp;=&nbsp;monitorService.getServerListFromRegistry(<span style="color: #56b6c2;line-height: 26px;">true</span>);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(masterServers.isEmpty())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putMsg(result,&nbsp;Status.MASTER_NOT_EXISTS);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;<span style="color: #e6c07b;line-height: 26px;">set</span>&nbsp;status<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scheduleObj.setReleaseState(scheduleStatus);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scheduleMapper.updateById(scheduleObj);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(scheduleStatus)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">case</span>&nbsp;ONLINE:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"Call&nbsp;master&nbsp;client&nbsp;set&nbsp;schedule&nbsp;online,&nbsp;project&nbsp;id:&nbsp;{},&nbsp;flow&nbsp;id:&nbsp;{},host:&nbsp;{}"</span>,&nbsp;project.getId(),&nbsp;processDefinition.getId(),&nbsp;masterServers);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setSchedule(project.getId(),&nbsp;scheduleObj);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">break</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">case</span>&nbsp;OFFLINE:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"Call&nbsp;master&nbsp;client&nbsp;set&nbsp;schedule&nbsp;offline,&nbsp;project&nbsp;id:&nbsp;{},&nbsp;flow&nbsp;id:&nbsp;{},host:&nbsp;{}"</span>,&nbsp;project.getId(),&nbsp;processDefinition.getId(),&nbsp;masterServers);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deleteSchedule(project.getId(),&nbsp;id);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">break</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putMsg(result,&nbsp;Status.SCHEDULE_STATUS_UNKNOWN,&nbsp;scheduleStatus.toString());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.put(Constants.MSG,&nbsp;scheduleStatus&nbsp;==&nbsp;ReleaseState.ONLINE&nbsp;?&nbsp;<span style="color: #98c379;line-height: 26px;">"set&nbsp;online&nbsp;failure"</span>&nbsp;:&nbsp;<span style="color: #98c379;line-height: 26px;">"set&nbsp;offline&nbsp;failure"</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ServiceException(result.get(Constants.MSG).toString(),&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putMsg(result,&nbsp;Status.SUCCESS);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;void&nbsp;setSchedule(int&nbsp;projectId,&nbsp;Schedule&nbsp;schedule)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"set&nbsp;schedule,&nbsp;project&nbsp;id:&nbsp;{},&nbsp;scheduleId:&nbsp;{}"</span>,&nbsp;projectId,&nbsp;schedule.getId());<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quartzExecutor.addJob(ProcessScheduleJob.class,&nbsp;projectId,&nbsp;schedule);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;void&nbsp;addJob(Class&lt;?&nbsp;extends&nbsp;Job&gt;&nbsp;clazz,&nbsp;int&nbsp;projectId,&nbsp;final&nbsp;Schedule&nbsp;schedule)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;jobName&nbsp;=&nbsp;this.buildJobName(schedule.getId());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;jobGroupName&nbsp;=&nbsp;this.buildJobGroupName(projectId);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&lt;String,&nbsp;Object&gt;&nbsp;jobDataMap&nbsp;=&nbsp;this.buildDataMap(projectId,&nbsp;schedule);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;cronExpression&nbsp;=&nbsp;schedule.getCrontab();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;timezoneId&nbsp;=&nbsp;schedule.getTimezoneId();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;transform&nbsp;from&nbsp;server&nbsp;default&nbsp;timezone&nbsp;to&nbsp;schedule&nbsp;timezone<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;e.g.&nbsp;server&nbsp;default&nbsp;timezone&nbsp;is&nbsp;`UTC`<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;user&nbsp;<span style="color: #e6c07b;line-height: 26px;">set</span>&nbsp;a&nbsp;schedule&nbsp;with&nbsp;startTime&nbsp;`2022-04-28&nbsp;10:00:00`,&nbsp;timezone&nbsp;is&nbsp;`Asia/Shanghai`,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;api&nbsp;skip&nbsp;to&nbsp;transform&nbsp;it&nbsp;and&nbsp;save&nbsp;into&nbsp;databases&nbsp;directly,&nbsp;startTime&nbsp;`2022-04-28&nbsp;10:00:00`,&nbsp;timezone&nbsp;is&nbsp;`UTC`,&nbsp;<span style="color: #e6c07b;line-height: 26px;">which</span>&nbsp;actually&nbsp;added&nbsp;8&nbsp;hours,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;so&nbsp;when&nbsp;add&nbsp;job&nbsp;to&nbsp;quartz,&nbsp;it&nbsp;should&nbsp;recover&nbsp;by&nbsp;transform&nbsp;timezone<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Date&nbsp;startDate&nbsp;=&nbsp;DateUtils.transformTimezoneDate(schedule.getStartTime(),&nbsp;timezoneId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Date&nbsp;endDate&nbsp;=&nbsp;DateUtils.transformTimezoneDate(schedule.getEndTime(),&nbsp;timezoneId);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock.writeLock().lock();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JobKey&nbsp;jobKey&nbsp;=&nbsp;new&nbsp;JobKey(jobName,&nbsp;jobGroupName);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JobDetail&nbsp;jobDetail;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//add&nbsp;a&nbsp;task&nbsp;(<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;this&nbsp;task&nbsp;already&nbsp;exists,&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;this&nbsp;task&nbsp;directly)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(scheduler.checkExists(jobKey))&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobDetail&nbsp;=&nbsp;scheduler.getJobDetail(jobKey);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobDetail.getJobDataMap().putAll(jobDataMap);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobDetail&nbsp;=&nbsp;newJob(clazz).withIdentity(jobKey).build();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobDetail.getJobDataMap().putAll(jobDataMap);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scheduler.addJob(jobDetail,&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"Add&nbsp;job,&nbsp;job&nbsp;name:&nbsp;{},&nbsp;group&nbsp;name:&nbsp;{}"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobName,&nbsp;jobGroupName);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TriggerKey&nbsp;triggerKey&nbsp;=&nbsp;new&nbsp;TriggerKey(jobName,&nbsp;jobGroupName);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Instructs&nbsp;the&nbsp;Scheduler&nbsp;that&nbsp;upon&nbsp;a&nbsp;mis-fire<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;situation,&nbsp;the&nbsp;CronTrigger&nbsp;wants&nbsp;to&nbsp;have&nbsp;it<span style="color: #98c379;line-height: 26px;">'s<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;next-fire-time&nbsp;updated&nbsp;to&nbsp;the&nbsp;next&nbsp;time&nbsp;in&nbsp;the&nbsp;schedule&nbsp;after&nbsp;the<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;current&nbsp;time&nbsp;(taking&nbsp;into&nbsp;account&nbsp;any&nbsp;associated&nbsp;Calendar),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;but&nbsp;it&nbsp;does&nbsp;not&nbsp;want&nbsp;to&nbsp;be&nbsp;fired&nbsp;now.<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CronTrigger&nbsp;cronTrigger&nbsp;=&nbsp;newTrigger()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withIdentity(triggerKey)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.startAt(startDate)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.endAt(endDate)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withSchedule(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cronSchedule(cronExpression)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.withMisfireHandlingInstructionDoNothing()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.inTimeZone(DateUtils.getTimezone(timezoneId))<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.forJob(jobDetail).build();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(scheduler.checkExists(triggerKey))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;updateProcessInstance&nbsp;scheduler&nbsp;trigger&nbsp;when&nbsp;scheduler&nbsp;cycle&nbsp;changes<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CronTrigger&nbsp;oldCronTrigger&nbsp;=&nbsp;(CronTrigger)&nbsp;scheduler.getTrigger(triggerKey);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;oldCronExpression&nbsp;=&nbsp;oldCronTrigger.getCronExpression();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!StringUtils.equalsIgnoreCase(cronExpression,&nbsp;oldCronExpression))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;reschedule&nbsp;job&nbsp;trigger<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scheduler.rescheduleJob(triggerKey,&nbsp;cronTrigger);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info("reschedule&nbsp;job&nbsp;trigger,&nbsp;triggerName:&nbsp;{},&nbsp;triggerGroupName:&nbsp;{},&nbsp;cronExpression:&nbsp;{},&nbsp;startDate:&nbsp;{},&nbsp;endDate:&nbsp;{}",<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobName,&nbsp;jobGroupName,&nbsp;cronExpression,&nbsp;startDate,&nbsp;endDate);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scheduler.scheduleJob(cronTrigger);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info("schedule&nbsp;job&nbsp;trigger,&nbsp;triggerName:&nbsp;{},&nbsp;triggerGroupName:&nbsp;{},&nbsp;cronExpression:&nbsp;{},&nbsp;startDate:&nbsp;{},&nbsp;endDate:&nbsp;{}",<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jobName,&nbsp;jobGroupName,&nbsp;cronExpression,&nbsp;startDate,&nbsp;endDate);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ServiceException("add&nbsp;job&nbsp;failed",&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lock.writeLock().unlock();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></span></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2.3 Quaterz架构与运行流程<span style="display: none;"></span></h3><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.3.1 概念与架构<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Quartz 框架主要包括如下几个部分：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">SchedulerFactory：任务调度工厂，主要负责管理任务调度器;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Scheduler ：任务调度器，主要负责任务调度，以及操作任务的相关接口;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Job ：任务接口，实现类包含具体任务业务代码;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">JobDetail：用于定义作业的实例;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Trigger：任务触发器，主要存放 Job 执行的时间策略。例如多久执行一次，什么时候执行，以什么频率执行等等;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">JobBuilder ：用于定义/构建 JobDetail 实例，用于定义作业的实例。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">TriggerBuilder ：用于定义/构建触发器实例;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Calendar：Trigger 扩展对象，可以排除或者包含某个指定的时间点（如排除法定节假日）;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">JobStore：存储作业和任务调度期间的状态Scheduler的生命期，从 SchedulerFactory 创建它时开始，到 Scheduler 调用Shutdown() 方法时结束；</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Scheduler 被创建后，可以增加、删除和列举 Job 和 Trigger，以及执行其它与调度相关的操作（如暂停 Trigger）。但Scheduler 只有在调用 start() 方法后，才会真正地触发 trigger（即执行 job）</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.3.2 初始化与执行流程<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Quartz的基本原理就是通过Scheduler来调度被JobDetail和Trigger定义的安装Job接口规范实现的自定义任务业务对象，来完成任务的调度。基本逻辑如下图：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.6144200626959248" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/8_BFMnsETHKdyauuR0AwWv5cTDHwQyBQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn689cFrk7pf0G2mJl1PqmlznsZJBFMnsETHKdyauuR0AwWv5cTDHwQyBQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="638" style="display: block;margin-right: auto;margin-left: auto;"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">代码时序图如下：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.7453703703703703" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/9_X6InsAm5ApiasURka8T8NTkriaI9FA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn68N3MV1zhRbozuXCNHOIWHdoecloX6InsAm5ApiasURka8T8NTkriaI9FA/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">基本内容就是初始化任务调度容器Scheduler，以及容器所需的线程池，数据交互对象JobStore，任务处理线程QuartzSchedulerThread用来处理Job接口的具体业务实现类。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">DolphinScheduler的业务类是ProcessScheduleJob，主要功能就是根据调度信息往commond表中写数据。</p><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.3.3 集群运转<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">需要注意的事：</p><ol data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">当Quartz采用集群形式部署的时候，存储介质不能使用内存的形式，也就是不能使用JobStoreRAM。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Quartz集群对于对于需要被调度的Triggers实例的扫描是使用数据库锁TRIGGER_ACCESS来完成的，保障此扫描过程只能被一个Quartz实例获取到。代码如下：</section></li></ol><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;List&lt;OperableTrigger&gt;&nbsp;acquireNextTriggers(final&nbsp;long&nbsp;noLaterThan,&nbsp;final&nbsp;int&nbsp;maxCount,&nbsp;final&nbsp;long&nbsp;timeWindow)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;JobPersistenceException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;lockName;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>(isAcquireTriggersWithinLock()&nbsp;||&nbsp;maxCount&nbsp;&gt;&nbsp;1)&nbsp;{&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lockName&nbsp;=&nbsp;LOCK_TRIGGER_ACCESS;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lockName&nbsp;=&nbsp;null;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;executeInNonManagedTXLock(lockName,&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;TransactionCallback&lt;List&lt;OperableTrigger&gt;&gt;()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;List&lt;OperableTrigger&gt;&nbsp;execute(Connection&nbsp;conn)&nbsp;throws&nbsp;JobPersistenceException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;acquireNextTrigger(conn,&nbsp;noLaterThan,&nbsp;maxCount,&nbsp;timeWindow);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;TransactionValidator&lt;List&lt;OperableTrigger&gt;&gt;()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Boolean&nbsp;validate(Connection&nbsp;conn,&nbsp;List&lt;OperableTrigger&gt;&nbsp;result)&nbsp;throws&nbsp;JobPersistenceException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;FiredTriggerRecord&gt;&nbsp;acquired&nbsp;=&nbsp;getDelegate().selectInstancesFiredTriggerRecords(conn,&nbsp;getInstanceId());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt;&nbsp;fireInstanceIds&nbsp;=&nbsp;new&nbsp;HashSet&lt;String&gt;();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(FiredTriggerRecord&nbsp;ft&nbsp;:&nbsp;acquired)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fireInstanceIds.add(ft.getFireInstanceId());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(OperableTrigger&nbsp;tr&nbsp;:&nbsp;result)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(fireInstanceIds.contains(tr.getFireInstanceId()))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(SQLException&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JobPersistenceException(<span style="color: #98c379;line-height: 26px;">"error&nbsp;validating&nbsp;trigger&nbsp;acquisition"</span>,&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><ol start="3" data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">集群失败实例恢复需要注意的是各个实例恢复各自实例对应的异常实例，因为数据库有调度容器的instanceId信息。代码如下：</section></li></ol><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;protected&nbsp;void&nbsp;clusterRecover(Connection&nbsp;conn,&nbsp;List&lt;SchedulerStateRecord&gt;&nbsp;failedInstances)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;JobPersistenceException&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(failedInstances.size()&nbsp;&gt;&nbsp;0)&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;recoverIds&nbsp;=&nbsp;System.currentTimeMillis();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logWarnIfNonZero(failedInstances.size(),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"ClusterManager:&nbsp;detected&nbsp;"</span>&nbsp;+&nbsp;failedInstances.size()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style="color: #98c379;line-height: 26px;">"&nbsp;failed&nbsp;or&nbsp;restarted&nbsp;instances."</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(SchedulerStateRecord&nbsp;rec&nbsp;:&nbsp;failedInstances)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getLog().info(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"ClusterManager:&nbsp;Scanning&nbsp;for&nbsp;instance&nbsp;\""</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;rec.getSchedulerInstanceId()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style="color: #98c379;line-height: 26px;">"\"'s&nbsp;failed&nbsp;in-progress&nbsp;jobs."</span>);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;FiredTriggerRecord&gt;&nbsp;firedTriggerRecs&nbsp;=&nbsp;getDelegate()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.selectInstancesFiredTriggerRecords(conn,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rec.getSchedulerInstanceId());<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;acquiredCount&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;recoveredCount&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;otherCount&nbsp;=&nbsp;0;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;TriggerKey&gt;&nbsp;triggerKeys&nbsp;=&nbsp;new&nbsp;HashSet&lt;TriggerKey&gt;();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(FiredTriggerRecord&nbsp;ftRec&nbsp;:&nbsp;firedTriggerRecs)&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TriggerKey&nbsp;tKey&nbsp;=&nbsp;ftRec.getTriggerKey();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JobKey&nbsp;jKey&nbsp;=&nbsp;ftRec.getJobKey();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;triggerKeys.add(tKey);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;release&nbsp;blocked&nbsp;triggers..<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(ftRec.getFireInstanceState().equals(STATE_BLOCKED))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getDelegate()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.updateTriggerStatesForJobFromOtherState(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn,&nbsp;jKey,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_WAITING,&nbsp;STATE_BLOCKED);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(ftRec.getFireInstanceState().equals(STATE_PAUSED_BLOCKED))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getDelegate()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.updateTriggerStatesForJobFromOtherState(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn,&nbsp;jKey,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_PAUSED,&nbsp;STATE_PAUSED_BLOCKED);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;release&nbsp;acquired&nbsp;triggers..<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(ftRec.getFireInstanceState().equals(STATE_ACQUIRED))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getDelegate().updateTriggerStateFromOtherState(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn,&nbsp;tKey,&nbsp;STATE_WAITING,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_ACQUIRED);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acquiredCount++;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(ftRec.isJobRequestsRecovery())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;handle&nbsp;<span style="color: #e6c07b;line-height: 26px;">jobs</span>&nbsp;marked&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;recovery&nbsp;that&nbsp;were&nbsp;not&nbsp;fully<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;executed..<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(jobExists(conn,&nbsp;jKey))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(<span style="color: #98c379;line-height: 26px;">"deprecation"</span>)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SimpleTriggerImpl&nbsp;rcvryTrig&nbsp;=&nbsp;new&nbsp;SimpleTriggerImpl(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"recover_"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;rec.getSchedulerInstanceId()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style="color: #98c379;line-height: 26px;">"_"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;String.valueOf(recoverIds++),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Scheduler.DEFAULT_RECOVERY_GROUP,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;Date(ftRec.getScheduleTimestamp()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rcvryTrig.setJobName(jKey.getName());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rcvryTrig.setJobGroup(jKey.getGroup());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rcvryTrig.setMisfireInstruction(SimpleTrigger.MISFIRE_INSTRUCTION_IGNORE_MISFIRE_POLICY);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rcvryTrig.setPriority(ftRec.getPriority());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JobDataMap&nbsp;jd&nbsp;=&nbsp;getDelegate().selectTriggerJobDataMap(conn,&nbsp;tKey.getName(),&nbsp;tKey.getGroup());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jd.put(Scheduler.FAILED_JOB_ORIGINAL_TRIGGER_NAME,&nbsp;tKey.getName());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jd.put(Scheduler.FAILED_JOB_ORIGINAL_TRIGGER_GROUP,&nbsp;tKey.getGroup());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jd.put(Scheduler.FAILED_JOB_ORIGINAL_TRIGGER_FIRETIME_IN_MILLISECONDS,&nbsp;String.valueOf(ftRec.getFireTimestamp()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jd.put(Scheduler.FAILED_JOB_ORIGINAL_TRIGGER_SCHEDULED_FIRETIME_IN_MILLISECONDS,&nbsp;String.valueOf(ftRec.getScheduleTimestamp()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rcvryTrig.setJobDataMap(jd);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rcvryTrig.computeFirstFireTime(null);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;storeTrigger(conn,&nbsp;rcvryTrig,&nbsp;null,&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_WAITING,&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;recoveredCount++;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getLog()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.warn(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #98c379;line-height: 26px;">"ClusterManager:&nbsp;failed&nbsp;job&nbsp;'"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;jKey<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style="color: #98c379;line-height: 26px;">"'&nbsp;no&nbsp;longer&nbsp;exists,&nbsp;cannot&nbsp;schedule&nbsp;recovery."</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherCount++;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherCount++;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;free&nbsp;up&nbsp;stateful&nbsp;job<span style="color: #98c379;line-height: 26px;">'s&nbsp;triggers<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ftRec.isJobDisallowsConcurrentExecution())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getDelegate()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.updateTriggerStatesForJobFromOtherState(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn,&nbsp;jKey,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_WAITING,&nbsp;STATE_BLOCKED);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getDelegate()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.updateTriggerStatesForJobFromOtherState(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conn,&nbsp;jKey,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATE_PAUSED,&nbsp;STATE_PAUSED_BLOCKED);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getDelegate().deleteFiredTriggers(conn,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rec.getSchedulerInstanceId());<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Check&nbsp;if&nbsp;any&nbsp;of&nbsp;the&nbsp;fired&nbsp;triggers&nbsp;we&nbsp;just&nbsp;deleted&nbsp;were&nbsp;the&nbsp;last&nbsp;fired&nbsp;trigger<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;records&nbsp;of&nbsp;a&nbsp;COMPLETE&nbsp;trigger.<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;completeCount&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(TriggerKey&nbsp;triggerKey&nbsp;:&nbsp;triggerKeys)&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(getDelegate().selectTriggerState(conn,&nbsp;triggerKey).<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equals(STATE_COMPLETE))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;FiredTriggerRecord&gt;&nbsp;firedTriggers&nbsp;=<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getDelegate().selectFiredTriggerRecords(conn,&nbsp;triggerKey.getName(),&nbsp;triggerKey.getGroup());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(firedTriggers.isEmpty())&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(removeTrigger(conn,&nbsp;triggerKey))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;completeCount++;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logWarnIfNonZero(acquiredCount,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ClusterManager:&nbsp;......Freed&nbsp;"&nbsp;+&nbsp;acquiredCount<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;"&nbsp;acquired&nbsp;trigger(s).");<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logWarnIfNonZero(completeCount,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ClusterManager:&nbsp;......Deleted&nbsp;"&nbsp;+&nbsp;completeCount<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;"&nbsp;complete&nbsp;triggers(s).");<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logWarnIfNonZero(recoveredCount,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ClusterManager:&nbsp;......Scheduled&nbsp;"&nbsp;+&nbsp;recoveredCount<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;"&nbsp;recoverable&nbsp;job(s)&nbsp;for&nbsp;recovery.");<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logWarnIfNonZero(otherCount,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ClusterManager:&nbsp;......Cleaned-up&nbsp;"&nbsp;+&nbsp;otherCount<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;"&nbsp;other&nbsp;failed&nbsp;job(s).");<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!rec.getSchedulerInstanceId().equals(getInstanceId()))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getDelegate().deleteSchedulerState(conn,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rec.getSchedulerInstanceId());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Throwable&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;JobPersistenceException("Failure&nbsp;recovering&nbsp;jobs:&nbsp;"<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;e.getMessage(),&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></span></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2.4 Master启动与执行流程<span style="display: none;"></span></h3><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.8194444444444444" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/10_NWFVMHb5uSiapZBicXTicYcQc4hKhQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn6839a0nor2upHOMoDUMwzNXmyzMLWNWFVMHb5uSiapZBicXTicYcQc4hKhQ/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;"></figure><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.4.1 概念与执行逻辑<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">关键概念：</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>Quartz相关</strong>：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Scheduler（任务调度容器，一般都是StdScheduler实例）。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">ProcessScheduleJob：（实现Quarts调度框架的Job接口的业务类，专门生成DolphinScheduler数据库业务表t_ds_commond数据）;</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>DolphinScheduler相关</strong>：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">NettyRemotingServer（netty服务端，包含netty服务端serverBootstrap对象与netty服务端业务处理对象serverHandler）， NettyServerHandler：（netty服务端业务处理类：包含各类处理器以及处理器对应的执行线程池）;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">TaskPluginManager（任务插件管理器，不同类型的任务以插件的形式管理，在应用服务启动的时候，通过@AutoService加载实现了TaskChannelFactory接口的工厂信息到数据库，通过工厂对象来加载各类TaskChannel实现类到缓存）；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">MasterRegistryClient（master操作zk的客户端，封装了master对于zk的所有操作，注册，查询，删除等）;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">MasterSchedulerService（扫描服务，包含业务执行线程和work包含的nettyhe护短，负责任务调度业务，slot来控制集群模式下任务不被重复调度，底层实现是zookeeper分布式锁）;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">WorkflowExecuteThread（真正的业务处理线程，通过插槽获取命令commond，执行之前会校验slot的变化，如果变化不执行，关键功能就是构建任务相关的参数，定义，优先级等，然后发送到队列，供队列处理线程消费）;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">CommonTaskProcessor（普通任务处理器，实现ITaskProcessor接口，根据业务分为普通，依赖，子任务，阻塞，条件任务类型，包含了任务的提交，运行，分发，杀死等业务，通过@AutoService加载的类，根本就是封装了对）;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">TaskPriorityQueueImpl（任务队列，负责任务队列的存储控制）；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">TaskPriorityQueueConsumer（任务队列消费线程，负责任务的根据负载均衡策略在worker之间分发与执行）；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">ServerNodeManager （节点信息控制器，负责节点注册信息更新与槽位（slot）变更，底层实现是zookeeper分布式锁的应用）；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">EventExecuteService（事件处理线程，通过缓存起来的任务处理线程，处理每个任务在处理过程中注册在线程事件队列中的事件）；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">FailoverExecuteThread（故障转移线程，包含Master和worker的）；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">MasterRegistryDataListener（托管在zk管理框架cautor的故障监听器，负责对worker和master注册在zk上的节点的新增和删除）。</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">主节点容错代码如下，业务解释见1.5.1Master容错解释：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;private&nbsp;void&nbsp;failoverMasterWithLock(String&nbsp;masterHost)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;failoverPath&nbsp;=&nbsp;getFailoverLockPath(NodeType.MASTER,&nbsp;masterHost);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registryClient.getLock(failoverPath);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.failoverMaster(masterHost);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.error(<span style="color: #98c379;line-height: 26px;">"{}&nbsp;server&nbsp;failover&nbsp;failed,&nbsp;host:{}"</span>,&nbsp;NodeType.MASTER,&nbsp;masterHost,&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registryClient.releaseLock(failoverPath);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;failover&nbsp;master<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&lt;p&gt;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;failover&nbsp;process&nbsp;instance&nbsp;and&nbsp;associated&nbsp;task&nbsp;instance<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*故障转移流程实例和关联的任务实例<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;masterHost&nbsp;master&nbsp;host<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;failoverMaster(String&nbsp;masterHost)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(StringUtils.isEmpty(masterHost))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Date&nbsp;serverStartupTime&nbsp;=&nbsp;getServerStartupTime(NodeType.MASTER,&nbsp;masterHost);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;startTime&nbsp;=&nbsp;System.currentTimeMillis();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;ProcessInstance&gt;&nbsp;needFailoverProcessInstanceList&nbsp;=&nbsp;processService.queryNeedFailoverProcessInstances(masterHost);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.info(<span style="color: #98c379;line-height: 26px;">"start&nbsp;master[{}]&nbsp;failover,&nbsp;process&nbsp;list&nbsp;size:{}"</span>,&nbsp;masterHost,&nbsp;needFailoverProcessInstanceList.size());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Server&gt;&nbsp;workerServers&nbsp;=&nbsp;registryClient.getServerList(NodeType.WORKER);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(ProcessInstance&nbsp;processInstance&nbsp;:&nbsp;needFailoverProcessInstanceList)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(Constants.NULL.equals(processInstance.getHost()))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">continue</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;TaskInstance&gt;&nbsp;validTaskInstanceList&nbsp;=&nbsp;processService.findValidTaskListByProcessId(processInstance.getId());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(TaskInstance&nbsp;taskInstance&nbsp;:&nbsp;validTaskInstanceList)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.info(<span style="color: #98c379;line-height: 26px;">"failover&nbsp;task&nbsp;instance&nbsp;id:&nbsp;{},&nbsp;process&nbsp;instance&nbsp;id:&nbsp;{}"</span>,&nbsp;taskInstance.getId(),&nbsp;taskInstance.getProcessInstanceId());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failoverTaskInstance(processInstance,&nbsp;taskInstance,&nbsp;workerServers);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(serverStartupTime&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;processInstance.getRestartTime()&nbsp;!=&nbsp;null<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;processInstance.getRestartTime().after(serverStartupTime))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">continue</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.info(<span style="color: #98c379;line-height: 26px;">"failover&nbsp;process&nbsp;instance&nbsp;id:&nbsp;{}"</span>,&nbsp;processInstance.getId());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//updateProcessInstance&nbsp;host&nbsp;is&nbsp;null&nbsp;and&nbsp;insert&nbsp;into&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processInstance.setHost(Constants.NULL);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processService.processNeedFailoverProcessInstances(processInstance);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LOGGER.info(<span style="color: #98c379;line-height: 26px;">"master[{}]&nbsp;failover&nbsp;end,&nbsp;useTime:{}ms"</span>,&nbsp;masterHost,&nbsp;System.currentTimeMillis()&nbsp;-&nbsp;startTime);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.4.2 集群与槽（slot）<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">其实这里的采用Zookeer分布式锁准确也不准确，为什么这么说，因为Slot是CommondId对Master列表长度取模来计算的，而Master列表长度的刷新是Zookeeper分布式锁来控制，Master节点的调度数据扫描是通过Slot来控制的。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">具体代码如下：</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Slot刷新</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">private&nbsp;void&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">updateMasterNodes</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MASTER_SLOT&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MASTER_SIZE&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.masterNodes.clear();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;nodeLock&nbsp;=&nbsp;Constants.REGISTRY_DOLPHINSCHEDULER_LOCK_MASTERS;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registryClient.getLock(nodeLock);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Collection&lt;String&gt;&nbsp;currentNodes&nbsp;=&nbsp;registryClient.getMasterNodesDirectly();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Server&gt;&nbsp;masterNodes&nbsp;=&nbsp;registryClient.getServerList(NodeType.MASTER);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syncMasterNodes(currentNodes,&nbsp;masterNodes);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span style="color: #98c379;line-height: 26px;">"update&nbsp;master&nbsp;nodes&nbsp;error"</span>,&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registryClient.releaseLock(nodeLock);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;sync&nbsp;master&nbsp;nodes<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;nodes&nbsp;master&nbsp;nodes<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;syncMasterNodes(Collection&lt;String&gt;&nbsp;nodes,&nbsp;List&lt;Server&gt;&nbsp;masterNodes)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;masterLock.lock();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;addr&nbsp;=&nbsp;NetUtils.getAddr(NetUtils.getHost(),&nbsp;masterConfig.getListenPort());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.masterNodes.addAll(nodes);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.masterPriorityQueue.clear();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.masterPriorityQueue.putList(masterNodes);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;index&nbsp;=&nbsp;masterPriorityQueue.getIndex(addr);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(index&nbsp;&gt;=&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MASTER_SIZE&nbsp;=&nbsp;nodes.size();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MASTER_SLOT&nbsp;=&nbsp;index;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.warn(<span style="color: #98c379;line-height: 26px;">"current&nbsp;addr:{}&nbsp;is&nbsp;not&nbsp;in&nbsp;active&nbsp;master&nbsp;list"</span>,&nbsp;addr);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"update&nbsp;master&nbsp;nodes,&nbsp;master&nbsp;size:&nbsp;{},&nbsp;slot:&nbsp;{},&nbsp;addr:&nbsp;{}"</span>,&nbsp;MASTER_SIZE,&nbsp;MASTER_SLOT,&nbsp;addr);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;masterLock.unlock();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Slot应用</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;1.&nbsp;get&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;by&nbsp;slot<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;2.&nbsp;donot&nbsp;handle&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;slot&nbsp;is&nbsp;empty<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;*&nbsp;1.&nbsp;通过插槽获取命令&nbsp;*&nbsp;2.&nbsp;如果插槽为空，则不处理命令&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;void&nbsp;scheduleProcess()&nbsp;throws&nbsp;Exception&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Command&gt;&nbsp;commands&nbsp;=&nbsp;findCommands();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(CollectionUtils.isEmpty(commands))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//indicate&nbsp;that&nbsp;no&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;,sleep&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;1s<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thread.sleep(Constants.SLEEP_TIME_MILLIS);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;ProcessInstance&gt;&nbsp;processInstances&nbsp;=&nbsp;command2ProcessInstance(commands);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(CollectionUtils.isEmpty(processInstances))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(ProcessInstance&nbsp;processInstance&nbsp;:&nbsp;processInstances)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(processInstance&nbsp;==&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">continue</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WorkflowExecuteThread&nbsp;workflowExecuteThread&nbsp;=&nbsp;new&nbsp;WorkflowExecuteThread(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processInstance<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;processService<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;nettyExecutorManager<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;processAlertManager<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;masterConfig<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;stateWheelExecuteThread);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.processInstanceExecCacheManager.cache(processInstance.getId(),&nbsp;workflowExecuteThread);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(processInstance.getTimeout()&nbsp;&gt;&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stateWheelExecuteThread.addProcess4TimeoutCheck(processInstance);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workflowExecuteThreadPool.startWorkflow(workflowExecuteThread);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />private&nbsp;List&lt;Command&gt;&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">findCommands</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;pageNumber&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;pageSize&nbsp;=&nbsp;masterConfig.getFetchCommandNum();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;Command&gt;&nbsp;result&nbsp;=&nbsp;new&nbsp;ArrayList&lt;&gt;();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(Stopper.isRunning())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;thisMasterSlot&nbsp;=&nbsp;ServerNodeManager.getSlot();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;masterCount&nbsp;=&nbsp;ServerNodeManager.getMasterSize();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(masterCount&nbsp;&gt;&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;processService.findCommandPageBySlot(pageSize,&nbsp;pageNumber,&nbsp;masterCount,&nbsp;thisMasterSlot);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />@Override<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;List&lt;Command&gt;&nbsp;findCommandPageBySlot(int&nbsp;pageSize,&nbsp;int&nbsp;pageNumber,&nbsp;int&nbsp;masterCount,&nbsp;int&nbsp;thisMasterSlot)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(masterCount&nbsp;&lt;=&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;Lists.newArrayList();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;commandMapper.queryCommandPageBySlot(pageSize,&nbsp;pageNumber&nbsp;*&nbsp;pageSize,&nbsp;masterCount,&nbsp;thisMasterSlot);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&lt;select&nbsp;id=<span style="color: #98c379;line-height: 26px;">"queryCommandPageBySlot"</span>&nbsp;resultType=<span style="color: #98c379;line-height: 26px;">"org.apache.dolphinscheduler.dao.entity.Command"</span>&gt;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;t_ds_command<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">where</span>&nbsp;id&nbsp;%&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#{masterCount}&nbsp;=&nbsp;#{thisMasterSlot}</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order&nbsp;by&nbsp;process_instance_priority,&nbsp;id&nbsp;asc<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span>&nbsp;<span style="color: #5c6370;font-style: italic;line-height: 26px;">#{limit}&nbsp;offset&nbsp;#{offset}</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&lt;/select&gt;<br  /><br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">##槽位检查</span><br  />&nbsp;private&nbsp;List&lt;ProcessInstance&gt;&nbsp;command2ProcessInstance(List&lt;Command&gt;&nbsp;commands)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;ProcessInstance&gt;&nbsp;processInstances&nbsp;=&nbsp;Collections.synchronizedList(new&nbsp;ArrayList&lt;&gt;(commands.size()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CountDownLatch&nbsp;latch&nbsp;=&nbsp;new&nbsp;CountDownLatch(commands.size());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(final&nbsp;Command&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;:&nbsp;commands)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;masterPrepareExecService.execute(()&nbsp;-&gt;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;slot&nbsp;check&nbsp;again<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SlotCheckState&nbsp;slotCheckState&nbsp;=&nbsp;slotCheck(<span style="color: #e6c07b;line-height: 26px;">command</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(slotCheckState.equals(SlotCheckState.CHANGE)&nbsp;||&nbsp;slotCheckState.equals(SlotCheckState.INJECT))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"handle&nbsp;command&nbsp;{}&nbsp;skip,&nbsp;slot&nbsp;check&nbsp;state:&nbsp;{}"</span>,&nbsp;command.getId(),&nbsp;slotCheckState);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ProcessInstance&nbsp;processInstance&nbsp;=&nbsp;processService.handleCommand(logger,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getLocalAddress(),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(processInstance&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processInstances.add(processInstance);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"handle&nbsp;command&nbsp;{}&nbsp;end,&nbsp;create&nbsp;process&nbsp;instance&nbsp;{}"</span>,&nbsp;command.getId(),&nbsp;processInstance.getId());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span style="color: #98c379;line-height: 26px;">"handle&nbsp;command&nbsp;error&nbsp;"</span>,&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processService.moveToErrorCommand(<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;e.toString());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latch.countDown();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;make&nbsp;sure&nbsp;to&nbsp;finish&nbsp;handling&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;each&nbsp;time&nbsp;before&nbsp;next&nbsp;scan<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;latch.await();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(InterruptedException&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span style="color: #98c379;line-height: 26px;">"countDownLatch&nbsp;await&nbsp;error&nbsp;"</span>,&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;processInstances;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />private&nbsp;SlotCheckState&nbsp;slotCheck(Command&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;slot&nbsp;=&nbsp;ServerNodeManager.getSlot();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;masterSize&nbsp;=&nbsp;ServerNodeManager.getMasterSize();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SlotCheckState&nbsp;state;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(masterSize&nbsp;&lt;=&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state&nbsp;=&nbsp;SlotCheckState.CHANGE;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(command.getId()&nbsp;%&nbsp;masterSize&nbsp;==&nbsp;slot)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state&nbsp;=&nbsp;SlotCheckState.PASS;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state&nbsp;=&nbsp;SlotCheckState.INJECT;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;state;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.4.3 代码执行流程<span style="display: none;"></span></h5><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.6935185185185185" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/11_IYFk2T0AceJSAdiajQCYVMnALu5Qeg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn68KuX9rW1By2G9dk3BcibicKJLRqZIYFk2T0AceJSAdiajQCYVMnALu5Qeg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">代码过于繁琐，此处不再一一粘贴代码解释各个类的功能，自行看代码更加清晰。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2.5 Worker启动与执行流程<span style="display: none;"></span></h3><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.5.1 概念与执行逻辑<span style="display: none;"></span></h5><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-1"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">NettyRemotingServer（worker包含的netty服务端） WorkerRegistryClient（zk客户端，封装了worker与zk相关的操作，注册，查询，删除等） ;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">TaskPluginManager（任务插件管理器，封装了插件加载逻辑和任务实际执行业务的抽象） ;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">WorkerManagerThread（任务工作线程生成器，消费netty处理器推进队列的任务信息，并生成任务执行线程提交线程池管理） ;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">TaskExecuteProcessor（Netty任务执行处理器，生成master分发到work的任务信息，并推送到队列） ;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">TaskExecuteThread（任务执行线程） ;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">TaskCallbackService（任务回调线程，与master包含的netty client通信）;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">AbstractTask（任务实际业务的抽象类，子类包含实际的任务执行业务，SqlTask，DataXTask等） ;</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">RetryReportTaskStatusThread（不关注）</section></li></ul><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.5.2 代码执行流程<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Worker节点代码时序图如下：</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="1.0037037037037038" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/12_0u531YDFqAud8H9HFDOzaA0SGCkBTg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn6813f0F4lvygdo4oVKbaynq3j10u531YDFqAud8H9HFDOzaA0SGCkBTg/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;"></figure><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">代码过于繁琐，此处不再一一粘贴代码解释各个类的功能，自行看代码更加清晰。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2.6 RPC交互<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">因为节点和应用服务之间的RPC通信都是基于Netty实现的，Netty相关知识不在这里过多的讲解，当前章节只涉及Master与Worker之间的交互模式的设计与实现。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">整体设计如下</p><figure data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;display: flex;flex-direction: column;justify-content: center;align-items: center;"><img class="rich_pages wxw-img" data-ratio="0.31296296296296294" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/13_wmHicj6NFu9epriaN9ZBVTXsZ4wv7g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2OEXR6qy6XlQqqJ7dmxLn68SezWQnvAuDkM4pNAuicpyqicMIRWwmHicj6NFu9epriaN9ZBVTXsZ4wv7g/640?wx_fmt=png'" data-type="png" data-w="1080" style="display: block;margin-right: auto;margin-left: auto;"  /></figure><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.6.1 Master与Worker交互<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Master与worker之间的业务逻辑的交互是基于Netty服务端与客户端来实现Rpc通信的，Master和Worker启动的时候会将自己的Netty服务端信息注册到ZK相应的节点上，Master的任务分发线程和任务杀死等业务运行时，拉取ZK上的Worker节点信息，根据负载均衡策略选择一个节点，构建Netty客户端与Worker的Netty服务端通信，Worker收到Master的RPC请求之后会缓存Channel信息并处理对应业务，同时Callback回调线程会获取缓存的通道来执行回调操作，这样就形成的闭环。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">任务的执行杀死，以及回调状态处理等操作都是通过Netty客户端与服务端绑定的Processer处理器来进行的。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>Master部分具体代码如下</strong>：</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Master启动的时候会初始化Nettyserver，注册对应的请求处理器到NettyHandler并启动：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;@PostConstruct<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;run()&nbsp;throws&nbsp;SchedulerException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;init&nbsp;remoting&nbsp;server<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NettyServerConfig&nbsp;serverConfig&nbsp;=&nbsp;new&nbsp;NettyServerConfig();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverConfig.setListenPort(masterConfig.getListenPort());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer&nbsp;=&nbsp;new&nbsp;NettyRemotingServer(serverConfig);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.TASK_EXECUTE_RESPONSE,&nbsp;taskExecuteResponseProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.TASK_EXECUTE_RUNNING,&nbsp;taskExecuteRunningProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.TASK_KILL_RESPONSE,&nbsp;taskKillResponseProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.STATE_EVENT_REQUEST,&nbsp;stateEventProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.TASK_FORCE_STATE_EVENT_REQUEST,&nbsp;taskEventProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.TASK_WAKEUP_EVENT_REQUEST,&nbsp;taskEventProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.CACHE_EXPIRE,&nbsp;cacheProcessor);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;logger&nbsp;server<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.GET_LOG_BYTES_REQUEST,&nbsp;loggerRequestProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.ROLL_VIEW_LOG_REQUEST,&nbsp;loggerRequestProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.VIEW_WHOLE_LOG_REQUEST,&nbsp;loggerRequestProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.REMOVE_TAK_LOG_REQUEST,&nbsp;loggerRequestProcessor);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.start();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;install&nbsp;task&nbsp;plugin<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.taskPluginManager.installPlugin();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;self&nbsp;tolerant<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.masterRegistryClient.init();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.masterRegistryClient.start();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.masterRegistryClient.setRegistryStoppable(this);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.masterSchedulerService.init();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.masterSchedulerService.start();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.eventExecuteService.start();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.failoverExecuteThread.start();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.scheduler.start();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Runtime.getRuntime().addShutdownHook(new&nbsp;Thread(()&nbsp;-&gt;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(Stopper.isRunning())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(<span style="color: #98c379;line-height: 26px;">"shutdownHook"</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}));<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;server&nbsp;start<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">start</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(isStarted.compareAndSet(<span style="color: #56b6c2;line-height: 26px;">false</span>,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.serverBootstrap<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.group(this.bossGroup,&nbsp;this.workGroup)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.channel(NettyUtils.getServerSocketChannelClass())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.option(ChannelOption.SO_REUSEADDR,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.option(ChannelOption.SO_BACKLOG,&nbsp;serverConfig.getSoBacklog())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.childOption(ChannelOption.SO_KEEPALIVE,&nbsp;serverConfig.isSoKeepalive())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.childOption(ChannelOption.TCP_NODELAY,&nbsp;serverConfig.isTcpNoDelay())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.childOption(ChannelOption.SO_SNDBUF,&nbsp;serverConfig.getSendBufferSize())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.childOption(ChannelOption.SO_RCVBUF,&nbsp;serverConfig.getReceiveBufferSize())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.childHandler(new&nbsp;ChannelInitializer&lt;SocketChannel&gt;()&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected&nbsp;void&nbsp;initChannel(SocketChannel&nbsp;ch)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initNettyChannel(ch);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelFuture&nbsp;future;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;future&nbsp;=&nbsp;serverBootstrap.bind(serverConfig.getListenPort()).sync();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span style="color: #98c379;line-height: 26px;">"NettyRemotingServer&nbsp;bind&nbsp;fail&nbsp;{},&nbsp;exit"</span>,&nbsp;e.getMessage(),&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RemoteException(String.format(NETTY_BIND_FAILURE_MSG,&nbsp;serverConfig.getListenPort()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(future.isSuccess())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"NettyRemotingServer&nbsp;bind&nbsp;success&nbsp;at&nbsp;port&nbsp;:&nbsp;{}"</span>,&nbsp;serverConfig.getListenPort());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(future.cause()&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RemoteException(String.format(NETTY_BIND_FAILURE_MSG,&nbsp;serverConfig.getListenPort()),&nbsp;future.cause());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RemoteException(String.format(NETTY_BIND_FAILURE_MSG,&nbsp;serverConfig.getListenPort()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Master的NettyExecutorManager初始化的时候会将NettyRemotingClient也初始化，并且会注册处理Worker回调请求的处理器，真正的端口绑定是在获取到执行器端口之后：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;constructor<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">NettyExecutorManager</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;NettyClientConfig&nbsp;clientConfig&nbsp;=&nbsp;new&nbsp;NettyClientConfig();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingClient&nbsp;=&nbsp;new&nbsp;NettyRemotingClient(clientConfig);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><span style="color: #5c6370;font-style: italic;line-height: 26px;">##注册处理worker回调的处理器</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;@PostConstruct<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">init</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingClient.registerProcessor(CommandType.TASK_EXECUTE_RESPONSE,&nbsp;taskExecuteResponseProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingClient.registerProcessor(CommandType.TASK_EXECUTE_RUNNING,&nbsp;taskExecuteRunningProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingClient.registerProcessor(CommandType.TASK_KILL_RESPONSE,&nbsp;taskKillResponseProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;public&nbsp;NettyRemotingClient(final&nbsp;NettyClientConfig&nbsp;clientConfig)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.clientConfig&nbsp;=&nbsp;clientConfig;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(NettyUtils.useEpoll())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.workerGroup&nbsp;=&nbsp;new&nbsp;EpollEventLoopGroup(clientConfig.getWorkerThreads(),&nbsp;new&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">ThreadFactory</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;AtomicInteger&nbsp;threadIndex&nbsp;=&nbsp;new&nbsp;AtomicInteger(0);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Thread&nbsp;newThread(Runnable&nbsp;r)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;new&nbsp;Thread(r,&nbsp;String.format(<span style="color: #98c379;line-height: 26px;">"NettyClient_%d"</span>,&nbsp;this.threadIndex.incrementAndGet()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.workerGroup&nbsp;=&nbsp;new&nbsp;NioEventLoopGroup(clientConfig.getWorkerThreads(),&nbsp;new&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">ThreadFactory</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;final&nbsp;AtomicInteger&nbsp;threadIndex&nbsp;=&nbsp;new&nbsp;AtomicInteger(0);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Thread&nbsp;newThread(Runnable&nbsp;r)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;new&nbsp;Thread(r,&nbsp;String.format(<span style="color: #98c379;line-height: 26px;">"NettyClient_%d"</span>,&nbsp;this.threadIndex.incrementAndGet()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.callbackExecutor&nbsp;=&nbsp;new&nbsp;ThreadPoolExecutor(5,&nbsp;10,&nbsp;1,&nbsp;TimeUnit.MINUTES,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;LinkedBlockingQueue&lt;&gt;(1000),&nbsp;new&nbsp;NamedThreadFactory(<span style="color: #98c379;line-height: 26px;">"CallbackExecutor"</span>,&nbsp;10),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new&nbsp;CallerThreadExecutePolicy());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.clientHandler&nbsp;=&nbsp;new&nbsp;NettyClientHandler(this,&nbsp;callbackExecutor);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.responseFutureExecutor&nbsp;=&nbsp;Executors.newSingleThreadScheduledExecutor(new&nbsp;NamedThreadFactory(<span style="color: #98c379;line-height: 26px;">"ResponseFutureExecutor"</span>));<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.start();<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;start<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;private&nbsp;void&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">start</span></span>()&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.bootstrap<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.group(this.workerGroup)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.channel(NettyUtils.getSocketChannelClass())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.option(ChannelOption.SO_KEEPALIVE,&nbsp;clientConfig.isSoKeepalive())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.option(ChannelOption.TCP_NODELAY,&nbsp;clientConfig.isTcpNoDelay())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.option(ChannelOption.SO_SNDBUF,&nbsp;clientConfig.getSendBufferSize())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.option(ChannelOption.SO_RCVBUF,&nbsp;clientConfig.getReceiveBufferSize())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.option(ChannelOption.CONNECT_TIMEOUT_MILLIS,&nbsp;clientConfig.getConnectTimeoutMillis())<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.handler(new&nbsp;ChannelInitializer&lt;SocketChannel&gt;()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;initChannel(SocketChannel&nbsp;ch)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ch.pipeline()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addLast(<span style="color: #98c379;line-height: 26px;">"client-idle-handler"</span>,&nbsp;new&nbsp;IdleStateHandler(Constants.NETTY_CLIENT_HEART_BEAT_TIME,&nbsp;0,&nbsp;0,&nbsp;TimeUnit.MILLISECONDS))<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addLast(new&nbsp;NettyDecoder(),&nbsp;clientHandler,&nbsp;encoder);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.responseFutureExecutor.scheduleAtFixedRate(ResponseFuture::scanFutureTable,&nbsp;5000,&nbsp;1000,&nbsp;TimeUnit.MILLISECONDS);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isStarted.compareAndSet(<span style="color: #56b6c2;line-height: 26px;">false</span>,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">任务分发代码如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;task&nbsp;dispatch<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context&nbsp;context<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ExecuteException&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;error&nbsp;throws&nbsp;ExecuteException<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Boolean&nbsp;dispatch(final&nbsp;ExecutionContext&nbsp;context)&nbsp;throws&nbsp;ExecuteException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;get&nbsp;executor&nbsp;manager<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ExecutorManager&lt;Boolean&gt;&nbsp;executorManager&nbsp;=&nbsp;this.executorManagers.get(context.getExecutorType());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(executorManager&nbsp;==&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ExecuteException(<span style="color: #98c379;line-height: 26px;">"no&nbsp;ExecutorManager&nbsp;for&nbsp;type&nbsp;:&nbsp;"</span>&nbsp;+&nbsp;context.getExecutorType());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;host&nbsp;select<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Host&nbsp;host&nbsp;=&nbsp;hostManager.select(context);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(StringUtils.isEmpty(host.getAddress()))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ExecuteException(String.format(<span style="color: #98c379;line-height: 26px;">"fail&nbsp;to&nbsp;execute&nbsp;:&nbsp;%s&nbsp;due&nbsp;to&nbsp;no&nbsp;suitable&nbsp;worker,&nbsp;"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style="color: #98c379;line-height: 26px;">"current&nbsp;task&nbsp;needs&nbsp;worker&nbsp;group&nbsp;%s&nbsp;to&nbsp;execute"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.getCommand(),context.getWorkerGroup()));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.setHost(host);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executorManager.beforeExecute(context);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;task&nbsp;execute<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;executorManager.execute(context);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;executorManager.afterExecute(context);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  /><br  />/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;execute&nbsp;logic<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;context&nbsp;context<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ExecuteException&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;error&nbsp;throws&nbsp;ExecuteException<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;@Override<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Boolean&nbsp;execute(ExecutionContext&nbsp;context)&nbsp;throws&nbsp;ExecuteException&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;all&nbsp;nodes<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt;&nbsp;allNodes&nbsp;=&nbsp;getAllNodes(context);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;fail&nbsp;nodes<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt;&nbsp;failNodeSet&nbsp;=&nbsp;new&nbsp;HashSet&lt;&gt;();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;build&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;accord&nbsp;executeContext<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Command&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;=&nbsp;context.getCommand();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;execute&nbsp;task&nbsp;host<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Host&nbsp;host&nbsp;=&nbsp;context.getHost();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;success&nbsp;=&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">while</span>&nbsp;(!success)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;doExecute(host,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success&nbsp;=&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;context.setHost(host);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(ExecuteException&nbsp;ex)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(String.format(<span style="color: #98c379;line-height: 26px;">"execute&nbsp;command&nbsp;:&nbsp;%s&nbsp;error"</span>,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>),&nbsp;ex);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failNodeSet.add(host.getAddress());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt;&nbsp;tmpAllIps&nbsp;=&nbsp;new&nbsp;HashSet&lt;&gt;(allNodes);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Collection&lt;String&gt;&nbsp;remained&nbsp;=&nbsp;CollectionUtils.subtract(tmpAllIps,&nbsp;failNodeSet);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(remained&nbsp;!=&nbsp;null&nbsp;&amp;&amp;&nbsp;remained.size()&nbsp;&gt;&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host&nbsp;=&nbsp;Host.of(remained.iterator().next());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span style="color: #98c379;line-height: 26px;">"retry&nbsp;execute&nbsp;command&nbsp;:&nbsp;{}&nbsp;host&nbsp;:&nbsp;{}"</span>,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;host);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ExecuteException(<span style="color: #98c379;line-height: 26px;">"fail&nbsp;after&nbsp;try&nbsp;all&nbsp;nodes"</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Throwable&nbsp;t)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ExecuteException(<span style="color: #98c379;line-height: 26px;">"fail&nbsp;after&nbsp;try&nbsp;all&nbsp;nodes"</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;success;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  /><br  />/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;execute&nbsp;logic<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;host&nbsp;host<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@throws&nbsp;ExecuteException&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;error&nbsp;throws&nbsp;ExecuteException<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;doExecute(final&nbsp;Host&nbsp;host,&nbsp;final&nbsp;Command&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>)&nbsp;throws&nbsp;ExecuteException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;retry&nbsp;count，default&nbsp;retry&nbsp;3<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;retryCount&nbsp;=&nbsp;3;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;success&nbsp;=&nbsp;<span style="color: #56b6c2;line-height: 26px;">false</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">do</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nettyRemotingClient.send(host,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success&nbsp;=&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;ex)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(String.format(<span style="color: #98c379;line-height: 26px;">"send&nbsp;command&nbsp;:&nbsp;%s&nbsp;to&nbsp;%s&nbsp;error"</span>,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;host),&nbsp;ex);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;retryCount--;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ThreadUtils.sleep(100);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">while</span>&nbsp;(retryCount&nbsp;&gt;=&nbsp;0&nbsp;&amp;&amp;&nbsp;!success);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(!success)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;ExecuteException(String.format(<span style="color: #98c379;line-height: 26px;">"send&nbsp;command&nbsp;:&nbsp;%s&nbsp;to&nbsp;%s&nbsp;error"</span>,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;host));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;send&nbsp;task<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;host&nbsp;host<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;send(final&nbsp;Host&nbsp;host,&nbsp;final&nbsp;Command&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>)&nbsp;throws&nbsp;RemotingException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Channel&nbsp;channel&nbsp;=&nbsp;getChannel(host);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(channel&nbsp;==&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RemotingException(String.format(<span style="color: #98c379;line-height: 26px;">"connect&nbsp;to&nbsp;:&nbsp;%s&nbsp;fail"</span>,&nbsp;host));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ChannelFuture&nbsp;future&nbsp;=&nbsp;channel.writeAndFlush(<span style="color: #e6c07b;line-height: 26px;">command</span>).await();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(future.isSuccess())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.debug(<span style="color: #98c379;line-height: 26px;">"send&nbsp;command&nbsp;:&nbsp;{}&nbsp;,&nbsp;to&nbsp;:&nbsp;{}&nbsp;successfully."</span>,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;host.getAddress());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;msg&nbsp;=&nbsp;String.format(<span style="color: #98c379;line-height: 26px;">"send&nbsp;command&nbsp;:&nbsp;%s&nbsp;,&nbsp;to&nbsp;:%s&nbsp;failed"</span>,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;host.getAddress());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(msg,&nbsp;future.cause());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RemotingException(msg);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span style="color: #98c379;line-height: 26px;">"Send&nbsp;command&nbsp;{}&nbsp;to&nbsp;address&nbsp;{}&nbsp;encounter&nbsp;error."</span>,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;host.getAddress());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RemotingException(String.format(<span style="color: #98c379;line-height: 26px;">"Send&nbsp;command&nbsp;:&nbsp;%s&nbsp;,&nbsp;to&nbsp;:%s&nbsp;encounter&nbsp;error"</span>,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;host.getAddress()),&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>Worker部分具体代码如下</strong>：</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">同理Woker在启动的时候会初始化NettyServer，注册对应处理器并启动：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;worker&nbsp;server&nbsp;run<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;@PostConstruct<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">run</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;init&nbsp;remoting&nbsp;server<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NettyServerConfig&nbsp;serverConfig&nbsp;=&nbsp;new&nbsp;NettyServerConfig();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serverConfig.setListenPort(workerConfig.getListenPort());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer&nbsp;=&nbsp;new&nbsp;NettyRemotingServer(serverConfig);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.TASK_EXECUTE_REQUEST,&nbsp;taskExecuteProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.TASK_KILL_REQUEST,&nbsp;taskKillProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.TASK_EXECUTE_RUNNING_ACK,&nbsp;taskExecuteRunningAckProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.TASK_EXECUTE_RESPONSE_ACK,&nbsp;taskExecuteResponseAckProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.PROCESS_HOST_UPDATE_REQUEST,&nbsp;hostUpdateProcessor);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;logger&nbsp;server<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.GET_LOG_BYTES_REQUEST,&nbsp;loggerRequestProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.ROLL_VIEW_LOG_REQUEST,&nbsp;loggerRequestProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.VIEW_WHOLE_LOG_REQUEST,&nbsp;loggerRequestProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.registerProcessor(CommandType.REMOVE_TAK_LOG_REQUEST,&nbsp;loggerRequestProcessor);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingServer.start();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;install&nbsp;task&nbsp;plugin<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.taskPluginManager.installPlugin();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;worker&nbsp;registry<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.workerRegistryClient.registry();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.workerRegistryClient.setRegistryStoppable(this);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt;&nbsp;workerZkPaths&nbsp;=&nbsp;this.workerRegistryClient.getWorkerZkPaths();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.workerRegistryClient.handleDeadServer(workerZkPaths,&nbsp;NodeType.WORKER,&nbsp;Constants.DELETE_OP);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(e.getMessage(),&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RuntimeException(e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;task&nbsp;execute&nbsp;manager<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.workerManagerThread.start();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;retry&nbsp;report&nbsp;task&nbsp;status<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.retryReportTaskStatusThread.start();<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;registry&nbsp;hooks,&nbsp;<span style="color: #e6c07b;line-height: 26px;">which</span>&nbsp;are&nbsp;called&nbsp;before&nbsp;the&nbsp;process&nbsp;exits<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Runtime.getRuntime().addShutdownHook(new&nbsp;Thread(()&nbsp;-&gt;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(Stopper.isRunning())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(<span style="color: #98c379;line-height: 26px;">"shutdownHook"</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}));<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">回调线程对象初始化的时候，会将包含的Nettyremotingclient一起初始化，并注册好对应的业务处理器：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">public&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">TaskCallbackService</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;NettyClientConfig&nbsp;clientConfig&nbsp;=&nbsp;new&nbsp;NettyClientConfig();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingClient&nbsp;=&nbsp;new&nbsp;NettyRemotingClient(clientConfig);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingClient.registerProcessor(CommandType.TASK_EXECUTE_RUNNING_ACK,&nbsp;taskExecuteRunningProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.nettyRemotingClient.registerProcessor(CommandType.TASK_EXECUTE_RESPONSE_ACK,&nbsp;taskExecuteResponseAckProcessor);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">回调线程会通过其他执行器中缓存下来的Chanel与Master的客户端进行通信：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">/**<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;send&nbsp;result<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;taskInstanceId&nbsp;taskInstanceId<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;send(int&nbsp;taskInstanceId,&nbsp;Command&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NettyRemoteChannel&nbsp;nettyRemoteChannel&nbsp;=&nbsp;getRemoteChannel(taskInstanceId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(nettyRemoteChannel&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nettyRemoteChannel.writeAndFlush(<span style="color: #e6c07b;line-height: 26px;">command</span>).addListener(new&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">ChannelFutureListener</span></span>()&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;operationComplete(ChannelFuture&nbsp;future)&nbsp;throws&nbsp;Exception&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(future.isSuccess())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;remove(taskInstanceId);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.6.2 其他服务与Master交互<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">以日志服务为例，前端触发请求日志的接口，通过参数与数据库交互获取到Master的NettyServer信息，然后构建Netty客户端与Master进行通信获取日志并返回。具体代码如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">                                   @RequestParam(value = "skipLineNum") int skipNum,<br  />                                   @RequestParam(value = "limit") int limit) {<br  />        return loggerService.queryLog(taskInstanceId, skipNum, limit);<br  />    }<br  /></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;view&nbsp;<span style="color: #e6c07b;line-height: 26px;">log</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;taskInstId&nbsp;task&nbsp;instance&nbsp;id<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;skipLineNum&nbsp;skip&nbsp;line&nbsp;number<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">log</span>&nbsp;string&nbsp;data<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;@Override<br  />&nbsp;&nbsp;&nbsp;&nbsp;@SuppressWarnings(<span style="color: #98c379;line-height: 26px;">"unchecked"</span>)<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Result&lt;String&gt;&nbsp;queryLog(int&nbsp;taskInstId,&nbsp;int&nbsp;skipLineNum,&nbsp;int&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span>)&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TaskInstance&nbsp;taskInstance&nbsp;=&nbsp;processService.findTaskInstanceById(taskInstId);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(taskInstance&nbsp;==&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;Result.error(Status.TASK_INSTANCE_NOT_FOUND);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(StringUtils.isBlank(taskInstance.getHost()))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;Result.error(Status.TASK_INSTANCE_HOST_IS_NULL);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Result&lt;String&gt;&nbsp;result&nbsp;=&nbsp;new&nbsp;Result&lt;&gt;(Status.SUCCESS.getCode(),&nbsp;Status.SUCCESS.getMsg());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;<span style="color: #e6c07b;line-height: 26px;">log</span>&nbsp;=&nbsp;queryLog(taskInstance,skipLineNum,<span style="color: #e6c07b;line-height: 26px;">limit</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.setData(<span style="color: #e6c07b;line-height: 26px;">log</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;query&nbsp;<span style="color: #e6c07b;line-height: 26px;">log</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;taskInstance&nbsp;&nbsp;task&nbsp;instance<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;skipLineNum&nbsp;skip&nbsp;line&nbsp;number<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">log</span>&nbsp;string&nbsp;data<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;String&nbsp;queryLog(TaskInstance&nbsp;taskInstance,&nbsp;int&nbsp;skipLineNum,&nbsp;int&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span>)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Host&nbsp;host&nbsp;=&nbsp;Host.of(taskInstance.getHost());<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"log&nbsp;host&nbsp;:&nbsp;{}&nbsp;,&nbsp;logPath&nbsp;:&nbsp;{}&nbsp;,&nbsp;port&nbsp;:&nbsp;{}"</span>,&nbsp;host.getIp(),&nbsp;taskInstance.getLogPath(),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host.getPort());<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringBuilder&nbsp;<span style="color: #e6c07b;line-height: 26px;">log</span>&nbsp;=&nbsp;new&nbsp;StringBuilder();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(skipLineNum&nbsp;==&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;head&nbsp;=&nbsp;String.format(LOG_HEAD_FORMAT,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taskInstance.getLogPath(),<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;host,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Constants.SYSTEM_LINE_SEPARATOR);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.append(head);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;log.append(logClient<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.rollViewLog(host.getIp(),&nbsp;host.getPort(),&nbsp;taskInstance.getLogPath(),&nbsp;skipLineNum,&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span>));<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;log.toString();<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;roll&nbsp;view&nbsp;<span style="color: #e6c07b;line-height: 26px;">log</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;host&nbsp;host<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;port&nbsp;port<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;path&nbsp;path<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;skipLineNum&nbsp;skip&nbsp;line&nbsp;number<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">log</span>&nbsp;content<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;String&nbsp;rollViewLog(String&nbsp;host,&nbsp;int&nbsp;port,&nbsp;String&nbsp;path,&nbsp;int&nbsp;skipLineNum,&nbsp;int&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span>)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.info(<span style="color: #98c379;line-height: 26px;">"roll&nbsp;view&nbsp;log,&nbsp;host&nbsp;:&nbsp;{},&nbsp;port&nbsp;:&nbsp;{},&nbsp;path&nbsp;{},&nbsp;skipLineNum&nbsp;{}&nbsp;,limit&nbsp;{}"</span>,&nbsp;host,&nbsp;port,&nbsp;path,&nbsp;skipLineNum,&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RollViewLogRequestCommand&nbsp;request&nbsp;=&nbsp;new&nbsp;RollViewLogRequestCommand(path,&nbsp;skipLineNum,&nbsp;<span style="color: #e6c07b;line-height: 26px;">limit</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;result&nbsp;=&nbsp;<span style="color: #98c379;line-height: 26px;">""</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Host&nbsp;address&nbsp;=&nbsp;new&nbsp;Host(host,&nbsp;port);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Command&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;=&nbsp;request.convert2Command();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Command&nbsp;response&nbsp;=&nbsp;this.client.sendSync(address,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;LOG_REQUEST_TIMEOUT);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(response&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RollViewLogResponseCommand&nbsp;rollReviewLog&nbsp;=&nbsp;JSONUtils.parseObject(<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;response.getBody(),&nbsp;RollViewLogResponseCommand.class);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;rollReviewLog.getMsg();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;catch&nbsp;(Exception&nbsp;e)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span style="color: #98c379;line-height: 26px;">"roll&nbsp;view&nbsp;log&nbsp;error"</span>,&nbsp;e);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.client.closeChannel(address);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;sync&nbsp;send<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;host&nbsp;host<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;timeoutMillis&nbsp;timeoutMillis<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;Command&nbsp;sendSync(final&nbsp;Host&nbsp;host,&nbsp;final&nbsp;Command&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;final&nbsp;long&nbsp;timeoutMillis)&nbsp;throws&nbsp;InterruptedException,&nbsp;RemotingException&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;Channel&nbsp;channel&nbsp;=&nbsp;getChannel(host);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(channel&nbsp;==&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RemotingException(String.format(<span style="color: #98c379;line-height: 26px;">"connect&nbsp;to&nbsp;:&nbsp;%s&nbsp;fail"</span>,&nbsp;host));<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;long&nbsp;opaque&nbsp;=&nbsp;command.getOpaque();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final&nbsp;ResponseFuture&nbsp;responseFuture&nbsp;=&nbsp;new&nbsp;ResponseFuture(opaque,&nbsp;timeoutMillis,&nbsp;null,&nbsp;null);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel.writeAndFlush(<span style="color: #e6c07b;line-height: 26px;">command</span>).addListener(future&nbsp;-&gt;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(future.isSuccess())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;responseFuture.setSendOk(<span style="color: #56b6c2;line-height: 26px;">true</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;responseFuture.setSendOk(<span style="color: #56b6c2;line-height: 26px;">false</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;responseFuture.setCause(future.cause());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;responseFuture.putResponse(null);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;logger.error(<span style="color: #98c379;line-height: 26px;">"send&nbsp;command&nbsp;{}&nbsp;to&nbsp;host&nbsp;{}&nbsp;failed"</span>,&nbsp;<span style="color: #e6c07b;line-height: 26px;">command</span>,&nbsp;host);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;sync&nbsp;<span style="color: #e6c07b;line-height: 26px;">wait</span>&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;result<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Command&nbsp;result&nbsp;=&nbsp;responseFuture.waitResponse();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(result&nbsp;==&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(responseFuture.isSendOK())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RemotingTimeoutException(host.toString(),&nbsp;timeoutMillis,&nbsp;responseFuture.getCause());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span style="color: #c678dd;line-height: 26px;">else</span>&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;RemotingException(host.toString(),&nbsp;responseFuture.getCause());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;result;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Nettyclient随着日志业务对象初始化而初始化：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;construct&nbsp;client<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">LogClientService</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.clientConfig&nbsp;=&nbsp;new&nbsp;NettyClientConfig();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.clientConfig.setWorkerThreads(4);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.client&nbsp;=&nbsp;new&nbsp;NettyRemotingClient(clientConfig);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.isRunning&nbsp;=&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2.7 负载均衡算法<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Master在选择执行器的时候DolphinScheduler提供了三种负载均衡算法，且所有的算法都用到了节点权重：加权随机（random），平滑轮询（roundrobin），线性负载（lowerweight）。通过配置文件来控制到底使用哪一个负载均衡策略，默认配置是权重策略：host-selector: lower_weight。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HostManager&nbsp;<span style="line-height: 26px;"><span style="color: #61aeee;line-height: 26px;">hostManager</span></span>()&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HostSelector&nbsp;selector&nbsp;=&nbsp;masterConfig.getHostSelector();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HostManager&nbsp;hostManager;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(selector)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">case</span>&nbsp;RANDOM:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hostManager&nbsp;=&nbsp;new&nbsp;RandomHostManager();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">break</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">case</span>&nbsp;ROUND_ROBIN:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hostManager&nbsp;=&nbsp;new&nbsp;RoundRobinHostManager();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">break</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">case</span>&nbsp;LOWER_WEIGHT:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hostManager&nbsp;=&nbsp;new&nbsp;LowerWeightHostManager();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">break</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;IllegalArgumentException(<span style="color: #98c379;line-height: 26px;">"unSupport&nbsp;selector&nbsp;"</span>&nbsp;+&nbsp;selector);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;beanFactory.autowireBean(hostManager);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;hostManager;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.7.1 加权随机<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">看代码更好理解：按照全部权重值求和，然后取汇总结果的随机整数，随机整数对原先所有host的权重累差，返回小于零的时候的host，没有就随机返回一个。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HostWorker&nbsp;doSelect(final&nbsp;Collection&lt;HostWorker&gt;&nbsp;<span style="color: #e6c07b;line-height: 26px;">source</span>)&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;HostWorker&gt;&nbsp;hosts&nbsp;=&nbsp;new&nbsp;ArrayList&lt;&gt;(<span style="color: #e6c07b;line-height: 26px;">source</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;size&nbsp;=&nbsp;hosts.size();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int[]&nbsp;weights&nbsp;=&nbsp;new&nbsp;int[size];<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;totalWeight&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;index&nbsp;=&nbsp;0;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(HostWorker&nbsp;host&nbsp;:&nbsp;hosts)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalWeight&nbsp;+=&nbsp;host.getHostWeight();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weights[index]&nbsp;=&nbsp;host.getHostWeight();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index++;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(totalWeight&nbsp;&gt;&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;offset&nbsp;=&nbsp;ThreadLocalRandom.current().nextInt(totalWeight);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;size;&nbsp;i++)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;offset&nbsp;-=&nbsp;weights[i];<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(offset&nbsp;&lt;&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;hosts.get(i);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;hosts.get(ThreadLocalRandom.current().nextInt(size));<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><h5 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.7.2 线性负载<span style="display: none;"></span></h5><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">权重计算逻辑：利用注册的Cpu占用、内存占用以及加载因子还有启动时间消耗做计算。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;calculatedWeight&nbsp;=&nbsp;cpu&nbsp;*&nbsp;CPU_FACTOR&nbsp;+&nbsp;memory&nbsp;*&nbsp;MEMORY_FACTOR&nbsp;+&nbsp;loadAverage&nbsp;*&nbsp;LOAD_AVERAGE_FACTOR;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;uptime&nbsp;=&nbsp;System.currentTimeMillis()&nbsp;-&nbsp;startTime;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(uptime&nbsp;&gt;&nbsp;0&nbsp;&amp;&amp;&nbsp;uptime&nbsp;&lt;&nbsp;Constants.WARM_UP_TIME)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;If&nbsp;the&nbsp;warm-up&nbsp;is&nbsp;not&nbsp;over,&nbsp;add&nbsp;the&nbsp;weight<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;calculatedWeight&nbsp;*&nbsp;Constants.WARM_UP_TIME&nbsp;/&nbsp;uptime;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;calculatedWeight;<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">获取权重最小的节点，并把节点权重置为最大。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;select<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@param&nbsp;sources&nbsp;sources<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;@<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;HostWeight<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br  />&nbsp;&nbsp;&nbsp;&nbsp;@Override<br  />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HostWeight&nbsp;doSelect(Collection&lt;HostWeight&gt;&nbsp;sources)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;totalWeight&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;lowWeight&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HostWeight&nbsp;lowerNode&nbsp;=&nbsp;null;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(HostWeight&nbsp;hostWeight&nbsp;:&nbsp;sources)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalWeight&nbsp;+=&nbsp;hostWeight.getWeight();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hostWeight.setCurrentWeight(hostWeight.getCurrentWeight()&nbsp;+&nbsp;hostWeight.getWeight());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(lowerNode&nbsp;==&nbsp;null&nbsp;||&nbsp;lowWeight&nbsp;&gt;&nbsp;hostWeight.getCurrentWeight())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lowerNode&nbsp;=&nbsp;hostWeight;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lowWeight&nbsp;=&nbsp;hostWeight.getCurrentWeight();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lowerNode.setCurrentWeight(lowerNode.getCurrentWeight()&nbsp;+&nbsp;totalWeight);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;lowerNode;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><h6 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;"><span style="display: none;"></span>2.7.3 平滑轮询<span style="display: none;"></span></h6><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">这个算法不是很好的能够理解，所以我不知道我的理解是否正确，它有一个预热的过程，之前都是取第一个，等到累计的权重超过最大就整数就开始按权重轮询。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_svg/I1YzhXxW8YAM5ibZgh8WvoribQFO321NMtbFTAWcLoarDGoFkkNveTtEITulTs6VnB4SibI5Uogzibribw9RvZsUia9Dum1Lv3VvLE/640?wx_fmt=svg&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;"></span><code style="overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;HostWorker&nbsp;doSelect(Collection&lt;HostWorker&gt;&nbsp;<span style="color: #e6c07b;line-height: 26px;">source</span>)&nbsp;{<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;HostWorker&gt;&nbsp;hosts&nbsp;=&nbsp;new&nbsp;ArrayList&lt;&gt;(<span style="color: #e6c07b;line-height: 26px;">source</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;key&nbsp;=&nbsp;hosts.get(0).getWorkerGroup();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConcurrentMap&lt;String,&nbsp;WeightedRoundRobin&gt;&nbsp;map&nbsp;=&nbsp;workGroupWeightMap.get(key);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(map&nbsp;==&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workGroupWeightMap.putIfAbsent(key,&nbsp;new&nbsp;ConcurrentHashMap&lt;&gt;());<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;=&nbsp;workGroupWeightMap.get(key);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;totalWeight&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;maxCurrent&nbsp;=&nbsp;Long.MIN_VALUE;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;now&nbsp;=&nbsp;System.currentTimeMillis();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HostWorker&nbsp;selectedHost&nbsp;=&nbsp;null;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WeightedRoundRobin&nbsp;selectWeightRoundRobin&nbsp;=&nbsp;null;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">for</span>&nbsp;(HostWorker&nbsp;host&nbsp;:&nbsp;hosts)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;workGroupHost&nbsp;=&nbsp;host.getWorkerGroup()&nbsp;+&nbsp;host.getAddress();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WeightedRoundRobin&nbsp;weightedRoundRobin&nbsp;=&nbsp;map.get(workGroupHost);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;weight&nbsp;=&nbsp;host.getHostWeight();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(weight&nbsp;&lt;&nbsp;0)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weight&nbsp;=&nbsp;0;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(weightedRoundRobin&nbsp;==&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weightedRoundRobin&nbsp;=&nbsp;new&nbsp;WeightedRoundRobin();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;<span style="color: #e6c07b;line-height: 26px;">set</span>&nbsp;weight<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weightedRoundRobin.setWeight(weight);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map.putIfAbsent(workGroupHost,&nbsp;weightedRoundRobin);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weightedRoundRobin&nbsp;=&nbsp;map.get(workGroupHost);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(weight&nbsp;!=&nbsp;weightedRoundRobin.getWeight())&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weightedRoundRobin.setWeight(weight);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;cur&nbsp;=&nbsp;weightedRoundRobin.increaseCurrent();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;weightedRoundRobin.setLastUpdate(now);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(cur&nbsp;&gt;&nbsp;maxCurrent)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maxCurrent&nbsp;=&nbsp;cur;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selectedHost&nbsp;=&nbsp;host;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selectWeightRoundRobin&nbsp;=&nbsp;weightedRoundRobin;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalWeight&nbsp;+=&nbsp;weight;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(!updateLock.get()&nbsp;&amp;&amp;&nbsp;hosts.size()&nbsp;!=&nbsp;map.size()&nbsp;&amp;&amp;&nbsp;updateLock.compareAndSet(<span style="color: #56b6c2;line-height: 26px;">false</span>,&nbsp;<span style="color: #56b6c2;line-height: 26px;">true</span>))&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ConcurrentMap&lt;String,&nbsp;WeightedRoundRobin&gt;&nbsp;newMap&nbsp;=&nbsp;new&nbsp;ConcurrentHashMap&lt;&gt;(map);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newMap.entrySet().removeIf(item&nbsp;-&gt;&nbsp;now&nbsp;-&nbsp;item.getValue().getLastUpdate()&nbsp;&gt;&nbsp;RECYCLE_PERIOD);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workGroupWeightMap.put(key,&nbsp;newMap);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;finally&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateLock.set(<span style="color: #56b6c2;line-height: 26px;">false</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #c678dd;line-height: 26px;">if</span>&nbsp;(selectedHost&nbsp;!=&nbsp;null)&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selectWeightRoundRobin.sel(totalWeight);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;selectedHost;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #e6c07b;line-height: 26px;">return</span>&nbsp;hosts.get(0);<br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2.8 日志服务<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">2.6.2已经介绍不在做过多的说明。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>2.9 报警<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">暂未研究，目测基本就是根据规则筛选数据，然后调用指定类型的报警服务接口做报警操作，比如邮件，微信，短信通知等。</p></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="margin: 0px;padding: 0px 10px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;orphans: 2;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;line-height: 1.6;letter-spacing: 0.034em;color: rgb(63, 63, 63);font-size: 16px;"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section mp-original-font-size="14" mp-original-line-height="24.5" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;font-style: normal;font-variant-caps: normal;font-weight: normal;letter-spacing: 0.476px;text-indent: 0px;text-transform: none;white-space: normal;word-spacing: 0px;text-size-adjust: auto;-webkit-text-stroke: 0px rgb(178, 178, 178);font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.25px;font-family: &quot;Helvetica Neue&quot;;text-align: center;color: rgb(178, 178, 178);background-color: rgb(255, 255, 255);line-height: 21.4375px;visibility: visible;"><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;color: rgb(74, 74, 74);font-size: 15px;">如果这个文章对你有帮助，不要忘记&nbsp;</span><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;outline: 0px;font-size: 15px;color: rgb(255, 104, 39);"><strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「在看」</strong>&nbsp;<strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「点赞」</strong>&nbsp;<strong style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;outline: 0px;line-height: 1.75em;">「收藏」</strong></span><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;color: rgb(74, 74, 74);font-size: 15px;">&nbsp;三连啊喂！</span><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><p style="margin: 0px 0px 0em;padding: 0px;clear: both;min-height: 1em;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;text-align: center;"><img class="rich_pages wxw-img" data-ratio="1.6527777777777777" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/14_Zfh1Rf8hPd3euzJlYyfJq4081VB6Rg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/UdK9ByfMT2PuHq9qaJwJpGeRJBMqMloibzfcYl12AoR2v9kgqyZz4CYuKZfh1Rf8hPd3euzJlYyfJq4081VB6Rg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1'" data-w="576" style="margin: 0px;padding: 0px;max-width: 100%;height: 380px;overflow-wrap: break-word !important;vertical-align: bottom;width: 230px;"  /><span style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;background-color: rgb(255, 255, 255);color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;"></span></p></section></section><section style="margin: 0px;padding: 0px;max-width: 100%;color: rgb(51, 51, 51);font-family: mp-quote, -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 17px;font-style: normal;font-variant-ligatures: normal;font-variant-caps: normal;font-weight: 400;letter-spacing: normal;orphans: 2;text-align: justify;text-indent: 0px;text-transform: none;white-space: normal;widows: 2;word-spacing: 0px;-webkit-text-stroke-width: 0px;text-decoration-thickness: initial;text-decoration-style: initial;text-decoration-color: initial;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><img class="rich_pages wxw-img" data-ratio="0.10979228486646884" src="图片/大数据技术与架构_2022-10-26_「转」一文读懂，硬核 Apache DolphinScheduler30 源码解析/15_zrkyKUN5kNeUFicVC3bMP1GEqKz1OQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/BSBqCXrZtzAicMToibKuIysLrB62M5A5YaLhZg6z86tI7ZeEZqTLLYyNrmlzrkyKUN5kNeUFicVC3bMP1GEqKz1OQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1011" style="margin: 0px;padding: 0px;max-width: 100%;height: 42px;overflow-wrap: break-word !important;vertical-align: bottom;color: rgb(136, 136, 136);font-family: &quot;Helvetica Neue&quot;;font-size: 13px;letter-spacing: 1px;-webkit-text-stroke-color: rgb(136, 136, 136);box-sizing: border-box;width: 384px;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247510040&amp;idx=1&amp;sn=aa335f25965975731173916f012d56f4&amp;chksm=fd3eee8dca49679b82f632048fb64d21fac01497d1a0fe33917edb01e194caf0f9a1930a55ce&amp;scene=21#wechat_redirect" textvalue="2022年全网首发|大数据专家级技能模型与学习指南(胜天半子篇)" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">2022年全网首发|大数据专家级技能模型与学习指南(胜天半子篇)</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247508317&amp;idx=1&amp;sn=0bcb7fb6997b42306994b890eaa0d47f&amp;chksm=fd3ee7c8ca496ede347a2971002c6ea68dcfd70abeeb90b43c8b02a2a60ebc7cec3a87ef7d52&amp;scene=21#wechat_redirect" textvalue="互联网最坏的时代可能真的来了" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">互联网最坏的时代可能真的来了</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247507860&amp;idx=1&amp;sn=807ac5003762f29c127bc4071dcebe33&amp;chksm=fd3e9901ca4910178cfc816043ea86c29f881f70cd943d252de9ae2e21cb7e8ba80bff162e1b&amp;scene=21#wechat_redirect" textvalue="我在B站读大学，大数据专业" linktype="text" imgurl="" imgdata="null" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">我在B站读大学，大数据专业</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247499604&amp;idx=1&amp;sn=d938dfb30d221774704982d2938b30c1&amp;chksm=fd3eb9c1ca4930d76a391241333de461ca22d2aa27472eab3cffab1564872ae37f1b48fe2d3c&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我们在学习Flink的时候，到底在学习什么？</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504856&amp;idx=2&amp;sn=6f62e2a0c756ce56773eed253d2f41ee&amp;chksm=fd3e954dca491c5b732b7e2aa46db32efbc3f690e528522098659bb3c6e78e1582ab4529b5dc&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">193篇文章暴揍Flink，这个合集你需要关注一下</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504742&amp;idx=1&amp;sn=8765c198d8ad66219a7bcabb221e4a23&amp;chksm=fd3e95f3ca491ce52d0724b9e4154a47af0f5ea349e1e184c8fbc65aa17c0000242aa9b58429&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">Flink生产环境TOP难题与优化，阿里巴巴藏经阁YYDS</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504813&amp;idx=1&amp;sn=f5cd6ae2aa2b1e30f87a5ae55971c514&amp;chksm=fd3e9538ca491c2eb191677d070f2c7e4f1098eece00e256d6205b8a5d21b21c1e74f875f16f&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">Flink CDC我吃定了耶稣也留不住他！| Flink CDC线上问题小盘点</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=1&amp;sn=1f693e549f76622725b936041ff8896e&amp;chksm=e9bff2fbdec87bedecbdeed4547d7d612c72fc8d4918614a26a4e31666cf0128fd57b537f347&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我们在学习Spark的时候，到底在学习什么？</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504834&amp;idx=1&amp;sn=46ca1a3924b8fdb89ac1c2acb0319d6c&amp;chksm=fd3e9557ca491c41d837b917639ea62007ea16d3c2cc6c0c02d1f8a8c6e44318f5183b787c46&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;letter-spacing: 0.544px;">在所有Spark模块中，我愿称SparkSQL为最强！</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247502750&amp;idx=1&amp;sn=bd9a9173d060dc4e4ebd49c8efc6acfe&amp;chksm=fd3e8d0bca49041dea84da93910e5efdc4935e520525c09887c986691377aeb48e5cf7fb5667&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">硬刚Hive | 4万字基础调优面试小总结</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504382&amp;idx=2&amp;sn=550b78802acfe727e0e77cd9195f8784&amp;chksm=fd3e976bca491e7db2b8b2446d231736df01bbf13653804d680ac4390597ec17fa466ad4ae83&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">数据治理方法论和实践小百科全书</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503741&amp;idx=1&amp;sn=e5039be93123f2e337013756a818bfc3&amp;chksm=fd3e89e8ca4900fe603b63c5722a6fb8a32bd63d6ba23e0028851948a71b877eb1f742d95087&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">标签体系下的用户画像建设小指南</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247503675&amp;idx=1&amp;sn=3ee6af64d0126c78b48cad219308f81e&amp;chksm=fd3e89aeca4900b8b8954e9569ee3c0877881fac8c792bfafc22e7e9d3e8524da8eb860d33d8&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;">4万字长文 | ClickHouse基础&amp;实践&amp;调优全视角解析</a><br style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"  /></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI0NjU2NDkzMQ==&amp;mid=2247492567&amp;idx=2&amp;sn=57ecc77718f1b6f2f262d62e8318dcc9&amp;chksm=e9bff2fbdec87bedb1986765bfae7dbabb9aece45b0b2af147bbad1ac5d79ebc934c64df40ea&amp;scene=21#wechat_redirect" data-itemshowtype="11" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">【面试&amp;个人成长】2021年过半，社招和校招的经验之谈</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504478&amp;idx=1&amp;sn=14efef3868ba42bd044f9618745a7fdc&amp;chksm=fd3e94cbca491dddb961b7b8b93105b2869c5bcf4c03f9f0dc83ad62be0dce4c124b52ed0ba3&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">大数据方向另一个十年开启 |《硬刚系列》第一版完结</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);background-color: rgb(255, 255, 255);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504410&amp;idx=1&amp;sn=7e81ab5a324395eb0f12397c40247ca1&amp;chksm=fd3e948fca491d9946456acbd93b2d651ae4d7a7d0127a211981e08f50f377e60d1b7c0d7b3a&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">我写过的关于成长/面试/职场进阶的文章</a></section><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section powered-by="xiumi.us" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-role="outer" label="Powered by 135editor.com" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section data-tools="135编辑器" data-id="98469" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section hm_fix="349:393" style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;"><section style="margin: 0px;padding: 0px;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 13px;font-family: &quot;Helvetica Neue&quot;;letter-spacing: 0.544px;-webkit-text-stroke-color: rgb(136, 136, 136);text-align: left;color: rgb(136, 136, 136);line-height: 3em;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU3MzgwNTU2Mg==&amp;mid=2247504783&amp;idx=1&amp;sn=72aed147a459368ed934a007a2df3bc9&amp;chksm=fd3e951aca491c0cade212390011eca7d8a68951fee6aa2844b8f4d14bcbd5b3ed26305d69dc&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="margin: 0px;padding: 0px;color: rgb(87, 107, 149);text-decoration: none;max-width: 100%;overflow-wrap: break-word !important;box-sizing: border-box !important;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;">当我们在学习Hive的时候在学习什么？「硬刚Hive续集」</a></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><p style="display: none;"><mp-style-type data-value="3"></mp-style-type></p></content>
</div>
</body>
</html>