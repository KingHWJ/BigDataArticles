<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"大数据技术与数仓","title":"实时数仓|一文了解基于Flink1.12构建流批一体数仓的技术点","time":"2021-06-30 09:01:10","timeStamp":"1625014870"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&mid=2247486904&idx=2&sn=079b3a9de7e2b099effb32a38ac79c2a&chksm=fc8c1b1bcbfb920d5880134d5f94411bf4620f31d29824b2200c1ca1f560c13a7807a0c8bb97#rd" target="_blank">实时数仓|一文了解基于Flink1.12构建流批一体数仓的技术点</a></h1><div id="meta_content" class="rich_media_meta_list"><span id="copyright_logo" class="wx_tap_link js_wx_tap_highlight rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_text">西贝&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">大数据技术与数仓&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2021-06-30 09:01:10</em></div><content><div class="topic"><p>收录于话题</p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1502493234823020547#wechat_redirect" title="Hive" target="_blank">#Hive</a><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1337154238136549376#wechat_redirect" title="Flink" target="_blank">#Flink</a><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1344435576086560769#wechat_redirect" title="数仓" target="_blank">#数仓</a><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1502493234856574979#wechat_redirect" title="SQL" target="_blank">#SQL</a><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1512615869061906432#wechat_redirect" title="Kafka" target="_blank">#Kafka</a></p></div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px;color: black;padding-right: 10px;padding-left: 10px;line-height: 1.6;letter-spacing: 0px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;" data-mpa-powered-by="yiban.io"><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">基于Flink构建流批一体的实时数仓是目前数据仓库领域比较火的实践方案。随着Flink的不断迭代，其提供的一系列技术特性使得用户构建流批一体的应用变得越来越方便。本文将以Flink1.12为例，一一介绍这些特性的基本使用方式，主要包括以下内容：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Flink集成Hive</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hive Catalog与Hive Dialect</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Flink读写Hive</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Flink upsert-kafka连接器</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Flink CDC的connector</section><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><br  /></section></li><li><section class="mp_profile_iframe_wrp"><mpprofile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzU2ODQ3NjYyMA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsiaWUJ7uBrlIibLdUDlmsXrhE9b6ZXmFWGZFqzSQE7LFkL1XmLkmgAWibVYG7tpGyEjls5B0LWc8lkjg/0?wx_fmt=png" data-nickname="大数据技术与数仓" data-alias="bigdata_dw" data-signature="专注分享数据仓库与大数据技术(Flink/Hadoop/Spark/Hive)相关内容。关注我可以免费领取大数据书籍与视频。我的博客:https://jiamaoxiang.top/" data-from="0"></mpprofile></section></li></ul><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">尖叫提示：本文内容较长，建议收藏</p></blockquote><h1 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 24px;"><span style="display: none;"></span>Flink集成Hive</h1><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">使用Hive构建数据仓库已经成为了比较普遍的一种解决方案。目前，一些比较常见的大数据处理引擎，都无一例外兼容Hive。Flink从1.9开始支持集成Hive，不过1.9版本为beta版，不推荐在生产环境中使用。在Flink1.10版本中，标志着对 Blink的整合宣告完成，对 Hive 的集成也达到了生产级别的要求。值得注意的是，不同版本的Flink对于Hive的集成有所差异，本文将以最新的Flink1.12版本为例，阐述Flink集成Hive的简单步骤，以下是全文，希望对你有所帮助。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">Flink集成Hive的基本方式</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink 与 Hive 的集成主要体现在以下两个方面:</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">持久化元数据</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink利用 Hive 的 MetaStore 作为持久化的 Catalog，我们可通过<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">HiveCatalog</code>将不同会话中的 Flink 元数据存储到 Hive Metastore 中。例如，我们可以使用<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">HiveCatalog</code>将其 Kafka的数据源表存储在 Hive Metastore 中，这样该表的元数据信息会被持久化到Hive的MetaStore对应的元数据库中，在后续的 SQL 查询中，我们可以重复使用它们。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">利用 Flink 来读写 Hive 的表。</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink打通了与Hive的集成，如同使用SparkSQL或者Impala操作Hive中的数据一样，我们可以使用Flink直接读写Hive中的表。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">HiveCatalog</code>的设计提供了与 Hive 良好的兼容性，用户可以”开箱即用”的访问其已有的 Hive表。不需要修改现有的 Hive Metastore，也不需要更改表的数据位置或分区。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">Flink集成Hive的步骤</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>Flink支持的Hive版本<span style="display: none;"></span></h3><section data-tool="mdnice编辑器" style="overflow-x: auto;"><table style="width: 768px;"><thead><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(240, 240, 240);min-width: 85px;">大版本</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(240, 240, 240);min-width: 85px;">V1</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(240, 240, 240);min-width: 85px;">V2</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(240, 240, 240);min-width: 85px;">V3</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(240, 240, 240);min-width: 85px;">V4</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(240, 240, 240);min-width: 85px;">V5</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(240, 240, 240);min-width: 85px;">V6</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);text-align: left;background-color: rgb(240, 240, 240);min-width: 85px;">V7</th></tr></thead><tbody style="border-width: 0px;border-style: initial;border-color: initial;"><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.0.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.0.1</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.1</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.1.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.1.1</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.2</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.2.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.2.1</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.2.2</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.0.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.0.1</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.1</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.1.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.1.1</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.2</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.2.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.3</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.3.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.3.1</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.3.2</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.3.3</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.3.4</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.3.5</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.3.6</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">3.1</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">3.1.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">3.1.1</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">3.1.2</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><br  /></td></tr></tbody></table></section><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">值得注意的是，对于不同的Hive版本，可能在功能方面有所差异，这些差异取决于你使用的Hive版本，而不取决于Flink，一些版本的功能差异如下：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hive 内置函数在使用 Hive-1.2.0 及更高版本时支持。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">列约束，也就是 PRIMARY KEY 和 NOT NULL，在使用 Hive-3.1.0 及更高版本时支持。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">更改表的统计信息，在使用 Hive-1.2.0 及更高版本时支持。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">DATE</code>列统计信息，在使用 Hive-1.2.0 及更高版时支持。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">使用 Hive-2.0.x 版本时不支持写入 ORC 表。</section></li></ul><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>依赖项<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">本文以Flink1.12为例，集成的Hive版本为Hive2.3.4。集成Hive需要额外添加一些依赖jar包，并将其放置在Flink安装目录下的lib文件夹下，这样我们才能通过 Table API 或 SQL Client 与 Hive 进行交互。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">另外，Apache Hive 是基于 Hadoop 之上构建的, 所以还需要 Hadoop 的依赖，配置好HADOOP_CLASSPATH即可。这一点非常重要，否则在使用FlinkSQL Cli查询Hive中的表时，会报如下错误：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">java.lang.ClassNotFoundException:&nbsp;org.apache.hadoop.mapred.JobConf<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>配置HADOOP_CLASSPATH，需要在/etc/profile文件中配置如下的环境变量</strong>：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #0086b3;line-height: 26px;">export</span>&nbsp;HADOOP_CLASSPATH=`hadoop&nbsp;classpath`<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink官网提供了两种方式添加Hive的依赖项。第一种是使用 Flink 提供的 Hive Jar包(根据使用的 Metastore 的版本来选择对应的 Hive jar)，建议优先使用Flink提供的Hive jar包，这种方式比较简单方便。本文使用的就是此种方式。当然，如果你使用的Hive版本与Flink提供的Hive jar包兼容的版本不一致，你可以选择第二种方式，即别添加每个所需的 jar 包。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">下面列举了可用的jar包及其适用的Hive版本，我们可以根据使用的Hive版本，下载对应的jar包即可。比如本文使用的Hive版本为Hive2.3.4，所以只需要下载<strong>flink-sql-connector-hive-2.3.6</strong>即可，并将其放置在Flink安装目录的lib文件夹下。</p><section data-tool="mdnice编辑器" style="overflow-x: auto;"><table><thead><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: left;">Metastore version</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: left;">Maven dependency</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: left;">SQL Client JAR</th></tr></thead><tbody style="border-width: 0px;border-style: initial;border-color: initial;"><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">1.0.0 ~ 1.2.2</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><code>flink-sql-connector-hive-1.2.2</code></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Download</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.0.0 ~2.2.0</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><code>flink-sql-connector-hive-2.2.0</code></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Download</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">2.3.0 ~2.3.6</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><code>flink-sql-connector-hive-2.3.6</code></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Download</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">3.0.0 ~ 3.1.2</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;"><code>flink-sql-connector-hive-3.1.2</code></td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Download</td></tr></tbody></table></section><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">上面列举的jar包，是我们在使用Flink SQL Cli所需要的jar包，除此之外，根据不同的Hive版本，还需要添加如下jar包。以Hive2.3.4为例，除了上面的一个jar包之外，还需要添加下面两个jar包：</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>flink-connector-hive_2.11-1.12.0.jar</strong>和<strong>hive-exec-2.3.4.jar</strong>。其中<strong>hive-exec-2.3.4.jar</strong>包存在于Hive安装路径下的lib文件夹。<strong>flink-connector-hive_2.11-1.12.0.jar</strong>的下载地址为：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">https://repo1.maven.org/maven2/org/apache/flink/flink-connector-hive_2.11/1.12.0/<br  /></code></pre><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">NOTE:black_nib::Flink1.12集成Hive只需要添加如下三个jar包，以Hive2.3.4为例，分别为：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;"><strong>flink-sql-connector-hive-2.3.6</strong></p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;"><strong>flink-connector-hive_2.11-1.12.0.jar</strong></p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;"><strong>hive-exec-2.3.4.jar</strong></p></blockquote><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">Flink SQL Cli集成Hive</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">将上面的三个jar包添加至Flink的lib目录下之后，就可以使用Flink操作Hive的数据表了。以FlinkSQL Cli为例：</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>配置sql-client-defaults.yaml<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">该文件时Flink SQL Cli启动时使用的配置文件，该文件位于Flink安装目录的conf/文件夹下，具体的配置如下，主要是配置catalog：</p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.4186046511627907" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgm27Uk9BP0ZB83nzSPSbnCGyHZNyhyiayUAskKDOKJq3hic3ntsa9LdiaLXSer1QGkxjGUudBpXiaEWA/640?wx_fmt=png" data-type="png" data-w="1118" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">除了上面的一些配置参数，Flink还提供了下面的一些其他配置参数：</p><section data-tool="mdnice编辑器" style="overflow-x: auto;"><table><thead><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: left;">参数</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: center;">必选</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: center;">默认值</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: center;">类型</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: center;">描述</th></tr></thead><tbody style="border-width: 0px;border-style: initial;border-color: initial;"><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">type</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">是</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">(无)</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">String</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">Catalog 的类型。创建 HiveCatalog 时，该参数必须设置为<code>'hive'</code>。</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">name</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">是</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">(无)</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">String</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">Catalog 的名字。仅在使用 YAML file 时需要指定。</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">hive-conf-dir</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">否</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">(无)</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">String</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">指向包含 hive-site.xml 目录的 URI。该 URI 必须是 Hadoop 文件系统所支持的类型。如果指定一个相对 URI，即不包含 scheme，则默认为本地文件系统。如果该参数没有指定，我们会在 class path 下查找hive-site.xml。</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">default-database</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">否</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">default</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">String</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">当一个catalog被设为当前catalog时，所使用的默认当前database。</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">hive-version</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">否</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">(无)</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">String</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">HiveCatalog 能够自动检测使用的 Hive 版本。我们建议<strong>不要</strong>手动设置 Hive 版本，除非自动检测机制失败。</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">hadoop-conf-dir</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">否</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">(无)</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">String</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">Hadoop 配置文件目录的路径。目前仅支持本地文件系统路径。我们推荐使用 <strong>HADOOP_CONF_DIR</strong> 环境变量来指定 Hadoop 配置。因此仅在环境变量不满足您的需求时再考虑使用该参数，例如当您希望为每个 HiveCatalog 单独设置 Hadoop 配置时。</td></tr></tbody></table></section><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>操作Hive中的表<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">首先启动FlinkSQL Cli，命令如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">./bin/sql-client.sh&nbsp;embedded<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">接下来，我们可以查看注册的catalog</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;show&nbsp;catalogs;<br  />default_catalog<br  />myhive<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">使用注册的myhive catalog</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;use&nbsp;catalog&nbsp;myhive;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">假设Hive中有一张users表，在Hive中查询该表：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">hive&nbsp;(default)&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;*&nbsp;<span style="font-weight: bold;line-height: 26px;">from</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">users</span>;<br  />OK<br  />users.id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;users.mame<br  />1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jack<br  />2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tom<br  />3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robin<br  />4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;haha<br  />5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;haha<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">查看对应的数据库表，我们可以看到Hive中已经存在的表，这样就可以使用FlinkSQL操作Hive中的表，比如查询，写入数据。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;show&nbsp;tables;<br  />Flink&nbsp;SQL&gt;&nbsp;select&nbsp;*&nbsp;from&nbsp;users;<br  /></code></pre><p style="text-align: center;"><img class="rich_pages" data-ratio="0.2893081761006289" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgm27Uk9BP0ZB83nzSPSbnCYsSaw9fWMFm479M1BrRkwCeRzB1aBGGwreSkqoICzaTPRa47GbrBzQ/640?wx_fmt=png" data-type="png" data-w="795" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">向Hive表users中插入一条数据：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">insert</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">into</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">users</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;<span style="color: #008080;line-height: 26px;">6</span>,<span style="color: #d14;line-height: 26px;">'bob'</span>;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">再次使用Hive客户端去查询该表的数据，会发现写入了一条数据。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">接下来，我们再在FlinkSQL Cli中创建一张kafka的数据源表：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;user_behavior&nbsp;(&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`user_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`item_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;商品id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`cat_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;品类id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`action`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`province`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">INT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户所在的省份</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`ts`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为发生的时间戳</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`proctime`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;PROCTIME(),&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;通过计算列产生一个处理时间列</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`eventTime`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;TO_TIMESTAMP(FROM_UNIXTIME(ts,&nbsp;<span style="color: #d14;line-height: 26px;">'yyyy-MM-dd&nbsp;HH:mm:ss'</span>)),&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;事件时间</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WATERMARK&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;eventTime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;eventTime&nbsp;-&nbsp;<span style="color: #0086b3;line-height: 26px;">INTERVAL</span>&nbsp;<span style="color: #d14;line-height: 26px;">'5'</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">SECOND</span>&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;定义watermark</span><br  />&nbsp;)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用&nbsp;kafka&nbsp;connector</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'user_behavior'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka主题</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'scan.startup.mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'earliest-offset'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;偏移量</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.group.id'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'group1'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;消费者组</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:9092,kms-3:9092,kms-4:9092'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;数据源格式为json</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.fail-on-missing-field'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.ignore-parse-errors'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'false'</span><br  />);<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">查看表结构</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">DESCRIBE</span>&nbsp;user_behavior;<br  /></code></pre><p style="text-align: center;"><img class="rich_pages" data-ratio="0.17921935129191863" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgm27Uk9BP0ZB83nzSPSbnCNj961KcIWmtEaHdq7biaArNt7weQCm45TaTBibByUKXynKLicAIUr0oxw/640?wx_fmt=png" data-type="png" data-w="1819" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">我们可以在Hive的客户端中执行下面命令查看刚刚在Flink SQLCli中创建的表</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">hive&nbsp;(default)&gt;&nbsp;desc&nbsp;formatted&nbsp;&nbsp;user_behavior;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">#&nbsp;Detailed&nbsp;Table&nbsp;Information&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br  />Database:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Owner:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />CreateTime:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sun&nbsp;Dec&nbsp;20&nbsp;16:04:59&nbsp;CST&nbsp;2020&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />LastAccessTime:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;UNKNOWN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Retention:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Location:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://kms-1.apache.com:8020/user/hive/warehouse/user_behavior&nbsp;&nbsp;&nbsp;<br  />Table&nbsp;Type:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MANAGED_TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Table&nbsp;Parameters:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.connector&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kafka&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.format&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.json.fail-on-missing-field&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.json.ignore-parse-errors&nbsp;&nbsp;false&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.properties.bootstrap.servers&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kms-2:9092,kms-3:9092,kms-4:9092<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.properties.group.id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.scan.startup.mode&nbsp;earliest-offset&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.0.data-type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BIGINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.0.name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.1.data-type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BIGINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.1.name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.2.data-type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BIGINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.2.name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.3.data-type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VARCHAR(2147483647)&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.3.name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.4.data-type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.4.name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;province&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.5.data-type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BIGINT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.5.name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ts&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.6.data-type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIMESTAMP(3)&nbsp;NOT&nbsp;NULL<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.6.expr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PROCTIME()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.6.name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;proctime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.7.data-type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIMESTAMP(3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.7.expr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TO_TIMESTAMP(FROM_UNIXTIME(`ts`,&nbsp;'yyyy-MM-dd&nbsp;HH:mm:ss'))<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.7.name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eventTime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.watermark.0.rowtime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eventTime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.watermark.0.strategy.data-type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TIMESTAMP(3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.schema.watermark.0.strategy.expr&nbsp;&nbsp;`eventTime`&nbsp;-&nbsp;INTERVAL&nbsp;'5'&nbsp;SECOND<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flink.topic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_behavior&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_generic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transient_lastDdlTime&nbsp;&nbsp;&nbsp;1608451499&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">#&nbsp;Storage&nbsp;Information&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br  />SerDe&nbsp;Library:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />InputFormat:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.apache.hadoop.mapred.TextInputFormat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />OutputFormat:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat&nbsp;&nbsp;&nbsp;<br  />Compressed:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;No&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Num&nbsp;Buckets:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Bucket&nbsp;Columns:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Sort&nbsp;Columns:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Storage&nbsp;Desc&nbsp;Params:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serialization.format&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /></code></pre><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">NOTE:black_flag::在Flink中创建一张表，会把该表的元数据信息持久化到Hive的metastore中，我们可以在Hive的metastore中查看该表的元数据信息</p></blockquote><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">进入Hive的元数据信息库，本文使用的是MySQL。执行下面的命令：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;a.tbl_id,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;表id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;from_unixtime(create_time)&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;create_time,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;创建时间</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;a.db_id,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;数据库id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;b.name&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;db_name,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;数据库名称</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;a.tbl_name&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;表名称</span><br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;TBLS&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;a<br  /><span style="font-weight: bold;line-height: 26px;">LEFT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">JOIN</span>&nbsp;DBS&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;b&nbsp;<span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;a.db_id&nbsp;=b.db_id<br  /><span style="font-weight: bold;line-height: 26px;">WHERE</span>&nbsp;a.tbl_name&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">"user_behavior"</span>;<br  /></code><p style="text-align: center;"><img class="rich_pages" data-ratio="0.3888888888888889" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgm27Uk9BP0ZB83nzSPSbnC5ICHAebQhQguSicmvstMQVNROfGLdwg4icXnXxNhwlXpxBtqV2IUS3Xg/640?wx_fmt=png" data-type="png" data-w="1062" style=""  /></p></pre><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">使用代码连接到 Hive</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>maven依赖<span style="display: none;"></span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">&lt;!--&nbsp;Flink&nbsp;Dependency&nbsp;--&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">dependency</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">groupId</span>&gt;</span>org.apache.flink<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">groupId</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">artifactId</span>&gt;</span>flink-connector-hive_2.11<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">artifactId</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">version</span>&gt;</span>1.12.0<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">version</span>&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">dependency</span>&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">dependency</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">groupId</span>&gt;</span>org.apache.flink<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">groupId</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">artifactId</span>&gt;</span>flink-table-api-java-bridge_2.11<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">artifactId</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">version</span>&gt;</span>1.12.0<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">version</span>&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">dependency</span>&gt;</span><br  /><span style="color: #998;font-style: italic;line-height: 26px;">&lt;!--&nbsp;Hive&nbsp;Dependency&nbsp;--&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">dependency</span>&gt;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">groupId</span>&gt;</span>org.apache.hive<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">groupId</span>&gt;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">artifactId</span>&gt;</span>hive-exec<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">artifactId</span>&gt;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">version</span>&gt;</span>2.3.4<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">version</span>&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">dependency</span>&gt;</span><br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>代码<span style="display: none;"></span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">public</span>&nbsp;<span style="line-height: 26px;"><span style="font-weight: bold;line-height: 26px;">class</span>&nbsp;<span style="color: #458;font-weight: bold;line-height: 26px;">HiveIntegrationDemo</span>&nbsp;</span>{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="line-height: 26px;"><span style="font-weight: bold;line-height: 26px;">public</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">static</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">void</span>&nbsp;<span style="color: #900;font-weight: bold;line-height: 26px;">main</span><span style="line-height: 26px;">(String[]&nbsp;args)</span>&nbsp;</span>{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnvironmentSettings&nbsp;settings&nbsp;=&nbsp;EnvironmentSettings.newInstance().useBlinkPlanner().build();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TableEnvironment&nbsp;tableEnv&nbsp;=&nbsp;TableEnvironment.create(settings);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">"myhive"</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultDatabase&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">"default"</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;hiveConfDir&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">"/opt/modules/apache-hive-2.3.4-bin/conf"</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HiveCatalog&nbsp;hive&nbsp;=&nbsp;<span style="font-weight: bold;line-height: 26px;">new</span>&nbsp;HiveCatalog(name,&nbsp;defaultDatabase,&nbsp;hiveConfDir);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableEnv.registerCatalog(<span style="color: #d14;line-height: 26px;">"myhive"</span>,&nbsp;hive);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">//&nbsp;使用注册的catalog</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableEnv.useCatalog(<span style="color: #d14;line-height: 26px;">"myhive"</span>);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">//&nbsp;向Hive表中写入一条数据&nbsp;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;insertSQL&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">"insert&nbsp;into&nbsp;users&nbsp;select&nbsp;10,'lihua'"</span>;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TableResult&nbsp;result2&nbsp;=&nbsp;tableEnv.executeSql(insertSQL);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(result2.getJobClient().get().getJobStatus());<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;}<br  />}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">提交程序，观察Hive表的变化：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">bin/flink&nbsp;run&nbsp;-m&nbsp;kms-1:8081&nbsp;\<br  />-c&nbsp;com.flink.sql.hiveintegration.HiveIntegrationDemo&nbsp;\<br  />./original-study-flink-sql-1.0-SNAPSHOT.jar<br  /></code></pre><h1 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 24px;"><span style="display: none;"></span>Hive Catalog与Hive Dialect</h1></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px;color: black;padding-right: 10px;padding-left: 10px;line-height: 1.6;letter-spacing: 0px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;"><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">什么是Hive Catalog</span></h2></section><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px;color: black;padding-right: 10px;padding-left: 10px;line-height: 1.6;letter-spacing: 0px;word-break: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;"><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">我们知道，Hive使用Hive Metastore(HMS)存储元数据信息，使用关系型数据库来持久化存储这些信息。所以，Flink集成Hive需要打通Hive的metastore，去管理Flink的元数据，这就是Hive Catalog的功能。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Hive Catalog的主要作用是使用Hive MetaStore去管理Flink的元数据。Hive Catalog可以将元数据进行持久化，这样后续的操作就可以反复使用这些表的元数据，而不用每次使用时都要重新注册。如果不去持久化catalog，那么在每个session中取处理数据，都要去重复地创建元数据对象，这样是非常耗时的。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">如何使用Hive Catalog</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">HiveCatalog是开箱即用的，所以，一旦配置好Flink与Hive集成，就可以使用HiveCatalog。比如，我们通过FlinkSQL 的DDL语句创建一张kafka的数据源表，立刻就能查看该表的元数据信息。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">HiveCatalog可以处理两种类型的表：一种是Hive兼容的表，另一种是普通表(generic table)。其中Hive兼容表是以兼容Hive的方式来存储的，所以，对于Hive兼容表而言，我们既可以使用Flink去操作该表，又可以使用Hive去操作该表。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">普通表是对Flink而言的，当使用HiveCatalog创建一张普通表，仅仅是使用Hive MetaStore将其元数据进行了持久化，所以可以通过Hive查看这些表的元数据信息(通过DESCRIBE FORMATTED命令)，但是不能通过Hive去处理这些表，因为语法不兼容。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">对于是否是普通表，Flink使用<strong>is_generic</strong>属性进行标识。默认情况下，创建的表是普通表，即<strong>is_generic=true</strong>，如果要创建Hive兼容表，需要在建表属性中指定<strong>is_generic=false</strong>。</p><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">尖叫提示：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">由于依赖Hive Metastore，所以必须开启Hive MetaStore服务</p></blockquote><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>代码中使用Hive Catalog<span style="display: none;"></span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">&nbsp;&nbsp;&nbsp;EnvironmentSettings&nbsp;settings&nbsp;=&nbsp;EnvironmentSettings.newInstance().useBlinkPlanner().build();<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TableEnvironment&nbsp;tableEnv&nbsp;=&nbsp;TableEnvironment.create(settings);<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">"myhive"</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;defaultDatabase&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">"default"</span>;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;hiveConfDir&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">"/opt/modules/apache-hive-2.3.4-bin/conf"</span>;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HiveCatalog&nbsp;hive&nbsp;=&nbsp;<span style="font-weight: bold;line-height: 26px;">new</span>&nbsp;HiveCatalog(name,&nbsp;defaultDatabase,&nbsp;hiveConfDir);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableEnv.registerCatalog(<span style="color: #d14;line-height: 26px;">"myhive"</span>,&nbsp;hive);<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">//&nbsp;使用注册的catalog</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tableEnv.useCatalog(<span style="color: #d14;line-height: 26px;">"myhive"</span>);<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>Flink SQLCli中使用Hive Catalog<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在FlinkSQL Cli中使用Hive Catalog很简单，只需要配置一下sql-cli-defaults.yaml文件即可。配置内容如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">catalogs:<br  />&nbsp;&nbsp;&nbsp;-&nbsp;name:&nbsp;myhive<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">type</span>:&nbsp;hive<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default-database:&nbsp;default<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hive-conf-dir:&nbsp;/opt/modules/apache-hive-2.3.4-bin/conf<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在FlinkSQL Cli中创建一张kafka表，该表默认为普通表，即is_generic=true</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;user_behavior&nbsp;(&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`user_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`item_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;商品id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`cat_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;品类id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`action`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`province`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">INT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户所在的省份</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`ts`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为发生的时间戳</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`proctime`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;PROCTIME(),&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;通过计算列产生一个处理时间列</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`eventTime`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;TO_TIMESTAMP(FROM_UNIXTIME(ts,&nbsp;<span style="color: #d14;line-height: 26px;">'yyyy-MM-dd&nbsp;HH:mm:ss'</span>)),&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;事件时间</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WATERMARK&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;eventTime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;eventTime&nbsp;-&nbsp;<span style="color: #0086b3;line-height: 26px;">INTERVAL</span>&nbsp;<span style="color: #d14;line-height: 26px;">'5'</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">SECOND</span>&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;定义watermark</span><br  />&nbsp;)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用&nbsp;kafka&nbsp;connector</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'user_behavior'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka主题</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'scan.startup.mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'earliest-offset'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;偏移量</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.group.id'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'group1'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;消费者组</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:9092,kms-3:9092,kms-4:9092'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;数据源格式为json</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.fail-on-missing-field'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.ignore-parse-errors'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'false'</span><br  />);<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">我们可以在Hive客户端中查看该表的元数据信息</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">hive&nbsp;(default)&gt;&nbsp;desc&nbsp;formatted&nbsp;&nbsp;user_behavior;<br  />Table&nbsp;Parameters:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_generic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">从上面的元数据信息可以看出，is_generic=true，说明该表是一张普通表，如果在Hive中去查看该表，则会报错。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">上面创建的表是普通表，该表不能使用Hive去查询。那么，该如何创建一张Hive兼容表呢？我们只需要在建表的属性中显示指定<strong>is_generic=false</strong>即可，具体如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;hive_compatible_tbl&nbsp;(&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`user_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`item_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;商品id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`cat_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;品类id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`action`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`province`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">INT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户所在的省份</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`ts`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为发生的时间戳</span><br  />&nbsp;)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用&nbsp;kafka&nbsp;connector</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'user_behavior'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka主题</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'scan.startup.mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'earliest-offset'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;偏移量</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.group.id'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'group1'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;消费者组</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:9092,kms-3:9092,kms-4:9092'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;数据源格式为json</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.fail-on-missing-field'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.ignore-parse-errors'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'false'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'is_generic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'false'</span><br  />);<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">当我们在Hive中查看该表的元数据信息时，可以看出：<strong>is_generic =false</strong></p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">hive&nbsp;(default)&gt;&nbsp;desc&nbsp;formatted&nbsp;hive_compatible_tbl;<br  />Table&nbsp;Parameters:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_generic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">我们可以使用FlinkSQL Cli或者HiveCli向该表中写入数据，然后分别通过FlinkSQL Cli和Hive Cli去查看该表数据的变化</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">hive&nbsp;(default)&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">insert</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">into</span>&nbsp;hive_compatible_tbl&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;<span style="color: #008080;line-height: 26px;">2020</span>,<span style="color: #008080;line-height: 26px;">1221</span>,<span style="color: #008080;line-height: 26px;">100</span>,<span style="color: #d14;line-height: 26px;">'buy'</span>,<span style="color: #008080;line-height: 26px;">11</span>,<span style="color: #008080;line-height: 26px;">1574330486</span>;<br  />hive&nbsp;(default)&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;*&nbsp;<span style="font-weight: bold;line-height: 26px;">from</span>&nbsp;hive_compatible_tbl;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">再在FlinkSQL Cli中查看该表，</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;user_id,item_id,<span style="font-weight: bold;line-height: 26px;">action</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">from</span>&nbsp;hive_compatible_tbl;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2020&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1221&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buy<br  />&nbsp;&nbsp;&nbsp;&nbsp;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">同样，我们可以在FlinkSQL Cli中去向该表中写入数据：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">insert</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">into</span>&nbsp;hive_compatible_tbl&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;<span style="color: #008080;line-height: 26px;">2020</span>,<span style="color: #008080;line-height: 26px;">1222</span>,<span style="color: #008080;line-height: 26px;">101</span>,<span style="color: #d14;line-height: 26px;">'fav'</span>,<span style="color: #008080;line-height: 26px;">11</span>,<span style="color: #008080;line-height: 26px;">1574330486</span>;<br  />Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;user_id,item_id,<span style="font-weight: bold;line-height: 26px;">action</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">from</span>&nbsp;hive_compatible_tbl;<br  /><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;item_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;action<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2020&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1221&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buy<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2020&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1222&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fav<br  /></code></pre><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">尖叫提示：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">对于Hive兼容的表，需要注意数据类型，具体的数据类型对应关系以及注意点如下</p></blockquote><section data-tool="mdnice编辑器" style="overflow-x: auto;"><table><thead><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: center;">Flink 数据类型</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: center;">Hive 数据类型</th></tr></thead><tbody style="border-width: 0px;border-style: initial;border-color: initial;"><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">CHAR(p)</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">CHAR(p)</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">VARCHAR(p)</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">VARCHAR(p)</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">STRING</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">STRING</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">BOOLEAN</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">BOOLEAN</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">TINYINT</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">TINYINT</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">SMALLINT</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">SMALLINT</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">INT</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">INT</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">BIGINT</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">LONG</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">FLOAT</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">FLOAT</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">DOUBLE</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">DOUBLE</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">DECIMAL(p, s)</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">DECIMAL(p, s)</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">DATE</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">DATE</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">TIMESTAMP(9)</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">TIMESTAMP</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">BYTES</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">BINARY</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">ARRAY</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">LIST</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">MAP&lt;K, V&gt;</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">MAP&lt;K, V&gt;</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">ROW</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;text-align: center;">STRUCT</td></tr></tbody></table></section><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>注意</strong>：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hive <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">CHAR(p)</code> 类型的最大长度为255</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hive <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">VARCHAR(p)</code>类型的最大长度为65535</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hive <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">MAP</code>类型的key仅支持基本类型，而Flink’s <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">MAP</code> 类型的key执行任意类型</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hive不支持联合数据类型，比如STRUCT</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hive’s <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">TIMESTAMP</code> 的精度是 9 ， Hive UDFs函数只能处理 precision &lt;= 9的 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">TIMESTAMP</code> 值</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hive 不支持 Flink提供的 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">TIMESTAMP_WITH_TIME_ZONE</code>, <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">TIMESTAMP_WITH_LOCAL_TIME_ZONE</code>, 及<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">MULTISET</code>类型</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Flink<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">INTERVAL</code> 类型与 Hive <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">INTERVAL</code> 类型不一样</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">上面介绍了普通表和Hive兼容表，那么我们该如何使用Hive的语法进行建表呢？这个时候就需要使用<strong>Hive Dialect</strong>。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">什么是Hive Dialect</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">从Flink1.11.0开始，只要开启了Hive dialect配置，用户就可以使用HiveQL语法，这样我们就可以在Flink中使用Hive的语法使用一些DDL和DML操作。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink目前支持两种SQL方言(SQL dialects),分别为：<strong>default和hive</strong>。默认的SQL方言是<strong>default</strong>，如果要使用Hive的语法，需要将SQL方言切换到<strong>hive</strong>。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">如何使用Hive Dialect</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>在SQL Cli中使用Hive dialect<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">使用hive dialect只需要配置一个参数即可，该参数名称为：<strong>table.sql-dialect</strong>。我们就可以在sql-client-defaults.yaml配置文件中进行配置，也可以在具体的会话窗口中进行设定，对于SQL dialect的切换，不需要进行重启session。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="line-height: 26px;">execution:</span><br  />&nbsp;&nbsp;<span style="line-height: 26px;">planner:</span>&nbsp;<span style="color: #d14;line-height: 26px;">blink</span><br  />&nbsp;&nbsp;<span style="line-height: 26px;">type:</span>&nbsp;<span style="color: #d14;line-height: 26px;">batch</span><br  />&nbsp;&nbsp;<span style="line-height: 26px;">result-mode:</span>&nbsp;<span style="color: #d14;line-height: 26px;">table</span><br  /><br  /><span style="line-height: 26px;">configuration:</span><br  />&nbsp;&nbsp;<span style="line-height: 26px;">table.sql-dialect:</span>&nbsp;<span style="color: #d14;line-height: 26px;">hive</span><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果我们需要在SQL Cli中进行切换hive dialect，可以使用如下命令：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">set</span>&nbsp;table.sql-dialect=hive;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用hive&nbsp;dialect</span><br  />Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">set</span>&nbsp;table.sql-dialect=<span style="font-weight: bold;line-height: 26px;">default</span>;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用default&nbsp;dialect</span><br  /></code></pre><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">尖叫提示：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">一旦切换到了hive dialect，就只能使用Hive的语法建表，如果尝试使用Flink的语法建表，则会报错</p></blockquote><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>在Table API中配合dialect<span style="display: none;"></span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">EnvironmentSettings&nbsp;settings&nbsp;=&nbsp;EnvironmentSettings.newInstance().useBlinkPlanner()...build();<br  />TableEnvironment&nbsp;tableEnv&nbsp;=&nbsp;TableEnvironment.create(settings);<br  /><span style="color: #998;font-style: italic;line-height: 26px;">//&nbsp;使用hive&nbsp;dialect</span><br  />tableEnv.getConfig().setSqlDialect(SqlDialect.HIVE);<br  /><span style="color: #998;font-style: italic;line-height: 26px;">//&nbsp;使用&nbsp;default&nbsp;dialect</span><br  />tableEnv.getConfig().setSqlDialect(SqlDialect.DEFAULT);<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>操作示例<span style="display: none;"></span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">set</span>&nbsp;table.sql-dialect=hive;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用Hive语法创建一张表</span><br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">IF</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">NOT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">EXISTS</span>&nbsp;<span style="color: #d14;line-height: 26px;">`hive_dialect_tbl`</span>&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">int</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'id'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`name`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">string</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'名称'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`age`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">int</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'年龄'</span>&nbsp;<br  />)<br  /><span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'hive&nbsp;dialect表测试'</span><br  /><span style="font-weight: bold;line-height: 26px;">ROW</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">FORMAT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">DELIMITED</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">FIELDS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TERMINATED</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;<span style="color: #d14;line-height: 26px;">','</span>;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">进入Hive客户端去查看该表的元数据信息</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">desc&nbsp;formatted&nbsp;hive_dialect_tbl;<br  />col_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">comment</span><br  /><span style="color: #998;font-style: italic;line-height: 26px;">#&nbsp;col_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comment&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />age&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">#&nbsp;Detailed&nbsp;Table&nbsp;Information&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br  /><span style="font-weight: bold;line-height: 26px;">Database</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">default</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Owner:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008080;line-height: 26px;">null</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />CreateTime:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mon&nbsp;<span style="color: #0086b3;line-height: 26px;">Dec</span>&nbsp;<span style="color: #008080;line-height: 26px;">21</span>&nbsp;<span style="color: #008080;line-height: 26px;">17</span>:<span style="color: #008080;line-height: 26px;">23</span>:<span style="color: #008080;line-height: 26px;">48</span>&nbsp;CST&nbsp;<span style="color: #008080;line-height: 26px;">2020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />LastAccessTime:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008080;line-height: 26px;">UNKNOWN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">Retention</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008080;line-height: 26px;">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Location:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://kms<span style="color: #008080;line-height: 26px;">-1.</span>apache.com:<span style="color: #008080;line-height: 26px;">8020</span>/<span style="font-weight: bold;line-height: 26px;">user</span>/hive/warehouse/hive_dialect_tbl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">Table</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">Type</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MANAGED_TABLE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">Table</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">Parameters</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hive&nbsp;dialect表测试&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is_generic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008080;line-height: 26px;">false</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transient_lastDdlTime&nbsp;&nbsp;&nbsp;<span style="color: #008080;line-height: 26px;">1608542628</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">#&nbsp;Storage&nbsp;Information&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br  />SerDe&nbsp;<span style="font-weight: bold;line-height: 26px;">Library</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />InputFormat:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.apache.hadoop.mapred.TextInputFormat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />OutputFormat:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat&nbsp;&nbsp;&nbsp;<br  />Compressed:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">No</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">Num</span>&nbsp;Buckets:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008080;line-height: 26px;">-1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">Bucket</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">Columns</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">Sort</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">Columns</span>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">Storage</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">Desc</span>&nbsp;Params:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field.delim&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serialization.format&nbsp;&nbsp;&nbsp;&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">很明显，该表是一张Hive兼容表，即<strong>is_generic=false</strong>。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">使用FlinkSQLCli向该表中写入一条数据：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">insert</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">into</span>&nbsp;hive_dialect_tbl&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;<span style="color: #008080;line-height: 26px;">1</span>,<span style="color: #d14;line-height: 26px;">'tom'</span>,<span style="color: #008080;line-height: 26px;">20</span>;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">我们也可以在Hive的Cli中去操作该表</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">hive&nbsp;(default)&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;*&nbsp;<span style="font-weight: bold;line-height: 26px;">from</span>&nbsp;hive_dialect_tbl;<br  />hive&nbsp;(default)&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">insert</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">into</span>&nbsp;hive_dialect_tbl&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;<span style="color: #008080;line-height: 26px;">2</span>,<span style="color: #d14;line-height: 26px;">'jack'</span>,<span style="color: #008080;line-height: 26px;">22</span>;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">以下是使用Hive方言的一些注意事项。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hive dialect只能用于操作Hive表，不能用于普通表。Hive方言应与HiveCatalog一起使用。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">虽然所有Hive版本都支持相同的语法，但是是否有特定功能仍然取决于使用的Hive版本。例如，仅在Hive-2.4.0或更高版本中支持更新数据库位置。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hive和Calcite具有不同的保留关键字。例如，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">default</code>在Calcite中是保留关键字，在Hive中是非保留关键字。所以，在使用Hive dialect时，必须使用反引号（`）引用此类关键字，才能将其用作标识符。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">在Hive中不能查询在Flink中创建的视图。</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">当然，一旦开启了Hive dialect，我们就可以按照Hive的操作方式在Flink中去处理Hive的数据了，具体的操作与Hive一致，本文不再赘述。</p><h1 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 24px;"><span style="display: none;"></span>Flink读写Hive</h1><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">Flink写入Hive表</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink支持以**批处理(Batch)和流处理(Streaming)**的方式写入Hive表。当以批处理的方式写入Hive表时，只有当写入作业结束时，才可以看到写入的数据。<strong>批处理的方式写入支持append模式和overwrite模式</strong>。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>批处理模式写入<span style="display: none;"></span></h3><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">向非分区表写入数据</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">use</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">catalog</span>&nbsp;myhive;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用catalog</span><br  />Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">users</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<span style="color: #008080;line-height: 26px;">2</span>,<span style="color: #d14;line-height: 26px;">'tom'</span>;<br  />Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">set</span>&nbsp;execution.type=batch;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用批处理模式</span><br  />Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;OVERWRITE&nbsp;<span style="font-weight: bold;line-height: 26px;">users</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<span style="color: #008080;line-height: 26px;">2</span>,<span style="color: #d14;line-height: 26px;">'tom'</span>;<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">向分区表写入数据</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;向静态分区表写入数据</span><br  />Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;OVERWRITE&nbsp;myparttable&nbsp;<span style="font-weight: bold;line-height: 26px;">PARTITION</span>&nbsp;(my_type=<span style="color: #d14;line-height: 26px;">'type_1'</span>,&nbsp;my_date=<span style="color: #d14;line-height: 26px;">'2019-08-08'</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'Tom'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">25</span>;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;向动态分区表写入数据</span><br  />Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;OVERWRITE&nbsp;myparttable&nbsp;<span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'Tom'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">25</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'type_1'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2019-08-08'</span>;<br  /><br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>流处理模式写入<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">流式写入Hive表，不支持**Insert overwrite **方式，否则报如下错误：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">[ERROR]&nbsp;Could&nbsp;not&nbsp;execute&nbsp;SQL&nbsp;statement.&nbsp;Reason:<br  />java.lang.IllegalStateException:&nbsp;Streaming&nbsp;mode&nbsp;not&nbsp;support&nbsp;overwrite.<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">下面的示例是将kafka的数据流式写入Hive的分区表</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用流处理模式</span><br  />Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">set</span>&nbsp;execution.type=streaming;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用Hive方言</span><br  />Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;table.sql-dialect=hive;&nbsp;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;创建一张Hive分区表</span><br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;user_behavior_hive_tbl&nbsp;(<br  />&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`user_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`item_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;商品id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`cat_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;品类id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`action`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`province`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">INT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户所在的省份</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`ts`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为发生的时间戳</span><br  />)&nbsp;PARTITIONED&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;(dt&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,hr&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,mi&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">STORED</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;parquet&nbsp;&nbsp;TBLPROPERTIES&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'partition.time-extractor.timestamp-pattern'</span>=<span style="color: #d14;line-height: 26px;">'$dt&nbsp;$hr:$mi:00'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'sink.partition-commit.trigger'</span>=<span style="color: #d14;line-height: 26px;">'partition-time'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'sink.partition-commit.delay'</span>=<span style="color: #d14;line-height: 26px;">'0S'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'sink.partition-commit.policy.kind'</span>=<span style="color: #d14;line-height: 26px;">'metastore,success-file'</span><br  />);<br  /><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用默认SQL方言</span><br  />Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;table.sql-dialect=<span style="font-weight: bold;line-height: 26px;">default</span>;&nbsp;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;创建一张kafka数据源表</span><br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;user_behavior&nbsp;(&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`user_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`item_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;商品id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`cat_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;品类id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`action`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`province`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">INT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户所在的省份</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`ts`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为发生的时间戳</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`proctime`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;PROCTIME(),&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;通过计算列产生一个处理时间列</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`eventTime`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;TO_TIMESTAMP(FROM_UNIXTIME(ts,&nbsp;<span style="color: #d14;line-height: 26px;">'yyyy-MM-dd&nbsp;HH:mm:ss'</span>)),&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;事件时间</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WATERMARK&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;eventTime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;eventTime&nbsp;-&nbsp;<span style="color: #0086b3;line-height: 26px;">INTERVAL</span>&nbsp;<span style="color: #d14;line-height: 26px;">'5'</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">SECOND</span>&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;定义watermark</span><br  />&nbsp;)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用&nbsp;kafka&nbsp;connector</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'user_behaviors'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka主题</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'scan.startup.mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'earliest-offset'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;偏移量</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.group.id'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'group1'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;消费者组</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:9092,kms-3:9092,kms-4:9092'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;数据源格式为json</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.fail-on-missing-field'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.ignore-parse-errors'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'false'</span><br  />);<br  /><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">关于Hive表的一些属性解释：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>partition.time-extractor.timestamp-pattern</strong></p></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">默认值：(none)</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">解释：分区时间抽取器，与 DDL 中的分区字段保持一致,如果是按天分区，则可以是**<span style="cursor:pointer;"><span role="presentation" data-formula="dt**，如果是按年(year)月(month)日(day)时(hour)进行分区，则该属性值为：" data-formula-type="inline-equation" style=""><embed style="vertical-align: -0.566ex;width: 83.334ex;height: auto;" src="https://mmbiz.qlogo.cn/mmbiz_svg/4h0Uv4XOMvNL0Z4bn9IXAjShicfv4csM5R52nzoQBbicusiaDu1RA2IyunFtkrzazVgXdwZpbHexuvYz6oxxoZt3dquhaibuSr4G/0?wx_fmt=svg" data-type="svg+xml"></embed></span></span>year-<span style="cursor:pointer;"><span role="presentation" data-formula="month-" data-formula-type="inline-equation" style=""><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -694 3678 776" aria-hidden="true" style="vertical-align: -0.186ex;width: 8.321ex;height: 1.756ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(878, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1363, 0)"><path data-c="6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1963, 0)"><path data-c="74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(2324, 0)"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mo" transform="translate(2900, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g></g></g></svg></span></span>day <span style="cursor:pointer;"><span role="presentation" data-formula="hour:00:00" data-formula-type="inline-equation" style=""><svg xmlns="http://www.w3.org/2000/svg" role="img" focusable="false" viewbox="0 -750 24572.8 950" aria-hidden="true" style="vertical-align: -0.452ex;width: 55.595ex;height: 2.149ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="68" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"></path></g><g data-mml-node="mi" transform="translate(576, 0)"><path data-c="6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1061, 0)"><path data-c="75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1633, 0)"><path data-c="72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(2361.8, 0)"><path data-c="3A" d="M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mn" transform="translate(2917.6, 0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(4195.3, 0)"><path data-c="3A" d="M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mn" transform="translate(4751.1, 0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(5751.1, 0)"><path data-c="2018" d="M64 494Q64 548 86 597T131 670T160 694Q163 694 172 685T182 672Q182 669 170 656T144 625T116 573T101 501Q101 489 102 489T107 491T120 497T138 500Q163 500 180 483T198 440T181 397T139 379Q110 379 87 405T64 494Z"></path></g><g data-mml-node="mo" transform="translate(6029.1, 0)"><text data-variant="normal" transform="matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">，</text><text data-variant="normal" transform="translate(946.7, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">如</text><text data-variant="normal" transform="translate(1893.5, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">果</text><text data-variant="normal" transform="translate(2840.2, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">是</text><text data-variant="normal" transform="translate(3786.9, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">按</text><text data-variant="normal" transform="translate(4733.7, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">天</text><text data-variant="normal" transform="translate(5680.4, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">时</text><text data-variant="normal" transform="translate(6627.1, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">进</text><text data-variant="normal" transform="translate(7573.9, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">行</text><text data-variant="normal" transform="translate(8520.6, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">分</text><text data-variant="normal" transform="translate(9467.3, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">区</text><text data-variant="normal" transform="translate(10414.1, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">，</text><text data-variant="normal" transform="translate(11360.8, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">则</text><text data-variant="normal" transform="translate(12307.5, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">该</text><text data-variant="normal" transform="translate(13254.3, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">属</text><text data-variant="normal" transform="translate(14201, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">性</text><text data-variant="normal" transform="translate(15147.8, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">值</text><text data-variant="normal" transform="translate(16094.5, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">为</text><text data-variant="normal" transform="translate(17041.2, 0) matrix(1 0 0 -1 0 0)" font-size="947.1px" font-family="serif">：</text></g><g data-mml-node="mo" transform="translate(24294.8, 0)"><path data-c="2018" d="M64 494Q64 548 86 597T131 670T160 694Q163 694 172 685T182 672Q182 669 170 656T144 625T116 573T101 501Q101 489 102 489T107 491T120 497T138 500Q163 500 180 483T198 440T181 397T139 379Q110 379 87 405T64 494Z"></path></g></g></g></svg></span></span>dt $hour:00:00`;</section></li></ul><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>sink.partition-commit.trigger</strong></p></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">process-time</strong>：不需要时间提取器和水位线，当当前时间大于分区创建时间 + sink.partition-commit.delay 中定义的时间，提交分区；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">partition-time</strong>：需要 Source 表中定义 watermark，当 watermark &gt; 提取到的分区时间 +sink.partition-commit.delay 中定义的时间，提交分区；</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">默认值：<strong style="color: black;">process-time</strong></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">解释：分区触发器类型，可选 <strong style="color: black;">process-time 或partition-time</strong>。</section></li></ul><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>sink.partition-commit.delay</strong></p></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">默认值：0S</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">解释：分区提交的延时时间，如果是按天分区，则该属性的值为：<strong style="color: black;">1d</strong>，如果是按小时分区，则该属性值为<strong style="color: black;">1h</strong>;</section></li></ul><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>sink.partition-commit.policy.kind</strong></p></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">metastore</strong>：添加分区的元数据信息，仅Hive表支持该值配置</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">success-file</strong>：在表的存储路径下添加一个<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">_SUCCESS</code>文件</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">默认值：(none)</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">解释：提交分区的策略，用于通知下游的应用该分区已经完成了写入，也就是说该分区的数据可以被访问读取。可选的值如下：</p><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">可以同时配置上面的两个值，比如<strong>metastore,success-file</strong></p></section></li></ul></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">执行流式写入Hive表</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;streaming&nbsp;sql,将数据写入Hive表</span><br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;user_behavior_hive_tbl&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;user_id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;item_id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;cat_id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">action</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;province,<br  />&nbsp;&nbsp;&nbsp;&nbsp;ts,<br  />&nbsp;&nbsp;&nbsp;&nbsp;FROM_UNIXTIME(ts,&nbsp;<span style="color: #d14;line-height: 26px;">'yyyy-MM-dd'</span>),<br  />&nbsp;&nbsp;&nbsp;&nbsp;FROM_UNIXTIME(ts,&nbsp;<span style="color: #d14;line-height: 26px;">'HH'</span>),<br  />&nbsp;&nbsp;&nbsp;&nbsp;FROM_UNIXTIME(ts,&nbsp;<span style="color: #d14;line-height: 26px;">'mm'</span>)<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;user_behavior;<br  /><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;batch&nbsp;sql,查询Hive表的分区数据</span><br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;*&nbsp;<span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;user_behavior_hive_tbl&nbsp;<span style="font-weight: bold;line-height: 26px;">WHERE</span>&nbsp;dt=<span style="color: #d14;line-height: 26px;">'2021-01-04'</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AND</span>&nbsp;&nbsp;hr=<span style="color: #d14;line-height: 26px;">'16'</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AND</span>&nbsp;mi&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'46'</span>;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">同时查看Hive表的分区数据：</p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.225" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicshO3kbnEYPq3iaDFEK9SDagMmaQHvK1Wgia7sbtuXJFRUBLWLDZeK8tB8BI4xZ6oDa2dcnRxPruKW8A/640?wx_fmt=png" data-type="png" data-w="1280" style=""  /></p><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">尖叫提示：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">1.Flink读取Hive表默认使用的是batch模式，如果要使用流式读取Hive表，需要而外指定一些参数，见下文。</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">2.只有在完成 Checkpoint 之后，文件才会从 In-progress 状态变成 Finish 状态，同时生成<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">_SUCCESS</code>文件，所以，Flink流式写入Hive表需要开启并配置 Checkpoint。对于Flink SQL Client而言，需要在flink-conf.yaml中开启CheckPoint，配置内容为：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">state.backend: filesystem
execution.checkpointing.externalized-checkpoint-retention:RETAIN_ON_CANCELLATION
execution.checkpointing.interval: 60s
execution.checkpointing.mode: EXACTLY_ONCE
state.savepoints.dir: hdfs://kms-1:8020/flink-savepoints</p></blockquote><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">Flink读取Hive表</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink支持以**批处理(Batch)和流处理(Streaming)**的方式读取Hive中的表。批处理的方式与Hive的本身查询类似，即只在提交查询的时刻查询一次Hive表。流处理的方式将会持续地监控Hive表，并且会增量地提取新的数据。<strong>默认情况下，Flink是以批处理的方式读取Hive表</strong>。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">关于流式读取Hive表，Flink既支持分区表又支持非分区表。对于分区表而言，Flink将会监控新产生的分区数据，并以增量的方式读取这些数据。对于非分区表，Flink会监控Hive表存储路径文件夹里面的新文件，并以增量的方式读取新的数据。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink读取Hive表可以配置一下参数：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>streaming-source.enable</strong></p></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">默认值：<strong style="color: black;">false</strong></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">解释：是否开启流式读取 Hive 表，默认不开启。</section></li></ul><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>streaming-source.partition.include</strong></p></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">默认值：<strong style="color: black;">all</strong></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">解释：配置读取Hive的分区，包括两种方式：<strong style="color: black;">all和latest</strong>。all意味着读取所有分区的数据，latest表示只读取最新的分区数据。值得注意的是，latest方式只能用于开启了流式读取Hive表，并用于维表JOIN的场景。</section></li></ul><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>streaming-source.monitor-interval</strong></p></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">默认值：<strong style="color: black;">None</strong></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">解释：持续监控Hive表分区或者文件的时间间隔。值得注意的是，当以流的方式读取Hive表时，该参数的默认值是<strong style="color: black;">1m</strong>，即1分钟。当temporal join时，默认的值是<strong style="color: black;">60m</strong>，即1小时。另外，该参数配置不宜过短 ，最短是1 个小时，因为目前的实现是每个 task 都会查询 metastore，高频的查可能会对metastore 产生过大的压力。</section></li></ul><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>streaming-source.partition-order</strong></p></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">默认值：<strong style="color: black;">partition-name</strong></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">解释：streaming source的分区顺序。默认的是<strong style="color: black;">partition-name</strong>，表示使用默认分区名称顺序加载最新分区，也是推荐使用的方式。除此之外还有两种方式，分别为：<strong style="color: black;">create-time和partition-time</strong>。其中create-time表示使用分区文件创建时间顺序。partition-time表示使用分区时间顺序。指的注意的是，对于非分区表，该参数的默认值为：<strong style="color: black;">create-time</strong>。</section></li></ul><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>streaming-source.consume-start-offset</strong></p></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">默认值：<strong style="color: black;">None</strong></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">解释：流式读取Hive表的起始偏移量。</section></li></ul><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><h5 style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;"><span style="display: none;"></span>partition.time-extractor.kind<span style="display: none;"></span></h5></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">默认值：default</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">分区时间提取器类型。用于从分区中提取时间，支持default和自定义。如果使用default，则需要通过参数<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">partition.time-extractor.timestamp-pattern</code>配置时间戳提取的正则表达式。</section></li></ul></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在 SQL Client 中需要显示地开启 SQL Hint 功能</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;<span style="color: #0086b3;line-height: 26px;">set</span>&nbsp;table.dynamic-table-options.enabled=&nbsp;<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;&nbsp;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">使用SQLHint流式查询Hive表</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;*&nbsp;<span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;user_behavior_hive_tbl&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">/*+&nbsp;OPTIONS('streaming-source.enable'='true',&nbsp;'streaming-source.consume-start-offset'='2021-01-03')&nbsp;*/</span>;<br  /></code></pre><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">Hive维表JOIN</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink 1.12 支持了 Hive 最新的分区作为时态表的功能，可以通过 SQL 的方式直接关联 Hive 分区表的最新分区，并且会自动监听最新的 Hive 分区，当监控到新的分区后，会自动地做维表数据的全量替换。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink支持的是processing-time的temporal join，也就是说总是与最新版本的时态表进行JOIN。另外，Flink既支持非分区表的temporal join，又支持分区表的temporal join。对于分区表而言，Flink会监听Hive表的最新分区数据。值得注意的是，Flink尚不支持 event-time temporal join。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>Temporal Join最新分区<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">对于一张随着时间变化的Hive分区表，Flink可以读取该表的数据作为一个无界流。<strong>如果Hive分区表的每个分区都包含全量的数据，那么每个分区将做为一个时态表的版本数据</strong>，即将最新的分区数据作为一个全量维表数据。值得注意的是，该功能特点仅支持Flink的STREAMING模式。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">使用 Hive 最新分区作为 Tempmoral table 之前，需要设置必要的两个参数：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #d14;line-height: 26px;">'streaming-source.enable'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,&nbsp;&nbsp;<br  /><span style="color: #d14;line-height: 26px;">'streaming-source.partition.include'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'latest'</span><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">除此之外还有一些其他的参数，关于参数的解释见上面的分析。<strong>我们在使用Hive维表的时候，既可以在创建Hive表时指定具体的参数，也可以使用SQL Hint的方式动态指定参数</strong>。一个Hive维表的创建模板如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用Hive的sql方言</span><br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;table.sql-dialect=hive;<br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;dimension_table&nbsp;(<br  />&nbsp;&nbsp;product_id&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;product_name&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;unit_price&nbsp;<span style="color: #0086b3;line-height: 26px;">DECIMAL</span>(<span style="color: #008080;line-height: 26px;">10</span>,&nbsp;<span style="color: #008080;line-height: 26px;">4</span>),<br  />&nbsp;&nbsp;pv_count&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;like_count&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;comment_count&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;update_time&nbsp;<span style="color: #0086b3;line-height: 26px;">TIMESTAMP</span>(<span style="color: #008080;line-height: 26px;">3</span>),<br  />&nbsp;&nbsp;update_user&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;...<br  />)&nbsp;PARTITIONED&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;(pt_year&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;pt_month&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;pt_day&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>)&nbsp;TBLPROPERTIES&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;方式1：按照分区名排序来识别最新分区(推荐使用该种方式)</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.enable'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;开启Streaming&nbsp;source</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.partition.include'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'latest'</span>,<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;选择最新分区</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.monitor-interval'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'12&nbsp;h'</span>,<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;每12小时加载一次最新分区数据</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.partition-order'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'partition-name'</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;按照分区名排序</span><br  /><br  />&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;方式2:分区文件的创建时间排序来识别最新分区</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.enable'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.partition.include'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'latest'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.partition-order'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'create-time'</span>,<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;分区文件的创建时间排序</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.monitor-interval'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'12&nbsp;h'</span><br  /><br  />&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;方式3:按照分区时间排序来识别最新分区</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.enable'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.partition.include'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'latest'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.monitor-interval'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'12&nbsp;h'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.partition-order'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'partition-time'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;按照分区时间排序</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'partition.time-extractor.kind'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'default'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'partition.time-extractor.timestamp-pattern'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'$pt_year-$pt_month-$pt_day&nbsp;00:00:00'</span>&nbsp;<br  />);<br  /><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">有了上面的Hive维表，我们就可以使用该维表与Kafka的实时流数据进行JOIN，得到相应的宽表数据。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用default&nbsp;sql方言</span><br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;table.sql-dialect=<span style="font-weight: bold;line-height: 26px;">default</span>;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka实时流数据表</span><br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;orders_table&nbsp;(<br  />&nbsp;&nbsp;order_id&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;order_amount&nbsp;<span style="font-weight: bold;line-height: 26px;">DOUBLE</span>,<br  />&nbsp;&nbsp;product_id&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;log_ts&nbsp;<span style="color: #0086b3;line-height: 26px;">TIMESTAMP</span>(<span style="color: #008080;line-height: 26px;">3</span>),<br  />&nbsp;&nbsp;proctime&nbsp;<span style="font-weight: bold;line-height: 26px;">as</span>&nbsp;PROCTIME()<br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(...);<br  /><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;将流表与hive最新分区数据关联&nbsp;</span><br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;*<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;orders_table&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;orders<br  /><span style="font-weight: bold;line-height: 26px;">JOIN</span>&nbsp;dimension_table&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;SYSTEM_TIME&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">OF</span>&nbsp;orders.proctime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;dim&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;orders.product_id&nbsp;=&nbsp;dim.product_id;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">除了在定义Hive维表时指定相关的参数，我们还可以通过SQL Hint的方式动态指定相关的参数，具体方式如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;*<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;orders_table&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;orders<br  /><span style="font-weight: bold;line-height: 26px;">JOIN</span>&nbsp;dimension_table<br  /><span style="color: #998;font-style: italic;line-height: 26px;">/*+&nbsp;OPTIONS('streaming-source.enable'='true',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;'streaming-source.partition.include'&nbsp;=&nbsp;'latest',<br  />&nbsp;&nbsp;&nbsp;&nbsp;'streaming-source.monitor-interval'&nbsp;=&nbsp;'1&nbsp;h',<br  />&nbsp;&nbsp;&nbsp;&nbsp;'streaming-source.partition-order'&nbsp;=&nbsp;'partition-name')&nbsp;*/</span><br  /><span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;SYSTEM_TIME&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">OF</span>&nbsp;orders.proctime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;dim&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;时态表(维表)</span><br  /><span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;orders.product_id&nbsp;=&nbsp;dim.product_id;<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>Temporal Join最新表<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">对于Hive的非分区表，当使用temporal join时，整个Hive表会被缓存到Slot内存中，然后根据流中的数据对应的key与其进行匹配。使用最新的Hive表进行temporal join不需要进行额外的配置，我们只需要配置一个Hive表缓存的TTL时间，该时间的作用是：当缓存过期时，就会重新扫描Hive表并加载最新的数据。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;"><strong>lookup.join.cache.ttl</strong></p><blockquote style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">尖叫提示：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">当使用此种方式时，Hive表必须是有界的lookup表，即非Streaming Source的时态表，换句话说，该表的属性<strong>streaming-source.enable = false</strong>。</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">如果要使用Streaming Source的时态表，记得配置<strong>streaming-source.monitor-interval</strong>的值，即数据更新的时间间隔。</p></blockquote></section></li><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;list-style-type: square;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">默认值：60min</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">解释：表示缓存时间。由于 Hive 维表会把维表所有数据缓存在 TM 的内存中，当维表数据量很大时，很容易造成 OOM。当然TTL的时间也不能太短，因为会频繁地加载数据，从而影响性能。</section></li></ul></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;Hive维表数据使用批处理的方式按天装载</span><br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;table.sql-dialect=hive;<br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;dimension_table&nbsp;(<br  />&nbsp;&nbsp;product_id&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;product_name&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;unit_price&nbsp;<span style="color: #0086b3;line-height: 26px;">DECIMAL</span>(<span style="color: #008080;line-height: 26px;">10</span>,&nbsp;<span style="color: #008080;line-height: 26px;">4</span>),<br  />&nbsp;&nbsp;pv_count&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;like_count&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;comment_count&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;update_time&nbsp;<span style="color: #0086b3;line-height: 26px;">TIMESTAMP</span>(<span style="color: #008080;line-height: 26px;">3</span>),<br  />&nbsp;&nbsp;update_user&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;...<br  />)&nbsp;TBLPROPERTIES&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.enable'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'false'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;关闭streaming&nbsp;source</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.partition.include'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'all'</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;读取所有数据</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'lookup.join.cache.ttl'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'12&nbsp;h'</span><br  />);<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka事实表</span><br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;table.sql-dialect=<span style="font-weight: bold;line-height: 26px;">default</span>;<br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;orders_table&nbsp;(<br  />&nbsp;&nbsp;order_id&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;order_amount&nbsp;<span style="font-weight: bold;line-height: 26px;">DOUBLE</span>,<br  />&nbsp;&nbsp;product_id&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;log_ts&nbsp;<span style="color: #0086b3;line-height: 26px;">TIMESTAMP</span>(<span style="color: #008080;line-height: 26px;">3</span>),<br  />&nbsp;&nbsp;proctime&nbsp;<span style="font-weight: bold;line-height: 26px;">as</span>&nbsp;PROCTIME()<br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(...);<br  /><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;Hive维表join，Flink会加载该维表的所有数据到内存中</span><br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;*<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;orders_table&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;orders<br  /><span style="font-weight: bold;line-height: 26px;">JOIN</span>&nbsp;dimension_table&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;SYSTEM_TIME&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">OF</span>&nbsp;orders.proctime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;dim<br  /><span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;orders.product_id&nbsp;=&nbsp;dim.product_id;<br  /></code></pre><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">尖叫提示：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">1.每一个子任务都需要缓存一份维表的全量数据，一定要确保TM的task Slot 大小能够容纳维表的数据量；</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">2.推荐将streaming-source.monitor-interval和lookup.join.cache.ttl的值设为一个较大的数，因为频繁的更新和加载数据会影响性能。</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">3.当缓存的维表数据需要重新刷新时，目前的做法是将整个表进行加载，因此不能够将新数据与旧数据区分开来。</p></blockquote><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>Hive维表JOIN示例<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">假设维表的数据是通过批处理的方式(比如每天)装载至Hive中，而Kafka中的事实流数据需要与该维表进行JOIN，从而构建一个宽表数据，这个时候就可以使用Hive的维表JOIN。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">创建一张kafka数据源表,实时流</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;table.sql-dialect=<span style="font-weight: bold;line-height: 26px;">default</span>;<br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;fact_user_behavior&nbsp;(&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`user_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`item_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;商品id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`action`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`province`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">INT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户所在的省份</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`ts`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为发生的时间戳</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`proctime`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;PROCTIME(),&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;通过计算列产生一个处理时间列</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`eventTime`</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;TO_TIMESTAMP(FROM_UNIXTIME(ts,&nbsp;<span style="color: #d14;line-height: 26px;">'yyyy-MM-dd&nbsp;HH:mm:ss'</span>)),&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;事件时间</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WATERMARK&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;eventTime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;eventTime&nbsp;-&nbsp;<span style="color: #0086b3;line-height: 26px;">INTERVAL</span>&nbsp;<span style="color: #d14;line-height: 26px;">'5'</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">SECOND</span>&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;定义watermark</span><br  />&nbsp;)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用&nbsp;kafka&nbsp;connector</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'user_behaviors'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka主题</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'scan.startup.mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'earliest-offset'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;偏移量</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.group.id'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'group1'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;消费者组</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:9092,kms-3:9092,kms-4:9092'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;数据源格式为json</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.fail-on-missing-field'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.ignore-parse-errors'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'false'</span><br  />);<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">创建一张Hive维表</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;table.sql-dialect=hive;<br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;dim_item&nbsp;(<br  />&nbsp;&nbsp;item_id&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;item_name&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;unit_price&nbsp;<span style="color: #0086b3;line-height: 26px;">DECIMAL</span>(<span style="color: #008080;line-height: 26px;">10</span>,&nbsp;<span style="color: #008080;line-height: 26px;">4</span>)<br  />)&nbsp;PARTITIONED&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;(dt&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>)&nbsp;TBLPROPERTIES&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.enable'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.partition.include'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'latest'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.monitor-interval'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'12&nbsp;h'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'streaming-source.partition-order'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'partition-name'</span><br  />);<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">关联Hive维表的最新数据</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;fact.item_id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;dim.item_name,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">count</span>(*)&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;buy_cnt<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;fact_user_behavior&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;fact<br  /><span style="font-weight: bold;line-height: 26px;">LEFT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">JOIN</span>&nbsp;dim_item&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;SYSTEM_TIME&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">OF</span>&nbsp;fact.proctime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;dim<br  /><span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;fact.item_id&nbsp;=&nbsp;dim.item_id<br  /><span style="font-weight: bold;line-height: 26px;">WHERE</span>&nbsp;fact.action&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'buy'</span><br  /><span style="font-weight: bold;line-height: 26px;">GROUP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;fact.item_id,dim.item_name;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">使用SQL Hint方式，关联非分区的Hive维表：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">set</span>&nbsp;table.dynamic-<span style="font-weight: bold;line-height: 26px;">table</span>-options.enabled=&nbsp;<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;fact.item_id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;dim.item_name,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">count</span>(*)&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;buy_cnt<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;fact_user_behavior&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;fact<br  /><span style="font-weight: bold;line-height: 26px;">LEFT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">JOIN</span>&nbsp;dim_item1<br  /><span style="color: #998;font-style: italic;line-height: 26px;">/*+&nbsp;OPTIONS('streaming-source.enable'='false',&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;'streaming-source.partition.include'&nbsp;=&nbsp;'all',<br  />&nbsp;&nbsp;&nbsp;&nbsp;'lookup.join.cache.ttl'&nbsp;=&nbsp;'12&nbsp;h')&nbsp;*/</span><br  /><span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;SYSTEM_TIME&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">OF</span>&nbsp;fact.proctime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;dim<br  /><span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;fact.item_id&nbsp;=&nbsp;dim.item_id<br  /><span style="font-weight: bold;line-height: 26px;">WHERE</span>&nbsp;fact.action&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'buy'</span><br  /><span style="font-weight: bold;line-height: 26px;">GROUP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;fact.item_id,dim.item_name;<br  /></code></pre><h1 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 24px;"><span style="display: none;"></span>Flink upsert-kafka连接器</h1><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">Upsert Kafka connector简介</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>Upsert Kafka Connector</strong>允许用户以upsert的方式从Kafka主题读取数据或将数据写入Kafka主题。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>当作为数据源时</strong>，upsert-kafka Connector会生产一个changelog流，其中每条数据记录都表示一个更新或删除事件。更准确地说，如果不存在对应的key，则视为<strong>INSERT</strong>操作。如果已经存在了相对应的key，则该key对应的value值为最后一次更新的值。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">用表来类比，changelog 流中的数据记录被解释为 UPSERT，也称为 INSERT/UPDATE，因为任何具有相同 key 的现有行都被覆盖。另外，value 为空的消息将会被视作为 DELETE 消息。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>当作为数据汇时</strong>，upsert-kafka Connector会消费一个changelog流。它将<strong>INSERT / UPDATE_AFTER</strong>数据作为正常的Kafka消息值写入(即INSERT和UPDATE操作，都会进行正常写入，如果是更新，则同一个key会存储多条数据，但在读取该表数据时，只保留最后一次更新的值)，并将 DELETE 数据以 value 为空的 Kafka 消息写入（key被打上墓碑标记，表示对应 key 的消息被删除）。Flink 将根据主键列的值对数据进行分区，从而保证主键上的消息有序，因此同一主键上的更新/删除消息将落在同一分区中</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">依赖</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">为了使用Upsert Kafka连接器，需要添加下面的依赖</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">dependency</span>&gt;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">groupId</span>&gt;</span>org.apache.flink<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">groupId</span>&gt;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">artifactId</span>&gt;</span>flink-connector-kafka_2.12<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">artifactId</span>&gt;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">version</span>&gt;</span>1.12.0<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">version</span>&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">dependency</span>&gt;</span><br  /><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果使用SQL Client，需要下载<strong>flink-sql-connector-kafka_2.11-1.12.0.jar</strong>，并将其放置在Flink安装目录的lib文件夹下。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">使用方式</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>使用样例<span style="display: none;"></span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;创建一张kafka表，用户存储sink的数据</span><br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;pageviews_per_region&nbsp;(<br  />&nbsp;&nbsp;user_region&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;pv&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;uv&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;PRIMARY&nbsp;<span style="font-weight: bold;line-height: 26px;">KEY</span>&nbsp;(user_region)&nbsp;<span style="font-weight: bold;line-height: 26px;">NOT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">ENFORCED</span><br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'upsert-kafka'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'pageviews_per_region'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:9092,kms-3:9092,kms-4:9092'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'key.format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'avro'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'value.format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'avro'</span><br  />);<br  /><br  /></code></pre><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">尖叫提示：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">要使用 upsert-kafka connector，必须在创建表时使用<strong>PRIMARY KEY</strong>定义主键，并为键（key.format）和值（value.format）指定序列化反序列化格式。</p></blockquote><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>upsert-kafka connector参数<span style="display: none;"></span></h3><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">connector</strong></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>必选</strong>。指定要使用的连接器，Upsert Kafka 连接器使用：<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">'upsert-kafka'</code>。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">topic</strong></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>必选</strong>。用于读取和写入的 Kafka topic 名称。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">properties.bootstrap.servers</strong></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>必选</strong>。以逗号分隔的 Kafka brokers 列表。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">key.format</strong></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>必选</strong>。用于对 Kafka 消息中 key 部分序列化和反序列化的格式。key 字段由 <strong>PRIMARY KEY</strong> 语法指定。支持的格式包括 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">'csv'</code>、<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">'json'</code>、<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">'avro'</code>。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">value.format</strong></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>必选</strong>。用于对 Kafka 消息中 value 部分序列化和反序列化的格式。支持的格式包括 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">'csv'</code>、<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">'json'</code>、<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">'avro'</code>。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">*<em style="color: black;">properties.</em> **</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>可选</strong>。该选项可以传递任意的 Kafka 参数。选项的后缀名必须匹配定义在 Kafka 参数文档中的参数名。Flink 会自动移除 选项名中的 "properties." 前缀，并将转换后的键名以及值传入 KafkaClient。例如，你可以通过 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">'properties.allow.auto.create.topics' = 'false'</code> 来禁止自动创建 topic。但是，某些选项，例如<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">'key.deserializer'</code> 和 <code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">'value.deserializer'</code> 是不允许通过该方式传递参数，因为 Flink 会重写这些参数的值。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">value.fields-include</strong></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>可选</strong>，默认为<strong>ALL</strong>。控制key字段是否出现在 value 中。当取<strong>ALL</strong>时，表示<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">消息的 value 部分将包含 schema 中所有的字段，包括定义为主键的字段。</code>当取<strong>EXCEPT_KEY</strong>时，表示记录的 value 部分包含 schema 的所有字段，定义为主键的字段除外。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">key.fields-prefix</strong></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>可选</strong>。为了避免与value字段命名冲突，为key字段添加一个自定义前缀。默认前缀为空。一旦指定了key字段的前缀，必须在DDL中指明前缀的名称，但是在构建key的序列化数据类型时，将移除该前缀。见下面的示例。在需要注意的是：使用该配置属性，<strong>value.fields-include</strong>的值必须为<strong>EXCEPT_KEY</strong>。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;创建一张upsert表，当指定了qwe前缀，涉及的key必须指定qwe前缀</span><br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;result_total_pvuv_min_prefix&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;qwedo_date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;统计日期，必须包含qwe前缀</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;qwedo_min&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;统计分钟，必须包含qwe前缀</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;pv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;点击量</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;uv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;一天内同个访客多次访问仅计算一个UV</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;currenttime&nbsp;<span style="color: #0086b3;line-height: 26px;">TIMESTAMP</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;当前时间</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;PRIMARY&nbsp;<span style="font-weight: bold;line-height: 26px;">KEY</span>&nbsp;(qwedo_date,&nbsp;qwedo_min)&nbsp;<span style="font-weight: bold;line-height: 26px;">NOT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">ENFORCED</span>&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;必须包含qwe前缀</span><br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'upsert-kafka'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'result_total_pvuv_min_prefix'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:9092,kms-3:9092,kms-4:9092'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'key.json.ignore-parse-errors'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'value.json.fail-on-missing-field'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'false'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'key.format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'value.format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'key.fields-prefix'</span>=<span style="color: #d14;line-height: 26px;">'qwe'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;指定前缀qwe</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'value.fields-include'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'EXCEPT_KEY'</span>&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;key不出现kafka消息的value中</span><br  />);<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;向该表中写入数据</span><br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;result_total_pvuv_min_prefix<br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span><br  />&nbsp;&nbsp;do_date,&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;&nbsp;时间分区</span><br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">cast</span>(<span style="font-weight: bold;line-height: 26px;">DATE_FORMAT</span>&nbsp;(access_time,<span style="color: #d14;line-height: 26px;">'HH:mm'</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;do_min,<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;分钟级别的时间</span><br  />&nbsp;&nbsp;pv,<br  />&nbsp;&nbsp;uv,<br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">CURRENT_TIMESTAMP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;currenttime&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;当前时间</span><br  /><span style="font-weight: bold;line-height: 26px;">from</span><br  />&nbsp;&nbsp;view_total_pvuv_min;<br  /></code></pre><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">尖叫提示：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">如果指定了key字段前缀，但在DDL中并没有添加该前缀字符串，那么在向该表写入数时，会抛出下面异常：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">[ERROR] Could not execute SQL statement. Reason:
org.apache.flink.table.api.ValidationException: All fields in 'key.fields' must be prefixed with 'qwe' when option 'key.fields-prefix' is set but field 'do_date' is not prefixed.</p></blockquote><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">sink.parallelism</strong></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>可选</strong>。定义 upsert-kafka sink 算子的并行度。默认情况下，由框架确定并行度，与上游链接算子的并行度保持一致。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">其他注意事项</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>Key和Value的序列化格式<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">关于Key、value的序列化可以参考Kafka connector。值得注意的是，必须指定Key和Value的序列化格式，其中Key是通过<strong>PRIMARY KEY</strong>指定的。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>Primary Key约束<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>Upsert Kafka</strong> 工作在 upsert 模式（FLIP-149）下。当我们创建表时，需要在 DDL 中定义主键。具有相同key的数据，会存在相同的分区中。在 changlog source 上定义主键意味着在物化后的 changelog 上主键具有唯一性。定义的主键将决定哪些字段出现在 Kafka 消息的 key 中。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>一致性保障<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">默认情况下，如果启用 checkpoint，Upsert Kafka sink 会保证至少一次将数据插入 Kafka topic。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">这意味着，Flink 可以将具有相同 key 的重复记录写入 Kafka topic。但由于该连接器以 upsert 的模式工作，该连接器作为 source 读入时，可以确保具有相同主键值下仅最后一条消息会生效。因此，upsert-kafka 连接器可以像 HBase sink 一样实现幂等写入。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>分区水位线<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink 支持根据 Upsert Kafka 的 每个分区的数据特性发送相应的 watermark。当使用这个特性的时候，watermark 是在 Kafka consumer 内部生成的。合并每个分区生成的 watermark 的方式和 streaming shuffle 的方式是一致的(<strong>单个分区的输入取最大值，多个分区的输入取最小值</strong>)。数据源产生的 watermark 是取决于该 consumer 负责的所有分区中当前最小的 watermark。如果该 consumer 负责的部分分区是空闲的，那么整体的 watermark 并不会前进。在这种情况下，可以通过设置合适的 table.exec.source.idle-timeout 来缓解这个问题。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>数据类型<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Upsert Kafka 用字节bytes存储消息的 key 和 value，因此没有 schema 或数据类型。消息按格式进行序列化和反序列化，例如：csv、json、avro。不同的序列化格式所提供的数据类型有所不同，因此需要根据使用的序列化格式进行确定表字段的数据类型是否与该序列化类型提供的数据类型兼容。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">使用案例</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">本文以实时地统计网页PV和UV的总量为例，介绍upsert-kafka基本使用方式：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Kafka 数据源</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">用户的ippv信息，一个用户在一天内可以有很多次pv</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;source_ods_fact_user_ippv&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;user_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户ID</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;client_ip&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;客户端IP</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;client_info&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;设备机型信息</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;pagecode&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;页面代码</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;access_time&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">TIMESTAMP</span>,&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;请求时间</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;dt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;时间分区天</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;WATERMARK&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;access_time&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;access_time&nbsp;-&nbsp;<span style="color: #0086b3;line-height: 26px;">INTERVAL</span>&nbsp;<span style="color: #d14;line-height: 26px;">'5'</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">SECOND</span>&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;定义watermark</span><br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用&nbsp;kafka&nbsp;connector</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'user_ippv'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka主题</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'scan.startup.mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'earliest-offset'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;偏移量</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.group.id'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'group1'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;消费者组</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:9092,kms-3:9092,kms-4:9092'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;数据源格式为json</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.fail-on-missing-field'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'false'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'json.ignore-parse-errors'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span><br  />);<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Kafka Sink表</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">统计每分钟的PV、UV，并将结果存储在Kafka中</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;result_total_pvuv_min&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;do_date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;统计日期</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;do_min&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;统计分钟</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;pv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;点击量</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;uv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;一天内同个访客多次访问仅计算一个UV</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;currenttime&nbsp;<span style="color: #0086b3;line-height: 26px;">TIMESTAMP</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;当前时间</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;PRIMARY&nbsp;<span style="font-weight: bold;line-height: 26px;">KEY</span>&nbsp;(do_date,&nbsp;do_min)&nbsp;<span style="font-weight: bold;line-height: 26px;">NOT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">ENFORCED</span><br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'upsert-kafka'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'result_total_pvuv_min'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:9092,kms-3:9092,kms-4:9092'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'key.json.ignore-parse-errors'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'true'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'value.json.fail-on-missing-field'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'false'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'key.format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'value.format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'value.fields-include'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'EXCEPT_KEY'</span>&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;key不出现kafka消息的value中</span><br  />);<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">计算逻辑</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;创建视图</span><br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">VIEW</span>&nbsp;view_total_pvuv_min&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span><br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dt&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;do_date,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;时间分区</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">count</span>&nbsp;(client_ip)&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;pv,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;客户端的IP</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">count</span>&nbsp;(<span style="font-weight: bold;line-height: 26px;">DISTINCT</span>&nbsp;client_ip)&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;uv,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;客户端去重</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">max</span>(access_time)&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;access_time&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;请求的时间</span><br  /><span style="font-weight: bold;line-height: 26px;">FROM</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;source_ods_fact_user_ippv<br  /><span style="font-weight: bold;line-height: 26px;">GROUP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;dt;<br  /><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;写入数据</span><br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;result_total_pvuv_min<br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span><br  />&nbsp;&nbsp;do_date,&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;&nbsp;时间分区</span><br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">cast</span>(<span style="font-weight: bold;line-height: 26px;">DATE_FORMAT</span>&nbsp;(access_time,<span style="color: #d14;line-height: 26px;">'HH:mm'</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;do_min,<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;分钟级别的时间</span><br  />&nbsp;&nbsp;pv,<br  />&nbsp;&nbsp;uv,<br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">CURRENT_TIMESTAMP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;currenttime&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;当前时间</span><br  /><span style="font-weight: bold;line-height: 26px;">from</span><br  />&nbsp;&nbsp;view_total_pvuv_min;<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">生产用户访问数据到kafka，向kafka中的user_ippv插入数据：</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">{<span style="color: #d14;line-height: 26px;">"user_id"</span>:<span style="color: #d14;line-height: 26px;">"1"</span>,<span style="color: #d14;line-height: 26px;">"client_ip"</span>:<span style="color: #d14;line-height: 26px;">"192.168.12.1"</span>,<span style="color: #d14;line-height: 26px;">"client_info"</span>:<span style="color: #d14;line-height: 26px;">"phone"</span>,<span style="color: #d14;line-height: 26px;">"pagecode"</span>:<span style="color: #d14;line-height: 26px;">"1001"</span>,<span style="color: #d14;line-height: 26px;">"access_time"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08&nbsp;11:32:24"</span>,<span style="color: #d14;line-height: 26px;">"dt"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08"</span>}<br  /><br  />{<span style="color: #d14;line-height: 26px;">"user_id"</span>:<span style="color: #d14;line-height: 26px;">"1"</span>,<span style="color: #d14;line-height: 26px;">"client_ip"</span>:<span style="color: #d14;line-height: 26px;">"192.168.12.1"</span>,<span style="color: #d14;line-height: 26px;">"client_info"</span>:<span style="color: #d14;line-height: 26px;">"phone"</span>,<span style="color: #d14;line-height: 26px;">"pagecode"</span>:<span style="color: #d14;line-height: 26px;">"1201"</span>,<span style="color: #d14;line-height: 26px;">"access_time"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08&nbsp;11:32:55"</span>,<span style="color: #d14;line-height: 26px;">"dt"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08"</span>}<br  /><br  />{<span style="color: #d14;line-height: 26px;">"user_id"</span>:<span style="color: #d14;line-height: 26px;">"2"</span>,<span style="color: #d14;line-height: 26px;">"client_ip"</span>:<span style="color: #d14;line-height: 26px;">"192.165.12.1"</span>,<span style="color: #d14;line-height: 26px;">"client_info"</span>:<span style="color: #d14;line-height: 26px;">"pc"</span>,<span style="color: #d14;line-height: 26px;">"pagecode"</span>:<span style="color: #d14;line-height: 26px;">"1031"</span>,<span style="color: #d14;line-height: 26px;">"access_time"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08&nbsp;11:32:59"</span>,<span style="color: #d14;line-height: 26px;">"dt"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08"</span>}<br  /><br  />{<span style="color: #d14;line-height: 26px;">"user_id"</span>:<span style="color: #d14;line-height: 26px;">"1"</span>,<span style="color: #d14;line-height: 26px;">"client_ip"</span>:<span style="color: #d14;line-height: 26px;">"192.168.12.1"</span>,<span style="color: #d14;line-height: 26px;">"client_info"</span>:<span style="color: #d14;line-height: 26px;">"phone"</span>,<span style="color: #d14;line-height: 26px;">"pagecode"</span>:<span style="color: #d14;line-height: 26px;">"1101"</span>,<span style="color: #d14;line-height: 26px;">"access_time"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08&nbsp;11:33:24"</span>,<span style="color: #d14;line-height: 26px;">"dt"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08"</span>}<br  /><br  />{<span style="color: #d14;line-height: 26px;">"user_id"</span>:<span style="color: #d14;line-height: 26px;">"3"</span>,<span style="color: #d14;line-height: 26px;">"client_ip"</span>:<span style="color: #d14;line-height: 26px;">"192.168.10.3"</span>,<span style="color: #d14;line-height: 26px;">"client_info"</span>:<span style="color: #d14;line-height: 26px;">"pc"</span>,<span style="color: #d14;line-height: 26px;">"pagecode"</span>:<span style="color: #d14;line-height: 26px;">"1001"</span>,<span style="color: #d14;line-height: 26px;">"access_time"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08&nbsp;11:33:30"</span>,<span style="color: #d14;line-height: 26px;">"dt"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08"</span>}<br  /><br  />{<span style="color: #d14;line-height: 26px;">"user_id"</span>:<span style="color: #d14;line-height: 26px;">"1"</span>,<span style="color: #d14;line-height: 26px;">"client_ip"</span>:<span style="color: #d14;line-height: 26px;">"192.168.12.1"</span>,<span style="color: #d14;line-height: 26px;">"client_info"</span>:<span style="color: #d14;line-height: 26px;">"phone"</span>,<span style="color: #d14;line-height: 26px;">"pagecode"</span>:<span style="color: #d14;line-height: 26px;">"1001"</span>,<span style="color: #d14;line-height: 26px;">"access_time"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08&nbsp;11:34:24"</span>,<span style="color: #d14;line-height: 26px;">"dt"</span>:<span style="color: #d14;line-height: 26px;">"2021-01-08"</span>}<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">查询结果表：</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;*&nbsp;<span style="font-weight: bold;line-height: 26px;">from</span>&nbsp;result_total_pvuv_min;<br  /></code></pre><p style="text-align: center;"><img class="rich_pages" data-ratio="0.11922365988909427" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgLLfmaaicwGOpIR94ejKQvJckjicvcwSMiczN06nzZTvaxmysXaQJTGj3Jaee7Atte42mNgdvyMf9Tg/640?wx_fmt=png" data-type="png" data-w="1082" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>可以看出</strong>：每分钟的pv、uv只显示一条数据，即代表着截止到当前时间点的pv和uv</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">查看Kafka中result_total_pvuv_min主题的数据，如下：</p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.19554455445544555" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgLLfmaaicwGOpIR94ejKQvJvTXlDIbzfmR0tK3kKbRbRtDT84dBCib4wvXN2UchthmnoOvkXKnSASQ/640?wx_fmt=png" data-type="png" data-w="808" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>可以看出</strong>：针对每一条访问数据，触发计算了一次PV、UV，每一条数据都是截止到当前时间的累计PV和UV。</p><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">尖叫提示：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">默认情况下，如果在启用了检查点的情况下执行查询，Upsert Kafka接收器会将具有至少一次保证的数据提取到Kafka主题中。</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">这意味着，Flink可能会将具有相同键的重复记录写入Kafka主题。但是，由于连接器在upsert模式下工作，因此作为源读回时，同一键上的最后一条记录将生效。因此，upsert-kafka连接器就像HBase接收器一样实现幂等写入。</p></blockquote><h1 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 24px;"><span style="display: none;"></span>Flink CDC的connector</h1><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">简介</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink CDC Connector 是ApacheFlink的一组数据源连接器，使用<strong>变化数据捕获change data capture (CDC)</strong>从不同的数据库中提取变更数据。Flink CDC连接器将Debezium集成为引擎来捕获数据变更。因此，它可以充分利用Debezium的功能。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>特点<span style="display: none;"></span></h3><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">支持读取数据库快照，并且能够持续读取数据库的变更日志，即使发生故障，也支持<strong>exactly-once</strong> 的处理语义</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">对于DataStream API的CDC connector，用户无需部署Debezium和Kafka，即可在单个作业中使用多个数据库和表上的变更数据。</p></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">对于Table/SQL API 的CDC connector，用户可以使用SQL DDL创建CDC数据源，来监视单个表上的数据变更。</p></section></li></ul><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>使用场景<span style="display: none;"></span></h3><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">数据库之间的增量数据同步</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">审计日志</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">数据库之上的实时物化视图</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">基于CDC的维表join</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">…</section></li></ul><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">Flink提供的 table format</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink提供了一系列可以用于table connector的table format，具体如下：</p><section data-tool="mdnice编辑器" style="overflow-x: auto;"><table><thead><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: left;">Formats</th><th style="border-top-width: 1px;border-color: rgb(204, 204, 204);background-color: rgb(240, 240, 240);min-width: 85px;text-align: left;">Supported Connectors</th></tr></thead><tbody style="border-width: 0px;border-style: initial;border-color: initial;"><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">CSV</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Apache Kafka, Filesystem</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">JSON</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Apache Kafka, Filesystem, Elasticsearch</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Apache Avro</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Apache Kafka, Filesystem</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Debezium CDC</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Apache Kafka</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Canal CDC</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Apache Kafka</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: rgb(248, 248, 248);"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Apache Parquet</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Filesystem</td></tr><tr style="border-width: 1px 0px 0px;border-right-style: initial;border-bottom-style: initial;border-left-style: initial;border-right-color: initial;border-bottom-color: initial;border-left-color: initial;border-top-style: solid;border-top-color: rgb(204, 204, 204);background-color: white;"><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Apache ORC</td><td style="border-color: rgb(204, 204, 204);min-width: 85px;">Filesystem</td></tr></tbody></table></section><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">使用过程中的注意点</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>使用MySQL CDC的注意点<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果要使用MySQL CDC connector，对于程序而言，需要添加如下依赖:</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">dependency</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">groupId</span>&gt;</span>com.alibaba.ververica<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">groupId</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">artifactId</span>&gt;</span>flink-connector-mysql-cdc<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">artifactId</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">version</span>&gt;</span>1.0.0<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">version</span>&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">dependency</span>&gt;</span><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果要使用Flink SQL Client，需要添加如下jar包：<strong>flink-sql-connector-mysql-cdc-1.0.0.jar</strong>，将该jar包放在Flink安装目录的lib文件夹下即可。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>使用canal-json的注意点<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果要使用Kafka的canal-json，对于程序而言，需要添加如下依赖:</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">&lt;!--&nbsp;universal&nbsp;--&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">dependency</span>&gt;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">groupId</span>&gt;</span>org.apache.flink<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">groupId</span>&gt;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">artifactId</span>&gt;</span>flink-connector-kafka_2.11<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">artifactId</span>&gt;</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">version</span>&gt;</span>1.11.0<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">version</span>&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">dependency</span>&gt;</span><br  /><br  /><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果要使用Flink SQL Client，需要添加如下jar包：<strong>flink-sql-connector-kafka_2.11-1.11.0.jar</strong>，将该jar包放在Flink安装目录的lib文件夹下即可。由于Flink1.11的安装包 的lib目录下并没有提供该jar包，所以必须要手动添加依赖包，否则会报如下错误：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">[ERROR]&nbsp;Could&nbsp;not&nbsp;execute&nbsp;SQL&nbsp;statement.&nbsp;Reason:<br  />org.apache.flink.table.api.ValidationException:&nbsp;Could&nbsp;not&nbsp;find&nbsp;any&nbsp;factory&nbsp;<span style="font-weight: bold;line-height: 26px;">for</span>&nbsp;identifier&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>&nbsp;that&nbsp;implements&nbsp;<span style="color: #d14;line-height: 26px;">'org.apache.flink.table.factories.DynamicTableSourceFactory'</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">in</span>&nbsp;the&nbsp;classpath.<br  /><br  />Available&nbsp;factory&nbsp;identifiers&nbsp;are:<br  /><br  />datagen<br  />mysql-cdc<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>使用changelog-json的注意点<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果要使用Kafka的changelog-json Format，对于程序而言，需要添加如下依赖:</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">dependency</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">groupId</span>&gt;</span>com.alibaba.ververica<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">groupId</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">artifactId</span>&gt;</span>flink-format-changelog-json<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">artifactId</span>&gt;</span><br  />&nbsp;&nbsp;<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;<span style="line-height: 26px;">version</span>&gt;</span>1.0.0<span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">version</span>&gt;</span><br  /><span style="color: rgb(0, 0, 128);line-height: 26px;">&lt;/<span style="line-height: 26px;">dependency</span>&gt;</span><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果要使用Flink SQL Client，需要添加如下jar包：<strong>flink-format-changelog-json-1.0.0.jar</strong>，将该jar包放在Flink安装目录的lib文件夹下即可。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">mysql-cdc的操作实践</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>创建MySQL数据源表<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在创建MySQL CDC表之前，需要先创建MySQL的数据表，如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;MySQL</span><br  /><span style="color: #998;font-style: italic;line-height: 26px;">/*Table&nbsp;structure&nbsp;for&nbsp;table&nbsp;`order_info`&nbsp;*/</span><br  /><span style="font-weight: bold;line-height: 26px;">DROP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">IF</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">EXISTS</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_info`</span>;<br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_info`</span>&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">bigint</span>(<span style="color: #008080;line-height: 26px;">20</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">NOT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;AUTO_INCREMENT&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'编号'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`consignee`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">100</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'收货人'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`consignee_tel`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">20</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'收件人电话'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`total_amount`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">decimal</span>(<span style="color: #008080;line-height: 26px;">10</span>,<span style="color: #008080;line-height: 26px;">2</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'总金额'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`order_status`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">20</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'订单状态,1表示下单，2表示支付'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`user_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">bigint</span>(<span style="color: #008080;line-height: 26px;">20</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'用户id'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`payment_way`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">20</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'付款方式'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`delivery_address`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">1000</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'送货地址'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`order_comment`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">200</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'订单备注'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`out_trade_no`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">50</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'订单交易编号（第三方支付用)'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`trade_body`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">200</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'订单描述(第三方支付用)'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`create_time`</span>&nbsp;datetime&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'创建时间'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`operate_time`</span>&nbsp;datetime&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'操作时间'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`expire_time`</span>&nbsp;datetime&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'失效时间'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`tracking_no`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">100</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'物流单编号'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`parent_order_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">bigint</span>(<span style="color: #008080;line-height: 26px;">20</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'父订单编号'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`img_url`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">200</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'图片路径'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`province_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">int</span>(<span style="color: #008080;line-height: 26px;">20</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'地区'</span>,<br  />&nbsp;&nbsp;PRIMARY&nbsp;<span style="font-weight: bold;line-height: 26px;">KEY</span>&nbsp;(<span style="color: #d14;line-height: 26px;">`id`</span>)<br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">ENGINE</span>=<span style="font-weight: bold;line-height: 26px;">InnoDB</span>&nbsp;AUTO_INCREMENT=<span style="color: #008080;line-height: 26px;">1</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">CHARSET</span>=utf8&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>=<span style="color: #d14;line-height: 26px;">'订单表'</span>;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;----------------------------</span><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;Records&nbsp;of&nbsp;order_info</span><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;----------------------------</span><br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_info`</span>&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">VALUES</span>&nbsp;(<span style="color: #008080;line-height: 26px;">476</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'lAXjcL'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'13408115089'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">433.00</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">10</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'OYyAdSdLxedceqovndCD'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'ihjAYsSjrgJMQVdFQnSy'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'8728720206'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">''</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2020-06-18&nbsp;02:21:38'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">9</span>);<br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_info`</span><br  /><span style="font-weight: bold;line-height: 26px;">VALUES</span>&nbsp;(<span style="color: #008080;line-height: 26px;">477</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'QLiFDb'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'13415139984'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">772.00</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'1'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">90</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'OizYrQbKuWvrvdfpkeSZ'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'wiBhhqhMndCCgXwmWVQq'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'1679381473'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">''</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2020-06-18&nbsp;09:12:25'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">3</span>);<br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_info`</span><br  /><span style="font-weight: bold;line-height: 26px;">VALUES</span>&nbsp;(<span style="color: #008080;line-height: 26px;">478</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'iwKjQD'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'13320383859'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">88.00</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'1'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">107</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'1'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'cbXLKtNHWOcWzJVBWdAs'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'njjsnknHxsxhuCCeNDDi'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'0937074290'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">''</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2020-06-18&nbsp;15:56:34'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>,&nbsp;<span style="color: #008080;line-height: 26px;">7</span>);<br  /><br  /><span style="color: #998;font-style: italic;line-height: 26px;">/*Table&nbsp;structure&nbsp;for&nbsp;table&nbsp;`order_detail`&nbsp;*/</span><br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_detail`</span>&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">bigint</span>(<span style="color: #008080;line-height: 26px;">20</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">NOT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;AUTO_INCREMENT&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'编号'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`order_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">bigint</span>(<span style="color: #008080;line-height: 26px;">20</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'订单编号'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`sku_id`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">bigint</span>(<span style="color: #008080;line-height: 26px;">20</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'sku_id'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`sku_name`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">200</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'sku名称（冗余)'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`img_url`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">200</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'图片名称（冗余)'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`order_price`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">decimal</span>(<span style="color: #008080;line-height: 26px;">10</span>,<span style="color: #008080;line-height: 26px;">2</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'购买价格(下单时sku价格）'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`sku_num`</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">varchar</span>(<span style="color: #008080;line-height: 26px;">200</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'购买个数'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">`create_time`</span>&nbsp;datetime&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="color: #008080;line-height: 26px;">NULL</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;<span style="color: #d14;line-height: 26px;">'创建时间'</span>,<br  />&nbsp;&nbsp;PRIMARY&nbsp;<span style="font-weight: bold;line-height: 26px;">KEY</span>&nbsp;(<span style="color: #d14;line-height: 26px;">`id`</span>)<br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">ENGINE</span>=<span style="font-weight: bold;line-height: 26px;">InnoDB</span>&nbsp;AUTO_INCREMENT=<span style="color: #008080;line-height: 26px;">1</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFAULT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">CHARSET</span>=utf8&nbsp;<span style="font-weight: bold;line-height: 26px;">COMMENT</span>=<span style="color: #d14;line-height: 26px;">'订单明细表'</span>;<br  /><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;----------------------------</span><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;Records&nbsp;of&nbsp;order_detail</span><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;----------------------------</span><br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_detail`</span>&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">VALUES</span>&nbsp;(<span style="color: #008080;line-height: 26px;">1329</span>,&nbsp;<span style="color: #008080;line-height: 26px;">476</span>,&nbsp;<span style="color: #008080;line-height: 26px;">8</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'Apple&nbsp;iPhone&nbsp;XS&nbsp;Max&nbsp;(A2104)&nbsp;256GB&nbsp;深空灰色&nbsp;移动联通电信4G手机&nbsp;双卡双待'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'http://XLMByOyZDTJQYxphQHNTgYAFzJJCKTmCbzvEJIpz'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">8900.00</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'3'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2020-06-18&nbsp;02:21:38'</span>);<br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_detail`</span>&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">VALUES</span>&nbsp;(<span style="color: #008080;line-height: 26px;">1330</span>,&nbsp;<span style="color: #008080;line-height: 26px;">477</span>,&nbsp;<span style="color: #008080;line-height: 26px;">9</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'荣耀10&nbsp;GT游戏加速&nbsp;AIS手持夜景&nbsp;6GB+64GB&nbsp;幻影蓝全网通&nbsp;移动联通电信'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'http://ixOCtlYmlxEEgUfPLiLdjMftzrleOEIBKSjrhMne'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">2452.00</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'4'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2020-06-18&nbsp;09:12:25'</span>);<br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_detail`</span><br  /><span style="font-weight: bold;line-height: 26px;">VALUES</span>&nbsp;(<span style="color: #008080;line-height: 26px;">1331</span>,&nbsp;<span style="color: #008080;line-height: 26px;">478</span>,&nbsp;<span style="color: #008080;line-height: 26px;">4</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'小米Play&nbsp;流光渐变AI双摄&nbsp;4GB+64GB&nbsp;梦幻蓝&nbsp;全网通4G&nbsp;双卡双待&nbsp;小水滴全面屏拍照游戏智能手机'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'http://RqfEFnAOqnqRnNZLFRvBuwXxwNBtptYJCILDKQYv'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">1442.00</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'1'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2020-06-18&nbsp;15:56:34'</span>);<br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_detail`</span>&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">VALUES</span>&nbsp;(<span style="color: #008080;line-height: 26px;">1332</span>,&nbsp;<span style="color: #008080;line-height: 26px;">478</span>,&nbsp;<span style="color: #008080;line-height: 26px;">8</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'Apple&nbsp;iPhone&nbsp;XS&nbsp;Max&nbsp;(A2104)&nbsp;256GB&nbsp;深空灰色&nbsp;移动联通电信4G手机&nbsp;双卡双待'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'http://IwhuCDlsiLenfKjPzbJrIoxswdfofKhJLMzlJAKV'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">8900.00</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'3'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2020-06-18&nbsp;15:56:34'</span>);<br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;<span style="color: #d14;line-height: 26px;">`order_detail`</span>&nbsp;<br  /><span style="font-weight: bold;line-height: 26px;">VALUES</span>&nbsp;(<span style="color: #008080;line-height: 26px;">1333</span>,&nbsp;<span style="color: #008080;line-height: 26px;">478</span>,&nbsp;<span style="color: #008080;line-height: 26px;">8</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'Apple&nbsp;iPhone&nbsp;XS&nbsp;Max&nbsp;(A2104)&nbsp;256GB&nbsp;深空灰色&nbsp;移动联通电信4G手机&nbsp;双卡双待'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'http://bbfwTbAzTWapywODzOtDJMJUEqNTeRTUQuCDkqXP'</span>,&nbsp;<span style="color: #008080;line-height: 26px;">8900.00</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'1'</span>,&nbsp;<span style="color: #d14;line-height: 26px;">'2020-06-18&nbsp;15:56:34'</span>);<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>Flink SQL Cli创建CDC数据源<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">启动 Flink 集群，再启动 SQL CLI,执行下面命令：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;创建订单信息表</span><br  /><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;order_info(<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">id</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;user_id&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;create_time&nbsp;<span style="color: #0086b3;line-height: 26px;">TIMESTAMP</span>(<span style="color: #008080;line-height: 26px;">0</span>),<br  />&nbsp;&nbsp;&nbsp;&nbsp;operate_time&nbsp;<span style="color: #0086b3;line-height: 26px;">TIMESTAMP</span>(<span style="color: #008080;line-height: 26px;">0</span>),<br  />&nbsp;&nbsp;&nbsp;&nbsp;province_id&nbsp;<span style="color: #0086b3;line-height: 26px;">INT</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;order_status&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;total_amount&nbsp;<span style="color: #0086b3;line-height: 26px;">DECIMAL</span>(<span style="color: #008080;line-height: 26px;">10</span>,&nbsp;<span style="color: #008080;line-height: 26px;">5</span>)<br  />&nbsp;&nbsp;)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'mysql-cdc'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'hostname'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-1'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'port'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'3306'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'username'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'root'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'password'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'123qwe'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'database-name'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'mydw'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'table-name'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'order_info'</span><br  />);<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在Flink SQL Cli中查询该表的数据：result-mode: tableau，+表示数据的insert</p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.1302785265049416" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgdKibaWckM9fQzrWpfuc71yFnyiaJA3TmwmawUESyGRsZJJC1K556ulzp8U3Ycntn9eOmC8GhRkTicA/640?wx_fmt=png" data-type="png" data-w="1113" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在SQL CLI中创建订单详情表：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;order_detail(<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">id</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;order_id&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;sku_id&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;sku_name&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;sku_num&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;order_price&nbsp;<span style="color: #0086b3;line-height: 26px;">DECIMAL</span>(<span style="color: #008080;line-height: 26px;">10</span>,&nbsp;<span style="color: #008080;line-height: 26px;">5</span>),<br  />&nbsp;create_time&nbsp;<span style="color: #0086b3;line-height: 26px;">TIMESTAMP</span>(<span style="color: #008080;line-height: 26px;">0</span>)<br  />&nbsp;)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'mysql-cdc'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'hostname'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-1'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'port'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'3306'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'username'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'root'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'password'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'123qwe'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'database-name'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'mydw'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'table-name'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'order_detail'</span><br  />);<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">查询结果如下：</p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.13671875" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgdKibaWckM9fQzrWpfuc71yAnDVVYkyOrG70oSFs5NymvbNG2VUiaK9Gv1HPFC95jPAWfnqCnuxmjA/640?wx_fmt=png" data-type="png" data-w="1280" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">执行JOIN操作：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SELECT</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;od.id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;oi.id&nbsp;order_id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;oi.user_id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;oi.province_id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;od.sku_id,<br  />&nbsp;&nbsp;&nbsp;&nbsp;od.sku_name,<br  />&nbsp;&nbsp;&nbsp;&nbsp;od.sku_num,<br  />&nbsp;&nbsp;&nbsp;&nbsp;od.order_price,<br  />&nbsp;&nbsp;&nbsp;&nbsp;oi.create_time,<br  />&nbsp;&nbsp;&nbsp;&nbsp;oi.operate_time<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span><br  />&nbsp;&nbsp;&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;*&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;order_info<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">WHERE</span>&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;order_status&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'2'</span><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;已支付</span><br  />&nbsp;&nbsp;&nbsp;)&nbsp;oi<br  />&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">JOIN</span><br  />&nbsp;&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;*<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;order_detail<br  />&nbsp;&nbsp;)&nbsp;od&nbsp;<br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;oi.id&nbsp;=&nbsp;od.order_id;<br  /></code></pre><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">canal-json的操作实践</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">关于cannal的使用方式，可以参考我的另一篇文章：<a href="https://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&amp;mid=2247483676&amp;idx=1&amp;sn=c2dafd2dc5cf092d3d74993bb51be45c&amp;scene=21#wechat_redirect" style="font-weight: bold;color: rgb(239, 112, 96);border-bottom: 1px solid rgb(239, 112, 96);" data-linktype="2">基于Canal与Flink实现数据实时增量同步(一)</a>。我已经将下面的表通过canal同步到了kafka，具体格式为：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">{<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"data"</span>:[<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"id"</span>:<span style="color: #d14;line-height: 26px;">"1"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"region_name"</span>:<span style="color: #d14;line-height: 26px;">"华北"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"id"</span>:<span style="color: #d14;line-height: 26px;">"2"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"region_name"</span>:<span style="color: #d14;line-height: 26px;">"华东"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"id"</span>:<span style="color: #d14;line-height: 26px;">"3"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"region_name"</span>:<span style="color: #d14;line-height: 26px;">"东北"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"id"</span>:<span style="color: #d14;line-height: 26px;">"4"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"region_name"</span>:<span style="color: #d14;line-height: 26px;">"华中"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"id"</span>:<span style="color: #d14;line-height: 26px;">"5"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"region_name"</span>:<span style="color: #d14;line-height: 26px;">"华南"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"id"</span>:<span style="color: #d14;line-height: 26px;">"6"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"region_name"</span>:<span style="color: #d14;line-height: 26px;">"西南"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"id"</span>:<span style="color: #d14;line-height: 26px;">"7"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"region_name"</span>:<span style="color: #d14;line-height: 26px;">"西北"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br  />&nbsp;&nbsp;&nbsp;&nbsp;],<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"database"</span>:<span style="color: #d14;line-height: 26px;">"mydw"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"es"</span>:1597128441000,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"id"</span>:102,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"isDdl"</span>:<span style="color: #008080;line-height: 26px;">false</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"mysqlType"</span>:{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"id"</span>:<span style="color: #d14;line-height: 26px;">"varchar(20)"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"region_name"</span>:<span style="color: #d14;line-height: 26px;">"varchar(20)"</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"old"</span>:null,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"pkNames"</span>:null,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"sql"</span>:<span style="color: #d14;line-height: 26px;">""</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"sqlType"</span>:{<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"id"</span>:12,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"region_name"</span>:12<br  />&nbsp;&nbsp;&nbsp;&nbsp;},<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"table"</span>:<span style="color: #d14;line-height: 26px;">"base_region"</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"ts"</span>:1597128441424,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">"type"</span>:<span style="color: #d14;line-height: 26px;">"INSERT"</span><br  />}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在SQL CLI中创建该canal-json格式的表：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;region&nbsp;(<br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">id</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,<br  />&nbsp;&nbsp;region_name&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span><br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>,<br  />&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'mydw.base_region'</span>,<br  />&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-3:9092'</span>,<br  />&nbsp;<span style="color: #d14;line-height: 26px;">'properties.group.id'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'testGroup'</span>,<br  />&nbsp;<span style="color: #d14;line-height: 26px;">'format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'canal-json'</span>&nbsp;,<br  />&nbsp;<span style="color: #d14;line-height: 26px;">'scan.startup.mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'earliest-offset'</span>&nbsp;<br  />);<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">查询结果如下：</p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.4896551724137931" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgdKibaWckM9fQzrWpfuc71y8vRZDomwwR492jTDf1XaicRIq4lsYh1PFmdmg851F2Eu2E7nhAggKjw/640?wx_fmt=png" data-type="png" data-w="435" style=""  /></p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">changelog-json的操作实践</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>创建MySQL数据源<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">参见上面的<strong>order_info</strong></p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>Flink SQL Cli创建changelog-json表<span style="display: none;"></span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;order_gmv2kafka&nbsp;(<br  />&nbsp;&nbsp;day_str&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<br  />&nbsp;&nbsp;gmv&nbsp;<span style="color: #0086b3;line-height: 26px;">DECIMAL</span>(<span style="color: #008080;line-height: 26px;">10</span>,&nbsp;<span style="color: #008080;line-height: 26px;">5</span>)<br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'order_gmv_kafka'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'scan.startup.mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'earliest-offset'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-3:9092'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'format'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'changelog-json'</span><br  />);<br  /><br  /><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;order_gmv2kafka<br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">DATE_FORMAT</span>(create_time,&nbsp;<span style="color: #d14;line-height: 26px;">'yyyy-MM-dd'</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">as</span>&nbsp;day_str,&nbsp;<span style="font-weight: bold;line-height: 26px;">SUM</span>(total_amount)&nbsp;<span style="font-weight: bold;line-height: 26px;">as</span>&nbsp;gmv<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;order_info<br  /><span style="font-weight: bold;line-height: 26px;">WHERE</span>&nbsp;order_status&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'2'</span>&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;订单已支付</span><br  /><span style="font-weight: bold;line-height: 26px;">GROUP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">DATE_FORMAT</span>(create_time,&nbsp;<span style="color: #d14;line-height: 26px;">'yyyy-MM-dd'</span>);&nbsp;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">查询表看一下结果：</p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.2505854800936768" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgdKibaWckM9fQzrWpfuc71yPEicicVnCMd0yfPh8G5sSkclFSxic8KtMbXzD4GxHqiam9ic0ksGJDwysfg/640?wx_fmt=png" data-type="png" data-w="427" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">再查一下kafka的数据：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">{<span style="color: #d14;line-height: 26px;">"data"</span>:{<span style="color: #d14;line-height: 26px;">"day_str"</span>:<span style="color: #d14;line-height: 26px;">"2020-06-18"</span>,<span style="color: #d14;line-height: 26px;">"gmv"</span>:433},<span style="color: #d14;line-height: 26px;">"op"</span>:<span style="color: #d14;line-height: 26px;">"+I"</span>}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">当将另外两个订单的状态order_status更新为2时，<code style="font-size: 14px;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">总金额=443+772+88=1293</code>再观察数据：</p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.32116788321167883" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgdKibaWckM9fQzrWpfuc71yrAMrYvvbhG1nObk4Z6OhKUiccm985JwLQMBAicy9G4demxUJQ4XCCSRQ/640?wx_fmt=png" data-type="png" data-w="548" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">再看kafka中的数据：</p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.23848684210526316" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgdKibaWckM9fQzrWpfuc71yFJgvSliacJSelo7Z7nsxquZyYCiciaiakqeeMNfkQRkWvL24zvic41czmUg/640?wx_fmt=png" data-type="png" data-w="608" style=""  /></p><h1 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 24px;"><span style="display: none;"></span>总结</h1><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">本文主要介绍了基于FlinK构建实时数仓的技术点，并对其使用方式进行了详细描述，通过本文你或许对实时数仓和流批一体的应用会有一个深刻认识，希望本文对你有所帮助。</p><blockquote data-tool="mdnice编辑器" style="border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">添加微信，回复"进群"，入大数据技术交流群<br  /></p></blockquote></section><p style="text-align: center;"><img class="rich_pages" data-ratio="1.2952127659574468" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/PL10rfzHicsgSwyuFAHrIHib40RYaGkyQxVn7629suCCWxJO5heFibm2q46Uz3thXuFDNciaunNiaXSdoiaPC3lFPlRw/640?wx_fmt=jpeg" data-type="jpeg" data-w="752" style=""  /></p><section data-role="outer" label="Powered by 135editor.com"><p><br  /></p><section data-tools="135编辑器" data-id="98929"><section style="display:flex;justify-content: space-between;align-items: flex-end;margin:10px auto;"><section style="display:flex;justify-content:center;align-items: flex-end;"><section style="width: auto;"><section style="width: 26px;margin-right: auto;margin-left: auto;"><img data-ratio="0.958904109589041" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgdKibaWckM9fQzrWpfuc71yvIicia4YIHPUz4DsMwia38gNOxlrz6819BI27foYdrJ2ISwn8ibIiaH4w9g/640?wx_fmt=png" data-type="png" data-w="73" data-width="100%" style="box-sizing:border-box;width:100%;display:block;"  /></section><section data-brushtype="text" style="text-align:center;font-size:14px;letter-spacing: 1.5px;color: #000;font-weight: bold;">点分享</section></section><section style="width: auto;margin-left: 10px;"><section style="width: 26px;margin-right: auto;margin-left: auto;"><img data-ratio="0.9594594594594594" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgdKibaWckM9fQzrWpfuc71yldtpS6vAy8Ynzib4HficzNTn4uzibVrHq1Xb0vowOsW80F49C5EPkZPIg/640?wx_fmt=png" data-type="png" data-w="74" data-width="100%" style="box-sizing:border-box;width:100%;display:block;"  /></section><section data-brushtype="text" style="text-align:center;font-size:14px;letter-spacing: 1.5px;color: #000;font-weight: bold;">点收藏</section></section></section><section style="display:flex;justify-content:center;align-items: flex-end;"><section style="width: auto;"><section style="width: 26px;margin-right: auto;margin-left: auto;"><img data-ratio="0.958904109589041" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgdKibaWckM9fQzrWpfuc71yzXCkMStSnPo2VaIVQd3wM3IicSxl3VRhUNqgvr40t8iaxOTFmb6vCiaLg/640?wx_fmt=png" data-type="png" data-w="73" data-width="100%" style="box-sizing:border-box;width:100%;display:block;"  /></section><section data-brushtype="text" style="text-align:center;font-size:14px;letter-spacing: 1.5px;color: #000;font-weight: bold;">点点赞</section></section><section style="width: auto;margin-left: 10px;"><section style="width: 26px;margin-right: auto;margin-left: auto;"><img data-ratio="0.9594594594594594" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgdKibaWckM9fQzrWpfuc71ybJJZIQ6cWbHicDX5kMicuq9FzjiaSNI1Qa7qQMb1PHvicRc9X1y6VILiaQw/640?wx_fmt=png" data-type="png" data-w="74" data-width="100%" style="box-sizing:border-box;width:100%;display:block;"  /></section><section data-brushtype="text" style="text-align:center;font-size:14px;letter-spacing: 1.5px;color: #000;font-weight: bold;">点在看</section></section></section></section></section></section><div class="msg_source_url"><a href="https://t.1yb.co/dkIa" target="_blank">阅读原文</a></div></content><div class="msg_source_url"><a href="https://t.1yb.co/dkIa" target="_blank">阅读原文</a></div>
</div>
</body>
</html>