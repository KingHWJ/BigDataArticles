<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"大数据技术与数仓","title":"快手基于 Flink 构建实时数仓场景化实践","time":"2021-08-26 08:30:00","timeStamp":"1629937800"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&mid=2247487182&idx=2&sn=a7086042c63718277a5b6456ad4f3772&chksm=fc8c186dcbfb917b0fde7c7cf343b3a90d6d949314f3986e0b22c6b7d68b559d2e02d1873693#rd" target="_blank">快手基于 Flink 构建实时数仓场景化实践</a></h1><div id="meta_content" class="rich_media_meta_list"><span class="rich_media_meta rich_media_meta_text">李天朔@快手&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">大数据技术与数仓&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2021-08-26 08:30:00</em></div><content><div class="reprint"><p>转自公众号：Flink 中文社区<br><a href="http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&mid=2247493350&idx=1&sn=8279865dfded0f60c4e12aea4e1be923" target="_blank" title="阅读原文">http://mp.weixin.qq.com/s?__biz=MzU3Mzg4OTMyNQ==&mid=2247493350&idx=1&sn=8279865dfded0f60c4e12aea4e1be923</a></p></div><section powered-by="xiumi.us" style="white-space: normal;max-width: 100%;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;line-height: 27.2px;box-sizing: border-box !important;overflow-wrap: break-word !important;" data-mpa-powered-by="yiban.io"><section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section donone="shifuMouseDownCard(&#39;shifu_c_008&#39;)" label="Copyright Reserved by PLAYHUDONG." style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section donone="shifuMouseDownCard(&#39;shifu_c_008&#39;)" label="Copyright Reserved by PLAYHUDONG." style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section donone="shifuMouseDownCard(&#39;shifu_c_008&#39;)" label="Copyright Reserved by PLAYHUDONG." style="margin-right: 0em;margin-left: 0em;padding: 0.5em 1em;max-width: 100%;border-style: none;background-color: rgb(245, 245, 245);box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="line-height: 1.75em;"><span style="color: rgb(89, 89, 89);"><span style="font-size: 15px;letter-spacing: 0.5px;">摘要：本文整理自快手数据技术专家李天朔在 5 月 22 日北京站 Flink Meetup 分</span><span style="letter-spacing: 0.5px;font-size: 15px;">享的议题《快手基于 Flink 构建实时数仓场景化实践》，内容包括：</span></span></section><section style="line-height: 1.75em;"><span style="font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.5px;font-size: 15px;color: rgb(89, 89, 89);"><br  /></span></section><ol class="list-paddingleft-2" style="list-style-type: decimal;"><li style="font-size: 15px;color: rgb(89, 89, 89);"><p><span style="font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.5px;font-size: 15px;color: rgb(89, 89, 89);">快手实时计算场景</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);"><p><span style="font-size: 15px;color: rgb(89, 89, 89);">快手实时数仓架构及保障措施</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);"><p><span style="font-size: 15px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.5px;color: rgb(89, 89, 89);">快手场景问题及解决方案</span></p></li><li style="font-size: 15px;color: rgb(89, 89, 89);"><p><span style="font-size: 15px;letter-spacing: 0.5px;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(89, 89, 89);">未来规划</span></p></li></ol><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">Tips：点击</span><span style="color: rgb(255, 79, 121);"><strong><span style="font-size: 15px;letter-spacing: 0.5px;">「阅读原文」获得更多精彩内容</span></strong></span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section></section><section><section class="mp_profile_iframe_wrp"><mpprofile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzU2ODQ3NjYyMA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsiaWUJ7uBrlIibLdUDlmsXrhE9b6ZXmFWGZFqzSQE7LFkL1XmLkmgAWibVYG7tpGyEjls5B0LWc8lkjg/0?wx_fmt=png" data-nickname="大数据技术与数仓" data-alias="bigdata_dw" data-signature="专注分享数据仓库与大数据技术(Flink/Hadoop/Spark/Hive)相关内容。关注我可以免费领取大数据书籍与视频。我的博客:https://jiamaoxiang.top/" data-from="0"></mpprofile></section><section style="line-height: 1.75em;"><br  /></section><section><section powered-by="xiumi.us"><section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></section><section style="white-space: normal;max-width: 100%;box-sizing: border-box;font-size: 16px;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;max-width: 100%;box-sizing: border-box;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;overflow-wrap: break-word !important;"><section style="padding: 3px;max-width: 100%;box-sizing: border-box;display: inline-block;border-bottom: 5px solid rgb(71, 193, 168);font-size: 18px;overflow-wrap: break-word !important;"><p cid="n12" mdtype="heading" style="text-align: left;max-width: 100%;box-sizing: border-box;min-height: 1em;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><span style="letter-spacing: 0.544px;">一、</span><span style="color:#595959;"><span style="letter-spacing: 0.5px;">快手实时计算场景</span></span></strong></p></section></section></section></section></section></section><section style="line-height: 1.75em;"><br  /></section></section><p cid="n15" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJNUEyNgE3qWyV2zSibuUYrp4tUPzzzA7iczf2EBpic8jhxBUFicpQiaNpKug/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">快手业务中的实时计算场景主要分为四块：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">公司级别</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">的核心数据：</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">包括公司经营大盘，实时核心日报，以及移动版数据。相当于团队会有公司的大盘指标，以及各个业务线，比如视频相关、直播相关，都会有一个核心的实时看</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">板；</span></p><p><br  /></p></li><li><p><strong style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">大型活动实时指标：</span></strong><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">其中最核心的内容是实时大屏。例如快手的春晚活动，我们会有一个总体的大屏去看总体活动现状。一个大型的活动会分为 N 个不同的模块，我们对每一个模块不同的玩法会有不同的实时数据看板；</span></p><p><br  /></p></li><li><p><strong style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">运营部分的数据：</span></strong><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">运营数据主要包括两方面，一个是创作者，另一个是内容。对于创作者和内容，在运营侧，比如上线一个大 V 的活动，我们想看到一些信息如直播间的实时现状，以及直播间对于大盘的牵引情况。基于这个场景，我们会做各种实时大屏的多维数据，以及大盘的一些数据。</span></p><p><br  /></p><p><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">此外，这块还包括运营策略的支撑，比如我们可能会实时发掘一些热点内容和热点创</span><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">作者，以及目前的一些热点情况。</span><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">我们基于这些热点情况输出策略，这个也是我们需要提供的一些支撑能力；</span></p><p><br  /></p><p><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">最后还包括 C 端数据展示，比如现在快手里有创作者中心和主播中心，这里会有一些如主播关播的关播页，关播页的实时数据有一部分也是我们做的。</span></p><p><br  /></p></li><li><p><strong style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">实时特征：</span></strong><span style="font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">包含搜索推荐特征和广告实时特征。</span></p></li></ul><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></section><section style="line-height: 1.75em;"><br  /></section><section><section><section powered-by="xiumi.us"><section><section style="white-space: normal;max-width: 100%;box-sizing: border-box;font-size: 16px;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;max-width: 100%;box-sizing: border-box;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;overflow-wrap: break-word !important;"><section style="padding: 3px;max-width: 100%;box-sizing: border-box;display: inline-block;border-bottom: 5px solid rgb(71, 193, 168);font-size: 18px;overflow-wrap: break-word !important;"><p cid="n12" mdtype="heading" style="max-width: 100%;box-sizing: border-box;min-height: 1em;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;">二、快手实时数仓架构及保障措施</strong></p></section></section></section></section></section></section></section><h3 cid="n30" mdtype="heading" style="white-space: normal;text-align: left;line-height: 1.75em;"><br  /></h3><h3 cid="n30" mdtype="heading" style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);">1. 目标及难点</span></strong></h3><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span><br  /></p><p cid="n32" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJ27ZtVMfBAXrca0BCDf2f02AU08DZV6XgMicoOxwh4UxA2ic4jKI4sHWA/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></p><h4 cid="n31" mdtype="heading"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">■ 1.1&nbsp;目标</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></h4><p><br  /></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">首先由于我们是做数仓的，因此希望所有的实时指标都有离线指标去对应，要</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">求实时指标和离线指标整体的数据差异在 1% 以内，这是最低标准。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">其次是数据延迟，其 SLA 标准是活动期间所有核心报表场景的数据延迟不能超过 5 分钟，这 5 分钟包括作业挂掉之后和恢复时间，如果超过则意味着 SLA 不达标。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">最后是稳定性，针对一些场景，比如作业重启后，我们的曲线是正常的，不会因为作业重启导致指标产出一</span><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">些明显的异常。</span></p></li></ul><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></section><h4 cid="n31" mdtype="heading" style="white-space: normal;text-align: left;line-height: 1.75em;"><br  /></h4><h4 cid="n31" mdtype="heading"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">■ 1.2&nbsp;难点</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></h4><p><br  /></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第一个难点是数据量大。每天整体的入口流量数据量级大概在万亿级。在活动</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">如春晚的场景，QPS 峰值能达到亿 / 秒。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第二个难点是组件依赖比较复杂。可能这条链路里有的依赖于 Kafka，有的依赖 Flink，还有一些依赖 KV 存储、RPC 接口、OLAP 引擎等，我们需要思考在这条链路里如何分布，才能让这些组件都能正常工作。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第三个难点是链路复杂。目前我们</span><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">有 200+ 核心业务作业，50+ 核心数据源，整体作业超过 1000。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><h3 cid="n50" mdtype="heading" style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);">2. 实时数仓 - 分层模型</span></strong></h3><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></p><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">基于上面三个难点，来看一下数仓架构：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n52" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJCAqDubmvQmZxxKmQO5UBedaCCUcrqMCacoOg299xwtGLeuicfbrYNLw/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">如上所示：</span></section><section style="line-height: 1.75em;"><br  /></section><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">最下层有三个不同的数据源，分别是客户端日志、服务端日志以及 Binlog 日</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">志；</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">在公共基础层分为两个不同的层次，一个是 DWD 层，做明细数据，另一个是 DWS 层，做公共聚合数据，DIM 是我们常说的维度。我们有一个基于离线数仓的主题预分层，这个主题预分层可能包括流量、用户、设备、视频的生产消费、风控、社交等。</span></p><p><br  /></p></li><ul class="list-paddingleft-2" style="list-style-type: square;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">DWD 层的核心工作是标准化的清洗；</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">DWS 层是把维度的数据和 DWD 层进行关联，关联之后生成一些通用粒度的聚合层次。</span></p><p><br  /></p></li></ul><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">再往上是应用层，包括一些大盘的数据，多维分析的模型以及业务专题数据；</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">最上面是场景。</span></p></li></ul><section><br  /></section><section><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">整体过程可以分为三步：</span></section><section><br  /></section><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第一步是做业务数据化，相当于把业务的数据接进来；</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第二步是数据资产化，意思是对数据做很多的清洗，然后形成一些规则有序的数据；</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第三步是数据业务化，可以理解数据在实时数据层面可以反哺业务，为业务数据价值建设提供一些赋能。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><h3 cid="n77" mdtype="heading" style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);">3. 实时数仓 - 保障措施</span></strong></h3><p><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);"><br  /></span></strong></p><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">基于上面的分层模型，来看一下整体的保障措施：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n79" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJUYONtr90solYs1UgcaS1wibWA9eqpM8fgZ8tWF2lfZs8icBUq3GK6krw/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">保障层面分为三个不同的部分，分别是质量保障，时效保障以及稳定保障。</span></section><section style="line-height: 1.75em;"><br  /></section><ul class="list-paddingleft-2" style="line-height: 1.75em;"><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">我们先看蓝色部分的质量保障。针对质量保障，可以看到在数据源阶段，做了如数据源的乱序监控，这是我们基于自己的 SDK 的采集做的，以及数据源和离线的一致性校准。研发阶段的计算过程有三个阶段，分别是研发阶段、上线阶段和服务阶段。</span></p><p style="line-height: 1.75em;"><br  /></p></li><ul class="list-paddingleft-2" style="line-height: 1.75em;list-style-type: square;"><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">研发阶段可能会提供一个标准化的模型，基于这个模型会有一些 Benchmark，并且做离线的比对验证，保证质量是一致的；</span></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">上线阶段更多的是服务监控和指标监控；</span></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">在服务阶段，如果出现一些异常情况，先做 Flink 状态拉起，如果出现了一些不符合预期的场景，我们会做离线的整体数据修复。</span></p><p style="line-height: 1.75em;"><br  /></p></li></ul><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第二个是时效性保障。针对数据源，我们把数据源的延迟情况也纳入监控。在研发阶段其实还有两个事情：</span></p><p style="line-height: 1.75em;"><br  /></p></li><ul class="list-paddingleft-2" style="line-height: 1.75em;list-style-type: square;"><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">首先是压测，常规的任务会拿最近 7 天或者最近 14 天的峰值流量去看它是否存在任务延迟的情况；</span></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">通过压测之后，会有一些任务上线和重启性能评估，相当于按照 CP 恢复之后，重启的性能是什么样子。</span></p><p style="line-height: 1.75em;"><br  /></p></li></ul><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">最后一个是稳定保障。这在大型活动中会做得比较多，比如切换演练和分级保障。我们会基于之前的压测结果做限流，目的是保障作业在超过极限的情况下，仍然是稳定的，不会出现很多的不稳定或者 CP 失败的情况。之后我们会有两种不同的标准，一种是冷备双机房，另外一种是热备双机房。</span></p><p style="line-height: 1.75em;"><br  /></p></li><ul class="list-paddingleft-2" style="line-height: 1.75em;list-style-type: square;"><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">冷备双机房是：当一个单机房挂掉，我们会从另一个机房去拉起；</span></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">热备双机房：相当于同样一份逻辑在两个机房各部署一次。</span></p></li></ul></ul><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">以上就是我们整体的保障措施。</span></section><section style="line-height: 1.75em;"><br  /></section><section><section><section powered-by="xiumi.us"><section><section style="white-space: normal;max-width: 100%;box-sizing: border-box;font-size: 16px;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;max-width: 100%;box-sizing: border-box;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;overflow-wrap: break-word !important;"><section style="padding: 3px;max-width: 100%;box-sizing: border-box;display: inline-block;border-bottom: 5px solid rgb(71, 193, 168);font-size: 18px;overflow-wrap: break-word !important;"><p cid="n12" mdtype="heading" style="text-align: left;max-width: 100%;box-sizing: border-box;min-height: 1em;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><span style="letter-spacing: 0.544px;">三、</span><span style="color:#595959;"><span style="letter-spacing: 0.5px;">快手场景问题及解决方案</span></span></strong></p></section></section></section></section></section></section><section style="line-height: 1.75em;"><br  /></section></section><h3 cid="n108" mdtype="heading" style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);">1. PV/UV 标准化</span></strong></h3><p><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);"><br  /></span></strong></p><h4 cid="n31" mdtype="heading" style="line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">■&nbsp;1.1 场景</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></h4><h4 cid="n109" mdtype="heading" style="line-height: 1.75em;"><br  /></h4><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第一个问题是 PV/UV 标准化，这里有三个截图：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n111" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJMRpBDt1elTm9BOc9tRsvejsQjCo9njaMI91kkBTNGnFzFtCpQY3JmA/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第一张图是春晚活动的预热场景，相当于是一种玩法，第二和第三张图是春晚当天的发红包活动和直播间截图。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">在活动进行过程中，我们发现 60~70% 的需求是计算页面里的信息，如：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><ul class="list-paddingleft-2" style="line-height: 1.75em;"><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">这个页面来了多少人，或者有多少人点击进入这个页面；</span></p><p style="line-height: 1.75em;"><br  /></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">活动一共来了多少人；</span></p><p style="line-height: 1.75em;"><br  /></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">页面里的某一个挂件，获得了多少点击、产生了多少曝光。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><h4 cid="n31" mdtype="heading" style="line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">■&nbsp;1.2 方案</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></h4><h4 cid="n122" mdtype="heading" style="line-height: 1.75em;"><br  /></h4><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">抽象一下这个场景就是下面这种 SQL：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n124" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJtNHlXaOpbXuJjiaaGErl2guu8LlIFRpBrzsfeib9VEHI3aerP6WPD7NA/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">简单来说，就是从一张表做筛选条件，然后按照维度层面做聚合，接着产生一些 Count 或者 Sum 操作。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">基于这种场景，我们最开始的解决方案如上图右边所示。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">我们用到了 Flink SQL 的 Early Fire 机制，从 Source 数据源取数据，之后做了 DID 的分桶。比如最开始紫色的部分按这个做分桶，先做分桶的原因是防止某一个 DID 存在热点的问题。分桶之后会有一个叫做 Local Window Agg 的东西，相当于数据分完桶之后把相同类型的数据相加。Local Window Agg 之后再按照维度进行 Global Window Agg 的合桶，合桶的概念相当于按照维度计算出最终的结果。Early Fire 机制相当于在 Local Window Agg 开一个天级的窗口，然后每分钟去对外输出一次。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">这个过程中我们遇到了一些问题，如上图左下角所示。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">在代码正常运行的情况下是没有问题的，但如果整体数据存在延迟或者追溯历史数据的情况，比如一分钟 Early Fire 一次，因为追溯历史的时候数据量会比较大，所以可能导致 14:00 追溯历史，直接读到了 14:02 的数据，而 14:01 的那个点就被丢掉了，丢掉了以后会发生什么？</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n130" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJ5P2ictlFTyLdOuRXk8vOleDnQp0wWWjHMibRRicEIz8NuuzDQ7E5ljg8Q/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">在这种场景下，图中上方的曲线为 Early Fire 回溯历史数据的结果。横坐标是分钟，纵坐标是截止到当前时刻的页面 UV，我们发现有些点是横着的，意味着没有数据结果，然后一个陡增，然后又横着的，接着又一个陡增，而这个曲线的预期结果其实是图中下方那种平滑的曲线。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">为了解决这个问题，我们用到了 Cumulate Window 的解决方案，这个解决方案在 Flink 1.13 版本里也有涉及，其原理是一样的。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n133" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJnMuZpficicGxWibqUlek4wPs7S0sFSAhGzbqLoSmgzJQCNlviaibUJZNIdw/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">数据开一个大的天级窗口，大窗口下又开了一个小的分钟级窗口，数据按数据本身的 Row Time 落到分钟级窗口。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">Watermark 推进过了窗口的 event_time，它会进行一次下发的触发，通过这</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">种方式可以解决回溯的问题，数据本身落在真实的窗口， Watermark 推进，在窗口结束后触发。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">此外，这种方式在一定程度上能够解决乱序的问题。比如它的乱序数据本身是一个不丢弃的状态，会记录到最新的累计数据。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">最后是语义一致性，它会基于事件时间，在乱序不严重的情况下，和离线计算出来的结果一致性是相当高的。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">以上是 PV/UV 一个标准化的解决方案。</span></section><section style="line-height: 1.75em;"><br  /></section><h3 cid="n144" mdtype="heading" style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);">2. DAU 计算</span></strong></h3><p><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);"><br  /></span></strong></p><h4 cid="n31" mdtype="heading" style="line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">■&nbsp;2.1 背景介绍</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></h4><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">下面介绍一下 DAU 计算：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n147" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJH0ZWrkleCVvCvUgsanvK020ncOSLPzgVgbicopbsa5B5ibOTt1ibjblag/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">我们对于整个大盘的活跃设备、新增设备和回流设备有比较多的监控。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><ul class="list-paddingleft-2" style="line-height: 1.75em;"><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">活跃设备指的是当天来过的设备；</span></p><p style="line-height: 1.75em;"><br  /></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">新增设备指的是当天来过且历史没有来过的设备；</span></p><p style="line-height: 1.75em;"><br  /></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">回流设备指的是当天来过且 N 天内没有来过的设备。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">但是我们计算过程之中可能需要 5~8 个这样不同的 Topic 去计算这几个指标。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">我们看一下离线过程中，逻辑应该怎么算。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">首先我们先算活跃设备，把这些合并到一起，然后做一个维度下的天级别去重，接着再去关联维度表，这个维度表包括设备的首末次时间，就是截止到昨天设备首次访问和末次访问的时间。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">得到这个信息之后，我们就可以进行逻辑计算，然后我们会发现新增和回流的设备其实是活跃设备里打的一个子标签。新增设备就是做了一个逻辑处理，回流设备是做了 30 天的逻辑处理，基于这样的解决方案，我们能否简单地写一个 SQL 去解决这个问题？</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">其实我们最开始是这么做的，但遇到了一些问题：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><ul class="list-paddingleft-2" style="line-height: 1.75em;"><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第一个问题是：数据源是 6~8 个，而且我们大盘的口径经常会做微调，如果是单作业的话，每次微调的过程之中都要改，单作业的稳定性会非常差；</span></p><p style="line-height: 1.75em;"><br  /></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第二个问题是：数据量是万亿级，这会导致两个情况，首先是这个量级的单作业稳定性非常差，其次是实时关联维表的时候用的 KV 存储，任何一个这样的 RPC 服务接口，都不可能在万亿级数据量的场景下保证服务稳定性；</span></p><p style="line-height: 1.75em;"><br  /></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第三个问题是：我们对于时延要求比较高，要求时延小于一分钟。整个链路要避免批处理，如果出现了一些任务性能的单点问题，我们还要保证高性能和可扩容。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><h4 cid="n31" mdtype="heading" style="line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">■&nbsp;2.2 技术方案</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></h4><h4 cid="n169" mdtype="heading" style="line-height: 1.75em;"><br  /></h4><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">针对以上问题，介绍一下我们是怎么做的：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n171" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJiaZe9be9lX3msNhOUVZTTvuy83IY1pM3GuviabT7icD2DDHLMXwwh7UPw/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">如上图的例子，第一步是对 A B C 这三个数据源，先按照维度和 DID 做分钟级别去重，分别去重之后得到三个分钟级别去重的数据源，接着把它们 Union 到一起，然后再进行同样的逻辑操作。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">这相当于我们数据源的入口从万亿变到了百亿的级别，分钟级别去重之后再进行一个天级别的去重，产生的数据源就可以从百亿变成了几十亿的级别。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">在几十亿级别数据量的情况下，我们再去关联数据服务化，这就是一种比较可行的状态，相当于去关联用户画像的 RPC 接口，得到 RPC 接口之后，最终写入到了目标 Topic。这个目标 Topic 会导入到 OLAP 引擎，供给多个不同的服务，包括移动版服务，大屏服务，指标看板服务等。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">这个方案有三个方面的优势，分别是稳定性、时效性和准确性。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">首先是稳定性。松耦合可以简单理解为当数据源 A 的逻辑和数据源 B 的逻辑需要修改时，可以单独修改。第二是任务可扩容，因为我们把所有逻辑拆分得非常</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">细粒度，当一些地方出现了如流量问题，不会影响后面的部分，所以它扩容比较简单，除此之外还有服务化后置和状态可控。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">其次是时效性，我们做到毫秒延迟，并且维度丰富，整体上有 20+ 的维度做多维聚合。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">最后是准确性，我们支持数据验证、实时监控、模型出口统一等。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">此时我们遇到了另外一个问题 - 乱序。对于上方三个不同的作业，每一个作业重启至少会有两分钟左右的延迟，延迟会导致下游的数据源 Union 到一起就会有乱序。</span></section><section style="line-height: 1.75em;"><br  /></section><h4 cid="n31" mdtype="heading" style="line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">■&nbsp;2.3 延迟计算方案</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></h4><h4 cid="n185" mdtype="heading" style="line-height: 1.75em;"><br  /></h4><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">遇到上面这种有乱序的情况下，我们要怎么处理？</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n187" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJKy38c40XK7ibEVceFDb8AurqmA1SgU4Js6mThZDNqXIuqhmsG2tq8iag/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">我们总共有三种处理方案：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><ul class="list-paddingleft-2" style="line-height: 1.75em;"><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第一种解决方案是用 “did + 维度 + 分钟” 进行去重，Value 设为 “是否来过”。比如同一个 did，04:01 来了一条，它会进行结果输出。同样的，04:02 和 04:04 也会进行结果输出。但如果 04：01 再来，它就会丢弃，但如果 04:00 来，依旧会进行结果输出。</span></p><p style="line-height: 1.75em;"><br  /></p><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">这个解决方案存在一些问题，因为我们按分钟存，存 20 分钟的状态大小是存 10 分钟的两倍，到后面这个状态大小有点不太可控，因此我们又换了解决方案 2。</span></p><p style="line-height: 1.75em;"><br  /></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第二种解决方案，我们的做法会涉及到一个假设前提，就是假设不存在数据源乱序的情况。在这种情况下，key 存的是 “did + 维度”，Value 为 “时间戳”，它的更新方式如上图所示。</span></p><p style="line-height: 1.75em;"><br  /></p><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">04:01 来了一条数据，进行结果输出。04:02 来了一条数据，如果是同一个 did，那么它会更新时间戳，然后仍然做结果输出。04：04 也是同样的逻辑，然后将时间戳更新到 04：04，如果后面来了一条 04：01 的数据，它发现时间戳已经更新到 04:04，它会丢弃这条数据。</span></p><p style="line-height: 1.75em;"><br  /></p><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">这样的做法大幅度减少了本身所需要的一些状态，但是对乱序是零容忍，不允许发生任何乱序的情况，由于我们不好解决这个问题，因此我们又想出了解决方案 3。</span></p><p style="line-height: 1.75em;"><br  /></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">方案 3 是在方案 2 时间戳的基础之上，加了一个类似于环形缓冲区，在缓冲区之内允许乱序。</span></p><p style="line-height: 1.75em;"><br  /></p><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">比如 04:01 来了一条数据，进行结果输出；04:02 来了一条数据，它会把时间戳更新到 04:02，并且会记录同一个设备在 04:01 也来过。如果 04:04 再来了一条数据，就按照相应的时间差做一个位移，最后通过这样的逻辑去保障它能够容忍一定的乱序。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">综合来看这三个方案：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">方案 1 在容忍 16 分钟乱序的情况下，单作业的状态大小在 480G 左右。这种情况虽然保证了准确性，但是作业的恢复和稳定性是完全不可控的状态，因此</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">我们还是放弃了这个方案；</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">方案 2 是 30G 左右的状态大小，对于乱序 0 容忍，但是数据不准确，由于我们对准确性的要求非常高，因此也放弃了这个方案；</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">方案 3 的状态跟方案 1 相比，它的状态虽然变化了但是增加的不多，而且整体能达到跟方案 1 同样的效果。方案 3 容忍乱序的时间是 16 分钟，我们正常更新一个作业的话，10 分钟完全足够重启，因此最终选择了方</span><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">案 3。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><h4 cid="n31" mdtype="heading" style="white-space: normal;text-align: left;line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(0, 122, 170);">3. 运营场景</span></strong></h4><h3 cid="n209" mdtype="heading" style="line-height: 1.75em;"><br  /></h3><h4 cid="n31" mdtype="heading" style="line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">■&nbsp;&nbsp;3.1 背景介绍</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></h4><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></p><p cid="n211" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJmj9kuuxfR8rSCXic1lbNrGtVKoKkcMibCF7gBlIkiazDgVOahG4gDPLLg/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">运营场景可分为四个部分：</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><ul class="list-paddingleft-2" style="list-style-type: disc;"><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第一个是数据大屏支持，包括单直播间的分析数据和大盘的分析数据，需要做到分钟级延迟，更新要求比较高；</span></p><p style="line-height: 1.75em;"><br  /></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第二个是直播看板支持，直播看板的数据会有特定维度的分析，特定人群支持，对维度丰富性要求比较高；</span></p><p style="line-height: 1.75em;"><br  /></p></li><li style="line-height: 1.75em;"><p style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第三个是数据策略榜单，这个榜单主要是预测热门作品、爆款，要求的是小时级别的数据，更新要求比较低；</span></p><p style="line-height: 1.75em;"><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第四个是 C 端实时指标展示，查询量比较大，但是查询模式比较固</span><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">定。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">下面进行分析这 4 种不同的状态产生的一些不同的场景。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n223" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJHt6wfMEOpXcv6dIVCxmTHicic8lmiahiaWXic98Pt1qCy9NfrXubuADqcrA/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">前 3 种基本没有什么差别，只是在查询模式上，有的是特定业务场景，有的是通用业务场景。</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">针对第 3 种和第 4 种，它对于更新的要求比较低，对于吞吐的要求比较高，过程之中的曲线也不要求有一致性。第 4 种查询模式更多的是单实体的一些查询，比如去查询内容，会有哪些指标，而且对 QPS 要求比较高。</span></section><section style="line-height: 1.75em;"><br  /></section><h4 cid="n31" mdtype="heading" style="line-height: 1.75em;"><strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">■&nbsp;3.2 技术方案</span></strong><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"></span></h4><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">针对上方 4 种不同的场景，我们是如何去做的？</span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n229" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJgwf07Qa0SGBsy9OzWIWCF9WEpX9y0x906ll14oRoOWcmfvNfvTCjzw/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><p><br  /></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">首先看一下基础明细层 (图中左方)，数据源有两条链路，其中一条链路是消费的流，比如直播的消费信息，还有观看 / 点赞 / 评论。经过一轮基础清洗，然后</span><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">做维度管理。上游的这些维度信息来源于 Kafka，Kafka 写入了一些内容的维度，放到了 KV 存储里边，包括一些用户的维度。</span></p><p><br  /></p><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">这些维度关联了之后，最终写入 Kafka 的 DWD 事实层，这里为了做性能的提升，我们做了二级缓存的操作。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">如图中上方，我们读取 DWD 层的数据然后做基础汇总，核心是窗口维度聚合生成 4 种不同粒度的数据，分别是大盘多维汇总 topic、直播间多维汇总 topic、作者多维汇总 topic、用户多维汇总 topic，这些都是通用维度的数据。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">如图中下方，基于这些通用维度数据，我们再去加工个性化维度的数据，也就是 ADS 层。拿到了这些数据之后会有维度扩展，包括内容扩展和运营维度的拓展，然后再去做聚合，比如会有电商实时 topic，机构服务实时 topic 和大 V 直播实时 topic。</span></p><p><br  /></p><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">分成这样的两个链路会有一个好处：一个地方处理的是通用维度，另一个地方处理的是个性化的维度。通用维度保障的要求会比较高一些，个性化维度则会做很多个性化的逻辑。如果这两个耦合在一起的话，会发现任务经常出问题，并且分不清楚哪个任务的职责是什么，构建不出这样的一个稳定层。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">如图中右方，最终我们用到了三种不同的引擎。简单来说就是 Redis 查询用到了 C 端的场景，OLAP 查询用到了大屏、业务看板的场景。</span></p></li></ul><section style="line-height: 1.75em;"><br  /></section><section><section><section powered-by="xiumi.us"><section><section style="white-space: normal;max-width: 100%;box-sizing: border-box;font-size: 16px;overflow-wrap: break-word !important;"><section powered-by="xiumi.us" style="margin-top: 10px;margin-bottom: 10px;max-width: 100%;box-sizing: border-box;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;overflow-wrap: break-word !important;"><section style="padding: 3px;max-width: 100%;box-sizing: border-box;display: inline-block;border-bottom: 5px solid rgb(71, 193, 168);font-size: 18px;overflow-wrap: break-word !important;"><p cid="n12" mdtype="heading" style="text-align: left;max-width: 100%;box-sizing: border-box;min-height: 1em;overflow-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;"><span style="letter-spacing: 0.544px;">四、</span><span style="color:#595959;"><span style="letter-spacing: 0.5px;">未来规划</span></span></strong></p></section></section></section></section></section></section><section style="line-height: 1.75em;"><br  /></section></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">上文一共讲了三个场景，第一个场景是标准化 PU/UV 的计算，第二个场景是 DAU 整体的解决方案，第三个场景是运营侧如何解决。基于这些内容，我们有一些未来规划，分为 4 个部分。<br  /></span></section><section style="line-height: 1.75em;"><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);"><br  /></span></section><p cid="n244" mdtype="paragraph"><img data-ratio="0.5625" src="https://mmbiz.qpic.cn/mmbiz_jpg/8AsYBicEePu4IrYyXKRlvmyfAXY0lMXzJwla3rO8Ttpt8w6Q7LMZZ8DA5m4YHKQYIdPYp3OlnqHa9LloH4rQbnA/640?wx_fmt=jpeg" data-type="jpeg" data-w="2000" style="box-sizing: border-box;border-width: 0px 4px 0px 2px;border-right-style: solid;border-left-style: solid;border-right-color: transparent;border-left-color: transparent;vertical-align: middle;image-orientation: from-image;cursor: default;transform: translateZ(0px);display: block;margin: auto;"  /></p><p><br  /></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第一部分是实时保障体系完善：</span></p><p><br  /></p></li><ul class="list-paddingleft-2" style="list-style-type: square;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">一方面做一些大型的活动，包括春晚活动以及后续常态化的活动。针对这些活动如何去保障，我们有一套规范去做平台化的建设；</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第二个是分级保障标准制定，哪些作业是什么样的保障级别 / 标准，会有一个标准化的说明；</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第三个是引擎平台能力推动解决，包括 Flink 任务的一些引擎，在这上面我们会有一个平台，基于这个平台去做规范、标准化的推动。</span></p><p><br  /></p></li></ul><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第二部分是实时数仓内容构建：</span></p><p><br  /></p></li><ul class="list-paddingleft-2" style="list-style-type: square;"><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">一方面是场景化方案的输出，比如针对活动会有一些通用化的方案，而不是每次活动都开发一套新的解决方案；</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">另一方面是内容数据层次沉淀，比如现在的数据内容建设，在厚度方面有一些场景的缺失，包括内容如何更好地服务于上游的场景。</span></p><p><br  /></p></li></ul><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第三部分是 Flink SQL 场景化构建，包括 SQL 持续推广、SQL 任务稳定性和 SQL 任务资源利用率。我们在预估资源的过程中，会考虑比如在什么样 QPS 的场景下， SQL 用什么样的解决方案，能支撑到什么情况。Flink SQL 可以大幅减少人效，但是在这个过程中，我们想让业务操作更加简单。</span></p><p><br  /></p></li><li><p><span style="font-size: 15px;letter-spacing: 0.5px;color: rgb(89, 89, 89);">第四部分是批流一体探索。实时数仓的场景其实就是做离线 ETL 计算加速，我们会有很多小时级别的任务，针对这些任务，每次批处理的时候有一些逻辑可以放到流处理去解决，这对于离线数仓 SLA 体系的提升十分巨大。</span></p></li></ul><section style="max-width: 100%;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></section><hr style="max-width: 100%;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);border-style: solid;border-right-width: 0px;border-bottom-width: 0px;border-left-width: 0px;border-color: rgba(0, 0, 0, 0.1);transform-origin: 0px 0px;transform: scale(1, 0.5);box-sizing: border-box !important;overflow-wrap: break-word !important;"  /><section style="max-width: 100%;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br  /></section><section style="max-width: 100%;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(89, 89, 89);font-size: 15px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.5px;box-sizing: border-box !important;overflow-wrap: break-word !important;">更多 Flink 相关技术问题，可扫码加入大数据技术交</span><span style="color: rgb(89, 89, 89);font-size: 15px;letter-spacing: 0.5px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">流群</span><span style="color: rgb(89, 89, 89);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 0.5px;">～</span></section><section style="max-width: 100%;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;min-height: 1em;background-color: rgb(255, 255, 255);line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"  /></section><section style="max-width: 100%;font-family: -apple-system, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;min-height: 1em;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img class="rich_pages" data-cropselx1="117" data-cropselx2="317" data-cropsely1="0" data-cropsely2="241" data-ratio="0.5555555555555556" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgYic9icrPjCqicQZOqicicQRjOr9ka3KSCgElNV1HLd89YxT5NMTUmMwhGyE7KFVo2I11Rta7icUMP2muA/640?wx_fmt=png" data-type="png" data-w="900" style="box-sizing: border-box !important;overflow-wrap: break-word !important;visibility: visible !important;width: 434px;height: 241px;"  /></section><section style="max-width: 100%;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);min-height: 1em;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;letter-spacing: 0.5px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(89, 89, 89);box-sizing: border-box !important;overflow-wrap: break-word !important;">▼ 关注「</span><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="color:#d94e6a;"><strong>大数据技术与数仓</strong></span></span><span style="max-width: 100%;font-size: 15px;color: rgb(89, 89, 89);box-sizing: border-box !important;overflow-wrap: break-word !important;">」，获取更多技术干货&nbsp;<span style="max-width: 100%;text-align: left;box-sizing: border-box !important;overflow-wrap: break-word !important;">▼</span></span></span></section><section class="mp_profile_iframe_wrp"><mpprofile class="js_uneditable custom_select_card mp_profile_iframe" data-pluginname="mpprofile" data-id="MzU2ODQ3NjYyMA==" data-headimg="http://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsiaWUJ7uBrlIibLdUDlmsXrhE9b6ZXmFWGZFqzSQE7LFkL1XmLkmgAWibVYG7tpGyEjls5B0LWc8lkjg/0?wx_fmt=png" data-nickname="大数据技术与数仓" data-alias="bigdata_dw" data-signature="专注分享数据仓库与大数据技术(Flink/Hadoop/Spark/Hive)相关内容。关注我可以免费领取大数据书籍与视频。我的博客:https://jiamaoxiang.top/" data-from="0"></mpprofile><span style="background-color: rgb(255, 255, 255);color: rgb(217, 78, 106);font-family: &quot;Microsoft YaHei&quot;, &quot;Segoe UI&quot;, system-ui, Roboto, &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif, Tahoma, &quot;Segoe UI SymbolMyanmar Text&quot;, 微软雅黑;font-size: 12px;letter-spacing: 0.5px;text-align: left;white-space: pre-wrap;"></span></section><div class="msg_source_url"><a href="http://mp.weixin.qq.com/mp/homepage?__biz=MzU2ODQ3NjYyMA==&hid=5&sn=512054e59f6ed54bd7e5f451785e82c9&scene=18#wechat_redirect" target="_blank">阅读原文</a></div></content><div class="msg_source_url"><a href="http://mp.weixin.qq.com/mp/homepage?__biz=MzU2ODQ3NjYyMA==&hid=5&sn=512054e59f6ed54bd7e5f451785e82c9&scene=18#wechat_redirect" target="_blank">阅读原文</a></div>
</div>
</body>
</html>