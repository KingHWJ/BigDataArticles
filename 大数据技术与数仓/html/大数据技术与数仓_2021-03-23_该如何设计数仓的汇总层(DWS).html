<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"大数据技术与数仓","title":"该如何设计数仓的汇总层(DWS)","time":"2021-03-23 08:30:00","timeStamp":"1616459400"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&mid=2247486511&idx=1&sn=5a959ce84ea93d41e51efc7b61e855f3&chksm=fc8c1a8ccbfb939a193eea96a27f562bfdb6d8a10325d0783fbd73c3ffdbd87ffc7668f5d979#rd" target="_blank">该如何设计数仓的汇总层(DWS)</a></h1><div id="meta_content" class="rich_media_meta_list"><span id="copyright_logo" class="wx_tap_link js_wx_tap_highlight rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_text">西贝&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">大数据技术与数仓&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2021-03-23 08:30:00</em></div><content><div class="topic"><p>收录于话题</p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1516633651147554819#wechat_redirect" title="OLAP" target="_blank">#OLAP</a><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1502493234856574979#wechat_redirect" title="SQL" target="_blank">#SQL</a><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1756056890591002628#wechat_redirect" title="维度建模" target="_blank">#维度建模</a><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1344435576086560769#wechat_redirect" title="数仓" target="_blank">#数仓</a><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1502493234823020547#wechat_redirect" title="Hive" target="_blank">#Hive</a></p></div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px;white-space: normal;line-height: 1.6;word-break: break-word;word-wrap: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;padding: 5px;color: rgb(53, 53, 53);word-spacing: 0.8px;letter-spacing: 0.8px;border-top-left-radius: 16px;border-top-right-radius: 16px;border-bottom-right-radius: 16px;border-bottom-left-radius: 16px;"><section data-role="outer" label="Powered by 135editor.com" style="caret-color: rgb(0, 0, 0);color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;text-align: left;white-space: normal;"><section data-tools="135编辑器" data-id="92356"><section data-role="paragraph" style="border: 0px none;box-sizing: border-box;"><section style="padding: 10px;box-sizing: border-box;"><section data-width="97%" style="box-sizing: border-box;width: 521.859375px;"><section style="margin-bottom: -30px;display: -webkit-flex;justify-content: flex-end;transform: translateZ(10px);"><section style="margin-right: -15px;box-sizing: border-box;width: 40px;"><section style="box-sizing: border-box;width: 40px;"><img data-ratio="1.3246753246753247" src="https://mmbiz.qpic.cn/mmbiz_png/uN1LIav7oJibnXRTwzul99YfpqjjVFWoFABPTfAIWeODwwzprdQd6xO6w5PTntPoJBicOa9kS1N0jqL5dkXJAwhQ/640?wx_fmt=png" data-type="png" data-w="77" data-width="100%" style="box-sizing: border-box;width: 40px;display: block;"  /></section></section></section><section style="margin-bottom: -15px;margin-left: 45px;transform: translateZ(10px);"><section style="padding-right: 8px;padding-left: 8px;display: inline-block;background-color: rgb(249, 231, 192);font-size: 18px;color: rgb(237, 91, 115);box-sizing: border-box;"><p data-brushtype="text"><br  /></p></section></section><section data-bgless="spin" data-bglessp="120" style="padding-bottom: 15px;background-color: rgb(236, 234, 233);border: 1px solid transparent;display: -webkit-flex;justify-content: flex-end;box-sizing: border-box;"><section data-width="100%" style="margin-top: -15px;margin-right: -15px;margin-left: 15px;padding: 15px;box-sizing: border-box;width: 519.859375px;background-color: rgb(249, 231, 192);box-shadow: rgb(204, 204, 204) 0px 0px 2px;"><section style="padding: 15px;border: 2px solid rgb(254, 254, 254);line-height: 26px;box-sizing: border-box;"><p>如果本文对你有所帮助，请分享、点赞、在看，想要获得更多信息，请关注我。</p><p>欢迎扫描文末二维码加我微信，回复【进群】，可以加入大数据技术交流群，期待与你一起交流<br  /></p></section></section></section></section></section></section></section></section><section data-tools="135编辑器" data-id="102462" style="caret-color: rgb(0, 0, 0);color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;text-align: left;white-space: normal;"><section style="margin: 10px auto;text-align: center;"><section style="margin-top: -40px;"><section style="margin-top: -14px;display: flex;justify-content: flex-end;"><section style="box-sizing: border-box;width: 45px;"><img data-ratio="0.5283018867924528" src="https://mmbiz.qpic.cn/mmbiz_png/FIBZec7ucCjv9me2lz9aUeUY91fHaIhIODzyCn62XtvA8ictTjkd5ym0o2hmxRTy2K38hcANQmK9qHyic4L7ohNA/640?wx_fmt=png" data-type="png" data-w="53" data-width="100%" style="box-sizing: border-box;width: 45px;display: block;"  /></section></section></section></section></section><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 1.75;margin-top: 0.8em;margin-bottom: 0.8em;">关于数据仓库的分层，似乎大家都有一个共同的认识。但涉及到每一层该如何去建模，可能每个人都有自己的理解。数据建模，毫无疑问是数仓建设的重中之重，然后，在实际的开发过程中，会把大量的时间都投入到了需求开发，往往会忽略数据建模(尤其是DWS层的建模)，长此以往，数据模型变的越来越杂乱，指标口径无法统一，造成的结果就是：虽然表很多，但是却很难取数。本文主要介绍DWS层建模的基本方法论，希望对你有所帮助。<br  /></p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;"><span style="font-size: 16px;color: rgb(34, 34, 34);">数仓为什么要分层</span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 1.75;margin-top: 0.8em;margin-bottom: 0.8em;">合理的数据仓库分层一方面能够降低耦合性，提高重用性，可读性可维护性，另一方面也能提高运算的效率，影响到数据需求迭代的速度，近而影响到产品决策的及时性。建立数据分层可以提炼公共层，避免烟囱式开发，可见一个合适且合理的数仓分层是极其重要。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;"><span style="font-size: 16px;color: rgb(34, 34, 34);">通用分层设计思路</span></h3><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: rgb(248, 57, 41);" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">ODS</span>:操作型数据(Operational Data Store)，指结构与源系统基本保持一致的增量或者全量数据。作为DW数据的一个数据准备区，同时又承担基础数据记录历史变化，之所以保留原始数据和线上原始数据保持一致，方便后期数据核对需要。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">CDM</span>：通用数据模型，又称为数据中间层(Common Data Model)，包含DWD、DWS、DIM层。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">DWD</span>：数据仓库明细层数据(Data Warehouse Detail)。对ODS层数据进行清洗转化，以业务过程作为建模驱动，基于每个具体的业务过程特点，构建最细粒度的明细事实表。可以结合企业的数据使用特点，基于维度建模思想，将明细事实表的某些重要属性字段做适当冗余，也即宽表化处理，构建明细宽表。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">DWS</span>：数据仓库汇总层数据(Data Warehouse Summary)，基于指标需求，构建初步汇总事实表，一般是宽表。基于上层的应用和产品的指标需求，构建公共粒度的汇总指标表。以宽表化手段物理化模型，构建命名规范、口径一致的统计指标，为上层提供公共指标。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">DIM</span>：建立一致数据分析维表，可以降低数据计算口径不统一的风险，同时可以方便进行交叉探查。以维度作为建模驱动，基于每个维度的业务含义，通过添加维度属性、关联维度等定义计算逻辑，完成属性定义的过程并建立一致的数据分析维表。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">ADS</span>：面向应用的数据服务层(Application Data Service)。整合汇总成分析某一个主题域的服务数据，面向应用逻辑的数据加工。该层主要存放数据产品个性化的统计指标数据，这一层的数据直接对接数据的消费者，是产品、运营等角色可以直接感知理解的一层，大多数这一层的表都可以直接在BI上通过图表的形式直接透出。</section></li></ul><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;"><span style="font-size: 16px;color: rgb(34, 34, 34);">没有DWS层不行吗</span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 1.75;margin-top: 0.8em;margin-bottom: 0.8em;">当我们在做数据需求时，会不会有这样的疑问：<span style="font-weight: 700;color: rgb(248, 57, 41);">我直接能从DWD层很方便的取出想要的数据，为什么还要多此一举建立DWS层的汇总表呢</span>？那是不是意味着可以不用建立DWS层的表呢，答案是：**可以的。**但是这有一个前提，就是业务场景不复杂。从短期来看可以快速满足数据需求的开发，但是长期来看，会存在如下的问题：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: rgb(248, 57, 41);" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">对于复杂的业务场景而言，会出现很多跨域、跨事实的交叉探查，如果没有沉淀出DWS层的指标进行统一口径的收口，那么相同的指标会出现不同的口径和命名，其后果就是取数变得越来越不方便，而且容易造成业务怀疑数据是否正确的尴尬局面。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">公共指标没有统一计算，当每次需要相同的指标时，则需要重新计算一遍取数逻辑，不仅效率不高(需要关联表，计算指标)，而且会造成计算资源浪费。</section></li></ul><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;"><span style="font-size: 16px;color: rgb(34, 34, 34);">DWS层设计</span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 1.75;margin-top: 0.8em;margin-bottom: 0.8em;">以分析的主题对象作为建模驱动，基于上层的应用和产品的指标需求，构建公共粒度的汇总指标表。以宽表化手段物理化模型，构建命名规范、口径一致的统计指标，为上层提供公共指标，建立汇总宽表。如：形成日，周，月粒度汇总明细，或者基于某一个维度，如商品类目粒度的汇总日表，统计便于下一步报表数据结构的组织。</p><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;">DWS层的基本特点</h4><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: rgb(248, 57, 41);" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">DWS层是面向分析维度进行设计的，分析维度通常是业务经常需要的看数据的角度。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">DWS层的表服务于数据报表和数据产品的指标需求</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">ADS层的指标数据会存在交叉探查的情况，所以DWS层的指标要保持命名和口径一致，避免ADS层的指标数据混乱</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">DWS是公共汇总层，提供不同维度的统计指标，指标的口径要保持一致，并且要提供详细的描述</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">以宽表的形式进行设计，比如相同粒度的统计指标可以放在一起，避免创建太多的表</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">公共汇总层的一个表通常会对应一个派生指标</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">DWS存储派生指标(统计周期+修饰词+统计粒度+原子指标)，原子指标存储在DWD层的事实表中</section></li></ul><blockquote data-tool="mdnice编辑器" style="border: none;font-size: 0.9em;overflow: auto;margin-bottom: 20px;margin-top: 20px;padding-top: 15px;padding-right: 10px;padding-bottom: 15px;line-height: 1.75;border-top-left-radius: 13px;border-top-right-radius: 13px;border-bottom-right-radius: 13px;border-bottom-left-radius: 13px;color: rgb(53, 53, 53);background-color: rgb(245, 245, 245);"><span style="display: block;font-size: 2em;color: rgb(248, 57, 41);font-family: Arial, serif;line-height: 1em;font-weight: 700;">“</span><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;font-size: 16px;margin-right: 10px;margin-left: 10px;">原子指标与派生指标</p><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;font-size: 16px;margin-right: 10px;margin-left: 10px;">所谓<span style="font-weight: 700;color: rgb(248, 57, 41);">原子指标</span>，即是业务过程的度量，就是明细事实表中的度量值。比如订单表，那么某个订单对应的订单金额就是一个原子指标，这个指标是伴随着订单的业务过程而产生的。</p><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;font-size: 16px;margin-right: 10px;margin-left: 10px;">所谓<span style="font-weight: 700;color: rgb(248, 57, 41);">派生指标</span>，即由<span style="font-weight: 700;color: rgb(248, 57, 41);">统计周期+修饰词+统计粒度+原子指标</span>组合加工而成的指标</p><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;font-size: 16px;margin-right: 10px;margin-left: 10px;">其中，<span style="font-weight: 700;color: rgb(248, 57, 41);">统计周期</span>：指的是想要统计的时间周期，比如天、周、月</p><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;font-size: 16px;margin-right: 10px;margin-left: 10px;">&nbsp;&nbsp;<span style="font-weight: 700;color: rgb(248, 57, 41);">修饰词</span>：指的是业务的约束，<span style="font-weight: 700;color: rgb(248, 57, 41);">通常出现在SQL的where条件中</span>，比如订单的下单渠道等等</p><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;font-size: 16px;margin-right: 10px;margin-left: 10px;">&nbsp;&nbsp;<span style="font-weight: 700;color: rgb(248, 57, 41);">统计粒度</span>：指的是维度组合，<span style="font-weight: 700;color: rgb(248, 57, 41);">通常出现在SQL的group by中</span>，比如统计商品一级类目对应的销售额，那一级类目就是统计粒度</p><span style="float: right;display: block;font-size: 2em;color: rgb(248, 57, 41);font-family: Arial, serif;line-height: 1em;font-weight: 700;">”</span></blockquote><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;">DWS层的设计原则</h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 1.75;margin-top: 0.8em;margin-bottom: 0.8em;">关于汇总层的表建模应遵循以下的原则：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: rgb(248, 57, 41);" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">数据公用性</span>比如，汇总的聚集表能否与他人公用？基于某个维度的聚集是否是数据分析或者报表中经常使用的？如果满足这些情况，我们就有必要把明细数据沉淀到汇总表中。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">不跨数据域</span>数据域是在较高层次上对数据进行分类聚集的抽象，如交易统一划到交易域下，商品的新增、修改放到商品域下。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">区分统计周期</span>表命名上要能说明数据的统计周期，如_1d 表示最近1天，_td 截止到当天，_nd 表示最近N天。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">避免多个层级的数据</span>应该避免将不同层级的数据放在一起，比如，如果存在7天和30天的事实，我们可以选择用两列存放7天和30天的事实，但是需要在列名和字段注释上说明清楚。同时我们也可以使用两张表分别存储不同统计周期的数据加以区分。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);"><span style="font-weight: 700;color: rgb(248, 57, 41);">聚集是不跨越事实的</span>聚集是针对原始星型模型进行的汇总，为了获取和查询原始模型一致的结果，聚集的维度和度量必须与原始模型保持一致，因此聚集是不跨事实的。横向钻取(交叉探查)是针对多个事实基于一致性维度进行的分析，很多时候采用融合事实表，预先存放横向钻取的结果，从而提高查询性能。因此融合事实表是一种导出模式而不是聚集。</section></li></ul><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;">DWS层设计步骤</h4><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: rgb(248, 57, 41);" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">首先，确定聚集维度，即确定统计粒度，比如商品粒度</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">然后，确定统计周期，比如天</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(53, 53, 53);">最后，确定聚集事实，即派生指标</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;border-top-left-radius: 5px;border-top-right-radius: 5px;border-bottom-right-radius: 5px;border-bottom-left-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsjnKmRfFTjnx4Br3JVicYxQk0ibY50BJJWMYwFv4KZZrGD9L6D8wic3Nic5guoFKQGuLBL77FlBJibBM8g/640?wx_fmt=png&quot;);height: 30px;width: 774px;background-size: 40px;background-color: rgb(40, 44, 52);margin-bottom: -7px;border-top-left-radius: 5px;border-top-right-radius: 5px;border-bottom-right-radius: 5px;border-bottom-left-radius: 5px;background-position: 10px 10px;background-repeat: no-repeat no-repeat;"></span><code style="overflow-x: auto;padding: 15px 16px 16px;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background-color: rgb(40, 44, 52);border-top-left-radius: 5px;border-top-right-radius: 5px;border-bottom-right-radius: 5px;border-bottom-left-radius: 5px;background-position: initial initial;background-repeat: initial initial;"><span style="color: rgb(198, 120, 221);line-height: 26px;">CREATE</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">TABLE</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">IF</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">NOT</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">EXISTS</span>&nbsp;dws_asale_trd_itm_ord_1d<br  />(<br  />&nbsp;&nbsp;&nbsp;&nbsp;item_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(230, 192, 123);line-height: 26px;">BIGINT</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">COMMENT</span>&nbsp;<span style="color: rgb(152, 195, 121);line-height: 26px;">'商品ID'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;item_title&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">STRING</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">COMMENT</span>&nbsp;<span style="color: rgb(152, 195, 121);line-height: 26px;">'商品名称'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;cate_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(230, 192, 123);line-height: 26px;">BIGINT</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">COMMENT</span>&nbsp;<span style="color: rgb(152, 195, 121);line-height: 26px;">'商品类目ID'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;cate_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">STRING</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">COMMENT</span>&nbsp;<span style="color: rgb(152, 195, 121);line-height: 26px;">'商品类目名称'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;mord_prov&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">STRING</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">COMMENT</span>&nbsp;<span style="color: rgb(152, 195, 121);line-height: 26px;">'收货人省份'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;confirm_paid_amt_sum_1d&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">DOUBLE</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">COMMENT</span>&nbsp;<span style="color: rgb(152, 195, 121);line-height: 26px;">'最近一天订单已经确认收货的金额总和'</span><br  />)<br  /><span style="color: rgb(198, 120, 221);line-height: 26px;">COMMENT</span>&nbsp;<span style="color: rgb(152, 195, 121);line-height: 26px;">'商品粒度交易最近一天汇总事实表'</span><br  />PARTITIONED&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">BY</span>&nbsp;(ds&nbsp;&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">STRING</span>&nbsp;<span style="color: rgb(198, 120, 221);line-height: 26px;">COMMENT</span>&nbsp;<span style="color: rgb(152, 195, 121);line-height: 26px;">'分区字段YYYYMMDD'</span>)<br  />;<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;"><span style="font-size: 16px;color: rgb(34, 34, 34);">关于DWS层建设的一些问题</span></h3><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;">为什么一张DWS表通常只会对应一个派生指标？</h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 1.75;margin-top: 0.8em;margin-bottom: 0.8em;">在设计DWS表的时候，很多人会把所有可以聚合的维度进行cube，这样就得到了很多个派生指标，而这些派生指标放在同一张表中无疑会增加这张表的使用难度，比如在实际的取数时，往往只关心某个统计粒度的指标。实际上cube的数据尽量放在ADS层，这样在开发数据接口或者应用层取数时都会比较方便。所以在设计DWS层时，应当遵循前文提到的一些原则，一言以蔽之，就是设计尽量体现出公共性、使用简单并且用户很容易理解。</p><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;">怎么设计出完美的DWS层表？</h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 1.75;margin-top: 0.8em;margin-bottom: 0.8em;">数仓建设是一个不断迭代的过程，数据建模同样是一个不断迭代的过程。同时，业务是不断变化的，建模人员对业务的理解也是变化的，这些也就注定了建模是一个迭代过程。虽然存在这些变化，但我们在数据建模的时候同样要遵循一定的规范，切不可随心所欲。</p><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 18px;">如何评价DWS层建设的好坏？</h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 1.75;margin-top: 0.8em;margin-bottom: 0.8em;">由于数仓的建设是与业务息息相关的，数仓建设的方法论仅仅只是指引我们构建数仓的一个方向，在实际的落地执行过程中会存在各种各样的问题，且不可被这些理论所禁锢。简单一句话就是：合适就好。所以，评价模型的好坏与否，更多的是从使用者的角度出发，比如简单、易于取数、表的数量恰好。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;"><span style="font-size: 16px;color: rgb(34, 34, 34);">总结</span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 1.75;margin-top: 0.8em;margin-bottom: 0.8em;">本文主要介绍了数据仓库中DWS建设的基本思路，包括DWS层的特点、设计原则以及设计步骤，并对DWS层建设存在的一些问题进行了阐述。当然，这些只是DWS层建模的一些方法论，智者见智仁者见仁，在实际的数据建模过程中可以参考这些方法论，但也要注意与具体的业务场景相结合，数据建模是建立在自己对业务的理解基础之上的，切不可一味地照搬，要灵活运用。另外，不要苛求建立完美的数据模型，应当追求简单、方便、易用。换句话说，建模没有对错之分，合适就好。</p><section style="display: flex;justify-content: flex-start;align-items: flex-end;"><section data-width="100%" style="box-sizing: border-box;width: 507px;border-bottom-width: 1px;border-bottom-style: solid;border-bottom-color: rgb(229, 82, 35);color: rgb(229, 82, 35);"><section data-brushtype="text" style="font-size: 16px;text-align: left;"><span style="font-size: 17px;">往期精彩回顾</span></section></section><section style="display: flex;justify-content: center;"><section style="margin-left: 5px;box-sizing: border-box;width: 2px;height: 2px;background-color: rgb(226, 65, 14);overflow: hidden;"><br  /></section><section style="margin-right: 5px;margin-left: 5px;box-sizing: border-box;width: 2px;height: 2px;background-color: rgb(226, 65, 14);overflow: hidden;"><br  /></section><section style="box-sizing: border-box;width: 2px;height: 2px;background-color: rgb(226, 65, 14);overflow: hidden;"><br  /></section></section></section><p style="caret-color: rgb(229, 82, 35);color: rgb(229, 82, 35);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 14px;text-align: center;white-space: normal;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&amp;mid=2247484561&amp;idx=1&amp;sn=70af9e747e7b1ec121dbd430b4309c5d&amp;chksm=fc8c1232cbfb9b24ddc803d85f940f7a4acb5b00cdcc079599f026a212da56ccf9810e713213&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">数仓开发应避免的10个陷阱</a><br  /></p><p style="caret-color: rgb(229, 82, 35);color: rgb(229, 82, 35);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 14px;text-align: center;white-space: normal;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&amp;mid=2247485606&amp;idx=1&amp;sn=1dfd0fba7c2c903cc887a88cd25b8211&amp;chksm=fc8c1e05cbfb97134879d36808cfbcb5439feb468585d751d1e016a6c8fb2981d01585725a6f&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">数仓|几种SQL隐藏的错误，你遇到过吗？</a><br  /></p><p style="caret-color: rgb(229, 82, 35);color: rgb(229, 82, 35);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 14px;text-align: center;white-space: normal;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&amp;mid=2247484865&amp;idx=1&amp;sn=ffcb7f1f56aa8d5df61386778491677a&amp;chksm=fc8c1362cbfb9a7480c5c5a1cfa07d3d586cca75c15e4ab95eb1bf750972d87c34875a7b8eb2&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">数仓面试|四个在工作后才知道的SQL密技</a><br  /></p><p style="caret-color: rgb(229, 82, 35);color: rgb(229, 82, 35);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 14px;text-align: center;white-space: normal;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&amp;mid=2247484633&amp;idx=1&amp;sn=4318c44a7ba10c8f98ae17f1a13bf20f&amp;chksm=fc8c127acbfb9b6cd38eb4f12e1598beb47779d8ab2085d2f100f09766fbb3cd6c05f2560e0d&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">数仓|大数据时代,维度建模过时了吗?</a><br  /></p><p style="caret-color: rgb(229, 82, 35);color: rgb(229, 82, 35);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 14px;text-align: center;white-space: normal;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&amp;mid=2247484622&amp;idx=1&amp;sn=09a652b7ee8d03cd5581cc57931420bf&amp;chksm=fc8c126dcbfb9b7b7d74d4cd7716c86d27592ac42c3e6a676880ededfff1d7f72df2dec0b4b8&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">数仓规范|使SQL更易于阅读的几个小技巧</a></p><p style="caret-color: rgb(229, 82, 35);color: rgb(229, 82, 35);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 14px;text-align: center;white-space: normal;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&amp;mid=2247486456&amp;idx=1&amp;sn=8ebcb9db2bf9e84d2b0e73dfc4a094f5&amp;chksm=fc8c1d5bcbfb944d508c69db99adfe3c73e926b86c734b2cf1a0600489c391720591a3986df1&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">关于构建数据仓库的几个问题</a><br  /></p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.5555555555555556" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgYic9icrPjCqicQZOqicicQRjOr9ka3KSCgElNV1HLd89YxT5NMTUmMwhGyE7KFVo2I11Rta7icUMP2muA/640?wx_fmt=png" data-type="png" data-w="900" style=""  /></p></section><p><br  /></p><div class="msg_source_url"><a href="https://t.1yb.co/dkIa" target="_blank">阅读原文</a></div></content><div class="msg_source_url"><a href="https://t.1yb.co/dkIa" target="_blank">阅读原文</a></div>
</div>
</body>
</html>