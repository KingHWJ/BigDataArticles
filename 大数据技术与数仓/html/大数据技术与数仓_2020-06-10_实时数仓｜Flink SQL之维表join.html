<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"大数据技术与数仓","title":"实时数仓|Flink SQL之维表join","time":"2020-06-10 08:25:00","timeStamp":"1591748700"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&mid=2247484489&idx=1&sn=5990725c4d675093a030d9444b7dbdc9&chksm=fc8c12eacbfb9bfc8d1e1993da8ddb176eae6c3cd92274a3b1f104978e54d2e296fc356430a2#rd" target="_blank">实时数仓|Flink SQL之维表join</a></h1><div id="meta_content" class="rich_media_meta_list"><span id="copyright_logo" class="wx_tap_link js_wx_tap_highlight rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_text">西贝&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">大数据技术与数仓&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2020-06-10 08:25:00</em></div><content><div class="topic"><p>收录于话题</p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1344435576086560769#wechat_redirect" title="数仓" target="_blank">#数仓</a></p></div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px;color: black;padding-right: 10px;padding-left: 10px;line-height: 1.6;letter-spacing: 0px;word-break: break-word;overflow-wrap: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;margin-top: -10px;"><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="95324"><section style="width: 100%;" data-width="100%"><section style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgLBTN9IHtVKibXSic7BB1NOAic66I4CfAEgibtgbMmeKqGicnrQoyNjQxpyokh1ib3pibScJGY9183ZUfSA/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-attachment: initial;background-origin: initial;background-clip: initial;background-size: 100%;background-position: center bottom;"><section data-brushtype="text" style="text-align: center;padding-top: 20px;padding-bottom: 6px;padding-left: 20px;letter-spacing: 1.5px;font-size: 14px;color: rgb(136, 136, 136);box-sizing: border-box;"><span style="font-size: 12px;">点击上方“蓝字”关注我们</span></section></section></section></section></section><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">维表是数仓中的一个概念，维表中的维度属性是观察数据的角度，在建设离线数仓的时候，通常是将维表与事实表进行关联构建星型模型。在实时数仓中，同样也有维表与事实表的概念，其中事实表通常存储在kafka中，维表通常存储在外部设备中(比如MySQL，HBase)。对于每条流式数据，可以关联一个外部维表数据源，为实时计算提供数据关联查询。维表可能是会不断变化的，在维表JOIN时，需指明这条记录关联维表快照的时刻。需要注意是，目前Flink SQL的维表JOIN仅支持对当前时刻维表快照的关联(处理时间语义)，而不支持事实表rowtime所对应的的维表快照(事件时间语义)。通过本文你可以了解到：<br  /></p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">如何使用Flink SQL创建表</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">如何定义Kafka数据源表</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">如何定义MySQL数据源表</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">什么是Temporal Table Join</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">维表join的案例</section></li></ul><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">Flink SQL创建表</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>注意</strong>：本文的所有操作都是在Flink SQL cli中进行的</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>创建表的语法<span style="display: none;"></span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;[catalog_name.][db_name.]table_name<br  />&nbsp;&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&lt;column_definition&gt;&nbsp;|&nbsp;&lt;computed_column_definition&gt;&nbsp;}[&nbsp;,&nbsp;...n]<br  />&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&lt;watermark_definition&gt;&nbsp;]<br  />&nbsp;&nbsp;)<br  />&nbsp;&nbsp;[<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;table_comment]<br  />&nbsp;&nbsp;[PARTITIONED&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;(partition_column_name1,&nbsp;partition_column_name2,&nbsp;...)]<br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(key1=val1,&nbsp;key2=val2,&nbsp;...)<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;定义表字段</span><br  />&lt;column_definition&gt;:<br  />&nbsp;&nbsp;column_name&nbsp;column_type&nbsp;[<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;column_comment]<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;定义计算列</span><br  />&lt;computed_column_definition&gt;:<br  />&nbsp;&nbsp;column_name&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;computed_column_expression&nbsp;[<span style="font-weight: bold;line-height: 26px;">COMMENT</span>&nbsp;column_comment]<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;定义水位线</span><br  />&lt;watermark_definition&gt;:<br  />&nbsp;&nbsp;WATERMARK&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;rowtime_column_name&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;watermark_strategy_expression<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>解释<span style="display: none;"></span></h3><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>COMPUTED COLUMN(计算列)<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">计算列是一个通过<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">column_name AS computed_column_expression</code>生成的虚拟列，产生的计算列不是物理存储在数据源表中。一个计算列可以通过原有数据源表中的某个字段、运算符及内置函数生成。比如，定义一个消费金额的计算列(cost)，可以使用表的价格(price)*数量(quantity)计算得到。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">计算列常常被用在定义时间属性(见另一篇文章<a href="https://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&amp;mid=2247484453&amp;idx=1&amp;sn=3bffb10e7b950a3a93887a59998dd014&amp;scene=21#wechat_redirect" style="overflow-wrap: break-word;font-weight: bold;color: rgb(239, 112, 96);border-bottom: 1px solid rgb(239, 112, 96);" data-linktype="2">Flink Table API&amp;SQL编程指南之时间属性(3)</a>，可以通过PROCTIME()函数定义处理时间属性，语法为<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">proc AS PROCTIME()</code>。除此之外，计算列可以被用作提取事件时间列，因为原始的事件时间可能不是TIMESTAMP(3)类型或者是存在JSON串中。</p><blockquote data-tool="mdnice编辑器" style="font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;"><strong>尖叫提示</strong>：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">1.在源表上定义计算列，是在读取数据源之后计算的，计算列需要跟在SELECT查询语句之后；</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">2.计算列不能被INSERT语句插入数据，在INSERT语句中，只能包括实际的目标表的schema，不能包括计算列</p></blockquote><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>水位线<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">水位线定义了表的事件时间属性，其语法为:</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">WATERMARK&nbsp;FOR&nbsp;rowtime_column_name&nbsp;AS&nbsp;watermark_strategy_expression<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">其中<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">rowtime_column_name</code>表示表中已经存在的事件时间字段，值得注意的是，该事件时间字段必须是TIMESTAMP(3)类型，即形如<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">yyyy-MM-dd HH:mm:ss</code>,如果不是这种形式的数据类型，需要通过定义计算列进行转换。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">watermark_strategy_expression</code>定义了水位线生成的策略，该表达式的返回数据类型必须是TIMESTAMP(3)类型。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Flink提供了许多常用的水位线生成策略：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">严格单调递增的水位线：语法为</p><pre style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;background: rgba(27, 31, 35, 0.05);display: -webkit-box;font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">WATERMARK&nbsp;FOR&nbsp;rowtime_column&nbsp;AS&nbsp;rowtime_column<br  /></code></pre></section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">即直接使用时间时间戳作为水位线</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">递增水位线:语法为</p><pre style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;background: rgba(27, 31, 35, 0.05);display: -webkit-box;font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">WATERMARK&nbsp;FOR&nbsp;rowtime_column&nbsp;AS&nbsp;rowtime_column&nbsp;-&nbsp;INTERVAL&nbsp;'0.001'&nbsp;SECOND<br  /></code></pre></section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><p style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;">乱序水位线：语法为</p><pre style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;background: rgba(27, 31, 35, 0.05);display: -webkit-box;font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">WATERMARK&nbsp;FOR&nbsp;rowtime_column&nbsp;AS&nbsp;rowtime_column&nbsp;-&nbsp;INTERVAL&nbsp;'string'&nbsp;timeUnit<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;比如，允许5秒的乱序</span><br  />WATERMARK&nbsp;FOR&nbsp;rowtime_column&nbsp;AS&nbsp;rowtime_column&nbsp;-&nbsp;INTERVAL&nbsp;'5'&nbsp;SECOND<br  /></code></pre></section></li></ul><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>分区<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">根据具体的字段创建分区表，每一个分区会对应一个文件路径</p><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>WITH 选项<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">创建Table source或者Table sink需要指定表的属性，属性是以key/value的形式配置的，具体参考其相对应的connector</p><blockquote data-tool="mdnice编辑器" style="font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;"><strong>尖叫提示</strong>：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">Note：创建表时指定的表名有三种形式：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">（1）catalog_name.db_name.table_name</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">（2）db_name.table_name</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">（3）table_name</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">对于第一种形式：会将表注册到一个名为‘catalog_name’的catalog以及一个名为'db_name'd的数据库的元数据中；</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">对于第二种形式：会将表注册到当前执行环境的catalog以及名为‘db_name’的数据库的元数据中；</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">对于第三种形式：会将表注册到当前执行环境的catalog与数据库的元数据中</p></blockquote><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">定义Kafka数据表</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">kafka是构建实时数仓常用的数据存储设备，使用Flink SQL创建kafka数据源表的语法如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;MyKafkaTable&nbsp;(<br  />&nbsp;&nbsp;...<br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.type'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;连接类型&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.version'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'0.11'</span>,<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;必选:&nbsp;可选的kafka版本有：0.8/0.9/0.10/0.11/universal</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'topic_name'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;必选:&nbsp;主题名称</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.properties.zookeeper.connect'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'localhost:2181'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;必选:&nbsp;zk连接地址</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'localhost:9092'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;必选:&nbsp;Kafka连接地址</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.properties.group.id'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'testGroup'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--可选:&nbsp;消费者组</span><br  />&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选:偏移量,&nbsp;earliest-offset/latest-offset/group-offsets/specific-offsets</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.startup-mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'earliest-offset'</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选:&nbsp;当偏移量指定为specific&nbsp;offsets，为指定每个分区指定具体位置</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.specific-offsets'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'partition:0,offset:42;partition:1,offset:300'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.sink-partitioner'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'...'</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选:&nbsp;sink分区器，fixed/round-robin/custom</span><br  />&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选:&nbsp;当自定义分区器时，指定分区器的类名</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.sink-partitioner-class'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'org.mycompany.MyPartitioner'</span>,<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'format.type'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'...'</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;必选:&nbsp;指定格式，支持csv/json/avro</span><br  />&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;指定update-mode，支持append/retract/upsert</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'update-mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'append'</span>,<br  /><br  />)<br  /></code></pre><blockquote data-tool="mdnice编辑器" style="font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;"><strong>尖叫提示</strong>：</p><ul style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">指定具体的偏移量位置：默认是从当前消费者组提交的偏移量开始消费</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">sink分区：默认是尽可能向更多的分区写数据(每一个sink并行度实例只向一个分区写数据)，也可以自已分区策略。当使用 round-robin分区器时，可以避免分区不均衡，但是会造成Flink实例与kafka broker之间大量的网络连接</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">一致性保证：默认sink语义是at-least-once</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">Kafka 0.10+</strong> 是时间戳：从kafka0.10开始，kafka消息附带一个时间戳作为消息的元数据，表示记录被写入kafka主题的时间，这个时间戳可以作为事件时间属性( rowtime attribute)</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">**Kafka 0.11+**版本：Flink从1.7开始，支持使用universal版本作为kafka的连接器 ，可以兼容kafka0.11之后版本</section></li></ul></blockquote><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">定义MySQL数据表</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;MySQLTable&nbsp;(<br  />&nbsp;&nbsp;...<br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.type'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'jdbc'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;必选:&nbsp;jdbc方式</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.url'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'jdbc:mysql://localhost:3306/flink-test'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;必选:&nbsp;JDBC&nbsp;url</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.table'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'jdbc_table_name'</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;必选:&nbsp;表名</span><br  />&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选:&nbsp;JDBC&nbsp;driver，如果不配置，会自动通过url提取&nbsp;</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.driver'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'com.mysql.jdbc.Driver'</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.username'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'name'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选:&nbsp;数据库用户名</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.password'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'password'</span>,<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选:&nbsp;数据库密码</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选,&nbsp;将输入进行分区的字段名.</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.read.partition.column'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'column_name'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选,&nbsp;分区数量.</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.read.partition.num'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'50'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选,&nbsp;第一个分区的最小值.</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.read.partition.lower-bound'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'500'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选,&nbsp;最后一个分区的最大值</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.read.partition.upper-bound'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'1000'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选,&nbsp;一次提取数据的行数，默认为0，表示忽略此配置</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.read.fetch-size'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'100'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选,&nbsp;lookup缓存数据的最大行数，如果超过改配置，老的数据会被清除</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.lookup.cache.max-rows'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'5000'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选，lookup缓存存活的最大时间，超过该时间旧数据会过时，注意cache.max-rows与cache.ttl必须同时配置</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.lookup.cache.ttl'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'10s'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选,&nbsp;查询数据最大重试次数</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.lookup.max-retries'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'3'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选,写数据最大的flush行数，默认5000，超过改配置，会触发刷数据&nbsp;</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.write.flush.max-rows'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'5000'</span>,&nbsp;<br  />&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--可选，flush数据的间隔时间，超过该时间，会通过一个异步线程flush数据，默认是0s&nbsp;</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.write.flush.interval'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'2s'</span>,&nbsp;<br  />&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;可选,&nbsp;写数据失败最大重试次数</span><br  />&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.write.max-retries'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'3'</span>&nbsp;<br  />)<br  /></code></pre><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">Temporal Table Join</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>使用语法<span style="display: none;"></span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">column</span>-<span style="font-weight: bold;line-height: 26px;">names</span><br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;table1&nbsp;&nbsp;[<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;&lt;alias1&gt;]<br  />[<span style="font-weight: bold;line-height: 26px;">LEFT</span>]&nbsp;<span style="font-weight: bold;line-height: 26px;">JOIN</span>&nbsp;table2&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;SYSTEM_TIME&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">OF</span>&nbsp;table1.proctime&nbsp;[<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;&lt;alias2&gt;]<br  /><span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;table1.column-name1&nbsp;=&nbsp;table2.key-name1<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;"><strong>注意</strong>：目前，仅支持INNER JOIN与LEFT JOIN。在join的时候需要使用 <code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">FOR SYSTEM_TIME AS OF</code> ，其中table1.proctime表示table1的proctime处理时间属性(计算列)。使用<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">FOR SYSTEM_TIME AS OF table1.proctime</code>表示当左边表的记录与右边的维表join时，只匹配当前处理时间维表所对应的的快照数据。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>样例<span style="display: none;"></span></h3><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SELECT</span><br  />&nbsp;&nbsp;o.amout,&nbsp;o.currency,&nbsp;r.rate,&nbsp;o.amount&nbsp;*&nbsp;r.rate<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span><br  />&nbsp;&nbsp;Orders&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;o<br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">JOIN</span>&nbsp;LatestRates&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;SYSTEM_TIME&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">OF</span>&nbsp;o.proctime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;r<br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;r.currency&nbsp;=&nbsp;o.currency<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>使用说明<span style="display: none;"></span></h3><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">仅支持Blink planner</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">仅支持SQL，目前不支持Table API</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">目前不支持基于事件时间(event time)的temporal table join</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">维表可能会不断变化，JOIN行为发生后，维表中的数据发生了变化（新增、更新或删除），则已关联的维表数据不会被同步变化</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">维表和维表不能进行JOIN</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">维表必须指定主键。维表JOIN时，ON的条件必须包含所有主键的等值条件</section></li></ul><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">维表Join案例</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>背景<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Kafka中有一份用户行为数据，包括pv，buy，cart，fav行为；MySQL中有一份省份区域的维表数据。现将两种表进行JOIN，统计每个区域的购买行为数量。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>步骤<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">维表存储在MySQL中，如下创建维表数据源：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;dim_province&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;province_id&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;省份id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;province_name&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">VARCHAR</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;省份名称</span><br  />&nbsp;region_name&nbsp;<span style="color: #0086b3;line-height: 26px;">VARCHAR</span>&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;区域名称</span><br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.type'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'jdbc'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.url'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'jdbc:mysql://192.168.10.203:3306/mydw'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.table'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'dim_province'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.driver'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'com.mysql.jdbc.Driver'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.username'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'root'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.password'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'123qwe'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.lookup.cache.max-rows'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'5000'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.lookup.cache.ttl'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'10min'</span><br  />);<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">事实表存储在kafka中，数据为用户点击行为，格式为JSON，具体数据样例如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">{"user_id":63401,"item_id":6244,"cat_id":143,"action":"pv","province":3,"ts":1573445919}<br  />{"user_id":9164,"item_id":2817,"cat_id":611,"action":"fav","province":28,"ts":1573420486}<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">创建kafka数据源表，如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;user_behavior&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;user_id&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;item_id&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;商品id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;cat_id&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;品类id</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">action</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为</span><br  />&nbsp;province&nbsp;<span style="color: #0086b3;line-height: 26px;">INT</span>,&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户所在的省份</span><br  />&nbsp;ts&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;用户行为发生的时间戳</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;proctime&nbsp;<span style="font-weight: bold;line-height: 26px;">as</span>&nbsp;PROCTIME(),&nbsp;&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;通过计算列产生一个处理时间列</span><br  />&nbsp;eventTime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;TO_TIMESTAMP(FROM_UNIXTIME(ts,&nbsp;<span style="color: #d14;line-height: 26px;">'yyyy-MM-dd&nbsp;HH:mm:ss'</span>)),&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;事件时间</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;WATERMARK&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;eventTime&nbsp;<span style="font-weight: bold;line-height: 26px;">as</span>&nbsp;eventTime&nbsp;-&nbsp;<span style="color: #0086b3;line-height: 26px;">INTERVAL</span>&nbsp;<span style="color: #d14;line-height: 26px;">'5'</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">SECOND</span>&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;在eventTime上定义watermark</span><br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.type'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kafka'</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用&nbsp;kafka&nbsp;connector</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.version'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'universal'</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka&nbsp;版本，universal&nbsp;支持&nbsp;0.11&nbsp;以上的版本</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.topic'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'user_behavior'</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka主题</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.startup-mode'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'earliest-offset'</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;偏移量，从起始&nbsp;offset&nbsp;开始读取</span><br  />&nbsp;<span style="color: #d14;line-height: 26px;">'connector.properties.group.id'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'group1'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;消费者组</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.properties.zookeeper.connect'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:2181,kms-3:2181,kms-4:2181'</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;zookeeper&nbsp;地址</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.properties.bootstrap.servers'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'kms-2:9092,kms-3:9092,kms-4:9092'</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;kafka&nbsp;broker&nbsp;地址</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'format.type'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'json'</span>&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;数据源格式为&nbsp;json</span><br  />);<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">创建MySQL的结果表，表示区域销量</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;region_sales_sink&nbsp;(<br  />&nbsp;&nbsp;&nbsp;&nbsp;region_name&nbsp;<span style="font-weight: bold;line-height: 26px;">STRING</span>,&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;区域名称</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;buy_cnt&nbsp;<span style="color: #0086b3;line-height: 26px;">BIGINT</span>&nbsp;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;销量</span><br  />)&nbsp;<span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;(<br  />&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.type'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'jdbc'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.url'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'jdbc:mysql://192.168.10.203:3306/mydw'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.table'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'top_region'</span>,&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;MySQL中的待插入数据的表</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.driver'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'com.mysql.jdbc.Driver'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.username'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'root'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.password'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'123qwe'</span>,<br  />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #d14;line-height: 26px;">'connector.write.flush.interval'</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'1s'</span><br  />);<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">用户行为数据与省份维表数据join</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">VIEW</span>&nbsp;user_behavior_detail&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span><br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span><br  />&nbsp;&nbsp;u.user_id,&nbsp;<br  />&nbsp;&nbsp;u.item_id,<br  />&nbsp;&nbsp;u.cat_id,<br  />&nbsp;&nbsp;u.action,&nbsp;&nbsp;<br  />&nbsp;&nbsp;p.province_name,<br  />&nbsp;&nbsp;p.region_name<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;user_behavior&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;u&nbsp;<span style="font-weight: bold;line-height: 26px;">LEFT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">JOIN</span>&nbsp;dim_province&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;SYSTEM_TIME&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">OF</span>&nbsp;u.proctime&nbsp;<span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;p<br  /><span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;u.province&nbsp;=&nbsp;p.province_id;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">计算区域的销量，并将计算结果写入MySQL</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">INSERT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INTO</span>&nbsp;region_sales_sink<br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;<br  />&nbsp;&nbsp;region_name,<br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">COUNT</span>(*)&nbsp;buy_cnt<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;user_behavior_detail<br  /><span style="font-weight: bold;line-height: 26px;">WHERE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">action</span>&nbsp;=&nbsp;<span style="color: #d14;line-height: 26px;">'buy'</span><br  /><span style="font-weight: bold;line-height: 26px;">GROUP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;region_name;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">结果查看：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">Flink&nbsp;SQL&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;*&nbsp;<span style="font-weight: bold;line-height: 26px;">from</span>&nbsp;&nbsp;region_sales_sink;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;在Flink&nbsp;SQL&nbsp;cli中查看</span><br  /></code></pre><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.2724097788125728" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgLBTN9IHtVKibXSic7BB1NOAfAJ2g957dGxwOuxkZtPaSVNicF3IgiacJf34ibbAjFQaxLdlM6M4JmFSQ/640?wx_fmt=png" data-type="png" data-w="859" style=""  /></p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">mysql&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">select</span>&nbsp;*&nbsp;<span style="font-weight: bold;line-height: 26px;">from</span>&nbsp;top_region;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;查看MySQL的数据</span><br  /></code></pre><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.448871181938911" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgLBTN9IHtVKibXSic7BB1NOAWQrsPCCbyKBegf9f2YUSjEhmFGNgWbDodylMSG5eAI5ha0MtlRPoNQ/640?wx_fmt=png" data-type="png" data-w="753" style=""  /></p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">总结</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">本文主要介绍了FlinkSQL的维表join，使用的方式为Temporal Table Join。首先介绍了Flink SQL创建表的基本语法，并对其中的细节进行了描述。接着介绍了如何创建Kafka以及MySQL的数据源表。然后介绍了Temporal Table Join的基本概念与使用语法。最后，给出了一个完整的维表JOIN案例。</p></section><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="98598"><section><section style="margin: 10px auto;"><section style="padding-top: 6px;box-sizing: border-box;"><section style="display: flex;align-items: center;"><section style="display: flex;flex-direction: column;"><section style="display: flex;align-items: center;margin-bottom: -30px;"><section style="display: flex;padding-right: 6px;padding-left: 6px;box-sizing: border-box;"><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: transparent;box-sizing: border-box;display: flex;justify-content: center;align-items: center;overflow: hidden;transform: rotate(45deg);"><br  /></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: transparent;box-sizing: border-box;display: flex;align-items: flex-end;transform: rotate(45deg);"><section style="width: 7px;height: 7px;background-image: linear-gradient(to right, #aeede2, #bbf2dd);overflow: hidden;"><br  /></section></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: transparent;box-sizing: border-box;display: flex;align-items: flex-end;transform: rotate(45deg);"><section style="width: 7px;height: 7px;background-image: linear-gradient(to right, #aeede2, #bbf2dd);overflow: hidden;"><br  /></section></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: transparent;box-sizing: border-box;display: flex;align-items: flex-end;transform: rotate(45deg);"><section style="width: 7px;height: 7px;background-image: linear-gradient(to right, #aeede2, #bbf2dd);overflow: hidden;"><br  /></section></section></section></section><section style="display: flex;align-items: center;"><section style="display: flex;padding-right: 6px;padding-left: 6px;box-sizing: border-box;"><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: rgb(122, 218, 216);box-sizing: border-box;display: flex;justify-content: center;align-items: center;transform: rotate(45deg);"><section data-brushtype="text" style="text-align: center;color: rgb(76, 174, 172);font-weight: bold;transform: rotate(-45deg);">关</section></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: rgb(122, 218, 216);box-sizing: border-box;display: flex;justify-content: center;align-items: center;transform: rotate(45deg);"><section data-brushtype="text" style="text-align: center;color: rgb(76, 174, 172);font-weight: bold;transform: rotate(-45deg);">注</section></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: rgb(122, 218, 216);box-sizing: border-box;display: flex;justify-content: center;align-items: center;transform: rotate(45deg);"><section data-brushtype="text" style="text-align: center;color: rgb(76, 174, 172);font-weight: bold;transform: rotate(-45deg);">我</section></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: rgb(122, 218, 216);box-sizing: border-box;display: flex;justify-content: center;align-items: center;transform: rotate(45deg);"><section data-brushtype="text" style="text-align: center;color: rgb(76, 174, 172);font-weight: bold;transform: rotate(-45deg);">们</section></section></section></section></section><section style="flex: 1 1 0%;height: 1px;background-image: linear-gradient(to right, #7cdad8, #cff2f1);overflow: hidden;"><br  /></section></section><section style="padding-top: 15px;padding-bottom: 15px;box-sizing: border-box;"><section style="display: flex;justify-content: center;align-items: center;"><section style="display: flex;justify-content: center;align-items: center;padding-right: 20px;padding-left: 15px;box-sizing: border-box;"><section style="width: auto;margin-right: 20px;"><section style="text-align: center;font-size: 14px;letter-spacing: 1.5px;color: rgb(84, 187, 185);line-height: 1.75em;word-break: break-all;font-weight: bold;">公众号：大数据技术与数仓</section><section style="text-align: center;font-size: 14px;letter-spacing: 1.5px;color: rgb(84, 187, 185);line-height: 1.75em;word-break: break-all;font-weight: bold;">关注免费领取资料</section><section style="text-align: center;font-size: 14px;letter-spacing: 1.5px;color: rgb(84, 187, 185);line-height: 1.75em;word-break: break-all;font-weight: bold;">keep it simple and stupid</section><section style="display: flex;justify-content: flex-start;"><section style="width: 10px;margin-top: -14px;margin-left: -15px;"><img data-ratio="1.3157894736842106" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgLBTN9IHtVKibXSic7BB1NOAOdgrq48iaR7VOFnyDy2ozEA1pWDY6Rvg2WmX6weFUfHibFf7NicjZwOOg/640?wx_fmt=png" data-type="png" data-w="19" data-width="100%" style="display: block;width: 100%;"  /></section><section style="width: 6px;margin-top: -2px;margin-left: -2px;"><img data-ratio="1.3157894736842106" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgLBTN9IHtVKibXSic7BB1NOAOdgrq48iaR7VOFnyDy2ozEA1pWDY6Rvg2WmX6weFUfHibFf7NicjZwOOg/640?wx_fmt=png" data-type="png" data-w="19" data-width="100%" style="display: block;width: 100%;"  /></section></section></section><section style="width: 80px;box-sizing: border-box;flex-shrink: 0;"><img data-ratio="1" src="https://mmbiz.qpic.cn/mmbiz_jpg/PL10rfzHicsgLBTN9IHtVKibXSic7BB1NOAib1uu3zQTJ9bYV2VJL1eeUC9jCTnbcSCaLQ41YOklRa6YUWltUC8oMg/640?wx_fmt=jpeg" data-type="jpeg" data-w="344" data-width="100%" style="width:100%;display:block;" title="二维码.jpg"  /></section></section></section></section><section style="display: flex;justify-content: flex-end;"><section style="width: 20px;margin-top: -20px;"><img data-ratio="0.6944444444444444" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgLBTN9IHtVKibXSic7BB1NOApFwznXLoCTvicm1sWecGguic33Ze5DyOMwickU7l2EDCBQs9FEdZrA4bQ/640?wx_fmt=png" data-type="png" data-w="36" data-width="100%" style="display: block;width: 100%;"  /></section></section><section style="width: 100%;height: 1px;background-image: linear-gradient(to right, #cff2f1, #7cdad8);overflow: hidden;" data-width="100%"><br  /></section></section></section></section></section></section><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="94783"><section style="display: flex;justify-content: flex-end;align-items: center;"><section style="width: 20px;"><section style="width: 20px;"><img data-ratio="1.037037037037037" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgLBTN9IHtVKibXSic7BB1NOAMsYfpVicZricjHemEbRX3ttx90onw8lWQta5mZxXWgYwcmZsUQkILTDA/640?wx_fmt=png" data-type="png" data-w="27" data-width="100%" style="width: 100%;display:block;"  /></section></section><section style="display: inline-block;text-align: right;"><section data-brushtype="text" style="font-size: 16px;color: rgb(63, 63, 63);letter-spacing: 2px;margin-bottom: -15px;transform: rotate(0deg);">强势围观</section></section><section style="width: 22px;"><section style="width: 22px;margin-top: 15px;"><img data-ratio="1" src="https://mmbiz.qpic.cn/mmbiz_gif/PL10rfzHicsgLBTN9IHtVKibXSic7BB1NOAw1cqF1uciaicJ2lHW7TWYhpqB3bSDAnfZLJHMFYoLRhiaBkybyuKxky2Q/640?wx_fmt=gif" data-type="gif" data-w="100" data-width="100%" style="width: 100%;display:block;"  /></section></section></section></section></section><div class="msg_source_url"><a href="https://mp.weixin.qq.com/s/RykdGWsESRNhq9r7q2f-CA#rd" target="_blank">阅读原文</a></div></content><div class="msg_source_url"><a href="https://mp.weixin.qq.com/s/RykdGWsESRNhq9r7q2f-CA#rd" target="_blank">阅读原文</a></div>
</div>
</body>
</html>