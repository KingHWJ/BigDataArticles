<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"大数据技术与数仓","title":"数仓|Hive性能调优指北","time":"2020-06-08 08:20:00","timeStamp":"1591575600"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzU2ODQ3NjYyMA==&mid=2247484473&idx=1&sn=57619d9d628c658dbdf1f92929ddd584&chksm=fc8c129acbfb9b8cc2c1a5519dc5c81db3ce0d8ba7f5d98d65f16ef1a1d2f488bf28d75b18d4#rd" target="_blank">数仓|Hive性能调优指北</a></h1><div id="meta_content" class="rich_media_meta_list"><span id="copyright_logo" class="wx_tap_link js_wx_tap_highlight rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_text">西贝&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">大数据技术与数仓&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2020-06-08 08:20:00</em></div><content><div class="topic"><p>收录于话题</p><p><a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU2ODQ3NjYyMA==&action=getalbum&album_id=1344435576086560769#wechat_redirect" title="数仓" target="_blank">#数仓</a></p></div><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="font-size: 16px;color: black;padding-right: 10px;padding-left: 10px;line-height: 1.6;letter-spacing: 0px;word-break: break-word;overflow-wrap: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;margin-top: -10px;"><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="98373"><section style="margin: 10px auto;"><section style="display: flex;justify-content: center;align-items: center;"><section style="width: 2px;background-image: linear-gradient(rgb(253, 151, 172), rgb(233, 147, 216));height: 25px;margin-right: 1.7px;overflow: hidden;"><br  /></section><section style="width: 5px;background-image: linear-gradient(rgb(253, 151, 172), rgb(233, 147, 216));height: 25px;overflow: hidden;"><br  /></section><section style="flex: 1 1 0%;"><section style="height: 1px;background-color: #f9daef;overflow: hidden;flex:1;"><br  /></section><section style="height: 1px;background-color: #f9daef;margin-top:2px;overflow: hidden;flex:1;"><br  /></section><section style="height: 1px;background-color: #f9daef;margin-top:2px;overflow: hidden;flex:1;"><br  /></section><section style="height: 1px;background-color: #f9daef;margin-top:2px;overflow: hidden;flex:1;"><br  /></section></section><section style="width: 30px;margin-top: -5px;margin-left: -14px;"><section style="width: 30px;"><img data-ratio="1" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgibbNuuylVPEWuhXFts2pszK8QompgnYPhmOsf4Nqx7dIq4hwLlCyTaxU1LBZeaOn9rH79MMQVtRw/640?wx_fmt=png" data-type="png" data-w="47" data-width="100%" style="width:100%;display:block;"  /></section></section></section><section data-brushtype="text" style="text-align: left;margin-left: 20px;font-size: 16px;color: rgb(228, 90, 132);font-weight: bold;letter-spacing: 1.5px;box-sizing: border-box;margin-top: -25px;">点击蓝字关注我们</section></section></section><section data-role="paragraph"><p><span style="letter-spacing: 0px;">在</span><span style="letter-spacing: 0px;">企业中使用Hive构建离线数仓是一种十分普遍的方案。</span><span style="letter-spacing: 0px;">尽管Hive的使用场景是</span><span style="letter-spacing: 0px;">通过批处理的方式处理大数据，通常对处理时间不敏感。</span><span style="letter-spacing: 0px;">但是在资源有限的情况下，我们需要关注Hive的性能调优，从而方便数据的快速产出。</span><span style="letter-spacing: 0px;">同时，关于Hive的性能调优，也是面试中比较常见的问题，因此掌握Hive性能调优的一些方法，不仅能够在工作中提升效率而且还可以在面试中脱颖而出。</span><span style="letter-spacing: 0px;">本文会通过四个方面介绍Hive性能调优，主要包括：</span><br  /></p></section></section><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><p style="font-size: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;list-style-type: none;"><em style="font-size: inherit;color: inherit;line-height: inherit;display: inline-block;vertical-align: middle;margin-right: 10px;"><span style="border-width: 2px;border-style: solid;border-color: rgb(62, 62, 62);color: red;padding: 2px 8px 2px 5px;border-radius: 5px;">√</span></em>性能调优的工具</p><p style="font-size: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;list-style-type: none;"><em style="font-size: inherit;color: inherit;line-height: inherit;display: inline-block;vertical-align: middle;margin-right: 10px;"><span style="border-width: 2px;border-style: solid;border-color: rgb(62, 62, 62);color: red;padding: 2px 8px 2px 5px;border-radius: 5px;">√</span></em>设计优化</p><p style="font-size: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;list-style-type: none;"><em style="font-size: inherit;color: inherit;line-height: inherit;display: inline-block;vertical-align: middle;margin-right: 10px;"><span style="border-width: 2px;border-style: solid;border-color: rgb(62, 62, 62);color: red;padding: 2px 8px 2px 5px;border-radius: 5px;">√</span></em>数据存储优化</p><p style="font-size: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;list-style-type: none;"><em style="font-size: inherit;color: inherit;line-height: inherit;display: inline-block;vertical-align: middle;margin-right: 10px;"><span style="border-width: 2px;border-style: solid;border-color: rgb(62, 62, 62);color: red;padding: 2px 8px 2px 5px;border-radius: 5px;">√</span></em>作业优化</p></ul><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">性能调优的工具</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">HQL提供了两个查看查询性能的工具：<strong>explain</strong>与<strong>analyze</strong>，除此之外Hive的日志也提供了非常详细的信息，方便查看执行性能和报错排查。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>善用explain语句<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">explain语句是查看执行计划经常使用的一个工具，可以使用该语句分析查询执行计划，具体使用语法如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">EXPLAIN</span>&nbsp;[FORMATTED|<span style="font-weight: bold;line-height: 26px;">EXTENDED</span>|DEPENDENCY|AUTHORIZATION]&nbsp;hql_query<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">上面的执行语句中，有4个可选的关键字，其具体含义如下：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">FORMATTED：对执行计划进行格式化，返回JSON格式的执行计划</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">EXTENDED：提供一些额外的信息，比如文件的路径信息</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">DEPENDENCY：以JSON格式返回查询所依赖的表和分区的列表，从Hive0.10开始使用，如下图</section></li></ul><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.34295227524972255" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgibbNuuylVPEWuhXFts2pszSoFLDJgkHFsqRcNmiaVfhic26icnyibTurbByp44jgLbLkO9RtYRW4C7rQ/640?wx_fmt=png" data-type="png" data-w="901" style=""  /></p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">AUTHORIZATION：列出需要被授权的条目，包括输入与输出，从Hive0.14开始使用,如下图</section></li></ul><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.30625" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgibbNuuylVPEWuhXFts2psz6dwYKvsQrUiaWUGZGKP5fVicibAP1zibgnRMxWK6GZsZwjSPBwic2R1xooQ/640?wx_fmt=png" data-type="png" data-w="1280" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">一个典型的查询执行计划主要包括三部分，具体如下：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">Abstract Syntax Tree (AST)</strong>：抽象语法树，Hive使用一个称之为antlr的解析生成器，可以自动地将HQL生成为抽象语法树</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">Stage Dependencies</strong>：会列出运行查询所有的依赖以及stage的数量</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);"><strong style="color: black;">Stage Plans</strong>：包含了非常重要的信息，比如运行作业时的operator 和sort orders</section></li></ul><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>举个栗子<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">假设有一张表：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;employee_partitioned<br  />(<br  />&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">name</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">string</span>,<br  />&nbsp;&nbsp;work_place&nbsp;<span style="color: #0086b3;line-height: 26px;">ARRAY</span>&lt;<span style="font-weight: bold;line-height: 26px;">string</span>&gt;,<br  />&nbsp;&nbsp;gender_age&nbsp;<span style="font-weight: bold;line-height: 26px;">STRUCT</span>&lt;gender:<span style="font-weight: bold;line-height: 26px;">string</span>,age:<span style="color: #0086b3;line-height: 26px;">int</span>&gt;,<br  />&nbsp;&nbsp;skills_score&nbsp;<span style="font-weight: bold;line-height: 26px;">MAP</span>&lt;<span style="font-weight: bold;line-height: 26px;">string</span>,<span style="color: #0086b3;line-height: 26px;">int</span>&gt;,<br  />&nbsp;&nbsp;depart_title&nbsp;<span style="font-weight: bold;line-height: 26px;">MAP</span>&lt;<span style="font-weight: bold;line-height: 26px;">STRING</span>,<span style="color: #0086b3;line-height: 26px;">ARRAY</span>&lt;<span style="font-weight: bold;line-height: 26px;">STRING</span>&gt;&gt;<br  />)<br  />PARTITIONED&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;(<span style="font-weight: bold;line-height: 26px;">Year</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">INT</span>,&nbsp;<span style="font-weight: bold;line-height: 26px;">Month</span>&nbsp;<span style="color: #0086b3;line-height: 26px;">INT</span>)<br  /><span style="font-weight: bold;line-height: 26px;">ROW</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">FORMAT</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">DELIMITED</span><br  /><span style="font-weight: bold;line-height: 26px;">FIELDS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TERMINATED</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;<span style="color: #d14;line-height: 26px;">'|'</span><br  />COLLECTION&nbsp;ITEMS&nbsp;<span style="font-weight: bold;line-height: 26px;">TERMINATED</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;<span style="color: #d14;line-height: 26px;">','</span><br  /><span style="font-weight: bold;line-height: 26px;">MAP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">KEYS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TERMINATED</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;<span style="color: #d14;line-height: 26px;">':'</span>;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">查看执行计划：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">EXPLAIN</span><br  /><span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;gender_age.gender,<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">count</span>(*)<br  /><span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;employee_partitioned<br  /><span style="font-weight: bold;line-height: 26px;">WHERE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">YEAR</span>=<span style="color: #008080;line-height: 26px;">2020</span><br  /><span style="font-weight: bold;line-height: 26px;">GROUP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;gender_age.gender<br  /><span style="font-weight: bold;line-height: 26px;">LIMIT</span>&nbsp;<span style="color: #008080;line-height: 26px;">2</span>;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">执行计划概览：</p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.7033805888767721" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgibbNuuylVPEWuhXFts2psz7bXcaX8cIf0QicxWiaTicfAibia7bf1njia1bFicOzsARcwVAHLZF3WBVCYbw/640?wx_fmt=png" data-type="png" data-w="917" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如上图：<em>Map/Reduce operator tree</em>是抽象语法树<strong>AST</strong>部分；<strong>STAGE
DEPENDENCIES</strong>包括三个阶段：Stage-0 、Stage-1及Stage-2，其中Stage-0 是root stage，即Stage-1与Stage-2依赖于Stage-0；<strong>STAGE PLANS</strong>部分，Stage-1与Stage2都包含一个Map Operator Tree和一个Reduce Operator Tree，Stage-0不包含map和reduce，仅仅是一个fetch数据的操作。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">执行计划详细信息：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">STAGE&nbsp;DEPENDENCIES:<br  />&nbsp;&nbsp;Stage-1&nbsp;is&nbsp;a&nbsp;root&nbsp;stage<br  />&nbsp;&nbsp;Stage-2&nbsp;depends&nbsp;on&nbsp;stages:&nbsp;Stage-1<br  />&nbsp;&nbsp;Stage-0&nbsp;depends&nbsp;on&nbsp;stages:&nbsp;Stage-2<br  /><br  />STAGE&nbsp;PLANS:<br  />&nbsp;&nbsp;Stage:&nbsp;Stage-1<br  />&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;Reduce<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;Operator&nbsp;Tree:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TableScan<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">alias</span>:&nbsp;employee_partitioned<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filterExpr:&nbsp;(year&nbsp;=&nbsp;2020)&nbsp;(<span style="color: #0086b3;line-height: 26px;">type</span>:&nbsp;boolean)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statistics:&nbsp;Num&nbsp;rows:&nbsp;1&nbsp;Data&nbsp;size:&nbsp;227&nbsp;Basic&nbsp;stats:&nbsp;PARTIAL&nbsp;Column&nbsp;stats:&nbsp;NONE<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Select&nbsp;Operator<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expressions:&nbsp;gender_age&nbsp;(<span style="color: #0086b3;line-height: 26px;">type</span>:&nbsp;struct&lt;gender:string,age:int&gt;)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputColumnNames:&nbsp;gender_age<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statistics:&nbsp;Num&nbsp;rows:&nbsp;1&nbsp;Data&nbsp;size:&nbsp;227&nbsp;Basic&nbsp;stats:&nbsp;PARTIAL&nbsp;Column&nbsp;stats:&nbsp;NONE<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reduce&nbsp;Output&nbsp;Operator<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key&nbsp;expressions:&nbsp;gender_age.gender&nbsp;(<span style="color: #0086b3;line-height: 26px;">type</span>:&nbsp;string)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort&nbsp;order:&nbsp;+<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map-reduce&nbsp;partition&nbsp;columns:&nbsp;rand()&nbsp;(<span style="color: #0086b3;line-height: 26px;">type</span>:&nbsp;double)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statistics:&nbsp;Num&nbsp;rows:&nbsp;1&nbsp;Data&nbsp;size:&nbsp;227&nbsp;Basic&nbsp;stats:&nbsp;PARTIAL&nbsp;Column&nbsp;stats:&nbsp;NONE<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reduce&nbsp;Operator&nbsp;Tree:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Group&nbsp;By&nbsp;Operator<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aggregations:&nbsp;count()<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keys:&nbsp;KEY._col0&nbsp;(<span style="color: #0086b3;line-height: 26px;">type</span>:&nbsp;string)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode:&nbsp;partial1<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputColumnNames:&nbsp;_col0,&nbsp;_col1<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statistics:&nbsp;Num&nbsp;rows:&nbsp;1&nbsp;Data&nbsp;size:&nbsp;227&nbsp;Basic&nbsp;stats:&nbsp;COMPLETE&nbsp;Column&nbsp;stats:&nbsp;NONE<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File&nbsp;Output&nbsp;Operator<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;compressed:&nbsp;<span style="color: #008080;line-height: 26px;">false</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input&nbsp;format:&nbsp;org.apache.hadoop.mapred.SequenceFileInputFormat<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;format:&nbsp;org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serde:&nbsp;org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe<br  /><br  />&nbsp;&nbsp;Stage:&nbsp;Stage-2<br  />&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;Reduce<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map&nbsp;Operator&nbsp;Tree:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TableScan<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reduce&nbsp;Output&nbsp;Operator<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key&nbsp;expressions:&nbsp;_col0&nbsp;(<span style="color: #0086b3;line-height: 26px;">type</span>:&nbsp;string)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sort&nbsp;order:&nbsp;+<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map-reduce&nbsp;partition&nbsp;columns:&nbsp;_col0&nbsp;(<span style="color: #0086b3;line-height: 26px;">type</span>:&nbsp;string)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statistics:&nbsp;Num&nbsp;rows:&nbsp;1&nbsp;Data&nbsp;size:&nbsp;227&nbsp;Basic&nbsp;stats:&nbsp;COMPLETE&nbsp;Column&nbsp;stats:&nbsp;NONE<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;expressions:&nbsp;_col1&nbsp;(<span style="color: #0086b3;line-height: 26px;">type</span>:&nbsp;bigint)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Reduce&nbsp;Operator&nbsp;Tree:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Group&nbsp;By&nbsp;Operator<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aggregations:&nbsp;count(VALUE._col0)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keys:&nbsp;KEY._col0&nbsp;(<span style="color: #0086b3;line-height: 26px;">type</span>:&nbsp;string)<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mode:&nbsp;final<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outputColumnNames:&nbsp;_col0,&nbsp;_col1<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statistics:&nbsp;Num&nbsp;rows:&nbsp;1&nbsp;Data&nbsp;size:&nbsp;227&nbsp;Basic&nbsp;stats:&nbsp;COMPLETE&nbsp;Column&nbsp;stats:&nbsp;NONE<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Limit<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Number&nbsp;of&nbsp;rows:&nbsp;2<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statistics:&nbsp;Num&nbsp;rows:&nbsp;1&nbsp;Data&nbsp;size:&nbsp;227&nbsp;Basic&nbsp;stats:&nbsp;COMPLETE&nbsp;Column&nbsp;stats:&nbsp;NONE<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File&nbsp;Output&nbsp;Operator<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;compressed:&nbsp;<span style="color: #008080;line-height: 26px;">false</span><br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Statistics:&nbsp;Num&nbsp;rows:&nbsp;1&nbsp;Data&nbsp;size:&nbsp;227&nbsp;Basic&nbsp;stats:&nbsp;COMPLETE&nbsp;Column&nbsp;stats:&nbsp;NONE<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;table:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input&nbsp;format:&nbsp;org.apache.hadoop.mapred.TextInputFormat<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;format:&nbsp;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;serde:&nbsp;org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe<br  /><br  />&nbsp;&nbsp;Stage:&nbsp;Stage-0<br  />&nbsp;&nbsp;&nbsp;&nbsp;Fetch&nbsp;Operator<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0086b3;line-height: 26px;">limit</span>:&nbsp;2<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Processor&nbsp;Tree:<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ListSink<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>巧用analyze语句<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">analyze语句可以收集一些详细的统计信息，比如表的行数、文件数、数据的大小等信息。这些统计信息作为元数据存储在hive的元数据库中。Hive支持表、分区和列级别的统计(与Impala类似)，这些信息作为Hive基于成本优化策略(Cost-Based Optimizer (CBO))的输入,该优化器的主要作用是选择耗费最小系统资源的查询计划。其实，在Hive3.2.0版本中，可以自动收集这些统计信息，当然也可以通过analyze语句进行手动统计表、分区或者字段的信息。具体的使用方式如下：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">1.收集表的统计信息(非分区表)，当指定NOSCAN关键字时，会忽略扫描文件内容，仅仅统计文件的数量与大小，速度会比较快</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;不使用NOSCAN关键字</span><br  />hive&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">ANALYZE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;user_behavior&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">COMPUTE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STATISTICS</span>;<br  />...<br  />Table&nbsp;default.user_behavior&nbsp;stats:&nbsp;[numFiles=1,&nbsp;numRows=10,&nbsp;totalSize=229,&nbsp;rawDataSize=219]<br  />Time&nbsp;taken:&nbsp;23.504&nbsp;seconds<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;使用NOSCAN关键字</span><br  />hive&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">ANALYZE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;user_behavior&nbsp;&nbsp;<span style="font-weight: bold;line-height: 26px;">COMPUTE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STATISTICS</span>&nbsp;NOSCAN;<br  />Table&nbsp;default.user_behavior&nbsp;stats:&nbsp;[numFiles=1,&nbsp;numRows=10,&nbsp;totalSize=229,&nbsp;rawDataSize=219]<br  />Time&nbsp;taken:&nbsp;0.309&nbsp;seconds<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">2.收集分区表的统计信息</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;收集具体分区的统计信息</span><br  />hive&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">ANALYZE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;employee_partitioned&nbsp;<span style="font-weight: bold;line-height: 26px;">PARTITION</span>(<span style="font-weight: bold;line-height: 26px;">year</span>=<span style="color: #008080;line-height: 26px;">2020</span>,&nbsp;<span style="font-weight: bold;line-height: 26px;">month</span>=<span style="color: #008080;line-height: 26px;">06</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">COMPUTE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STATISTICS</span>;<br  />...<br  />Partition&nbsp;default.employee_partitioned{year=2020,&nbsp;month=06}&nbsp;stats:&nbsp;[numFiles=1,&nbsp;numRows=0,&nbsp;totalSize=227,&nbsp;rawDataSize=0]<br  />Time&nbsp;taken:&nbsp;19.283&nbsp;seconds<br  /><br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;收集所有分区的统计信息</span><br  />hive&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">ANALYZE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;employee_partitioned&nbsp;<span style="font-weight: bold;line-height: 26px;">PARTITION</span>(<span style="font-weight: bold;line-height: 26px;">year</span>,&nbsp;<span style="font-weight: bold;line-height: 26px;">month</span>)&nbsp;<span style="font-weight: bold;line-height: 26px;">COMPUTE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STATISTICS</span>;<br  />...<br  />Partition&nbsp;default.employee_partitioned{year=2020,&nbsp;month=06}&nbsp;stats:&nbsp;[numFiles=1,&nbsp;numRows=0,&nbsp;totalSize=227,&nbsp;rawDataSize=0]<br  />Time&nbsp;taken:&nbsp;17.528&nbsp;seconds<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">3.收集表的某个字段的统计信息</section></li></ul><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">hive&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">ANALYZE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;user_behavior&nbsp;<span style="font-weight: bold;line-height: 26px;">COMPUTE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">STATISTICS</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">FOR</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">COLUMNS</span>&nbsp;user_id&nbsp;;&nbsp;<br  /></code></pre><blockquote data-tool="mdnice编辑器" style="font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;"><strong>尖叫提示</strong>：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">可以通过设置：<em>SET hive.stats.autogather=true</em>，进行自动收集统计信息，对于INSERT OVERWRITE/INTO操作的表或者分区，可以自动收集统计信息。值得注意的是，LOAD操作不能够自动收集统计信息</p></blockquote><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">一旦这些统计信息收集完毕，可以通过DESCRIBE EXTENDED/FORMATTED语句查询统计信息，具体使用如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;查看一个分区的统计信息</span><br  />hive&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">DESCRIBE</span>&nbsp;FORMATTED&nbsp;employee_partitioned&nbsp;<span style="font-weight: bold;line-height: 26px;">PARTITION</span>(<span style="font-weight: bold;line-height: 26px;">year</span>=<span style="color: #008080;line-height: 26px;">2020</span>,&nbsp;<span style="font-weight: bold;line-height: 26px;">month</span>=<span style="color: #008080;line-height: 26px;">06</span>);<br  />...<br  />Partition&nbsp;Parameters:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COLUMN_STATS_ACCURATE&nbsp;&nbsp;&nbsp;true&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numFiles&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numRows&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rawDataSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;totalSize&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;227&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transient_lastDdlTime&nbsp;&nbsp;&nbsp;1591437967&nbsp;<br  />...<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;查看一张表的统计信息</span><br  />hive&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">DESCRIBE</span>&nbsp;FORMATTED&nbsp;employee_partitioned;<br  />...<br  />Table&nbsp;Parameters:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numPartitions&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;transient_lastDdlTime&nbsp;&nbsp;&nbsp;1591431482&nbsp;<br  />...<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;查看某列的统计信息</span><br  />hive&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">DESCRIBE</span>&nbsp;FORMATTED&nbsp;&nbsp;user_behavior.user_id;<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>常用日志分析<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">日志提供了job运行的详细信息，通过查看日志信息，可以分析出导致作业执行瓶颈的问题，主要包括两种类型的日志：系统日志和作业日志。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">系统日志包含了Hive运行时的状态等信息，可以通过{HIVE_HOME}/conf/hive-log4j.properties文件进行配置，主要的配置选项有：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">hive.root.logger=WARN,DRFA&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">##&nbsp;日志级别</span><br  />hive.log.dir=/tmp/<span style="color: #008080;line-height: 26px;">${user.name}</span>&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">##&nbsp;日志路径</span><br  />hive.log.file=hive.log&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">##&nbsp;日志名称</span><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">也可以通过Hive cli命令行设置日志级别：<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">$hive --hiveconf hive.root.logger=DEBUG,console</code>这种方式只能在当前会话生效。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">作业日志所包含的作业信息通常是由YARN管理的，可以通过<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">yarn logs -applicationId &lt;application_id&gt;</code>命令查看作业日志。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">设计优化</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>分区表<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">对于一张比较大的表，将其设计成分区表可以提升查询的性能，对于一个特定分区的查询，只会加载对应分区路径的文件数据，所以执行速度会比较快。值得注意的是，分区字段的选择是影响查询性能的重要因素，尽量避免层级较深的分区，这样会造成太多的子文件夹。一些常见的分区字段可以是：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">日期或者时间</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">比如year、month、day或者hour，当表中存在时间或者日期字段时，可以使用些字段。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">地理位置</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">比如国家、省份、城市等</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">业务逻辑</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">比如部门、销售区域、客户等等</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>分桶表<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">与分区表类似，分桶表的组织方式是将HDFS上的文件分割成多个文件。分桶可以加快数据采样，也可以提升join的性能(join的字段是分桶字段)，因为分桶可以确保某个key对应的数据在一个特定的桶内(文件)，所以巧妙地选择分桶字段可以大幅度提升join的性能。通常情况下，分桶字段可以选择经常用在过滤操作或者join操作的字段。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>索引<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">创建索引是关系型数据库性能调优的常见手段，在Hive中也不例外。Hive从0.7版本开始支持索引，使用索引相比全表扫描而言，是一种比较廉价的操作，Hive中创建索引的方式如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INDEX</span>&nbsp;idx_user_id_user_behavior<br  /><span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;user_behavior&nbsp;(user_id)<br  /><span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="color: #d14;line-height: 26px;">'COMPACT'</span><br  /><span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFERRED</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">REBUILD</span>;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">上面创建的是COMPACT索引，存储的是索引列与其对应的block id的pair对。除了此种索引外，Hive还支持位图索引(BITMAP),使用方式如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INDEX</span>&nbsp;idx_behavior_user_behavior<br  /><span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;user_behavior&nbsp;(behavior)<br  /><span style="font-weight: bold;line-height: 26px;">AS</span>&nbsp;<span style="color: #d14;line-height: 26px;">'BITMAP'</span><br  /><span style="font-weight: bold;line-height: 26px;">WITH</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">DEFERRED</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">REBUILD</span>;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">上面创建的索引时，使用了<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">WITH DEFERRED REBUILD</code>选项，该选项可以避免索引立即被创建，当建立索引时，可以使用<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">LTER...REBUILD</code>命令(见下面的示例)，值得注意的是：当基表(被创建索引的表)发生变化时，该命令需要被再次执行以便更新索引到最新的状态。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">ALTER</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INDEX</span>&nbsp;idx_user_id_user_behavior&nbsp;<span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;user_behavior&nbsp;<span style="font-weight: bold;line-height: 26px;">REBUILD</span>;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">一旦索引创建成功，会生成一张索引表，表的名称格式为：<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">数据库名__表名_索引名__</code>，可以使用下面的命令查看索引：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">hive&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">SHOW</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLES</span>&nbsp;<span style="color: #d14;line-height: 26px;">'*idx*'</span>;<br  />OK<br  />default__user_behavior_idx_user_id_user_behavior__<br  />Time&nbsp;taken:&nbsp;0.044&nbsp;seconds,&nbsp;Fetched:&nbsp;1&nbsp;row(s)<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">索引表包含索引列、HDFS的文件URI以及每行的偏移量，可以通过下面命令查看：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;查看索引表结构</span><br  />hive&gt;&nbsp;DESC&nbsp;default__user_behavior_idx_user_id_user_behavior__;<br  />OK<br  />user_id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />_bucketname&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />_offsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array&lt;bigint&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  />Time&nbsp;taken:&nbsp;0.109&nbsp;seconds,&nbsp;Fetched:&nbsp;3&nbsp;row(s)<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;查看索引表内容</span><br  />hive&gt;&nbsp;<span style="font-weight: bold;line-height: 26px;">SELECT</span>&nbsp;*&nbsp;<span style="font-weight: bold;line-height: 26px;">FROM</span>&nbsp;default__user_behavior_idx_user_id_user_behavior__;<br  />OK<br  />9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://cdh03:8020/user/hive/warehouse/user_behavior/userbehavior.csv&nbsp;&nbsp;&nbsp;&nbsp;[181]<br  />7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://cdh03:8020/user/hive/warehouse/user_behavior/userbehavior.csv&nbsp;&nbsp;&nbsp;&nbsp;[136]<br  />1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://cdh03:8020/user/hive/warehouse/user_behavior/userbehavior.csv&nbsp;&nbsp;&nbsp;&nbsp;[0]<br  />6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://cdh03:8020/user/hive/warehouse/user_behavior/userbehavior.csv&nbsp;&nbsp;&nbsp;&nbsp;[113]<br  />5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://cdh03:8020/user/hive/warehouse/user_behavior/userbehavior.csv&nbsp;&nbsp;&nbsp;&nbsp;[90]<br  />10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://cdh03:8020/user/hive/warehouse/user_behavior/userbehavior.csv&nbsp;&nbsp;&nbsp;&nbsp;[205]<br  />4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://cdh03:8020/user/hive/warehouse/user_behavior/userbehavior.csv&nbsp;&nbsp;&nbsp;&nbsp;[66]<br  />8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://cdh03:8020/user/hive/warehouse/user_behavior/userbehavior.csv&nbsp;&nbsp;&nbsp;&nbsp;[158]<br  />3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://cdh03:8020/user/hive/warehouse/user_behavior/userbehavior.csv&nbsp;&nbsp;&nbsp;&nbsp;[44]<br  />2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hdfs://cdh03:8020/user/hive/warehouse/user_behavior/userbehavior.csv&nbsp;&nbsp;&nbsp;&nbsp;[22]<br  />Time&nbsp;taken:&nbsp;0.28&nbsp;seconds,&nbsp;Fetched:&nbsp;10&nbsp;row(s)<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">如果要删除索引，可以使用DROP INDEX命令，如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">DROP</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">INDEX</span>&nbsp;idx_user_id_user_behavior&nbsp;<span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;user_behavior;<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>使用skewed/temporary表<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Hive除了可以使用内部表、外部表、分区表、分桶表之外，也可以使用skewed/temporary表，也可以在一定程度上提升性能。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Hive从0.10版本之后开始支持skewed表，该表可以缓解数据倾斜。这种表之所以能够提升性能，是因为可以自动将造成数据倾斜的数据分割成不同的文件或者路径。使用示例如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">CREATE</span>&nbsp;<span style="font-weight: bold;line-height: 26px;">TABLE</span>&nbsp;sample_skewed_table&nbsp;(<br  />dept_no&nbsp;<span style="color: #0086b3;line-height: 26px;">int</span>,&nbsp;<br  />dept_name&nbsp;<span style="font-weight: bold;line-height: 26px;">string</span><br  />)&nbsp;<br  />SKEWED&nbsp;<span style="font-weight: bold;line-height: 26px;">BY</span>&nbsp;(dept_no)&nbsp;<span style="font-weight: bold;line-height: 26px;">ON</span>&nbsp;(<span style="color: #008080;line-height: 26px;">1000</span>,&nbsp;<span style="color: #008080;line-height: 26px;">2000</span>);<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;指定数据倾斜字段</span><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">另外，还可以使用temporary临时表，将公共使用部分的数据集建成临时表，同时临时表支持SSD或memory的数据存储，从而可以提升性能。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">数据存储优化</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>文件格式<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Hive支持TEXTFILE, SEQUENCEFILE, AVRO, RCFILE, ORC,以及PARQUET文件格式，可以通过两种方式指定表的文件格式：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">CREATE TABLE ... STORE AS &lt;file_format&gt;:即在建表时指定文件格式，默认是TEXTFILE</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">ALTER TABLE ... [PARTITION partition_spec] SET FILEFORMAT &lt;file_format&gt;:修改具体表的文件格式</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">一旦存储文件格式为TEXT的表被创建，可以直接通过load命令装载一个text类型的文件。我们可以先使用此命令将数据装载到一张TEXT格式的表中，然后在通过<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">INSERT OVERWRITE/INTO TABLE ... SELECT</code>命令将数据装载到其他文件格式的表中。</p><blockquote data-tool="mdnice编辑器" style="font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;"><strong>尖叫提示</strong>：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">如果要改变创建表的默认文件格式，可以使用hive.default.fileformat=&lt;file_format&gt;进行配置，改配置可以针对所有表。同时也可以使用hive.default.fileformat.managed =
&lt;file_format&gt;进行配置，改配置仅适用于内部表或外部表</p></blockquote><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">TEXT, SEQUENCE和 AVRO文件是面向行的文件存储格式，不是最佳的文件格式，因为即便是只查询一列数据，使用这些存储格式的表也需要读取完整的一行数据。另一方面，面向列的存储格式(RCFILE, ORC, PARQUET)可以很好地解决上面的问题。关于每种文件格式的说明，如下：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">TEXTFILE</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">创建表时的默认文件格式，数据被存储成文本格式。文本文件可以被分割和并行处理，也可以使用压缩，比如GZip、LZO或者Snappy。然而大部分的压缩文件不支持分割和并行处理，会造成一个作业只有一个mapper去处理数据，使用压缩的文本文件要确保文件的不要过大，一般接近两个HDFS块的大小。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">SEQUENCEFILE</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">key/value对的二进制存储格式，sequence文件的优势是比文本格式更好压缩，sequence文件可以被压缩成块级别的记录，块级别的压缩是一个很好的压缩比例。如果使用块压缩，需要使用下面的配置：set hive.exec.compress.output=true; set io.seqfile.compression.type=BLOCK</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">AVRO</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">二进制格式文件，除此之外，avro也是一个序列化和反序列化的框架。avro提供了具体的数据schema。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">RCFILE</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">全称是Record Columnar File，首先将表分为几个行组，对每个行组内的数据进行按列存储，每一列的数据都是分开存储，即先水平划分，再垂直划分。</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">ORC</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">全称是Optimized Row Columnar，从hive0.11版本开始支持，ORC格式是RCFILE格式的一种优化的格式，提供了更大的默认块(256M)</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">PARQUET</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">另外一种列式存储的文件格式，与ORC非常类似，与ORC相比，Parquet格式支持的生态更广，比如低版本的impala不支持orc格式</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>压缩<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">压缩技术可以减少map与reduce之间的数据传输，从而可以提升查询性能，关于压缩的配置可以在hive的命令行中或者hive-site.xml文件中进行配置</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.exec.compress.intermediate=<span style="color: #008080;line-height: 26px;">true</span><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">开启压缩之后，可以选择下面的压缩格式：</p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.3394327538883806" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgibbNuuylVPEWuhXFts2pszfoXjjHTA0vQtFmx0AnUGybraDVzXyuoO44ZthE28iahqesiaga5460XQ/640?wx_fmt=png" data-type="png" data-w="1093" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">关于压缩的编码器可以通过mapred-site.xml, hive-site.xml进行配置，也可以通过命令行进行配置,比如：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">-- 中间结果压缩<br  />SET hive.intermediate.compression.codec=org.apache.hadoop.io.compress.SnappyCodec<br  />-- 输出结果压缩<br  />SET hive.exec.compress.output=true;<br  />SET mapreduce.output.fileoutputformat.compress.codec=org.apache.hadoop.io.compress.SnappyCodc<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>存储优化<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">经常被访问的数据称之为热数据，可以针对热数据提升查询的性能。比如通过增加热数据的副本数，可以增加数据本地性命中的可能性，从而提升查询性能，当然这要与存储容量之间做出权衡。</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">$&nbsp;hdfs&nbsp;dfs&nbsp;-setrep&nbsp;-R&nbsp;-w&nbsp;4&nbsp;/user/hive/warehouse/employee<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">注意，大量的小文件或者冗余副本会造成namenode节点内存耗费，尤其是大量小于HDFS块大小的文件。HDSF本身提供了应对小文件的解决方案：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">Hadoop Archive/HAR:将小文件打包成大文件</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">SEQUENCEFILE格式：将小文件压缩成大文件</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">CombineFileInputFormat:在map和reduce处理之前组合小文件</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">HDFS Federation:HDFS联盟，使用多个namenode节点管理文件</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">对于Hive而言，可以使用下面的配置将查询结果的文件进行合并，从而避免产生小文件：</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">hive.merge.mapfiles: 在一个仅有map的作业中，合并最后的结果文件，默认为true</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">hive.merge.mapredfiles:合并mapreduce作业的结果小文件 默认false，可以设置true</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">hive.merge.size.per.task:定义合并文件的大小，默认 256,000,000，即256MB</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">hive.merge.smallfiles.avgsize: T触发文件合并的文件大小阈值，默认值是16,000,000</section></li></ul><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">当一个作业的输出结果文件的大小小于hive.merge.smallfiles.avgsize设定的阈值，并且hive.merge.mapfiles与hive.merge.mapredfiles设置为true，Hive会额外启动一个mr作业将输出小文件合并成大文件。</p><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">作业优化</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>本地模式<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">当Hive处理的数据量较小时，启动分布式去处理数据会有点浪费，因为可能启动的时间比数据处理的时间还要长，从Hive0.7版本之后，Hive支持将作业动态地转为本地模式，需要使用下面的配置：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.exec.mode.local.auto=<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;默认&nbsp;false</span><br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.exec.mode.local.auto.inputbytes.max=<span style="color: #008080;line-height: 26px;">50000000</span>;<br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.exec.mode.local.auto.input.files.max=<span style="color: #008080;line-height: 26px;">5</span>;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;默认&nbsp;4</span><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">一个作业只要满足下面的条件，会启用本地模式</p><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">输入文件的大小小于<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">hive.exec.mode.local.auto.inputbytes.max</code>配置的大小</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">map任务的数量小于<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">hive.exec.mode.local.auto.input.files.max</code>配置的大小</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">reduce任务的数量是1或者0</section></li></ul><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>JVM重用<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">默认情况下，Hadoop会为为一个map或者reduce启动一个JVM，这样可以并行执行map和reduce。当map或者reduce是那种仅运行几秒钟的轻量级作业时，JVM启动进程所耗费的时间会比作业执行的时间还要长。Hadoop可以重用JVM，通过共享JVM以串行而非并行的方式运行map或者reduce。JVM的重用适用于同一个作业的map和reduce，对于不同作业的task不能够共享JVM。如果要开启JVM重用，需要配置一个作业最大task数量，默认值为1，如果设置为-1，则表示不限制：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">SET&nbsp;mapreduce.job.jvm.numtasks=5;<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">这个功能的缺点是，开启JVM重用将一直占用使用到的task插槽，以便进行重用，直到任务完成后才能释放。如果某个“不平衡的”job中有某几个reduce task执行的时间要比其他Reduce task消耗的时间多的多的话，那么保留的插槽就会一直空闲着却无法被其他的job使用，直到所有的task都结束了才会释放。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>并行执行<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Hive的查询通常会被转换成一系列的stage，这些stage之间并不是一直相互依赖的，所以可以并行执行这些stage，可以通过下面的方式进行配置：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">SET&nbsp;hive.exec.parallel=<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;--&nbsp;默认<span style="color: #008080;line-height: 26px;">false</span><br  />SET&nbsp;hive.exec.parallel.thread.number=16;&nbsp;--&nbsp;默认8<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">并行执行可以增加集群资源的利用率，如果集群的资源使用率已经很高了，那么并行执行的效果不会很明显。</p><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>Fetch模式<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Fetch模式是指Hive中对某些情况的查询可以不必使用MapReduce计算。可以简单地读取表对应的存储目录下的文件，然后输出查询结果到控制台。在开启fetch模式之后，在全局查找、字段查找、limit查找等都启动mapreduce，通过下面方式进行配置：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">hive.fetch.task.conversion=more<br  /></code></pre><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>JOIN优化<span style="display: none;"></span></h3><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>普通join<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">普通join又称之为reduce端join，是一种最基本的join，并且耗时较长。对于大表join小表，需要将大表放在右侧，即小表join大表。新版的hive已经对小表JOIN大表和大表JOIN小表进行了优化。小表放在左边和右边已经没有明显区别。</p><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>map端join<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">map端join适用于当一张表很小(可以存在内存中)的情况，即可以将小表加载至内存。Hive从0.7开始支持自动转为map端join，具体配置如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">SET&nbsp;hive.auto.convert.join=<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;--&nbsp;&nbsp;hivev0.11.0之后默认<span style="color: #008080;line-height: 26px;">true</span><br  />SET&nbsp;hive.mapjoin.smalltable.filesize=600000000;&nbsp;--&nbsp;默认&nbsp;25m<br  />SET&nbsp;hive.auto.convert.join.noconditionaltask=<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;--&nbsp;默认<span style="color: #008080;line-height: 26px;">true</span>，所以不需要指定map&nbsp;join&nbsp;hint<br  />SET&nbsp;hive.auto.convert.join.noconditionaltask.size=10000000;&nbsp;--&nbsp;控制加载到内存的表的大小<br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">一旦开启map端join配置，Hive会自动检查小表是否大于<code style="font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(239, 112, 96);">hive.mapjoin.smalltable.filesize</code>配置的大小，如果大于则转为普通的join，如果小于则转为map端join。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">关于map端join的原理，如下图所示：</p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.664179104477612" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgibbNuuylVPEWuhXFts2psziajtOz7ZayVTrtsblicwviasw99licCc1QA8cVkOIoR8UHjia7KbjTH3dcg/640?wx_fmt=png" data-type="png" data-w="804" style=""  /></p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">首先，Task A(客户端本地执行的task)负责读取小表a，并将其转成一个HashTable的数据结构，写入到本地文件，之后将其加载至分布式缓存。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">然后，Task B任务会启动map任务读取大表b，在Map阶段，根据每条记录与分布式缓存中的a表对应的hashtable关联，并输出结果</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">注意：map端join没有reduce任务，所以map直接输出结果，即有多少个map任务就会产生多少个结果文件。</p><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>Bucket map join<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">bucket map join是一种特殊的map端join，主要区别是其应用在分桶表上。如果要开启分桶的map端join，需要开启一下配置：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.auto.convert.join=<span style="color: #008080;line-height: 26px;">true</span>;<br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.optimize.bucketmapjoin=<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;<span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;默认false</span><br  /></code></pre><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">在一个分桶的map端join中，所有参与join的表必须是分桶表，并且join的字段是分桶字段(通过CLUSTERED BY指定)，另外，对于大表的分桶数量必须是小表分桶数量的倍数。</p><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">与普通的join相比，分桶join仅仅只读取所需要的桶数据，不需要全表扫描。</p><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>Sort merge bucket (SMB) join<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">SMBjoin应用与分桶表，如果两张参与join的表是排序的，并且分桶字段相同，这样可以使用sort-merge join，其优势在于不用把小表完全加载至内存中，会读取两张分桶表对应的桶，执行普通join(包括map与reduce)配置如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.input.format=<br  />org.apache.hadoop.hive.ql.io.BucketizedHiveInputFormat;<br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.auto.convert.sortmerge.join=<span style="color: #008080;line-height: 26px;">true</span>;<br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.optimize.bucketmapjoin=<span style="color: #008080;line-height: 26px;">true</span>;<br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.optimize.bucketmapjoin.sortedmerge=<span style="color: #008080;line-height: 26px;">true</span>;<br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.auto.convert.sortmerge.join.noconditionaltask=<span style="color: #008080;line-height: 26px;">true</span>;<br  /></code></pre><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>Sort merge bucket map (SMBM) join<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">SMBM join是一种特殊的bucket map join，与map端join不同的是，不用将小表的所有数据行都加载至内存中。使用SMBM join，参与join的表必须是排序的，有着相同的分桶字段，并且join字段与分桶字段相同。配置如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">SET&nbsp;hive.auto.convert.join=<span style="color: #008080;line-height: 26px;">true</span>;<br  />SET&nbsp;hive.auto.convert.sortmerge.join=<span style="color: #008080;line-height: 26px;">true</span><br  />SET&nbsp;hive.optimize.bucketmapjoin=<span style="color: #008080;line-height: 26px;">true</span>;<br  />SET&nbsp;hive.optimize.bucketmapjoin.sortedmerge=<span style="color: #008080;line-height: 26px;">true</span>;<br  />SET&nbsp;hive.auto.convert.sortmerge.join.noconditionaltask=<span style="color: #008080;line-height: 26px;">true</span>;<br  />SET&nbsp;hive.auto.convert.sortmerge.join.bigtable.selection.policy=<br  />org.apache.hadoop.hive.ql.optimizer.TableSizeBasedBigTableSelectorForAutoSMJ;<br  /></code></pre><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>Skew join<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">当被处理的数据分布极其不均匀时，会造成数据倾斜的现象。Hive可以通过如下的配置优化数据倾斜的情况：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;"><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;默认false，如果数据倾斜，可以将其设置为true</span><br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.optimize.skewjoin=<span style="color: #008080;line-height: 26px;">true</span>;<br  /><span style="color: #998;font-style: italic;line-height: 26px;">--&nbsp;默认为100000，如果key的数量大于配置的值，则超过的数量的key对应的数据会被发送到其他的reduce任务</span><br  /><span style="font-weight: bold;line-height: 26px;">SET</span>&nbsp;hive.skewjoin.key=<span style="color: #008080;line-height: 26px;">100000</span>;<br  /></code></pre><blockquote data-tool="mdnice编辑器" style="font-size: 0.9em;overflow: auto;color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;border-left-color: rgb(239, 112, 96);background: rgb(255, 249, 249);"><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;"><strong>尖叫提示</strong>：</p><p style="font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;">数据倾斜在group by的情况下也会发生，所以可以开启一个配置：set hive.groupby.skewindata=true，优化group by出现的数据倾斜，一旦开启之后，执行作业时会首先额外触发一个mr作业，该作业的map任务的输出会被随机地分配到reduce任务上，从而避免数据倾斜</p></blockquote><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>执行引擎<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Hive支持多种执行引擎，比如spark、tez。对于执行引擎的选择，会影响整体的查询性能。使用的配置如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">SET&nbsp;hive.execution.engine=&lt;engine&gt;;&nbsp;--&nbsp;&lt;engine&gt;&nbsp;=&nbsp;mr|tez|spark<br  /></code></pre><ul data-tool="mdnice编辑器" style="margin-top: 8px;margin-bottom: 8px;padding-left: 25px;" class="list-paddingleft-2"><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">mr:默认的执行引擎，在Hive2.0版本版本中被标记过时</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">tez:可以将多个有依赖的作业转换为一个作业，这样只需写一次HDFS，且中间节点较少，从而大大提升作业的计算性能。</section></li><li><section style="margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);">spark:一个通用的大数据计算框架，基于内存计算，速度较快</section></li></ul><h3 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;"><span style="display: none;"></span>优化器<span style="display: none;"></span></h3><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">与关系型数据库类似，Hive会在真正执行计算之前，生成和优化逻辑执行计划与物理执行计划。Hive有两种优化器：<strong>Vectorize(向量化优化器)<strong>与</strong>Cost-Based Optimization (CBO,成本优化器)</strong>。</p><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>向量化优化器<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">向量化优化器会同时处理大批量的数据，而不是一行一行地处理。要使用这种向量化的操作，要求表的文件格式为ORC，配置如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">SET&nbsp;hive.vectorized.execution.enabled=<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;--&nbsp;默认&nbsp;<span style="color: #008080;line-height: 26px;">false</span><br  /></code></pre><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 18px;"><span style="display: none;"></span>成本优化器<span style="display: none;"></span></h4><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">Hive的CBO是基于apache Calcite的，Hive的CBO通过查询成本(有analyze收集的统计信息)会生成有效率的执行计划，最终会减少执行的时间和资源的利用，使用CBO的配置如下：</p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;"><code style="overflow-x: auto;padding: 16px;color: #333;background: #f8f8f8;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;border-radius: 0px;font-size: 12px;-webkit-overflow-scrolling: touch;">SET&nbsp;hive.cbo.enable=<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;--从&nbsp;v0.14.0默认<span style="color: #008080;line-height: 26px;">true</span><br  />SET&nbsp;hive.compute.query.using.stats=<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;--&nbsp;默认<span style="color: #008080;line-height: 26px;">false</span><br  />SET&nbsp;hive.stats.fetch.column.stats=<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;--&nbsp;默认<span style="color: #008080;line-height: 26px;">false</span><br  />SET&nbsp;hive.stats.fetch.partition.stats=<span style="color: #008080;line-height: 26px;">true</span>;&nbsp;--&nbsp;默认<span style="color: #008080;line-height: 26px;">true</span><br  /></code></pre><h2 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;font-weight: bold;border-bottom: 2px solid rgb(239, 112, 96);font-size: 1.3em;"><span style="display: none;"></span><span style="display: inline-block;background: rgb(239, 112, 96);color: rgb(255, 255, 255);padding: 3px 10px 1px;border-top-right-radius: 3px;border-top-left-radius: 3px;margin-right: 3px;">总结</span><span style="display: inline-block;vertical-align: bottom;border-bottom: 36px solid #efebe9;border-right: 20px solid transparent;"> </span></h2><p data-tool="mdnice编辑器" style="padding-top: 8px;padding-bottom: 8px;line-height: 26px;">本文主要介绍了Hive调优的基本思路。总共分为四部分，首先介绍了调优的基本工具使用(explain、analyze);接着从表设计层面介绍了一些优化策略(分区、分桶、索引)；然后介绍了数据存储方面的优化(文件格式、压缩、存储优化)；最后从作业层面介绍了优化的技巧(开启本地模式、JVM重用、并行执行、fetch模式、Join优化、执行引擎与优化器)。本文主要为Hive性能调优提供一些思路，在实际的操作过程中需要具体问题具体分析。总之一句话，重剑无锋，为作业分配合理的资源基本上可以满足大部分的情况，适合的就是最好的，没有必要追求狂拽酷炫的技巧，应该把更多的精力放在业务问题上，因为工具的存在的价值是为了解决业务问题的，切不可本末倒置。</p><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="98598"><section><section style="margin: 10px auto;"><section style="padding-top: 6px;box-sizing: border-box;"><section style="display: flex;align-items: center;"><section style="display: flex;flex-direction: column;"><section style="display: flex;align-items: center;margin-bottom: -30px;"><section style="display: flex;padding-right: 6px;padding-left: 6px;box-sizing: border-box;"><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: transparent;box-sizing: border-box;display: flex;justify-content: center;align-items: center;overflow: hidden;transform: rotate(45deg);"><br  /></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: transparent;box-sizing: border-box;display: flex;align-items: flex-end;transform: rotate(45deg);"><section style="width: 7px;height: 7px;background-image: linear-gradient(to right, #aeede2, #bbf2dd);overflow: hidden;"><br  /></section></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: transparent;box-sizing: border-box;display: flex;align-items: flex-end;transform: rotate(45deg);"><section style="width: 7px;height: 7px;background-image: linear-gradient(to right, #aeede2, #bbf2dd);overflow: hidden;"><br  /></section></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: transparent;box-sizing: border-box;display: flex;align-items: flex-end;transform: rotate(45deg);"><section style="width: 7px;height: 7px;background-image: linear-gradient(to right, #aeede2, #bbf2dd);overflow: hidden;"><br  /></section></section></section></section><section style="display: flex;align-items: center;"><section style="display: flex;padding-right: 6px;padding-left: 6px;box-sizing: border-box;"><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: rgb(122, 218, 216);box-sizing: border-box;display: flex;justify-content: center;align-items: center;transform: rotate(45deg);"><section data-brushtype="text" style="text-align: center;color: rgb(76, 174, 172);font-weight: bold;transform: rotate(-45deg);">关</section></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: rgb(122, 218, 216);box-sizing: border-box;display: flex;justify-content: center;align-items: center;transform: rotate(45deg);"><section data-brushtype="text" style="text-align: center;color: rgb(76, 174, 172);font-weight: bold;transform: rotate(-45deg);">注</section></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: rgb(122, 218, 216);box-sizing: border-box;display: flex;justify-content: center;align-items: center;transform: rotate(45deg);"><section data-brushtype="text" style="text-align: center;color: rgb(76, 174, 172);font-weight: bold;transform: rotate(-45deg);">我</section></section><section style="width: 30px;height: 30px;border-width: 1px;border-style: solid;border-color: rgb(122, 218, 216);box-sizing: border-box;display: flex;justify-content: center;align-items: center;transform: rotate(45deg);"><section data-brushtype="text" style="text-align: center;color: rgb(76, 174, 172);font-weight: bold;transform: rotate(-45deg);">们</section></section></section></section></section><section style="flex: 1 1 0%;height: 1px;background-image: linear-gradient(to right, #7cdad8, #cff2f1);overflow: hidden;"><br  /></section></section><section style="padding-top: 15px;padding-bottom: 15px;box-sizing: border-box;"><section style="display: flex;justify-content: center;align-items: center;"><section style="display: flex;justify-content: center;align-items: center;padding-right: 20px;padding-left: 15px;box-sizing: border-box;"><section style="width: auto;margin-right: 20px;"><section style="text-align: center;font-size: 14px;letter-spacing: 1.5px;color: rgb(84, 187, 185);line-height: 1.75em;word-break: break-all;font-weight: bold;">分享具有实践意义的大数据知识</section><section style="text-align: center;font-size: 14px;letter-spacing: 1.5px;color: rgb(84, 187, 185);line-height: 1.75em;word-break: break-all;font-weight: bold;">关注免费领取资料</section><section style="text-align: center;font-size: 14px;letter-spacing: 1.5px;color: rgb(84, 187, 185);line-height: 1.75em;word-break: break-all;font-weight: bold;">keep it simple and stupid</section><section style="display: flex;justify-content: flex-start;"><section style="width: 10px;margin-top: -14px;margin-left: -15px;"><img data-ratio="1.3157894736842106" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgibbNuuylVPEWuhXFts2psz8gibtUGjFVMVDGbpEHzlQttPria5M7YV1QULibzNTUcRbsJfEFpZSqiblA/640?wx_fmt=png" data-type="png" data-w="19" data-width="100%" style="display: block;width: 100%;"  /></section><section style="width: 6px;margin-top: -2px;margin-left: -2px;"><img data-ratio="1.3157894736842106" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgibbNuuylVPEWuhXFts2psz8gibtUGjFVMVDGbpEHzlQttPria5M7YV1QULibzNTUcRbsJfEFpZSqiblA/640?wx_fmt=png" data-type="png" data-w="19" data-width="100%" style="display: block;width: 100%;"  /></section></section></section><section style="width: 80px;box-sizing: border-box;flex-shrink: 0;"><img data-ratio="1" src="https://mmbiz.qpic.cn/mmbiz_jpg/PL10rfzHicsgibbNuuylVPEWuhXFts2pszMj7QEWyvrM5YQbDCFt5vHORYcsdVjRAvx2mmztibP2ibC3Aaib2PlBwGQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="344" data-width="100%" style="width:100%;display:block;" title="二维码.jpg"  /></section></section></section></section><section style="display: flex;justify-content: flex-end;"><section style="width: 20px;margin-top: -20px;"><img data-ratio="0.6944444444444444" src="https://mmbiz.qpic.cn/mmbiz_png/PL10rfzHicsgibbNuuylVPEWuhXFts2psz11vu7ll2aCKnuQAvC8Y67C4Ugs4GjaP363hThTH0PEXQ7Ub1WTYK4w/640?wx_fmt=png" data-type="png" data-w="36" data-width="100%" style="display: block;width: 100%;"  /></section></section><section style="width: 100%;height: 1px;background-image: linear-gradient(to right, #cff2f1, #7cdad8);overflow: hidden;" data-width="100%"><br  /></section></section></section></section></section><section data-role="paragraph"><section data-tools="135编辑器" data-id="98399"><section style="margin: 10px auto;"><section style="display: flex;justify-content: flex-end;align-items: center;"><section style="width: 35px;transform: rotate(0deg);"><section style="width: 35px;"><img data-ratio="1.0838323353293413" src="https://mmbiz.qpic.cn/mmbiz_gif/PL10rfzHicsgibbNuuylVPEWuhXFts2psz8sMsS2cnU8XmPkryHnxK6tz4VetEuEx1g3FHBbtt8hPZFoNhUxsPdA/640?wx_fmt=gif" data-type="gif" data-w="334" data-width="100%" style="width:100%;display:block;"  /></section></section><section data-brushtype="text" style="margin-bottom: 12px;margin-left: 5px;color: rgb(148, 165, 204);letter-spacing: 1.5px;font-size: 14px;">摊位已摆好，等你来围观(在看)!</section></section></section></section></section></section></section><div class="msg_source_url"><a href="https://mp.weixin.qq.com/s/RykdGWsESRNhq9r7q2f-CA#rd" target="_blank">阅读原文</a></div></content><div class="msg_source_url"><a href="https://mp.weixin.qq.com/s/RykdGWsESRNhq9r7q2f-CA#rd" target="_blank">阅读原文</a></div>
</div>
</body>
</html>