<html>
<head>
<title></title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;overflow:hidden;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:1.4;margin-bottom:13px;padding-bottom:13px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;padding:0 0 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:0px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:#a5a5a5;}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size: 15px;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}#copyright_logo{color:#bdbdbd;}.rich_media_meta_list{margin-bottom:10px;}.reprint{background:#efefef;border-radius:5px;padding:8px;color:#1f1f1f;}.reprint a{word-break:break-all;}.topic{color:#8e8e8e;background:#f7f7f7;border-radius:5px;padding:10px 8px;}.topic a{padding-right:5px;}.topic p{margin-bottom:5px;}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head><script>
var data={"mp":"数据治理体系","title":"史上最全干货！Flink面试大全总结（全文6万字、110个知识点、160张图）","time":"2021-08-29 09:30:00","timeStamp":"1630200600"};
</script>
<body>
<div class="rich_media"><h1 class="rich_media_title" id="activity-name"><a href="http://mp.weixin.qq.com/s?__biz=MzA3NjIzNjMwOA==&mid=2247483950&idx=1&sn=759eec7df506c49fefb00d53b068c072&chksm=9f651155a81298433adb41ff5daabe5618b06eb30efde3220b93e4fb0319a593905fade39115#rd" target="_blank">史上最全干货！Flink面试大全总结（全文6万字、110个知识点、160张图）</a></h1><div id="meta_content" class="rich_media_meta_list"><span class="rich_media_meta rich_media_meta_text">在IT中穿梭旅行&nbsp;&nbsp;</span><span class="rich_media_meta rich_media_meta_nickname" id="profileBt"><a href="javascript:void(0);" class="wx_tap_link js_wx_tap_highlight weui-wa-hotarea" id="js_name">数据治理体系&nbsp;&nbsp;</a></span><em id="publish_time" class="rich_media_meta rich_media_meta_text">2021-08-29 09:30:00</em></div><content><section data-mpa-category="背景" data-mpa-template="t" style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1F86jlR90b2GCvMPPtvG4WurspKkviagRlCt8g8clTOpkvZ9Tcft9UVg/640?wx_fmt=jpeg&quot;);" data-mpa-powered-by="yiban.io"><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;white-space: normal;font-size: 14px;letter-spacing: 1px;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;"><span style="letter-spacing: 1px;">&nbsp; &nbsp; 关注并标星&nbsp;<strong><span style="color: rgb(255, 0, 0);">3分钟秒懂大数据</span></strong><br  /></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;white-space: normal;font-size: 14px;letter-spacing: 1px;background-color: rgb(255, 255, 255);text-align: center;"><span style="color: rgb(62, 62, 62);letter-spacing: 1px;">每天1次，打卡阅读</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;white-space: normal;font-size: 14px;letter-spacing: 1px;background-color: rgb(255, 255, 255);text-align: center;"><span style="color: rgb(62, 62, 62);letter-spacing: 1px;">获取AI大数据技术、面经、内推信息</span></p><p><span style="color: rgb(255, 0, 0);font-size: 18px;letter-spacing: 1px;"><strong>前言</strong><br  /></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><p style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Helle，各位大数据学习爱好者，我是&nbsp;</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>3分钟秒懂大数据&nbsp;</strong></span><span style="font-size: 14px;">公众号的作者土哥，目前在杭州某互联网大厂担任大数据算法工程师，组内专注于Flink流式计算组件以及AB融合技术，为了让更多朋友更清晰的了解流式计算组件，现在我以面试的方式为大家全面总结了Flink所涉及的知识点，全文总共6万字，涉及各种原理，以及源码分析，</span><span style="font-size: 14px;color: rgb(172, 57, 255);"><strong>图片是一张张绘制而出</strong></span><span style="font-size: 14px;">，欢迎大家进行解读！<br  /></span></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="margin-bottom: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">在互联网行业，我们都知道薪资结构跟岗位存在直接关系，如下面这幅关系图：</span></section><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.11818181818181818" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OApvWgxnDBD9t7WAKEUvwDacyCIiaTN80r4Qib32tw9fHa9DgeLEP9DYwVvO4r39YmBIsIGEU97y4g/640?wx_fmt=png" data-type="png" data-w="1100" style=""  /></p><section style="text-align: left;margin-top: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">如果你想找大数据开发或者大数据算法工程师、那Flink流计算框架是面试必考点。<br  /></span></section><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="text-align: left;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">而作为一名大数据算法工程师，土哥我专门编写了Flink&nbsp;面试常问的题目，同时这些题目之间的&nbsp;</span><strong><span style="color: rgb(122, 79, 214);font-size: 14px;">关联性</span></strong><strong><span style="font-size: 14px;color: rgb(0, 128, 255);">&nbsp;</span></strong><span style="font-size: 14px;">很强，本文将通过&nbsp;</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">问答 + 图解</span></strong><span style="font-size: 14px;">&nbsp;的形式 </span><span style="font-size: 14px;color: rgb(122, 79, 214);"><strong>由浅入深</strong></span><span style="font-size: 14px;">&nbsp;帮助大家进一步学习和理解</span><span style="color: rgb(255, 76, 65);"><strong><span style="font-size: 14px;">Flink</span></strong><span style="font-size: 14px;"><strong>流批一体</strong></span></span><span style="font-size: 14px;">计算框架。</span></span></section><section style="text-align: left;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(2, 30, 170);">全文总计6万字</span></strong><span style="font-size: 14px;">、</span><strong><span style="font-size: 14px;color: rgb(255, 76, 0);">110个知识点</span></strong><span style="font-size: 14px;">、</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">160张原理、流程图</span></strong><span style="font-size: 14px;">。提纲如下：</span></span></section><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5291201982651796" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PqALZbh7IQstylo5PALv6BnQP2kEErnciaAzg6B0wKzOfbDJNeAyqHJh3PVvNhgIc2McGAJGoKozw/640?wx_fmt=png" data-type="png" data-w="1614" style=""  /></p><p style="text-align: center;"><span style="font-size: 13px;letter-spacing: 1px;">提纲<br  /></span></p><p><span style="color: rgb(255, 0, 0);font-size: 18px;letter-spacing: 1px;"><strong>正文</strong></span></p><p style="text-align: left;"><br  /></p><section data-mpa-template="t" mpa-from-tpl="t"><section style="display: flex;justify-content: center;align-items: center;width: 100%;" data-mid="" mpa-from-tpl="t"><section style="display: flex;justify-content: flex-start;align-items: center;flex-direction: column;" data-mid="" mpa-from-tpl="t"><section style="display: flex;justify-content: center;align-items: center;" data-mid="" mpa-from-tpl="t"><section style="width: 27px;margin-right: 3px;" data-mid="" mpa-from-tpl="t"><img data-ratio="0.9629629629629629" src="https://mmbiz.qpic.cn/mmbiz_png/DiaLG0VOfnEibU5UwN5aic6Ez0obyBiapEUbCdUnqu7yuwQVF8mfAkNOux6iatlI7gtN9IgWHVIhy1pibiapFW89HzTRw/640?wx_fmt=png" data-type="png" data-w="54" style="display: block;"  /></section><section style="height: 28px;background: rgba(206, 226, 255, 0.53);text-align: center;padding: 0px 7px 0px 11px;" data-mid="" mpa-from-tpl="t"><p style="font-size: 16px;font-family: PingFangSC-Semibold, PingFang SC;font-weight: bold;color: #1D6EEA;line-height: 28px;letter-spacing: 3px;" data-mid=""><span style="letter-spacing: 1px;">01、Flink 基础篇</span></p></section></section><section style="display: flex;justify-content: center;align-items: center;justify-content: space-between;width: 100%;margin-top: 4px;" data-mid="" mpa-from-tpl="t"><section style="width: 60%;height: 1px;background-color: #5698FC;" data-mid="" mpa-from-tpl="t"><br  /></section><section style="width: 10%;height: 1px;background-color: #5698FC;" data-mid="" mpa-from-tpl="t"><br  /></section></section></section></section></section><p style="text-align: center;"><br  /></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;white-space: normal;word-spacing: 2px;line-height: inherit;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">1、什么是Flink？描述一下</span></p></blockquote><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.3671071953010279" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AUCTgSicNPdtu9IlqrPZ9UQNLVicqEqvB9qUCfWwcTRT8cKne4ACObB8icw/640?wx_fmt=png" data-type="png" data-w="681" style="width: 326px;height: 120px;"  /></p><p style="margin-top: 1.7em;margin-bottom: 1.7em;color: inherit;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: inherit;letter-spacing: 2px;white-space: normal;word-spacing: 2px;background-color: rgb(255, 255, 255);line-height: inherit;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink是一个以</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong> 流</strong></span><span style="font-size: 14px;"> 为核心的高可用、高性能的分布式计算引擎。具备<span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;word-spacing: 2px;">&nbsp;</span><strong style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;white-space: normal;word-spacing: 2px;"><span style="color: rgb(0, 82, 255);">流批一体，</span></strong>高吞吐、低延迟，容错能力，大规模复杂计算等特点，<span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;word-spacing: 2px;">在数据流上提供&nbsp;</span><strong style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;white-space: normal;word-spacing: 2px;"><span style="color: rgb(0, 82, 255);">数据分发</span></strong><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;word-spacing: 2px;">、通信等功能。</span></span><br  /></span></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;white-space: normal;word-spacing: 2px;line-height: inherit;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">2、能否详细解释一下其中的 数据流、流批一体、容错能力等概念？</span></p></blockquote><p style="margin-top: 1.7em;margin-bottom: 1.7em;color: inherit;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: inherit;letter-spacing: 2px;white-space: normal;word-spacing: 2px;background-color: rgb(255, 255, 255);line-height: inherit;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(255, 76, 65);">数据流：</span></strong><span style="font-size: 14px;">所有产生的 </span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>数据</strong></span><span style="font-size: 14px;"> 都天然带有 </span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">时间概念</span></strong><span style="font-size: 14px;">，把 事件&nbsp;按照时间顺序排列起来，就形成了一个事件流，也被称作数据流。</span></span></p><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;"><strong style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;white-space: normal;word-spacing: 2px;"><span style="font-size: 14px;color: rgb(255, 76, 65);">流批一体：</span></strong><br  /></span></p><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">首先必须先明白什么是 </span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>有界数据</strong></span><span style="font-size: 14px;">&nbsp; 和 </span><span style="color: rgb(0, 82, 255);"><strong><span style="font-size: 14px;">无界数据</span></strong></span></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.24489795918367346" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AUba63FSERmWXWFse38S9EicfPa2libB3JkCUO3as45gEofrwVjgnlYPkA/640?wx_fmt=png" data-type="png" data-w="931" style=""  /></p><p style="text-align: left;"><br  /></p><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 82, 255);"><strong><span style="font-size: 14px;">有界数据</span></strong></span><span style="font-size: 14px;">，就是在一个确定的时间范围内的数据流，有开始，有结束，一旦确定就不会再改变，<span style="text-align: left;">一般 </span></span><strong><span style="text-align: left;font-size: 14px;color: rgb(255, 76, 65);">批</span></strong><span style="font-size: 14px;"><strong style="text-align: left;white-space: normal;"><span style="color: rgb(255, 76, 65);">处理</span></strong><span style="text-align: left;">&nbsp;用来处理有界数据</span>，如上图的 bounded stream。<br  /></span></span></p><section style="text-align: left;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">无界数据</span></strong><span style="font-size: 14px;">，就是持续产生的数据流，数据是无限的，有开始，无结束，一般 </span><strong><span style="font-size: 14px;color: rgb(255, 76, 65);">流处理</span></strong><span style="font-size: 14px;"> 用来处理无界数据。如图 unbounded stream。<br  /></span></span></section><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink的设计思想是以</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong> 流 </strong></span><span style="font-size: 14px;">为核心，批是流的特例，擅长处理 无界 和 有界&nbsp;数据，&nbsp;Flink 提供 精确的时间控制能力 和 有状态 计算机制，可以轻松应对无界数据流，同时&nbsp;提供 </span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">窗口 </span></strong><span style="font-size: 14px;">处理有界数据流。所以被成为流批一体。</span></span></p><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;"><strong style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;white-space: normal;word-spacing: 2px;"><span style="font-size: 14px;color: rgb(255, 76, 65);">容错能力：</span></strong></span></p><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;"><strong style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;white-space: normal;word-spacing: 2px;"><span style="font-size: 14px;color: rgb(255, 76, 65);"><br  /></span></strong></span></p><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">在分布式系统中，硬件故障、进程异常、应用异常、网络故障等异常无处不在，Flink引擎必须保证故障发生后&nbsp;不仅可以 <strong>重启</strong> 应用程序，还要 </span><span style="color: rgb(0, 0, 0);"><strong><span style="font-size: 14px;">确保</span></strong></span><span style="font-size: 14px;"> 其内部状态保持一致，从最后一次正确的时间点重新出发</span></span></p><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="text-align: left;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink提供&nbsp;</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>集群级容错</strong></span><span style="font-size: 14px;"> 和&nbsp;</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">应用级容错</span></strong><span style="font-size: 14px;"> 能力</span></span></section><section style="text-align: left;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 82, 255);"><strong><span style="font-size: 14px;">集群级容错：</span></strong></span><span style="font-size: 14px;">&nbsp;Flink 与 集群管理器紧密连接，如YARN、Kubernetes，当进程挂掉后，自动重启新进程接管之前的工作。同时具备 </span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">高可用</span></strong><span style="color: rgb(122, 79, 214);"><strong><span style="font-size: 14px;">性 ，</span></strong></span><span style="font-size: 14px;color: rgb(0, 0, 0);">可消除所有单点故障，</span></span></section><section style="text-align: left;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 82, 255);"><strong><span style="font-size: 14px;">应用级容错：</span></strong></span><span style="font-size: 14px;">Flink 使用 轻量级分布式快照，设计检查点（</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">checkpoint</span></strong><span style="font-size: 14px;">）实现可靠容错。</span></span></section><p style="text-align: left;margin-bottom: 20px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink 利用检查点特性，在框架层面 提供 </span><span style="font-size: 14px;color: rgb(122, 79, 214);"><strong>Exactly-once</strong></span><span style="font-size: 14px;"> 语义，即端到端的一致性，确保数据仅处理一次，不会重复也不会丢失，即使出现故障，也能保证数据只写一次。<br  /></span></span></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">3、Flink 和 Spark Streaming的区别？</span></p></blockquote><p style="text-align: left;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 82, 255);"><strong><span style="font-size: 14px;">Flink</span></strong></span><span style="font-size: 14px;"> 和 </span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">Spark&nbsp;Sreaming&nbsp;</span></strong><span style="color: rgb(255, 76, 65);"><strong><span style="font-size: 14px;">最大的区别</span></strong></span><span style="font-size: 14px;">在于：Flink 是标准的实时处理引擎，基于事件驱动，</span><strong><span style="font-size: 14px;color: rgb(255, 79, 121);">以流为核心</span></strong><span style="font-size: 14px;">，而 Spark Streaming 的RDD 实际是一组小批次的RDD集合，是微批（Micro-Batch）的模型，</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">以批为核心</span></strong><span style="font-size: 14px;">。</span></span></p><p style="text-align: left;margin-bottom: 20px;"><span style="font-size: 14px;letter-spacing: 1px;">下面我们介绍两个框架的主要区别：</span></p><p style="text-align: left;margin-bottom: 20px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">1. 架构模型</span></strong></span></p><p style="text-align: left;margin-bottom: 20px;"><span style="font-size: 14px;letter-spacing: 1px;">Spark Streaming 在运行时的主要角色包括：</span></p><section style="text-align: left;margin-bottom: 20px;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: PingFangSC-Regular, &quot;PingFang SC&quot;;font-size: 14px;letter-spacing: 1px;">服务架构集群和资源管理 Master / Yarn Application Master；</span></section><section style="text-align: left;margin-bottom: 20px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">工作节点 Work / Node Manager；</span></section><section style="text-align: left;margin-bottom: 20px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">任务调度器 Driver；任务执行器 Executor</span></section><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5327783558792925" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEE9GYpvHyoXjxMu5hiaiaAr825gYAe8y4OIcPV9XejLVxvBHEz5ypZu1bQ1zPz0lq0XZPu4yFccXA/640?wx_fmt=png" data-type="png" data-w="961" style=""  /></p><section style="text-align: left;margin-bottom: 20px;margin-top: 20px;"><span style="font-size: 14px;text-align: left;letter-spacing: 1px;">Flink 在运行时主要包含：客户端 Client、作业管理 Jobmanager、任务管理Taskmanager。</span></section><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.7341115434500648" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AUvaQhPsmjLNjfAibfSa0uaBpOe2piaW0YG2chznQBqwHTLQDtiaT19k3Vw/640?wx_fmt=png" data-type="png" data-w="771" style=""  /></p><p style="text-align: left;margin-bottom: 20px;"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);font-size: 14px;">2. 任务调度</span></strong><br  /></span></p><p style="text-align: left;margin-bottom: 20px;"><span style="font-size: 14px;letter-spacing: 1px;">Spark Streaming 连续不断的生成微小的数据批次，构建有向无环图DAG，Spark Streaming 会依次创建 DStreamGraph、JobScheduler。</span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.697429906542056" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AURibfZZdMF9ibMgvicLo6Q7mLbjQY03cATtIdTIluhcv5HBH4DeB2BaQag/640?wx_fmt=png" data-type="png" data-w="856" style=""  /></p><p style="text-align: left;margin-bottom: 20px;margin-top: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink 根据用户提交的代码生成 </span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">StreamGraph</span></strong><span style="font-size: 14px;">，经过优化生成 </span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">JobGraph</span></strong><span style="font-size: 14px;">，然后提交给 JobManager进行处理，JobManager 会根据 JobGraph 生成 </span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">ExecutionGraph</span></strong><span style="font-size: 14px;">，ExecutionGraph 是 Flink 调度最核心的数据结构，JobManager 根据 ExecutionGraph 对 Job 进行调度，根据物理执行图部署到Taskmanager上形成具体的Task执行。&nbsp;</span></span></p><section style="text-align: left;margin-bottom: 20px;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.27011494252873564" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AUj5doZpWG7yNN0b8e2ZdIqVWum7PnZ5Xkpotou9VcaGPiaEnFLsCM0JA/640?wx_fmt=png" data-type="png" data-w="870" style="text-align: center;"  /></section><p style="text-align: left;margin-bottom: 20px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">3. 时间机制</span></strong></span></p><p style="margin-top: 1.7em;margin-bottom: 1.7em;color: inherit;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: inherit;letter-spacing: 2px;white-space: normal;word-spacing: 2px;line-height: inherit;"><span style="letter-spacing: 1px;font-size: 14px;">Spark Streaming 支持的时间机制有限，只支持处理时间。</span></p><p style="margin-top: 1.7em;margin-bottom: 1.7em;color: inherit;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: inherit;letter-spacing: 2px;white-space: normal;word-spacing: 2px;line-height: inherit;"><span style="letter-spacing: 1px;font-size: 14px;">Flink 支持了流处理程序在时间上的三个定义：</span><span style="letter-spacing: 1px;font-size: 14px;color: rgb(217, 33, 66);"><strong>事件时间 EventTime</strong></span><span style="letter-spacing: 1px;font-size: 14px;">、</span><strong><span style="letter-spacing: 1px;font-size: 14px;color: rgb(2, 30, 170);">摄入时间 IngestionTime</span></strong><span style="letter-spacing: 1px;font-size: 14px;"> 、</span><strong><span style="letter-spacing: 1px;font-size: 14px;color: rgb(61, 167, 66);">处理时间 ProcessingTime</span></strong><span style="letter-spacing: 1px;font-size: 14px;">。同时也支持 watermark 机制来处理滞后数据。</span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.548936170212766" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AUpuJ511U8seVsMm5T8cBtX2Lq6brLZj7h1ZP6yg2rVPERnzDs6scicew/640?wx_fmt=png" data-type="png" data-w="705" style=""  /></p><p style="text-align: left;margin-bottom: 20px;"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);font-size: 14px;">4. 容错机制</span></strong></span></p><p style="margin-top: 1.7em;margin-bottom: 1.7em;color: inherit;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: inherit;letter-spacing: 2px;white-space: normal;word-spacing: 2px;line-height: inherit;"><span style="color: rgb(217, 33, 66);"><strong><span style="letter-spacing: 1px;font-size: 14px;">对于 Spark Streaming 任务，我们可以设置 checkpoint</span></strong></span><span style="letter-spacing: 1px;font-size: 14px;">，然后假如发生故障并重启，我们可以从上次 checkpoint 之处恢复，但是这个行为只能使得数据不丢失，可能会重复处理，不能做到恰好一次处理语义。</span></p><p style="text-align: left;margin-bottom: 20px;"><span style="font-size: 14px;letter-spacing: 1px;">Flink 则使用两阶段提交协议来解决这个问题。</span></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">4、Flink的架构包含哪些？</span></p></blockquote><p style="margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink&nbsp;架构分为</span><span style="color: rgb(0, 82, 255);"><strong><span style="font-size: 14px;">&nbsp;技术架构 </span></strong></span><span style="font-size: 14px;">和</span><span style="color: rgb(0, 82, 255);"><strong><span style="font-size: 14px;"> 运行架构 </span></strong></span><span style="font-size: 14px;">两部分。</span></span></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">5、简单介绍一下技术架构</span></p></blockquote><p style="margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">如下图为Flink技术架构：</span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5248667850799289" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AUd9dCntoibmAMVkqL8ZjDhHXz6TYoaianKwJ0mb3b0zYtgytiaTOU7f49A/640?wx_fmt=png" data-type="png" data-w="1126" style=""  /></p><p style="margin-bottom: 10px;white-space: normal;text-align: left;"><br  /></p><section style="margin-bottom: 10px;white-space: normal;text-align: left;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink 作为流批一体的分布式计算引擎，必须提供面向开发人员的</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>API层</strong></span><span style="font-size: 14px;">，同时还需要跟外部数据存储进行交互，需要</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>连接器</strong></span><span style="font-size: 14px;">，作业开发、测试完毕后，需要提交集群执行，需要</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">部署层</span></strong><span style="font-size: 14px;">，同时还需要运维人员能够管理和监控，还提供图计算、机器学习、SQL等，需要</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">应用框架层</span></strong><span style="font-size: 14px;">。</span></span></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">6、详细介绍一下Flink的运行架构</span></p></blockquote><p style="margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">如下图为Flink运行架构：</span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.7341115434500648" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AUvaQhPsmjLNjfAibfSa0uaBpOe2piaW0YG2chznQBqwHTLQDtiaT19k3Vw/640?wx_fmt=png" data-type="png" data-w="771" style="text-align: center;white-space: normal;"  /></span></p><p style="margin-top: 15px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink&nbsp;集群采取&nbsp;Master -&nbsp;Slave 架构，Master的角色为 </span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">JobManager</span></strong><span style="font-size: 14px;">，负责集群和作业管理，Slave的角色是 </span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>TaskManager</strong></span><span style="font-size: 14px;">，负责执行计算任务，同时，Flink 提供客户端 Client&nbsp;来管理集群和提交任务，<strong style="white-space: normal;"><span style="color: rgb(0, 82, 255);">JobManager&nbsp;</span></strong>和&nbsp;<strong style="color: rgb(0, 82, 255);font-size: 14px;white-space: normal;">TaskManager&nbsp;</strong>是集群的进程。</span></span></p><section style="margin-top: 15px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（1）Client</span></strong><span style="font-size: 14px;"><br  /></span></span></section><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">Flink 客户端是F1ink 提供的 CLI 命令行工具，用来提交 Flink 作业到 Flink 集群，在客户端中负责 StreamGraph (流图)和 Job Graph (作业图)的构建。</span></section><section style="margin-top: 15px;margin-bottom: 15px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（2）JobManager</span></strong></span></section><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">JobManager 根据并行度将 Flink 客户端提交的Flink 应用分解为子任务，从资源管理器 ResourceManager 申请所需的计算资源，资源具备之后，开始分发任务到 TaskManager 执行 Task，并负责应用容错，跟踪作业的执行状态，发现异常则恢复作业等。</span></section><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><strong style="white-space: normal;">（3）TaskManager</strong></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><strong style="white-space: normal;"><br  /></strong></span></p><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">TaskManager 接收 JobManage 分发的子任务，根据自身的资源情况 管理子任务的启动、 停止、销毁、异常恢复等生命周期阶段。Flink程序中必须有一个TaskManager。</span></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">7、Flink的并行度介绍一下？</span></p></blockquote><p style="margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink程序在执行的时候，会被映射成一个</span><span style="font-size: 14px;color: rgb(255, 76, 65);"><strong>Streaming Dataflow。</strong></span><span style="font-size: 14px;">一个Streaming Dataflow是由一组Stream和Transformation Operator组成的。在启动时从一个或多个Source Operator开始，结束于一个或多个Sink Operator。&nbsp;</span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">Flink程序本质上是并行的和分布式的</span></strong><span style="font-size: 14px;">，在执行过程中，</span><strong><span style="font-size: 14px;color: rgb(61, 167, 66);">一个流(stream)包含一个或多个流分区</span></strong><span style="font-size: 14px;">，而每一个operator包含一个或多个operator子任务。操作子任务间彼此独立，在不同的线程中执行，甚至是在不同的机器或不同的容器上。</span></span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>operator子任务的数量是这一特定operator的并行度</strong></span><span style="font-size: 14px;">。相同程序中的不同operator有不同级别的并行度。</span></span></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.6070707070707071" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MJFWiaPuolAQBCuo19vs95UagITalZaZibibRp99YqIBRK1VZ6EMTsI4DYNuuYQXla37bibP1hbCic64w/640?wx_fmt=png" data-type="png" data-w="990" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-top: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">一个Stream可以被分成多个Stream的分区，也就是Stream Partition。</span><span style="font-size: 14px;color: rgb(61, 167, 66);"><strong>一个Operator也可以被分为多个Operator Subtask</strong></span><span style="font-size: 14px;">。如上图中，Source被分成Source1和Source2，它们分别为Source的Operator Subtask。每一个Operator Subtask都是在不同的线程当中独立执行的。</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">一个Operator的并行度，就等于Operator Subtask的个数</span></strong><span style="font-size: 14px;">。</span></span></p><p style="margin-top: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">上图Source的并行度为2。而一个Stream的并行度就等于它生成的Operator的并行度。数据在两个operator之间传递的时候有两种模式：<br  /></span></p><p style="margin-top: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（1）</span><span style="font-size: 14px;color: rgb(255, 76, 65);"><strong>One to One模式：</strong></span><span style="font-size: 14px;">两个operator用此模式传递的时候，会保持数据的分区数和数据的 排序；如上图中的Source1到Map1，它就保留的Source的分区特性，以及分区元素处 理的有序性。</span></span></p><p style="margin-top: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（2）</span><strong><span style="font-size: 14px;color: rgb(255, 76, 65);">Redistributing （重新分配）模式</span></strong><span style="font-size: 14px;">：这种模式会改变数据的分区数；每个operator subtask会根据选择transformation把数据发送到不同的目标subtasks，比如keyBy()会通过hashcode重新分区，broadcast()和rebalance()方法会随机重新分区；</span></span></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">8、Flink的并行度的怎么设置的？</span></p></blockquote><p style="margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">我们在实际生产环境中可以从四个不同层面设置并行度：</span></p><ul class="list-paddingleft-2" style="width: 577.412px;white-space: normal;"><li style="font-size: 14px;letter-spacing: 1px;"><p style="line-height: 1.75em;"><span style="letter-spacing: 1px;">操作算子层面(Operator Level)</span></p></li><li style="font-size: 14px;letter-spacing: 1px;"><p style="line-height: 1.75em;"><span style="letter-spacing: 1px;">执行环境层面(Execution Environment Level)</span></p></li><li style="font-size: 14px;letter-spacing: 1px;"><p style="line-height: 1.75em;"><span style="letter-spacing: 1px;">客户端层面(Client Level)</span></p></li><li style="font-size: 14px;letter-spacing: 1px;"><p style="line-height: 1.75em;"><span style="letter-spacing: 1px;">系统层面(System Level)</span></p></li></ul><p style="margin-top: 10px;white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">需要注意的优先级：算子层面&gt;环境层面&gt;客户端层面&gt;系统层面。</span></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">9、Flink编程模型了解不？</span></p></blockquote><section style="outline: 0px;margin-bottom: 16px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);line-height: 26px !important;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink 应用程序主要由三部分组成，</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">源 </span></strong><span style="font-size: 14px;">Source、</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">转换</span></strong><span style="font-size: 14px;"> transformation、</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">目的地</span></strong><span style="font-size: 14px;"> sink。这些流式 dataflows 形成了有向图，以一个或多个源（source）开始，并以一个或多个目的地（sink）结束。</span></span></section><p style="outline: 0px;margin-bottom: 16px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);line-height: 26px !important;"><span style="font-size: 14px;letter-spacing: 1px;"><img data-ratio="0.7151898734177216" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AU9EZBynnLX112aSE4fZOLLNCnjAsUPw1vjy6HxFHqE08ao0qoAMe1Kw/640?wx_fmt=png" data-type="png" data-w="948"  /></span></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">10、Flink作业中的DataStream，Transformation介绍一下</span></p></blockquote><section style="margin-bottom: 10px;white-space: normal;text-align: left;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink作业中，包含两个基本的块：</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">数据流（DataStream）</span></strong><span style="font-size: 14px;">和&nbsp;</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>转换（Transformation）</strong></span><span style="font-size: 14px;">。</span></span></section><section style="margin-bottom: 10px;white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">DataStream是逻辑概念，为开发者提供API接口，</span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(0, 82, 255);"><strong>Transformation</strong></span><span style="font-size: 14px;letter-spacing: 1px;">是处理行为的抽象，包含了数据的读取、计算、写出。所以Flink 作业中的DataStream API 调用，实际上构建了多个由 Transformation组成的数据处理流水线（Pipeline）<br  /></span></section><section style="margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">DataStream API 和 Transformation 的转换如下图：</span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.6207674943566591" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AUbpdzlWjEZyIjs41dgecTr0uSEtyDkRZgc1PeNILB3Mj2hHgYLzwhfw/640?wx_fmt=png" data-type="png" data-w="886"  /></p><p style="white-space: normal;"><br  /></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">11、Flink的分区策略了解吗？</span></p></blockquote><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">目前 Flink 支持</span><strong><span style="font-size: 14px;letter-spacing: 1px;color: rgb(0, 82, 255);">8种分区策略</span></strong><span style="font-size: 14px;letter-spacing: 1px;">的实现，数据分区体系如下图：<br  /></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.3764705882352941" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AUUq0yqNvqJCakDUiaicSuw2lP0eveV0kIPOJKk4icOrIhibbJYCClB5qLYA/640?wx_fmt=png" data-type="png" data-w="1530" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="margin-top: 10px;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（1）GlobalPartitioner</span></strong></span></p><p><span style="font-size: 14px;letter-spacing: 1px;">数据会被分发到下游算子的第一个实例中进行处理。</span></p><p style="margin-top: 10px;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（2）ForwardPartitioner</span></strong></span></p><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">在API层面上</span><strong><span style="font-size: 14px;letter-spacing: 1px;color: rgb(0, 82, 255);">ForwardPartitioner</span></strong><span style="font-size: 14px;letter-spacing: 1px;">应用在DataStream上，生成一个新的 DataStream。</span></section><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">该Partitioner 比较特殊，用于在同一个 OperatorChain 中上下游算子之间的数据转发，实际上数据是直接传递给下游的，要求上下游并行度一样。</span></section><p style="margin-top: 10px;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（3）ShufflePartitioner</span></strong></span></p><p><span style="font-size: 14px;letter-spacing: 1px;">随机的将元素进行分区，可以确保下游的Task能够均匀地获得数据，使用代码如下：<br  /></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">dataStream.shuffle();</span></span></code></pre></section><p style="margin-top: 10px;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（4）RebalancePartitioner</span></strong></span></p><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">以</span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(0, 82, 255);"><strong>Round-robin</strong></span><span style="font-size: 14px;letter-spacing: 1px;"> 的方式为每个元素分配分区，确保下游的 Task 可以均匀地获得数据，避免数据倾斜。使用代码如下：</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="powershell"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">dataStream.rebalance();</span></span></code></pre></section><p style="margin-top: 10px;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（5）RescalePartitioner</span></strong></span></p><section style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">根据上下游 Task 的数量进行分区，&nbsp;使用 </span><span style="font-size: 14px;color: rgb(2, 30, 170);"><strong>Round-robin</strong></span><span style="font-size: 14px;"> 选择下游的一个Task 进行数据分区，如上游有2个 Source.，下游有6个 Map，那么每个 Source 会分配3个固定的下游 Map，不会向未分配给自己的分区写人数据。这一点与 ShufflePartitioner 和 RebalancePartitioner 不同， 后两者会写入下游所有的分区。</span></span></section><p><br  /></p><p><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.34523809523809523" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NpE6PPVU6cCzsA8ibELD9AUmUGYB2UBzzfTdBIWFbdbqe2cRBsicYC5cg995Tu2babVdwd2DjKUfrg/640?wx_fmt=png" data-type="png" data-w="1008" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><section><span style="font-size: 14px;letter-spacing: 1px;">运行代码如下：<br  /></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">dataStream.rescale();</span></span></code></pre></section><p style="margin-top: 10px;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（6）BroadcastPartitioner</span></strong></span></p><p><span style="font-size: 14px;letter-spacing: 1px;">将该记录广播给所有分区，即有N个分区，就把数据复制N份，每个分区1份，其使用代码如下：<br  /></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">dataStream.broadcast();</span></span></code></pre></section><p style="margin-top: 10px;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（7）KeyGroupStreamPartitioner</span></strong></span></p><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">在API层面上，</span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong>KeyGroupStreamPartitioner</strong></span><span style="font-size: 14px;letter-spacing: 1px;">应用在</span><strong><span style="font-size: 14px;letter-spacing: 1px;color: rgb(217, 33, 66);"> KeyedStream</span></strong><span style="font-size: 14px;letter-spacing: 1px;">上，生成一个新的 KeyedStream。</span></section><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">KeyedStream根据keyGroup索引编号进行分区，会将数据按 Key 的 Hash 值输出到下游算子实例中。该分区器不是提供给用户来用的。</span></section><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">KeyedStream在构造</span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong>Transformation</strong></span><span style="font-size: 14px;letter-spacing: 1px;">的时候默认使用KeyedGroup分区形式，从而在底层上支持作业Rescale功能。</span></section><p style="margin-top: 10px;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（8）CustomPartitionerWrapper</span></strong></span></p><p style="margin-bottom: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">用户自定义分区器。需要用户自己实现Partitioner接口，来定义自己的分区逻辑。</span></p><p style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;background-color: rgb(255, 255, 255);line-height: 26px !important;"><span style="color: rgb(77, 77, 77);font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;">更详细的介绍，请参考之前写的&nbsp;</span><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzU4NjY4NDU0MQ==&amp;mid=2247492628&amp;idx=1&amp;sn=722e512d99af3fe6b1712dc592693a7a&amp;chksm=fdf52506ca82ac10fa5134e4411b4fda7bf3daff2073750f0edebfaa2b423624452cba5b46af&amp;scene=21#wechat_redirect" textvalue="Flink分区策略：你可以不会，但不能不懂" data-itemshowtype="0" tab="innerlink" data-linktype="2" style="font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;white-space: normal;font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;letter-spacing: 1px;">Flink分区策略：你可以不会，但不能不懂</span></a></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">12、描述一下Flink wordcount执行包含的步骤有哪些？</span></p></blockquote><section style="margin-bottom: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">主要包含以下几步：</span></section><p style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;line-height: 26px !important;"><span style="color: rgb(77, 77, 77);font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;">（1）获取运行环境&nbsp;&nbsp;</span><strong><span style="font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;color: rgb(217, 33, 66);">StreamExecutionEnvironment</span></strong></p><p style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;line-height: 26px !important;"><span style="color: rgb(77, 77, 77);font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;">（2）</span><span style="font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong>接入</strong></span><span style="font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong>source源</strong></span><span style="color: rgb(77, 77, 77);font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;line-height: 26px !important;"><span style="color: rgb(77, 77, 77);font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;">（3）执行转换操作，如map()、flatmap()、keyby（）、sum()<br  /></span></p><p style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;line-height: 26px !important;"><span style="color: rgb(77, 77, 77);font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;">（4）</span><span style="font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong>输出sink源</strong></span><span style="color: rgb(77, 77, 77);font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;"> 如print()</span></p><p style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;line-height: 26px !important;"><span style="color: rgb(77, 77, 77);font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;">（5）&nbsp;</span><strong><span style="font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;letter-spacing: 1px;color: rgb(0, 82, 255);">执行 execute</span></strong></p><section style="margin-bottom: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">提供一个示例：</span></section><pre style="overflow: auto;font-size: 12px;color: rgb(0, 0, 0);font-family: &quot;Courier New&quot; !important;"></pre><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="java"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">import org.apache.flink.api.common.functions.FlatMapFunction;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">import org.apache.flink.api.java.utils.ParameterTool;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">import org.apache.flink.streaming.api.datastream.DataStream;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">import org.apache.flink.streaming.api.datastream.DataStreamSource;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">import org.apache.flink.streaming.api.windowing.time.Time;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">import org.apache.flink.util.Collector;</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public class WordCount {</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public static void main(String[] args) throws Exception {</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//定义socket的端口号</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">int port;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">try{</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">            ParameterTool parameterTool = ParameterTool.fromArgs(args);</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">            port = parameterTool.getInt("port");</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">        }catch (Exception e){</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">            System.err.println("没有指定port参数，使用默认值9000");</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">            port = 9000;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//获取运行环境</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StreamExecutionEnvironment&nbsp;env&nbsp;=&nbsp;StreamExecutionEnvironment.getExecutionEnvironment();</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//连接socket获取输入的数据</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataStreamSource&lt;String&gt;&nbsp;text&nbsp;=&nbsp;env.socketTextStream("10.192.12.106",&nbsp;port,&nbsp;"\n");</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//计算数据</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">        DataStream&lt;WordWithCount&gt; windowCount = text.flatMap(new FlatMapFunction&lt;String, WordWithCount&gt;() {</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public void flatMap(String value, Collector&lt;WordWithCount&gt; out) throws Exception {</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">                String[] splits = value.split("\\s");</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">for (String word:splits) {</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">                    out.collect(new WordWithCount(word,1L));</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">                }</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">            }</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">        })//打平操作，把每行的单词转为&lt;word,count&gt;类型的数据</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">                .keyBy("word")//针对相同的word数据进行分组</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">                .timeWindow(Time.seconds(2),Time.seconds(1))//指定计算数据的窗口大小和滑动窗口大小</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.sum("count");&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//把数据打印到控制台</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">        windowCount.print()</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">                .setParallelism(1);//使用一个并行度</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//注意：因为flink是懒加载的，所以必须调用execute方法，上面的代码才会执行</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;env.execute("streaming&nbsp;word&nbsp;count");</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">/**</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">     * 主要为了存储单词以及单词出现的次数</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">     */</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public static class WordWithCount{</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public String word;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public long count;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public WordWithCount(){}</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public WordWithCount(String word, long count) {</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">this.word = word;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">this.count = count;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">@Override</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public String toString() {</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">return "WordWithCount{" +</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">"word='" + word + '\'' +</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">", count=" + count +</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">'}';</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">        }</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">}</span></span></code></pre></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">13、Flink常用的算子有哪些？</span></p></blockquote><section style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;background-color: rgb(255, 255, 255);line-height: 26px !important;"><span style="font-size: 14px;letter-spacing: 1px;">分两部分：</span></section><section style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;background-color: rgb(255, 255, 255);line-height: 26px !important;"><span style="font-size: 14px;letter-spacing: 1px;">（1）</span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(0, 82, 255);"><strong>数据读取</strong></span><span style="font-size: 14px;letter-spacing: 1px;">，这是Flink流计算应用的起点，常用算子有：<br  /></span></section><section style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;background-color: rgb(255, 255, 255);line-height: 26px !important;"><span style="font-size: 14px;letter-spacing: 1px;">从内存读：fromElements、从文件读：readTextFile、Socket 接入 ：socketTextStream、自定义读取：createInput<br  /></span></section><section style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;background-color: rgb(255, 255, 255);line-height: 26px !important;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（2）处理数据的算子，主要用于&nbsp;</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">转换&nbsp;</span></strong><span style="font-size: 14px;">过程</span></span></section><section style="margin-bottom: 10px;white-space: normal;text-align: left;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">常用的算子包括：Map（单输入单输出）、FlatMap（单输入、多输出）、Filter（过滤）、KeyBy（分组）、Reduce（聚合）、Window（窗口）、Connect（连接）、Split（分割）等。</span></section><p style="white-space: normal;text-align: left;"><br  /></p><section data-mpa-template="t" mpa-from-tpl="t" style="white-space: normal;"><section data-mid="" mpa-from-tpl="t" style="display: flex;justify-content: center;align-items: center;width: 578px;"><section data-mid="" mpa-from-tpl="t" style="display: flex;justify-content: flex-start;align-items: center;flex-direction: column;"><section data-mid="" mpa-from-tpl="t" style="display: flex;justify-content: center;align-items: center;"><section data-mid="" mpa-from-tpl="t" style="margin-right: 3px;width: 27px;"><img data-ratio="0.9629629629629629" src="https://mmbiz.qpic.cn/mmbiz_png/DiaLG0VOfnEibU5UwN5aic6Ez0obyBiapEUbCdUnqu7yuwQVF8mfAkNOux6iatlI7gtN9IgWHVIhy1pibiapFW89HzTRw/640?wx_fmt=png" data-type="png" data-w="54" style="display: block;"  /></section><section data-mid="" mpa-from-tpl="t" style="padding-right: 7px;padding-left: 11px;height: 28px;background: rgba(206, 226, 255, 0.53);text-align: center;"><p data-mid="" style="font-size: 16px;font-family: PingFangSC-Semibold, &quot;PingFang SC&quot;;font-weight: bold;color: rgb(29, 110, 234);line-height: 28px;letter-spacing: 3px;"><span style="letter-spacing: 1px;">02、Flink 核心篇</span></p></section></section><section data-mid="" mpa-from-tpl="t" style="margin-top: 4px;display: flex;align-items: center;justify-content: space-between;width: 210.812px;"><section data-mid="" mpa-from-tpl="t" style="width: 126.488px;height: 1px;background-color: rgb(86, 152, 252);"><br  /></section><section data-mid="" mpa-from-tpl="t" style="width: 21.075px;height: 1px;background-color: rgb(86, 152, 252);"><br  /></section></section></section></section></section><p style="text-align: center;"><br  /></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-croporisrc="https://mmbiz.qlogo.cn/mmbiz_png/nEEdkvXCJ8PqALZbh7IQstylo5PALv6BHwHyTqggeEPXXnFv2su8PicqN9Mia0PxoXS8o3UPlsSMRbRnMEwucSbA/0?wx_fmt=png" data-cropx1="25.268166089965398" data-cropx2="635" data-cropy1="0" data-cropy2="416.37543252595157" data-galleryid="" data-ratio="0.6836065573770492" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/nEEdkvXCJ8PqALZbh7IQstylo5PALv6B8BH5jiaqmcukPFxyv6xjjrIaKRjIQQrUxf8PNIMvTMib7Co5BMTARCWA/640?wx_fmt=jpeg" data-type="jpeg" data-w="610" style="width: 555px;height: 379px;"  /></p><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">核心篇主要涉及以上知识点，下面让我们详细了解一下。<br  /></span></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">14、Flink的四大基石包含哪些？</span></p></blockquote><section style="line-height: 1.75em;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;letter-spacing: 1px;">Flink四大基石分别是：Checkpoint（检查点）、State（状态）、Time（时间）、Window（窗口）</span></strong></span><span style="font-size: 14px;letter-spacing: 1px;">。</span></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">15、说说Flink窗口，以及划分机制</span></p></blockquote><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;background-color: rgb(255, 255, 255);font-family: 微软雅黑;color: rgb(112, 48, 160);font-weight: bold;">窗口概念：</span><span style="font-size: 14px;background-color: rgb(255, 255, 255);font-family: 微软雅黑;color: rgb(112, 48, 160);">将无界流的数据，按时间区间，划分成多份数据，分别进行统计</span><span style="font-size: 14px;background-color: rgb(255, 255, 255);font-family: 微软雅黑;color: rgb(112, 48, 160);font-weight: bold;">(聚合)</span></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">Flink支持两种划分窗口的方式(time和count)，第一种，</span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong>按时间驱动进行划分</strong></span><span style="font-size: 14px;letter-spacing: 1px;">、另一种按</span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(61, 167, 66);"><strong>数据驱动进行划分</strong></span><span style="font-size: 14px;letter-spacing: 1px;">。</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.6023706896551724" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8M6UTK5tLX7wZAElWt2y5AKC18gJAX3j0MjrmLsr9wZiaw8qYGmmw33dhPw9GZnNFelcjs1vJ9IlFw/640?wx_fmt=png" data-type="png" data-w="928" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">1、按时间驱动Time Window 划分可以分为 滚动窗口&nbsp;</span><span style="font-size: 14px;color: rgb(255, 0, 0);">Tumbling Window</span><span style="font-size: 14px;">&nbsp;和滑动窗口&nbsp;</span><span style="font-size: 14px;color: rgb(255, 0, 0);">Sliding Window。</span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">2、按数据驱动Count Window也可以划分为滚动窗口&nbsp;<span style="font-size: 14px;color: rgb(255, 0, 0);">Tumbling Window</span>&nbsp;和滑动窗口&nbsp;<span style="font-size: 14px;color: rgb(255, 0, 0);">Sliding Window。</span></span></section><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">3、Flink支持窗口的两个重要属性(</span><span style="font-size: 14px;color: rgb(2, 30, 170);"><strong>窗口长度size和滑动间隔interval</strong></span><span style="font-size: 14px;">)，通过窗口长度和滑动间隔来区分滚动窗口和滑动窗口。</span></span></section><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">如果size=interval,那么就会形成tumbling-window(无重叠数据)--滚动窗口</span></section><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">如果size(1min)&gt;interval（30s）,那么就会形成sliding-window(有重叠数据)--滑动窗口</span></section><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">通过组合可以得出</span><span style="font-size: 14px;color: rgb(255, 76, 65);">四种基本窗口：</span><br  /></span></section><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（1）</span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(61, 167, 66);"><strong>time-tumbling-window</strong></span><span style="font-size: 14px;letter-spacing: 1px;"> 无重叠数据的时间窗口，设置方式举例：timeWindow(Time.seconds(5))---基于时间的滚动窗口</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.566813509544787" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8M6UTK5tLX7wZAElWt2y5AK3S0fn9lqgt308pm68ZrSsmKhOIWib3Aal3TP5WBqOvLnjfgTAkPOTfA/640?wx_fmt=png" data-type="png" data-w="681" style="box-sizing: border-box !important;width: 454px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.2523985239852399" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8M6UTK5tLX7wZAElWt2y5AKRsQtf1jIT1A6vyYKllhMVhVzWZr9JUyQ5vUZ9veiajgdV7a0xj4Jp5w/640?wx_fmt=png" data-type="png" data-w="1355" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /><br  /></p><section style="margin-top: 10px;margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（2）</span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(61, 167, 66);"><strong>time-sliding-window</strong></span><span style="font-size: 14px;letter-spacing: 1px;"> &nbsp;有重叠数据的时间窗口，设置方式举例：timeWindow(Time.seconds(10), Time.seconds(5))---基于时间的滑动窗口</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.6047619047619047" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8M6UTK5tLX7wZAElWt2y5AKuaWyljxoj62sJicWQf6RPgh0BXyf6mXSMoibRVrEbP1BwRb292WmcMZg/640?wx_fmt=png" data-type="png" data-w="630" style="box-sizing: border-box !important;width: 444px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.24853372434017595" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8M6UTK5tLX7wZAElWt2y5AKcvhW6ATJmyXRjIF8Rx9XsmdYAXWibCfLoM2JYFgOpjotS3icB5vCToicw/640?wx_fmt=png" data-type="png" data-w="1364" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-top: 10px;margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（3）<strong>count-tumbling-window</strong>无重叠数据的数量窗口，设置方式举例：countWindow(5)---基于数量的滚动窗口</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.21188428459734168" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8M6UTK5tLX7wZAElWt2y5AKxic6YjWD3EcKADRLHY1sZMVWeFWFnnjMhJ8Cm89GN2EdPYAkolIg6vw/640?wx_fmt=png" data-type="png" data-w="1279" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（4）</span><span style="font-size: 14px;letter-spacing: 1px;"><strong>count-sliding-window</strong></span><span style="font-size: 14px;letter-spacing: 1px;"> 有重叠数据的数量窗口，设置方式举例：countWindow(10,5)---基于数量的滑动窗口</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.17315329626687848" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8M6UTK5tLX7wZAElWt2y5AKBecsCWnxMedeGCRdgrQ79N22vVZQdHUiakZHujbnzVVlhaic6lP2XDeg/640?wx_fmt=png" data-type="png" data-w="1259" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(255, 76, 65);letter-spacing: 1px;"><strong><span style="color: rgb(255, 76, 65);font-size: 14px;">Flink中还支持一个特殊的窗口:会话窗口SessionWindows</span></strong></span></p><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">session窗口分配器通过session活动来对元素进行分组，session窗口跟滚动窗口和滑动窗口相比，不会有重叠和固定的开始时间和结束时间的情况</span></section><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">session窗口在一个固定的时间周期内不再收到元素，即非活动间隔产生，那个这个窗口就会关闭。</span></section><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">一个session窗口通过一个session间隔来配置，这个session间隔定义了非活跃周期的长度，当这个非活跃周期产生，那么当前的session将关闭并且后续的元素将被分配到新的session窗口中去,如下图所示：</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.5604249667994687" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8M6UTK5tLX7wZAElWt2y5AKbVxWI2C8kW7DZADobicM0U96APLiclJDmuZKVXobeosica8NcbYnP4y1A/640?wx_fmt=png" data-type="png" data-w="753" style="box-sizing: border-box !important;width: 462px !important;visibility: visible !important;"  /></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">16、看你基本概念讲的还是很清楚的，那你介绍下Flink的窗口机制以及各组件之间是如何相互工作的</span></p></blockquote><section style="white-space: normal;margin-bottom: 10px;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;letter-spacing: 1px;">以下为窗口机制的流程图：</span></section><section style="white-space: normal;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5341400172860847" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MS3ZsmzMtdMIMxYj0ZXuknEgDUIpEEjVrREPPDliaM5aRAibXgKVT1ic3Ev394dgCCibDJjRTOAHsbuw/640?wx_fmt=png" data-type="png" data-w="1157" style="text-align: center;white-space: normal;"  /></span></strong></span></section><section style="white-space: normal;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">WindowAssigner</span></strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">1、窗口算子负责处理窗口，数据流源源不断地进入算子（window operator）时，每一个到达的元素首先会被交给 WindowAssigner。</span><strong><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;color: rgb(217, 33, 66);">WindowAssigner 会决定元素被放到哪个或哪些窗口（window）</span></strong><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">，可能会创建新窗口。因为一个元素可以被放入多个窗口中（个人理解是滑动窗口，滚动窗口不会有此现象），所以同时存在多个窗口是可能的。注意，</span></span><code style="margin-right: 3px;margin-left: 3px;padding-right: 5px;padding-left: 5px;font-family: &quot;Courier New&quot;, sans-serif;font-size: 12px;line-height: 1.8;display: inline-block;overflow-x: auto;vertical-align: middle;border-radius: 3px;background-color: rgb(246, 246, 246);color: rgb(232, 62, 140);text-align: left;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">Window</span></code><span style="letter-spacing: 1px;"><strong><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;color: rgb(217, 33, 66);">本身只是一个ID标识符</span></strong><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">，其内部可能存储了一些元数据，如</span></span><code style="margin-right: 3px;margin-left: 3px;padding-right: 5px;padding-left: 5px;font-family: &quot;Courier New&quot;, sans-serif;font-size: 12px;line-height: 1.8;display: inline-block;overflow-x: auto;vertical-align: middle;border-radius: 3px;background-color: rgb(246, 246, 246);color: rgb(232, 62, 140);text-align: left;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">TimeWindow</span></code><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;letter-spacing: 1px;">中有开始和结束时间，但是并不会存储窗口中的元素。窗口中的元素实际存储在 Key/Value State 中，key为</span><code style="margin-right: 3px;margin-left: 3px;padding-right: 5px;padding-left: 5px;font-family: &quot;Courier New&quot;, sans-serif;font-size: 12px;line-height: 1.8;display: inline-block;overflow-x: auto;vertical-align: middle;border-radius: 3px;background-color: rgb(246, 246, 246);color: rgb(232, 62, 140);text-align: left;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">Window</span></code><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;letter-spacing: 1px;">，value为元素集合（或聚合值）。为了保证窗口的容错性，该实现依赖了 Flink 的 State 机制。</span></section><p style="white-space: normal;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;letter-spacing: 1px;"><strong style="white-space: normal;">WindowTrigger</strong></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">2、每一个Window都拥有一个属于自己的 Trigger，Trigger上会有定时器，</span><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;color: rgb(2, 30, 170);"><strong>用来决定一个窗口何时能够被计算或清除</strong></span><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">。每当有元素加入到该窗口，或者之前注册的定时器超时了，那么Trigger都会被调用。Trigger的返回结果可以是 ：</span></span></p><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（1）continue（继续、不做任何操作），</span></section><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（2）Fire（触发计算，处理窗口数据），</span></section><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（3）Purge（触发清理，移除窗口和窗口中的数据），</span></section><section style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（4）Fire + purge（触发计算+清理，处理数据并移除窗口和窗口中的数据）。</span></section><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">当数据到来时，调用</span><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;color: rgb(2, 30, 170);"><strong>Trigger</strong></span><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">判断是否需要触发计算，如果调用结果只是Fire的话，那么会计算窗口并保留窗口原样，也就是说窗口中的数据不清理，等待下次Trigger fire的时候再次执行计算。窗口中的数据会被反复计算，直到触发结果清理。在清理之前，窗口和数据不会释放没所以窗口会一直占用内存。</span></span></p><p style="margin: 10px auto;color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 15px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-size: 15px;">Trigger 触发流程：</span></strong></span></p><section style="margin: 10px auto;color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 15px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">3、当Trigger Fire了，窗口中的元素集合就会交给</span><code style="margin-right: 3px;margin-left: 3px;padding-right: 5px;padding-left: 5px;font-family: &quot;Courier New&quot;, sans-serif;font-size: 12px;line-height: 1.8;display: inline-block;overflow-x: auto;vertical-align: middle;border-radius: 3px;background-color: rgb(246, 246, 246);color: rgb(232, 62, 140);"><span style="font-size: 14px;letter-spacing: 1px;">Evictor</span></code><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（如果指定了的话）。</span><span style="font-size: 14px;color: rgb(172, 57, 255);"><strong>Evictor 主要用来遍历窗口中的元素列表，并决定最先进入窗口的多少个元素需要被移除</strong></span><span style="font-size: 14px;">。剩余的元素会交给用户指定的函数进行窗口的计算。如果没有 Evictor 的话，窗口中的所有元素会一起交给函数进行计算。</span><br  /></span></section><section style="margin: 10px auto;color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 15px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">4、计算函数收到了窗口的元素（可能经过了 Evictor 的过滤），并计算出窗口的结果值，并发送给下游。窗口的结果值可以是一个也可以是多个。DataStream API 上可以接收不同类型的计算函数，包括预定义的</span><code style="margin-right: 3px;margin-left: 3px;padding-right: 5px;padding-left: 5px;font-family: &quot;Courier New&quot;, sans-serif;font-size: 12px;line-height: 1.8;display: inline-block;overflow-x: auto;vertical-align: middle;border-radius: 3px;background-color: rgb(246, 246, 246);color: rgb(232, 62, 140);"><span style="font-size: 14px;letter-spacing: 1px;">sum()</span></code><span style="font-size: 14px;letter-spacing: 1px;">,</span><code style="margin-right: 3px;margin-left: 3px;padding-right: 5px;padding-left: 5px;font-family: &quot;Courier New&quot;, sans-serif;font-size: 12px;line-height: 1.8;display: inline-block;overflow-x: auto;vertical-align: middle;border-radius: 3px;background-color: rgb(246, 246, 246);color: rgb(232, 62, 140);"><span style="font-size: 14px;letter-spacing: 1px;">min()</span></code><span style="font-size: 14px;letter-spacing: 1px;">,</span><code style="margin-right: 3px;margin-left: 3px;padding-right: 5px;padding-left: 5px;font-family: &quot;Courier New&quot;, sans-serif;font-size: 12px;line-height: 1.8;display: inline-block;overflow-x: auto;vertical-align: middle;border-radius: 3px;background-color: rgb(246, 246, 246);color: rgb(232, 62, 140);"><span style="font-size: 14px;letter-spacing: 1px;">max()</span></code><span style="font-size: 14px;letter-spacing: 1px;">，还有&nbsp;</span><code style="margin-right: 3px;margin-left: 3px;padding-right: 5px;padding-left: 5px;font-family: &quot;Courier New&quot;, sans-serif;font-size: 12px;line-height: 1.8;display: inline-block;overflow-x: auto;vertical-align: middle;border-radius: 3px;background-color: rgb(246, 246, 246);color: rgb(232, 62, 140);"><span style="font-size: 14px;letter-spacing: 1px;">ReduceFunction</span></code><span style="font-size: 14px;letter-spacing: 1px;">，</span><code style="margin-right: 3px;margin-left: 3px;padding-right: 5px;padding-left: 5px;font-family: &quot;Courier New&quot;, sans-serif;font-size: 12px;line-height: 1.8;display: inline-block;overflow-x: auto;vertical-align: middle;border-radius: 3px;background-color: rgb(246, 246, 246);color: rgb(232, 62, 140);"><span style="font-size: 14px;letter-spacing: 1px;">FoldFunction</span></code><span style="font-size: 14px;letter-spacing: 1px;">，还有</span><code style="margin-right: 3px;margin-left: 3px;padding-right: 5px;padding-left: 5px;font-family: &quot;Courier New&quot;, sans-serif;font-size: 12px;line-height: 1.8;display: inline-block;overflow-x: auto;vertical-align: middle;border-radius: 3px;background-color: rgb(246, 246, 246);color: rgb(232, 62, 140);"><span style="font-size: 14px;letter-spacing: 1px;">WindowFunction</span></code><span style="font-size: 14px;letter-spacing: 1px;">。WindowFunction 是最通用的计算函数，其他的预定义的函数基本都是基于该函数实现的。</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;letter-spacing: 1px;">5、Flink 对于一些聚合类的窗口计算（如sum,min）做了优化，因为聚合类的计算不需要将窗口中的所有数据都保存下来，只需要保存一个result值就可以了。每个进入窗口的元素都会执行一次聚合函数并修改result值。这样可以大大降低内存的消耗并提升性能。但是如果用户定义了 Evictor，则不会启用对聚合窗口的优化，因为 Evictor 需要遍历窗口中的所有元素，必须要将窗口中所有元素都存下来。</span></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">17、讲一下Flink的Time概念</span></p></blockquote><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 25.5px;text-align: left;direction: ltr;unicode-bidi: embed;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 微软雅黑;color: black;">在</span><span style="font-size: 14px;color: black;">Flink</span><span style="font-size: 14px;font-family: 微软雅黑;color: black;">的流式处理中，会涉及到时间的不同概念，主要分为三种时间机制，如下图所示：</span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.5414847161572053" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MZMSFNb0owiaKt9Xwb4GAullfWMvELnEz6DChudK0icQN3IZHAkI0FdZWR2kRib6LXMaNoGqQJUfhLg/640?wx_fmt=png" data-type="png" data-w="687" style="box-sizing: border-box !important;width: 486px !important;visibility: visible !important;"></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(2, 30, 170);letter-spacing: 1px;"><strong><span style="color: rgb(2, 30, 170);font-size: 14px;">- EventTime[<span style="color: rgb(2, 30, 170);font-family: 宋体;">事件时间</span>]</span></strong><br  /></span></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">&nbsp;</span><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">事件发生的时间，例如：点击网站上的某个链接的时间，每一条日志都会记录自己的生成时间。</span></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;letter-spacing: 1px;">如果以EventTime为基准来定义时间窗口那将形成EventTimeWindow,要求消息本身就应该携带EventTime</span></section><section style="margin-top: 5px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(2, 30, 170);">- IngestionTime[<span style="font-family: 宋体;">摄入时间</span>]</span></strong></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">&nbsp;数据进入Flink的时间，如某个Flink节点的</span><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;color: rgb(2, 30, 170);"><strong>sourceoperator</strong></span><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">接收到数据的时间，例如：某个source消费到kafka中的数据</span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">如果以</span><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;color: rgb(2, 30, 170);"><strong>IngesingtTime</strong></span><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">为基准来定义时间窗口那将形成IngestingTimeWindow,以source的systemTime为准</span></span></section><section style="margin-top: 5px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(2, 30, 170);">- ProcessingTime[<span style="font-family: 宋体;">处理时间</span>]</span></strong></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;letter-spacing: 1px;">&nbsp;某个Flink节点执行某个operation的时间，例如：timeWindow处理数据时的系统时间，默认的时间属性就是Processing Time</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">如果以</span><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;color: rgb(2, 30, 170);"><strong>ProcessingTime</strong></span><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">基准来定义时间窗口那将形成ProcessingTimeWindow，以operator的systemTime为准</span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;letter-spacing: 1px;">在Flink的流式处理中，绝大部分的业务都会使用EventTime，一般只在EventTime无法使用时，才会被迫使用ProcessingTime或者IngestionTime。</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;letter-spacing: 1px;">如果要使用EventTime，那么需要引入EventTime的时间属性，引入方式如下所示：</span></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">18、那在API调用时，应该怎么使用？</span></p></blockquote><section style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 25.5px;text-align: left;direction: ltr;unicode-bidi: embed;"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">使用方式如下：</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">final&nbsp;StreamExecutionEnvironment&nbsp;env&nbsp;&nbsp;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;StreamExecutionEnvironment.getExecutionEnvironrnent();</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//&nbsp;使用处理时间</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime)&nbsp;;&nbsp;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//&nbsp;使用摄入时间</span></span></code><code style="white-space:pre-wrap;max-width: 1000%;text-align: left;display: flex;font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;"><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">env.setStrearnTimeCharacteristic(TimeCharacteristic.IngestionTime);</span></span></code><code style="white-space:pre-wrap;max-width: 1000%;text-align: left;display: flex;font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;"><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//&nbsp;使用事件时间</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">env.setStrearnTimeCharacteristic(TimeCharacteri&nbsp;stic&nbsp;Eve~tTime);</span></span></code></pre></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">19、在流数据处理中，有没有遇到过数据延迟等问题，通过什么处理呢？</span></p></blockquote><section style="margin-bottom: 10px;white-space: normal;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 25.5px;text-align: left;direction: ltr;unicode-bidi: embed;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 14px;letter-spacing: 1px;">有遇到过数据延迟问题。举个例子：</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;direction: ltr;unicode-bidi: embed;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;font-family: 等线;color: rgb(255, 0, 0);">案例1：&nbsp;</span></strong><span style="font-size: 14px;font-family: 等线;color: black;">假你正在去往地下停车场的路上，并且打算用手机点一份外卖。</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;direction: ltr;unicode-bidi: embed;"><span style="font-size: 14px;font-family: 等线;color: black;letter-spacing: 1px;">选好了外卖后，你就用在线支付功能付款了，这个时候是11点50分。恰好这时，你走进了地下停车库，而这里并没有手机信号。因此外卖的在线支付并没有立刻成功，而支付系统一直在Retry重试“支付”这个操作。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;direction: ltr;unicode-bidi: embed;"><span style="font-size: 14px;font-family: 等线;color: black;letter-spacing: 1px;">当你找到自己的车并且开出地下停车场的时候，已经是12点05分了。这个时候手机重新有了信号，手机上的支付数据成功发到了外卖在线支付系统，支付完成。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;direction: ltr;unicode-bidi: embed;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;font-family: 等线;color: black;">在上面这个场景中你可以看到，</span><span style="color: rgb(0, 122, 170);"><strong><span style="font-size: 14px;font-family: 等线;">支付数据的事件时间是11点50分</span></strong></span><span style="font-size: 14px;font-family: 等线;color: black;">，而</span><span style="color: rgb(122, 79, 214);"><strong><span style="font-size: 14px;font-family: 等线;">支付数据的处理时间是12点05分</span></strong></span></span></p><section style="margin-top: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><strong style="color: black;font-family: 等线;font-size: 14px;"><span style="color: rgb(255, 0, 0);">案例2：</span></strong><span style="color: black;font-family: 等线;font-size: 14px;">&nbsp;如上图所示，某App 会记录用户的所有点击行为，并回传日志（在网络不好的情况下，先保存在本地，延后回传）。</span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;direction: ltr;unicode-bidi: embed;"><span style="font-size: 14px;font-family: 等线;color: black;letter-spacing: 1px;">A 用户在11:02 对 App 进行操作，B用户在11:03 操作了 App，</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;direction: ltr;unicode-bidi: embed;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;font-family: 等线;color: black;">但是A 用户的网络不太稳定，回传日志延迟了，导致我们在服务端先接受到B 用户11:03 的消息，然后再接受到A 用户11:02 的消息，</span><span style="font-size: 14px;font-family: 等线;color: rgb(122, 79, 214);"><strong>消息乱序</strong></span><span style="font-size: 14px;font-family: 等线;color: black;">了。</span></span></p><section style="margin-bottom: 10px;white-space: normal;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 25.5px;text-align: left;direction: ltr;unicode-bidi: embed;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 14px;"><br  /></span><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;">一般处理数据延迟、消息乱序等问题，通过WaterMark水印来处理。</span></strong></span><br  /></span></section><p style="margin-top: 10px;margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong style="color: rgb(255, 0, 0);"><span style="font-size: 14px;">水印是用来解决数据延迟、数据乱序等问题，总结如下图所示：</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.46200607902735563" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MZMSFNb0owiaKt9Xwb4GAulibN03wOjbukjuEGYicEnXw9no8hkO7Y6ias6u8icGngDyBIM9uk33BJ6hg/640?wx_fmt=png" data-type="png" data-w="987" height="180" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;" width="987"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">水印就是一个时间戳（timestamp），Flink可以给数据流添加水印</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;<span style="font-size: 14px;font-family: 宋体;">水印并不会影响原有</span>Eventtime<span style="font-size: 14px;font-family: 宋体;">事件时间</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;<span style="font-size: 14px;font-family: 宋体;">当数据流添加水印后，会按照水印时间来触发窗口计算,</span><span style="font-size: 14px;color: rgb(255, 76, 65);"><span style="font-size: 14px;font-family: 宋体;">也就是说</span>watermark<span style="font-size: 14px;font-family: 宋体;">水印是用来触发窗口计算的</span></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;<span style="font-size: 14px;font-family: 宋体;">设置水印时间，会比事件时间小几秒钟</span>,<span style="font-size: 14px;font-family: 宋体;">表示最大允许数据延迟达到多久</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;-&nbsp;水印时间 = 事件时间 - 允许延迟时间 (例如：10:09:57 =&nbsp; 10:10:00&nbsp;- 3s )</span></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="font-size: inherit;color: inherit;line-height: inherit;"><span style="font-size: 14px;letter-spacing: 1px;">20、WaterMark原理讲解一下？</span></p></blockquote><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">如下图所示：<br  /></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.28888888888888886" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MZMSFNb0owiaKt9Xwb4GAuleCzzqcSvbdtLEDJdjympicOEMSVghp7vsmK9icrG2TyEK6YlZ7CQm7fQ/640?wx_fmt=png" data-type="png" data-w="1395" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">窗口是10分钟触发一次，现在在12:00 - 12:10 有一个窗口，本来有一条数据是在12:00 - 12:10这个窗口被计算，但因为延迟，12:12到达，这时12:00 - 12:10&nbsp;这个窗口就会被关闭，只能将数据下发到下一个窗口进行计算，这样就产生了数据延迟，造成计算不准确。</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">现在添加一个水位线：数据时间戳为2分钟。这时用数据产生的事件时间 12:12 -允许延迟的水印 2分钟&nbsp;= 12:10&nbsp;&gt;= 窗口结束时间&nbsp;。窗口触发计算，该数据就会被计算到这个窗口里。</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">在DataStream &nbsp;API 中使用 TimestampAssigner 接口定义时间戳的提取行为，包含两个子接口&nbsp;</span><strong><span style="font-size: 14px;color: rgb(255, 76, 65);">AssignerWithPeriodicWatermarks&nbsp;</span></strong><span style="font-size: 14px;">接口和</span><strong><span style="font-size: 14px;color: rgb(255, 76, 65);">&nbsp;AssignerWithPunctuatedWaterMarks</span></strong><span style="font-size: 14px;">接口</span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.3784246575342466" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MZMSFNb0owiaKt9Xwb4GAulCfDpeExibBLXUcyyOlAibyhicZckLj3yBxbL7iccb9CdmMfZkX81PfpURA/640?wx_fmt=png" data-type="png" data-w="584" style="box-sizing: border-box !important;width: 519px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.162839248434238" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MZMSFNb0owiaKt9Xwb4GAulx329ULvQjVug6ajWo9fpef36m2zPjuCXxOQW5Y8GJApSXtjiaibtFFhg/640?wx_fmt=png" data-type="png" data-w="479" style="box-sizing: border-box !important;width: 549px !important;visibility: visible !important;"  /></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><p style="margin-bottom: 10px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">如果觉得阿周讲解的知识点还满意的话，请关注公众号：</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>3分钟秒懂大数据</strong></span><span style="font-size: 14px;">，获取更多，更全面的技术博文。并加博主微信：</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">threeknowbigdata，</span></strong><span style="font-size: 14px;">拉你进大数据交流群。</span></span></p><p style="text-align: center;"><img data-ratio="0.9967177242888403" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MS3ZsmzMtdMIMxYj0ZXuknFsp5ic4phuhV8VibbOOKMnMurNPibvNRILGaTXEmiavHof6xBxAcGQ0R9w/640?wx_fmt=png" data-type="png" data-w="914" style="width: 173px;height: 172px;"  /></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">21、如果数据延迟非常严重呢？只使用WaterMark可以处理吗？那应该怎么解决？</span></p></blockquote><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;"><span style="text-indent: 28px;font-family: 宋体;">使用&nbsp;</span><span style="text-indent: 28px;">WaterMark+ EventTimeWindow&nbsp;</span><span style="text-indent: 28px;font-family: 宋体;">机制可以在一定程度上解决数据乱序的问题，</span></span><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;">但是，</span><span style="font-size: 14px;text-indent: 28px;">WaterMark&nbsp;</span><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;">水位线也不是万能的，在某些情况下，数据延迟会非常严重，即使通过</span><span style="font-size: 14px;text-indent: 28px;">Watermark + EventTimeWindow</span><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;">也无法等到数据全部进入窗口再进行处理，因为窗口触发计算后，</span><span style="color: rgb(255, 76, 65);"><strong><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;">对于延迟到达的本属于该窗口的数据，</span><span style="font-size: 14px;text-indent: 28px;">Flink</span><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;">默认会将这些延迟严重的数据进行丢弃</span></strong></span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;">那么如果想要让一定时间范围的延迟数据不会被丢弃，可以使用</span><span style="font-size: 14px;text-indent: 28px;background: yellow;">Allowed Lateness(</span><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;background: yellow;">允许迟到机制</span><span style="font-size: 14px;text-indent: 28px;background: yellow;">/</span><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;background: yellow;">侧道输出机制</span><span style="font-size: 14px;text-indent: 28px;background: yellow;">)</span><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;">设定一个允许延迟的时间和侧道输出对象来解决</span><br  /></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;">即使用</span><strong><span style="font-size: 14px;color: rgb(255, 76, 65);"><span style="text-indent: 28px;">WaterMark + EventTimeWindow +&nbsp;</span><span style="text-indent: 28px;background: yellow;">Allowed Lateness</span><span style="text-indent: 28px;font-family: 宋体;">方案</span></span></strong><span style="font-size: 14px;text-indent: 28px;font-family: 宋体;">（包含侧道输出），可以做到数据不丢失。</span><br  /></span></section><p style="margin-top: 10px;margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong style="font-size: 16px;"><span style="text-indent: 28px;font-family: 宋体;">API调用</span></strong><br  /></span></p><section style="margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: Wingdings;">l<span style="font-size: 14px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;line-height: normal;font-family: &quot;Times New Roman&quot;;">&nbsp;&nbsp;</span></span>allowedLateness(lateness:Time)---<span style="font-size: 14px;font-family: 宋体;">设置允许延迟的时间</span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-indent: 28px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 宋体;">该方法传入一个</span>Time<span style="font-size: 14px;font-family: 宋体;">值，设置允许数据迟到的时间，这个时间和</span>watermark<span style="font-size: 14px;font-family: 宋体;">中的时间概念不同。再来回顾一下，</span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-indent: 28px;line-height: 1.75em;"><span style="color: rgb(255, 76, 65);letter-spacing: 1px;"><strong><span style="color: rgb(255, 76, 65);font-size: 14px;">watermark=<span style="color: rgb(255, 76, 65);font-family: 宋体;">数据的事件时间</span>-<span style="color: rgb(255, 76, 65);font-family: 宋体;">允许乱序时间值</span></span></strong></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-indent: 28px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 宋体;">随着新数据的到来，</span>watermark<span style="font-size: 14px;font-family: 宋体;">的值会更新为最新数据事件时间</span>-<span style="font-size: 14px;font-family: 宋体;">允许乱序时间值，但是如果这时候来了一条历史数据，</span>watermark<span style="font-size: 14px;font-family: 宋体;">值则不会更新。</span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-indent: 28px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(255, 76, 65);"><span style="font-family: 宋体;">总的来说，</span>watermark<span style="font-family: 宋体;">永远不会倒退它是为了能接收到尽可能多的乱序数据。</span></span></strong></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-indent: 28px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 宋体;">那这里的</span>Time<span style="font-size: 14px;font-family: 宋体;">值呢？主要是为了等待迟到的数据，如果属于该窗口的数据到来，仍会进行计算，后面会对计算方式仔细说明</span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-indent: 28px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 宋体;">注意：该方法只针对于基于</span>event-time<span style="font-size: 14px;font-family: 宋体;">的窗口</span>&nbsp;</span></section><p style="margin-top: 10px;margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: Wingdings;">l<span style="font-size: 14px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;line-height: normal;font-family: &quot;Times New Roman&quot;;">&nbsp;&nbsp;</span></span>sideOutputLateData(outputTag:OutputTag[T])--<span style="font-size: 14px;font-family: 宋体;">保存延迟数据</span></span></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-indent: 28px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 宋体;">该方法是将迟来的数据保存至给定的</span>outputTag<span style="font-size: 14px;font-family: 宋体;">参数，而</span>OutputTag<span style="font-size: 14px;font-family: 宋体;">则是用来标记延迟数据的一个对象。</span></span></section><section style="margin-top: 10px;margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: Wingdings;">l<span style="font-size: 14px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;line-height: normal;font-family: &quot;Times New Roman&quot;;">&nbsp;&nbsp;</span></span>DataStream.getSideOutput(tag:OutputTag[X])--<span style="font-size: 14px;font-family: 宋体;">获取延迟数据</span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-indent: 28px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 宋体;">通过</span>window<span style="font-size: 14px;font-family: 宋体;">等操作返回的</span>DataStream<span style="font-size: 14px;font-family: 宋体;">调用该方法，传入标记延迟数据的对象来获取延迟的数据</span></span></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">22、刚才提到State，那你简单说一下什么是State。</span></p></blockquote><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: left;background-color: rgb(255, 255, 255);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img data-ratio="1.111254851228978" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N1FvCRViaFENmCfeJG1lJ1BQCg44HEf7hy9qp30ZkJ7foEFXkewRZVwvwqTQOh90AMFkLTpCldObw/640?wx_fmt=png" data-type="png" data-w="773" style="width: 364px;height: 405px;"  /></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);">在Flink中，</span>状态被称作state，是用来&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);">保存&nbsp;</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">中间的&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);">计算结果</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp;或者&nbsp;</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);"><strong>缓存数据。</strong></span><br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">根据状态是否需要保存中间结果，分为&nbsp;</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(122, 79, 214);"><strong>无状态计算</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp;和&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(122, 79, 214);">有状态计算。</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">对于流计算而言，事件持续产生，如果每次计算</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 128, 255);"><strong>相互独立</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">，不依赖上下游的事件，则相同输入，可以得到相同输出，</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 128, 255);">是无状态计算</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">。</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">如果计算需要</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(122, 79, 214);">依赖</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">于之前或者后续事件，则被称</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(122, 79, 214);">为有状态计算</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">。</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.476878612716763" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N1FvCRViaFENmCfeJG1lJ1BicC8cQtSYGlHxe5slGNeiacIdVwVuorV2mWaTF0ibibhtO779pBFoibYREA/640?wx_fmt=png" data-type="png" data-w="692" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">有状态计算如 sum求和，数据类加等。<br  /></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.4751286449399657" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N1FvCRViaFENmCfeJG1lJ1BbjXUwsGHjhFWvh5PIayAno5WtITibTzXcKAZqAbwRmNRzLd1eWl9lSA/640?wx_fmt=png" data-type="png" data-w="583" style="box-sizing: border-box !important;width: 583px !important;visibility: visible !important;"  /></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-indent: 28px;"><br  /></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">23、Flink 状态包括哪些？</span></p></blockquote><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">（1）&nbsp;</span></strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">按照由 Flink管理 还是 用户管理，状态可以分为&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(122, 79, 214);">原始状态（Raw State）</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">和&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);">托管状态（ManagedState）</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);">托管状态（ManagedState）</span></strong>:由Flink 自行进行管理的State。</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(122, 79, 214);">原始状态（Raw State）</span></strong>：由用户自行进行管理。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">两者区别：<br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">1.<span style="font-size: 14px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;line-height: normal;font-family: &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px;font-family: 宋体;">从状态管理方式的方式来说，</span></span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong>Managed State</strong></span><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;<span style="font-size: 14px;font-family: 宋体;">由</span></span><strong><span style="font-size: 14px;letter-spacing: 1px;color: rgb(217, 33, 66);">Flink Runtime</span></strong><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;<span style="font-size: 14px;font-family: 宋体;">管理，自动存储，自动恢复，在内存管理上有优化；而</span></span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(0, 82, 255);"><strong>&nbsp;Raw State</strong></span><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;<span style="font-size: 14px;font-family: 宋体;">需要用户自己管理，需要自己序列化，</span>Flink&nbsp;<span style="font-size: 14px;font-family: 宋体;">不知道</span>&nbsp;State&nbsp;<span style="font-size: 14px;font-family: 宋体;">中存入的数据是什么结构，只有用户自己知道，需要最终序列化为可存储的数据结构。</span></span></section><section style="margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">2.<span style="font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;line-height: normal;font-family: &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体;">从状态数据结构来说，</span>Managed State&nbsp;<span style="font-family: 宋体;">支持已知的数据结构，如</span>Value<span style="font-family: 宋体;">、</span>List<span style="font-family: 宋体;">、</span>Map<span style="font-family: 宋体;">等。而</span>&nbsp;Raw State&nbsp;</span><strong><span style="font-family: 宋体;font-size: 14px;color: rgb(61, 167, 66);">只支持</span></strong><strong><span style="font-size: 14px;font-family: 宋体;color: rgb(217, 33, 66);">字节</span></strong><span style="font-size: 14px;font-family: 宋体;">数组，所有状态都要转换为二进制字节数组才可以。</span></span></section><section style="margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">3.<span style="font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;line-height: normal;font-family: &quot;Times New Roman&quot;;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体;">从推荐使用场景来说，</span>Managed State&nbsp;<span style="font-family: 宋体;">大多数情况下均可使用，而</span>Raw State&nbsp;<span style="font-family: 宋体;">是当</span>&nbsp;Managed State&nbsp;<span style="font-family: 宋体;">不够用时，比如需要自定义</span>Operator&nbsp;<span style="font-family: 宋体;">时，才会使用</span>&nbsp;Raw State<span style="font-family: 宋体;">。</span></span><strong><span style="color: rgb(217, 33, 66);font-size: 14px;"><span style="font-family: 宋体;">在实际生产过程中，只推荐使用&nbsp;</span>Managed State 。</span></strong></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="font-size: 14px;"><strong><span style="color: rgb(217, 33, 66);">（2）</span></strong></span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">State&nbsp;</span></strong><span style="font-size: 14px;">按照是否有 key&nbsp;划分为</span><strong><span style="font-size: 14px;color: rgb(172, 57, 255);">&nbsp;KeyedState&nbsp;</span></strong><span style="font-size: 14px;">和&nbsp;</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>OperatorState&nbsp;</strong></span><span style="font-size: 14px;">两种。</span><br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(172, 57, 255);">keyedState特点：</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;1. 只能用在keyedStream上的算子中，状态跟特定的key绑定。<br  /></span></section><section style="margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">&nbsp;2. keyStream流上的每一个key 对应一个state 对象。若一个operator 实例处理多个key，访问相应的多个State，</span><strong><span style="font-size: 14px;color: rgb(172, 57, 255);">可对应多个state。</span></strong></span></section><section style="margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;3.&nbsp;keyedState 保存在StateBackend中<br  /></span></section><section style="margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;4. 通过RuntimeContext访问，实现Rich Function接口。<br  /></span></section><section style="margin-left: 28px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;5. 支持多种数据结构：ValueState、ListState、ReducingState、AggregatingState、MapState.</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;</span><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5060658578856152" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N1FvCRViaFENmCfeJG1lJ1B4swzlhELxK0icL3zmibbjNjogtWSmsCytZwIsM3fIbVUnsL0fH2319Vg/640?wx_fmt=png" data-type="png" data-w="577" style="box-sizing: border-box !important;width: 577px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;"><strong style="color: rgb(0, 82, 255);">Operato</strong></span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);"><strong>rState特点：</strong></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">1. 可以用于所有算子，但整个算子只对应一个state。</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">2.并发改变时有多种重新分配的方式可选：均匀分配；</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">3. 实现CheckpointedFunction或者 ListCheckpointed 接口。</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">4. 目前只支持 ListState数据结构。&nbsp;&nbsp;</span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br  /></span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.42483660130718953" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N1FvCRViaFENmCfeJG1lJ1BsiaUJT3HB7ibxpbJZFZU698Trq1vM93ibuZ4kYFfPoytkg0StBNccX63g/640?wx_fmt=png" data-type="png" data-w="612" style="box-sizing: border-box !important;width: 612px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="font-size: 14px;text-align: justify;letter-spacing: 1px;">这里的fromElements会调用</span><span style="font-size: 14px;text-align: justify;letter-spacing: 1px;color: rgb(0, 82, 255);"><strong>FromElementsFunction</strong></span><span style="font-size: 14px;text-align: justify;letter-spacing: 1px;">的类，其中就使用了类型为List state 的 operator state</span></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">24、Flink广播状态了解吗？</span></p></blockquote><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">Flink中，广播状态中叫作 BroadcastState。&nbsp;在广播状态模式中使用。</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(172, 57, 255);">所谓广播状态模式，&nbsp;就是来自一个流的数据需要被广播到所有下游任务</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">，</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">在算子本地存储，在处理另一个流的时候依赖于广播的数据</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">.下面以一个示例来说明广播状态模式。</span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5055487053020962" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8ML2ryII7cAKze0jISAsHexSNzECty5nHyAhCwcjNQ491CiciagdLmhjUCib849lrUgGPK489pvbbKug/640?wx_fmt=png" data-type="png" data-w="811" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">上图这个示例包含两个流，一个为</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(172, 57, 255);"><strong>kafka模型流</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">，该模型是通过机器学习或者深度学习训练得到的模型，将该模型通过广播，发送给下游所有规则算子，规则算子将规则缓存到Flink的本地内存中，另一个为&nbsp;</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 128, 255);"><strong>Kafka数据流</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">，用来接收测试集，该测试集依赖于模型流中的模型，通过模型完成测试集的推理任务。<br  /></span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">广播状态（State）必须是MapState类型，广播状态模式需要使用广播函数进行处理，广播函数提供了处理广播数据流和普通数据流的接口。</span></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><br  /></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">25、Flink 状态接口包括哪些？</span></p></blockquote><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">在Flink中使用状态，包含两种状态接口：<br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">（1）</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(172, 57, 255);">状态操作接口：</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">使用状态对象本身存储，写入、更新数据。</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">（2）</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">状态访问接口：</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">从StateBackend获取状态对象本身。<br  /></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;font-size: 16px;letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 16px;line-height: 1.74;outline-style: none;color: rgb(172, 57, 255);">状态操作接口</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">Flink 中的&nbsp;</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(122, 79, 214);"><strong>状态操作接口</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp;面向两类用户，即&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(255, 41, 65);">应用开发者&nbsp;</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">和&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);">Flink 框架本身</span></strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);">。</span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp;所有Flink设计了两套接口</span></span></p><p style="margin-top: 10px;margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0);letter-spacing: 1px;"><strong><span style="color: rgb(0, 0, 0);text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">1、面向开发者State接口</span></strong></span></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">面向开发的State接口只提供了对State中数据的增删改基本操作接口，用户无法访问状态的其他运行时所需要的信息。接口体系如下图：</span><strong style="font-size: 14px;letter-spacing: 0.112px;color: rgb(0, 0, 0);"></strong><br  /></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.32616753150481836" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8ML2ryII7cAKze0jISAsHexosPoUngZL443kic7ZhuFicTbUTGnlUkMAcB6FPEPqvVFjks0Ex4qtqNw/640?wx_fmt=png" data-type="png" data-w="1349" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="text-align: left;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;font-size: 13px;letter-spacing: 1px;">面向开发者的 State 接口体系</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="margin-top: 10px;margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 0, 0);letter-spacing: 1px;"><strong><span style="color: rgb(0, 0, 0);text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">2、面向内部State接口</span></strong></span></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">内部State 接口 是给 Flink 框架使用，提供更多的State方法，可以根据需要灵活扩展。除了对State中数据的访问之外，还提供内部运行时信息，如State中数据的序列化器，命名空间（namespace）、命名空间的序列化器、命名空间合并的接口。</span><strong><span style="color: rgb(64, 64, 64);font-size: 14px;text-align: left;">内部State接口命名方式为InternalxxxState。</span></strong></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);text-align: left;line-height: 1.74;outline-style: none;font-size: 16px;">状态访问接口</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">有了状态之后，开发者自定义UDF时，应该如何访问状态？<br  /></span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">状态会被保存在StateBackend中，但StateBackend 又包含不同的类型。所有Flink中抽象了两个状态访问接口：</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(172, 57, 255);">OperatorStateStore</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp;和&nbsp;</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 128, 255);"><strong>KeyedStateStore，</strong></span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">用户在编写UDF时，就无须考虑到底是使用哪种&nbsp;<span style="line-height: 1.74;outline-style: none;">StateBackend类型接口。</span></span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(172, 57, 255);letter-spacing: 1px;">OperatorStateStore 接口原理：</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.46785714285714286" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8ML2ryII7cAKze0jISAsHexR9woqpmDx4RppLwPZcJEjAic3WMErjm3LUibM3jhSS2HfqvBJlozSr4g/640?wx_fmt=png" data-type="png" data-w="560" style="box-sizing: border-box !important;width: 448px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">OperatorState数据以Map形式保存在内存中，并没有使用RocksDBStateBackend和HeapKeyedStateBackend。<br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);letter-spacing: 1px;">KeyedStateStore 接口原理：</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.34261036468330136" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8ML2ryII7cAKze0jISAsHexFtQVAHbhljccGNDg7kXrBCOicrr71LfbHt289RAficdHEyUzo9d9uoBw/640?wx_fmt=png" data-type="png" data-w="1042" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;font-size: 14px;letter-spacing: 1px;">keyedStateStore数据使用RocksDBStateBackend或者HeapKeyedStateBackend来存储，KeyedStateStore中创建、获取状态都交给了具体的StateBackend来处理，KeyedStateStore本身更像是一个代理。</span></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">26、Flink 状态如何存储</span></p></blockquote><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">在Flink中， 状态存储被叫做&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">StateBackend&nbsp;</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">, 它具备两种能力：<br  /></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">（1）在计算过程中提供访问State能力，开发者在编写业务逻辑中能够使用StateBackend的接口读写数据。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">（2）能够将State持久化到外部存储，提供容错能力。<br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">Flink状态</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);"><strong>提供三种存储方式</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">：<br  /></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);">（1）内存：</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">MemoryStateBackend,适用于验证、测试、不推荐生产使用。</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 128, 255);"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">（2）文件：</span></strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">FSStateBackend，适用于长周期大规模的数据。<br  /></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">（3）RocksDB :&nbsp;&nbsp;</span></strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">RocksDBStateBackend，适用于长周期大规模的数据。<br  /></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">上面提到的 StateBackend是面向用户的，在Flink内部3种 State 的关系如下图：<br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.6013824884792627" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8ML2ryII7cAKze0jISAsHexXwN7KUOu0j2y39EIxGyRqUgNx2OkpMCM5hQVXtfvdtwu4RsQjneFtA/640?wx_fmt=png" data-type="png" data-w="868" style="box-sizing: border-box !important;width: 507px;visibility: visible !important;height: 306px;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">在运行时，</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(172, 57, 255);"><strong>MemoryStateBackend</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp;和&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">FSStateBackend</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp;本地的 State 都保存在TaskManager的内存中，所以其底层都依赖于</span></span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;letter-spacing: 1px;color: rgb(217, 33, 66);">HeapKeyedStateBackend</span></strong><span style="letter-spacing: 1px;text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">。HeapKeyedStateBackend面向Flink 引擎内部，使用者无须感知。</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 16px;color: rgb(61, 167, 66);letter-spacing: 1px;"><strong><span style="font-size: 16px;color: rgb(61, 167, 66);text-align: left;line-height: 1.74;outline-style: none;">1、内存型&nbsp;&nbsp;StateBackend</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">MemoryStateBackend，运行时所需的State数据全部保存在&nbsp;</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);"><strong>TaskManager JVM堆上内存中，</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp; KV类型的State、窗口算子的State 使用HashTable 来保存数据、触发器等。</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);">执行检查点的时候，会把 State&nbsp;的快照数据保存到</span></strong><span style="color: rgb(217, 33, 66);"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">JobManager进程的内存中</span></strong></span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);">。</span></strong></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">MemoryStateBackend 可以使用</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);"><strong>异步</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">的方式进行快照，（也可以同步），</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);">推荐异步</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">，避免阻塞算子处理数据。<br  /></span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><br  /></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">基于内存的 Stateßackend 在生产环境下不建议使用，可以在本地开发调试测试 。</span></section><section style="margin-top: 5px;margin-bottom: 5px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);">注意点如下 ：</span></strong></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">1) State 存储在 JobManager 的内存中.受限于 JobManager的内存大小。&nbsp;</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">2) 每个 State默认5MB,可通过&nbsp;MemoryStateBackend&nbsp;构造函数调整&nbsp;</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">3) 每个 Stale 不能超过 Akka Frame 大小。</span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);text-align: left;line-height: 1.74;outline-style: none;font-size: 16px;">2、文件型 StateBackend</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">FSStateBackend，运行时所需的State数据全部保存在&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">TaskManager 的内存中，</span></strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(61, 167, 66);"><strong>&nbsp;</strong></span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);"><strong>执行检查点的时候，会把 State&nbsp;的快照数据保存到</strong></span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);"><strong>配置的文件系统中</strong></span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);"><strong>。</strong></span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><br  /></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">可以是分布式或者本地文件系统，路径如：<br  /></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">HDFS路径：“hdfs://namenode:40010/flink/checkpoints”</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">本地路径：“file:///data/flink/checkpoints”。<br  /></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">FSStateBackend&nbsp;</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);"><strong>适用于处理大状态、长窗口、或者大键值状态的有状态处理任务</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">。</span></span></p><p style="margin-top: 5px;margin-bottom: 5px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);">注意点如下 ：</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">1) State 数据首先被存在 TaskManager 的内存中。&nbsp;</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">2) State大小不能超过TM内存。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">3) TM异步将State数据写入外部存储。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;color: rgb(61, 170, 214);letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(61, 170, 214);text-align: left;line-height: 1.74;outline-style: none;"><span style="font-size: 14px;color: rgb(61, 170, 214);line-height: 1.74;outline-style: none;">MemoryStateBackend&nbsp;</span>和<span style="font-size: 14px;color: rgb(61, 170, 214);line-height: 1.74;outline-style: none;">FSStateBackend&nbsp;都依赖于HeapKeyedStateBackend，<span style="font-size: 14px;color: rgb(61, 170, 214);line-height: 1.74;outline-style: none;">HeapKeyedStateBackend 使用 State存储数据。</span></span></span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="text-align: left;line-height: 1.74;outline-style: none;font-size: 16px;color: rgb(217, 33, 66);">3、RocksDBStateBackend</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">RocksDBStateBackend 跟内存型和文件型都不同 。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">RocksDBStateBackend&nbsp;</span><strong><span style="font-size: 14px;color: rgb(255, 79, 121);">使用</span></strong><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>嵌入式的本地数据库 RocksDB</strong></span><span style="font-size: 14px;">&nbsp;将流计算数据状态</span><strong><span style="font-size: 14px;color: rgb(255, 79, 121);">存储在本地磁盘中</span></strong><span style="font-size: 14px;">，不会受限于TaskManager 的内存大小，在执行检查点的时候，再将整个 RocksDB 中保存的State数据全量或者增量持久化到配置的文件系统中，</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">在 JobManager 内存中会存储少量的检查点元数据。RocksDB克服了State受内存限制的问题，同时又能够持久化到远端文件系统中，比较适合在生产中使用。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(171, 25, 66);">缺点：</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">RocksDBStateBackend&nbsp;相比基于内存的StateBackend，访问State的成本高很多，可能导致数据流的吞吐量剧烈下降，甚至可能</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>降低为原来的 1/10</strong></span><span style="font-size: 14px;">。</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">适用场景</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">1）最适合用于处理大状态、长窗口，或大键值状态的有状态处理任务。&nbsp;</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">2）RocksDBStateBackend 非常适合用于高可用方案。&nbsp;</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">3)&nbsp;&nbsp;RocksDBStateBackend&nbsp;是</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);">目前唯一支持增量检查点的后端。</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp;增量检查点非常适用于超 大状态的场景。&nbsp;</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">注意点&nbsp;</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">1）总&nbsp;State&nbsp;大小仅限于磁盘大小，不受内存限制&nbsp;</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">2）</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong>RocksDBStateBackend&nbsp;</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">也需要配置外部文件系统，集中保存State&nbsp;。</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">3）RocksDB的 JNI API&nbsp;</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong>基于 byte 数组</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">，单 key 和单 Value 的大小不能超过&nbsp;8 字节</span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">4）对于使用具有合并操作状态的应用程序，如ListState ，随着时间可能会累积到超过 2*31次方字节大小，这将会导致在接下来的查询中失败。</span></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">27、Flink 状态如何持久化？</span></p></blockquote><section style="line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">首选，Flink的状态最终都要持久化到第三方存储中，确保集群故障或者作业挂掉后能够恢复。</span></section><section style="line-height: 1.75em;"><br  /></section><section style="margin-bottom: 10px;line-height: 1.75em;"><span style="color: rgb(64, 64, 64);font-size: 14px;text-align: left;letter-spacing: 1px;">RocksDBStateBackend 持久化策略有两种：</span></section><section style="margin-bottom: 5px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(122, 79, 214);"><strong><span style="font-size: 14px;text-align: left;">全量持久化策略</span></strong></span><span style="color: rgb(64, 64, 64);font-size: 14px;text-align: left;">&nbsp;RocksFullSnapshotStrategy</span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);"><strong>增量持久化策略</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">&nbsp;</span><span style="color: rgb(64, 64, 64);font-size: 14px;text-align: left;">RocksIncementalSnapshotStrategy</span></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;"><p><br  /></p><p><span style="letter-spacing: 1px;"><strong><span style="color: rgb(122, 79, 214);text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">1、全量持久化策略</span></strong></span></p><p><br  /></p><p><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">每次将全量的State写入到状态存储中（HDFS）。内存型、文件型、RocksDB类型的StataBackend 都支持全量持久化策略。<br  /></span></p><p><br  /></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.4065180102915952" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PVF3oeLZOBhPaUgCnkjtN1VILicmUdErHiaZazzrzib28HcXoy6l77ICkkictvibbUgtjELADJ5utoezQ/640?wx_fmt=png" data-type="png" data-w="1166" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="text-align: center;"><span style="font-size: 13px;letter-spacing: 1px;">快照保存策略类体系<br  /></span></p><p><br  /></p><section style="line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">在执行持久化策略的时候，使用异步机制，每个算子启动1个独立的线程，将自身的状态写入分布式存储可靠存储中。在做持久化的过程中，状态可能会被持续修改，</span></section><section style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(61, 170, 214);"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">基于内存的状态后端</span></strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">使用 CopyOnWriteStateTable 来保证线程安全，RocksDBStateBackend则使用RocksDB的快照机制，使用快照来保证线程安全。</span></span></section><p><br  /></p><p><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);text-align: left;line-height: 1.74;outline-style: none;font-size: 16px;">2、增量持久化策略</span></strong></span></p><p><br  /></p><section style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">增量持久化就是每次持久化增量的State，</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);"><strong>只有RocksDBStateBackend 支持增量持久化。</strong></span></span></section><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">Flink 增量式的检查点以 RocksDB为基础</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">，&nbsp;RocksDB是一个基于LSM-Tree的KV存储。新的数据保存在内存中， 称为</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);">memtable</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">。如果Key相同，后到的数据将覆盖之前的数据，一旦memtable写满了，RocksDB就会将数据压缩并写入磁盘。memtable的数据持久化到磁盘后，就变成了不可变的&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">sstable</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">。<br  /></span></span></section><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">因为 sstable 是不可变的，</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">Flink对比前一个检查点创建和删除的RocksDB sstable 文件就可以计算出状态有哪些发生改变。</span></span></section><section style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">为了确保 sstable 是不可变的，</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">Flink 会在RocksDB&nbsp;触发刷新操作</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">，</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">强制将 memtable 刷新到磁盘上 。</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">在Flink 执行检查点时，会将新的sstable 持久化到HDFS中，同时保留引用。这个过程中 Flink 并不会持久化本地所有的sstable，因为本地的一部分历史sstable 在之前的检查点中已经持久化到存储中了，只需增加对 sstable文件的引用次数就可以。&nbsp;</span></span></section><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">RocksDB会在后台合并 sstable 并删除其中重复的数据</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">。然后在RocksDB删除原来的 sstable，替换成新合成的 sstable.。</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);"><strong>新的&nbsp;sstable&nbsp;包含了被删除的 sstable中的信息，</strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">通过合并历史的sstable会合并成一个新的 sstable，并删除这些历史sstable. 可以减少检查点的历史文件，避免大量小文件的产生。</span></span></section></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">28、Flink 状态过期后如何清理？</span></p></blockquote><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 16px;letter-spacing: 1px;"><strong><span style="font-size: 16px;text-align: left;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">1、DataStream中状态过期</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">可以对DataStream中的每一个状态设置&nbsp;</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(0, 82, 255);">清理策略 StateTtlConfig</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">，可以设置的内容如下：<br  /></span></span></section><ul class="list-paddingleft-2" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><li style="letter-spacing: 1px;"><p><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">过期时间：超过多长时间未访问，视为State过期，类似于缓存。<br  /></span></p></li><li style="letter-spacing: 1px;"><p><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">过期时间更新策略：创建和写时更新、读取和写时更新。<br  /></span></p></li><li style="letter-spacing: 1px;"><p><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">State可见性：未清理可用，超时则不可用。</span></p></li></ul><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;"><strong style="font-size: 16px;">2、Flink SQL中状态过期</strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">Flink SQL 一般在流Join、聚合类场景使用State，如果State不定时清理，则导致State过多，内存溢出。清理策略配置如下：</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="nginx"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">StreamQueryConfig&nbsp;qConfig&nbsp;= ...</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//设置过期时间为&nbsp;min&nbsp;=&nbsp;12小时&nbsp;，max&nbsp;=&nbsp;24小时</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">qConfig.withIdleStateRetentionTime(Time.hours(12),Time.hours(24));</span></span></code></pre></section></section><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.3781021897810219" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MS3ZsmzMtdMIMxYj0ZXuknIgaicmOJ8tW74rYGnH192R55m0WUVck415Bu5cbO9cduD4ibUvRwQA2Q/640?wx_fmt=png" data-type="png" data-w="1370" style="text-align: center;white-space: normal;"  /></span></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="letter-spacing: 1px;"><span style="font-size: 14px;">29、<span style="text-align: left;">Flink 通过什么实现</span></span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong><span style="text-align: left;">可靠的容错机制</span></strong></span><span style="font-size: 14px;text-align: left;">。</span></span></p></blockquote><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><p style="letter-spacing: 0.544px;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;">Flink 使用&nbsp;轻量级分布式快照，设计检查点（</span><strong style="text-align: left;"><span style="font-size: 14px;color: rgb(122, 79, 214);">checkpoint</span></strong><span style="text-align: left;font-size: 14px;">）实现可靠容错。</span></span></p></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">30、什么是Checkpoin检查点？</span></p></blockquote><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">Checkpoint</span></strong></span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">被叫做</span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(217, 33, 66);"><strong>检查点</strong></span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">，是Flink实现容错机制最核心的功能，是Flink可靠性的基石，它能够根据配置周期性地基于Stream中各个Operator的</span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(217, 33, 66);"><strong>状态</strong></span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">来生成Snapshot</span><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(0, 82, 255);">快照</span></strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">，从而将这些状态数据定期持久化存储下来，当Flink程序一旦意外崩溃时，重新运行程序时可以有选择地从这些Snapshot进行恢复，从而修正因为故障带来的程序数据状态中断。</span></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">Flink的checkpoint机制原理来自“</span><span style="line-height: 21px;font-size: 14px;color: rgb(217, 33, 66);"><strong>Chandy-Lamport algorithm</strong></span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">”算法</span></span></p><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(217, 33, 66);">注意:区分State和Checkpoint</span></strong></span></section><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(172, 57, 255);">1.State:</span></strong></span></p><section style="white-space: normal;line-height: 1.75em;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">一般指一个具体的Task/Operator的状态(operator的状态表示一些算子在运行的过程中会产生的一些中间结果)</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">State数据默认保存在Java的堆内存中/TaskManage节点的内存中</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">State可以被记录，在失败的情况下数据还可以恢复。</span></section><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(0, 82, 255);">2.Checkpoint:</span></strong></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 表示了一个FlinkJob在一个特定时刻的一份全局状态快照，即包含了所有Task/Operator的状态</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 可以理解为Checkpoint是把State数据定时持久化存储了</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">比如KafkaConsumer算子中维护的Offset状态,当任务重新恢复的时候可以从Checkpoint中获取。</span></p><p style="letter-spacing: 0.544px;"><br  /></p><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">31、什么是Savepoin保存点？</span></p></blockquote><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><section style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong style="white-space: normal;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(217, 33, 66);">保存点</span></strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">在 Flink 中叫作</span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(217, 33, 66);"><strong>&nbsp;Savepoint</strong></span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">. 是基于Flink 检查点机制的应用完整快照备份机制. 用来保存状态 可以在另一个集群或者另一个时间点.从保存的状态中将作业恢复回来。适用 于应用升级、集群迁移、 Flink 集群版本更新、A/B测试以及假定场景、暂停和重启、归档等场景。保存点可以视为一个(算子 ID -&gt; State) 的Map，对于每一个有状态的算子，Key是算子ID，Value是算子State。</span></span></section></section><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;white-space: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">32、什么是CheckpointCoordinator检查点协调器？</span></p></blockquote></section><section style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink中检查点协调器叫作 </span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>CheckpointCoordinator</strong></span><span style="font-size: 14px;">，负责协调 Flink 算子的 State 的分布式快照。当触发快照的时候，CheckpointCoordinator向 Source 算子中注入</span><span style="font-size: 14px;color: rgb(122, 79, 214);"><strong>Barrier</strong></span><span style="font-size: 14px;">消息&nbsp;，然后等待所有的Task通知检查点确认完成，同时持有所有 Task 在确认完成消息中上报的State句柄。</span><br  /></span></section><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">33、Checkpoint中保存的是什么信息？</span></p></blockquote></section><section style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(77, 77, 77);font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-variant-ligatures: no-common-ligatures;text-align: start;background-color: rgb(255, 255, 255);font-size: 14px;letter-spacing: 1px;">检查点里面到底保存着什么信息呢？我们以flink消费kafka数据wordcount为例：</span></section><section style="white-space: normal;line-height: 1.75em;"><br  /></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">1、我们从Kafka读取到一条条的日志，从日志中解析出app_id，然后将统计的结果放到内存中一个Map集合，app_id做为key，对应的pv做为value，每次只需要将相应app_id 的pv值+1后put到Map中即可；</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">2、kafka topic：test；</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">3、flink运算流程如下：</span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.17721518987341772" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MS3ZsmzMtdMIMxYj0ZXuknjPSYtFb0WJDDgaNf3ayDoLVM7Zq7cDd1zV7y2YKV8XGgNo2YS7U4aQ/640?wx_fmt=png" data-type="png" data-w="1106"  /></p><section style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-variant-ligatures: no-common-ligatures;text-align: start;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;">kafka topic有且只有一个分区</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">假设kafka的topic-test只有一个分区，flink的Source task记录了当前消费到kafka test topic的所有partition的offset</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="swift"><code><span class="code-snippet_outer">例：（<span class="code-snippet__number">0</span>，<span class="code-snippet__number">1000</span>）表示<span class="code-snippet__number">0</span>号<span class="code-snippet__built_in">partition</span>目前消费到offset为<span class="code-snippet__number">1000</span>的数据</span></code></pre></section><p style="white-space: normal;"><strong><span style="font-size: 14px;letter-spacing: 1px;">Flink的pv task记录了当前计算的各app的pv值，为了方便讲解，我这里有两个app：app1、app2</span></strong></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="cs"><code><span class="code-snippet_outer">例：（app1，<span class="code-snippet__number">50000</span>）（app2，<span class="code-snippet__number">10000</span>）</span></code><code><span class="code-snippet_outer">表示app1当前pv值为<span class="code-snippet__number">50000</span></span></code><code><span class="code-snippet_outer">表示app2当前pv值为<span class="code-snippet__number">10000</span></span></code><code><span class="code-snippet_outer">每来一条数据，只需要确定相应app_id，将相应的<span class="code-snippet__keyword">value</span>值+<span class="code-snippet__number">1</span>后put到map中即可；</span></code></pre></section><p style="white-space: normal;"><br  /></p><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">该案例中，CheckPoint保存的其实就是</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>第n次CheckPoint消费的offset信息和各app的pv值信息</strong></span><span style="font-size: 14px;">，记录一下发生CheckPoint当前的状态信息，并将该状态信息保存到相应的状态后端。图下代码：（</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>注：状态后端是保存状态的地方，决定状态如何保存，如何保障状态高可用</strong></span><span style="font-size: 14px;">，我们只需要知道，我们能从状态后端拿到offset信息和pv信息即可。状态后端必须是高可用的，否则我们的状态后端经常出现故障，会导致无法通过checkpoint来恢复我们的应用程序）。</span></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="swift"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">chk-100</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">offset：（0，1000）</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">pv：（app1，50000）（app2，10000）</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">该状态信息表示第100次CheckPoint的时候，&nbsp;partition&nbsp;0&nbsp;offset消费到了1000，pv统计</span></span></code></pre></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">34、当作业失败后，检查点如何恢复作业？</span></p></blockquote></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink提供了&nbsp;</span><span style="font-size: 14px;color: rgb(172, 57, 255);"><strong>应用自动恢复机制&nbsp;</strong></span><span style="font-size: 14px;">和&nbsp;</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">手动作业恢复机制</span></strong><span style="font-size: 14px;">。</span></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(172, 57, 255);">应用自动恢复机制：</span></strong></span></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">Flink设置有作业失败重启策略，包含三种：<br  /></span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 0, 0);">1、定期恢复策略：fixed-delay</span></strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">固定延迟重启策略会尝试一个给定的次数来重启Job，如果超过最大的重启次数，Job最终将失败，在连续两次重启尝试之间，重启策略会等待一个固定时间，默认Integer.MAX_VALUE次<br  /></span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">2、失败比率策略：failure-rate</span></strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">失败率重启策略在job失败后重启，但是超过失败率后，Job会最终被认定失败，在两个连续的重启尝试之间，重启策略会等待一个固定的时间。<br  /></span></section><section style="white-space: normal;line-height: 1.75em;"><br  /></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">3、直接失败策略：None &nbsp;&nbsp;失败不重启</span></strong></span></section><section style="white-space: normal;line-height: 1.75em;"><br  /></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">手动作业恢复机制</span></strong>。</span></section><section style="white-space: normal;line-height: 1.75em;"><br  /></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">因为Flink检查点目录分别对应的是JobId，每通过flink run&nbsp;方式/页面提交方式恢复都会重新生成 jobId，Flink 提供了在启动之时通过设置</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>&nbsp;-s&nbsp;</strong></span><span style="font-size: 14px;">.参数指定检查点目录的功能，让新的 jobld 读取该检查点元文件信息和状态信息，从而达到指定时间节点启动作业的目的。<br  /></span></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">启动方式如下：</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="typescript"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">/bin/flink -s /flink/checkpoints/03112312a12398740a87393/chk-50/_metadata</span></span></code></pre></section><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">35、当作业失败后，从保存点如何恢复作业？</span></p></blockquote></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">从保存点恢复作业并不简单，尤其是在作业变更(如修改逻辑、修复 bug) 的情况下， 需要考虑如下几点:</span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;"><strong>（1）算子的顺序改变&nbsp;</strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">如果对应的 UID 没变，则可以恢复，如果对应的 UID 变了恢复失败。</span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;"><strong>（2）作业中添加了新的算子&nbsp;</strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">如果是无状态算子，没有影响，可以正常恢复，如果是有状态的算子，跟无状态的算子 一样处理。</span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;"><strong>（3）从作业中删除了一个有状态的算子</strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">默认需要恢复保存点中所记录的所有算子的状态，如果删除了一个有状态的算子，从保存点回复的时候被删除的OperatorID找不到，所以会报错 可以通过在命令中添加&nbsp;</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">-- allowNonReStoredSlale (short: -n ）跳过无法恢复的算子 。</span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;"><strong>（4）添加和删除无状态的算子</strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">如果手动设置了 UID 则可以恢复，保存点中不记录无状态的算子 如果是自动分配的 UID ，那么有状态算子的可能会变( Flink 一个单调递增的计数器生成 UID，DAG 改版，计数器极有可能会变) 很有可能恢复失败。</span></section><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">36、Flink如何实现轻量级异步分布式快照？</span></p></blockquote></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">要实现分布式快照，最关键的是能够将数据流切分。</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">Flink 中使用 Barrier (屏障)来切分数据 流。</span></strong><span style="font-size: 14px;">&nbsp;Barrierr 会周期性地注入数据流中，作为数据流的一部分，从上游到下游被算子处理。Barrier 会严格保证顺序，不会超过其前边的数据。Barrier 将记录分割成记录集，</span><span style="font-size: 14px;color: rgb(172, 57, 255);"><strong>两个 Barrier 之间的数据流中的数据隶属于同一个检查点。每一个 Barrier 都携带一个其所属快照的 ID 编号。</strong></span><span style="font-size: 14px;">Barrier 随着数据向下流动，不会打断数据流，因此非常轻量。&nbsp;在一个数据流中，可能会存在多个隶属于不同快照的 Barrier ，并发异步地执行分布式快照，如下图所示：</span></span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.35458515283842795" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MS3ZsmzMtdMIMxYj0ZXuknia9oiaXmsvLa9E24fHOcFVhLZGQwEEvSUfeHDKZorFPiaHk8t5mibuFUpA/640?wx_fmt=png" data-type="png" data-w="1145"  /></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Barrier 会在数据流源头被注人并行数据流中。</span><span style="font-size: 14px;color: rgb(172, 57, 255);"><strong>Barrier n所在的位置就是恢复时数据重新处理的起始位置。</strong></span><span style="font-size: 14px;">&nbsp;例如，在Kafka中，这个位置就是最后一个记录在分区内的偏移量&nbsp;( offset) ，作业恢复时，会根据这个位置从这个偏移量之后向 kafka 请求数据 这个偏移量就是State中保存的内容之一。</span></span></section><section style="white-space: normal;line-height: 1.75em;"><br  /></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Barrier 接着向下游传递。当一个非数据源算子从所有的输入流中收到了快照 n 的Barrier时，该算子就会对自己的 State 保存快照，并向自己的下游&nbsp;</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">广播 发送</span></strong><span style="font-size: 14px;">快照 n 的 Barrier。一旦Sink 算子接收到 Barrier ，有两种情况：</span></span></section><section style="white-space: normal;line-height: 1.75em;"><br  /></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;">（1）如果</span></strong></span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">是引擎内严格一次处理保证，</span></strong><span style="font-size: 14px;">当 Sink 算子已经收到了所有上游的 Barrie &nbsp;n 时， Sink 算子对自己的 State 进行快照，然后通知检查点协调器( CheckpointCoordinator) 。当所有 的算子都向检查点协调器汇报成功之后，检查点协调器向所有的算子确认本次快照完成。</span></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(172, 57, 255);"><strong>（2）如果是端到端严格一次处理保证，</strong></span><span style="font-size: 14px;">当 Sink 算子已经收到了所有上游的 Barrie n 时， Sink 算子对自己的 State 进行快照，</span><span style="font-size: 14px;color: rgb(172, 57, 255);"><strong>并预提交事务（两阶段提交的第一阶段）</strong></span><span style="font-size: 14px;">，再通知检查点协调器( CheckpointCoordinator) ，检查点协调器向所有的算子确认本次快照完成，Sink&nbsp;算子</span><strong><span style="font-size: 14px;color: rgb(172, 57, 255);">提交事务<strong>（两阶段提交的第二阶段）</strong></span></strong><span style="font-size: 14px;">，本次事务完成。</span></span></section><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;">我们接着 </span></strong></span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">33</span></strong><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;"> 的案例来具体说一下如何执行分布式快照：</span></strong></span></span></section><section style="white-space: normal;line-height: 1.75em;"><br  /></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;">对应到pv案例中就是</span></strong></span><span style="font-size: 14px;">，Source Task接收到JobManager的编号为</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">chk-100（从最近一次恢复）</span></strong><span style="font-size: 14px;">的CheckPoint触发请求后，发现自己恰好接收到kafka offset（0，1000）处的数据，所以会往offset（0，1000）数据之后offset（0，1001）数据之前安插一个barrier，然后自己开始做快照，也就是将offset（0，1000）保存到状态后端chk-100中。然后barrier接着往下游发送，当统计pv的task接收到barrier后，也会暂停处理数据，将自己内存中保存的pv信息（app1，50000）（app2，10000）保存到状态后端chk-100中。OK，flink大概就是通过这个原理来保存快照的;</span></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">统计pv的task接收到barrier，就意味着barrier之前的数据都处理了，所以说，不会出现丢数据的情况。</span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">37、什么是Barrier对齐？</span></p></blockquote></section><section data-mpa-template="t" mpa-from-tpl="t" style="white-space: normal;"><section data-mid="" mpa-from-tpl="t" style="display: flex;justify-content: center;align-items: center;width: 578px;"><section data-mid="" mpa-from-tpl="t" style="display: flex;justify-content: flex-start;align-items: center;flex-direction: column;"><section data-mid="" mpa-from-tpl="t" style="margin-top: 1px;margin-right: 1px;margin-bottom: -10px;width: 10px;height: 9px;align-self: flex-end;z-index: 1;"><br  /></section><section data-mid="" mpa-from-tpl="t" style="margin-top: -11px;margin-left: 2px;width: 9px;height: 9px;align-self: flex-start;"><img data-ratio="1" src="https://mmbiz.qpic.cn/mmbiz_png/o1IgHWNdvFeUBTXx4ewKsVHDADKEibichrAcN6QztFYO6bm59aKJtj5e7dV3UYiaXPib6ECYjyfvPdlesvcLgm0d6w/640?wx_fmt=png" data-type="png" data-w="18" style="display: block;"  /></section></section></section></section><p style="white-space: normal;text-align: center;"><br  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.41801075268817206" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MS3ZsmzMtdMIMxYj0ZXuknlFYKElZXwJhtY3qQDyF0jDyz1cicKicKRka01djmOXcmY1x0s7197XXQ/640?wx_fmt=png" data-type="png" data-w="744"  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.4253028263795424" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MS3ZsmzMtdMIMxYj0ZXukne2UWIKbk5icTU1oJOSQfmhYD3Iwkzh4h7CkiaGwUsLSPxVNbYhhoqic7Q/640?wx_fmt=png" data-type="png" data-w="743"  /></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">一旦Operator从输入流接收到CheckPoint barrier n，它就不能处理来自该流的任何数据记录，直到它从其他所有输入接收到barrier n为止。否则，它会混合属于快照n的记录和属于快照n + 1的记录；<br  /></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(172, 57, 255);">如上图所示：</span></strong><br  /></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">图1，算子收到数字流的Barrier,字母流对应的barrier尚未到达</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">图2，算子收到数字流的Barrier,会继续从数字流中接收数据，但这些流只能被搁置，记录不能被处理，而是放入缓存中，等待字母流 Barrier到达。在字母流到达前， 1，2，3数据已经被缓存。</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">图3，字母流到达，算子开始对齐State进行异步快照，并将Barrier向下游广播，并不等待快照执行完毕。</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">图4，算子做异步快照，首先处理缓存中积压数据，然后再从输入通道中获取数据。</span></section><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">38、什么是Barrier不对齐？</span></p></blockquote></section><section style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-variant-ligatures: no-common-ligatures;text-align: start;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="color: red;outline: 0px;letter-spacing: 1px;">checkpoint 是要等到所有的barrier全部都到才算完成<br  /></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">上述图2中，当还有其他输入流的barrier还没有到达时，会把已到达的barrier之后的数据1、2、3搁置在缓冲区，等待其他流的barrier到达后才能处理。</span></section><section style="white-space: normal;line-height: 1.75em;"><br  /></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;">barrier不对齐：</span></strong></span><strong><span style="font-size: 14px;color: rgb(172, 57, 255);">就是指当还有其他流的barrier还没到达时，为了不影响性能，也不用理会，直接处理barrier之后的数据。等到所有流的barrier的都到达后，就可以对该Operator做CheckPoint了；</span></strong></span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="letter-spacing: 1px;"><span style="font-size: 14px;">39、</span>为什么要进行barrier对齐？不对齐到底行不行？</span></p></blockquote></section><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">答：Exactly Once时必须barrier对齐，如果barrier不对齐就变成了At Least Once；</span></p><p style="white-space: normal;line-height: 1.75em;"><br  /></p><p style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-variant-ligatures: no-common-ligatures;text-align: start;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;">CheckPoint的目的就是为了保存快照</span></strong></span><span style="font-size: 14px;">，如果不对齐，那么在chk-100快照之前，已经处理了一些chk-100 对应的offset之后的数据，当程序从chk-100恢复任务时，chk-100对应的offset之后的数据还会被处理一次，所以就出现了重复消费。</span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">40、Flink支持Exactly-Once语义，那什么是<span style="font-size: 14px;color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;word-spacing: 2px;background-color: rgb(227, 242, 253);">Exactly-Once</span>？</span></p></blockquote></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);">Exactly-Once语义&nbsp;: 指</span><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);color: rgb(123, 12, 0);"><strong>端到端</strong></span><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);">的一致性，从</span><strong style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;color: rgb(0, 128, 255);">数据读取</span></strong><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);">、</span><strong style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;color: rgb(122, 79, 214);">引擎计算</span></strong><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);">、</span><strong style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: left;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;color: rgb(217, 33, 66);">写入外部存储的</span></strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">整个过程中，<span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;color: rgb(2, 30, 170);"><strong>即使机器或软件出现故障，</strong></span>都确保数据仅处理一次，不会重复、也不会丢失。</span></span></section><p><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">41、要实现Exactly-Once,需具备什么条件？</span></p></blockquote></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;">流系统要实现Exactly-Once，需要保证上游 Source 层、中间计算层和下游 Sink 层三部分同时满足</span><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;color: rgb(171, 25, 66);"><strong>端到端严格一次处理，如下图：</strong></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.4603825136612022" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQmHQibNicRrXqMQqCA0GYVTSnyiaGSPavONecell9ibgajDWZjfYhkpsjIQA/640?wx_fmt=png" data-type="png" data-w="732" style="box-sizing: border-box !important;width: 452px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size: 12px;letter-spacing: 1px;">Flink端到端严格一次处理<br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><span style="color: rgb(255, 76, 0);"><strong><span style="font-size: 14px;">Source端：</span></strong></span><span style="font-size: 14px;">数据从上游进入Flink，必须保证消息严格一次消费。同时Source 端必须满足可重放（replay）。<span style="text-align: center;">否则 Flink 计算层收到消息后未计算，却发生 failure 而重启，消息就会丢失。</span><br  /></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><span style="color: rgb(255, 76, 0);"><strong><span style="font-size: 14px;">Flink计算层：</span></strong></span><span style="font-size: 14px;">利用 Checkpoint 机制，把状态数据定期持久化存储下来，Flink程序一旦发生故障的时候，可以选择状态点恢复，避免数据的丢失、重复。<br  /></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><span style="color: rgb(255, 76, 0);"><strong><span style="font-size: 14px;">Sink端：</span></strong></span><span style="font-size: 14px;">Flink将处理完的数据发送到Sink端时，通过&nbsp;</span><span style="font-size: 14px;color: rgb(255, 0, 0);"><strong>两阶段提交协议 ，</strong></span><span style="font-size: 14px;">即 TwoPhaseCommitSinkFunction 函数。该 SinkFunction 提取并封装了两阶段提交协议中的公共逻辑，保证Flink 发送Sink端时实现严格一次处理语义。&nbsp;&nbsp;</span><strong><span style="font-size: 14px;color: rgb(0, 128, 255);">&nbsp;同时：</span></strong><span style="font-size: 14px;">Sink端必须支持</span><span style="color: rgb(0, 128, 255);"><strong><span style="font-size: 14px;">事务机制</span></strong></span><span style="font-size: 14px;">，能够进行数据</span><strong><span style="font-size: 14px;color: rgb(0, 128, 255);">回滚</span></strong><span style="font-size: 14px;">或者满足</span><strong><span style="font-size: 14px;color: rgb(0, 128, 255);">幂等性。</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 128, 255);">回滚机制：</span></strong><span style="font-size: 14px;">即当作业失败后，能够将部分写入的结果回滚到之前写入的状态。</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 128, 255);">幂等性：</span></strong><span style="font-size: 14px;">就是一个相同的操作，无论重复多少次，造成的结果和只操作一次相等。即当作业失败后，写入部分结果，但是当重新写入全部结果时，不会带来负面结果，重复写入不会带来错误结果。</span></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">42、什么是两阶段提交协议？</span></p></blockquote></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 128, 255);"><strong><span style="font-size: 14px;">两阶段提交协议（Two -Phase Commit，2PC）是解决分布式事务问题最常用的方法，它可以保证在分布式事务中，</span></strong></span><span style="color: rgb(255, 0, 0);"><strong><span style="font-size: 14px;">要么所有参与进程都提交事务，要么都取消</span></strong></span><span style="color: rgb(0, 128, 255);"><strong><span style="font-size: 14px;">，即实现ACID中的 A（原子性）。</span></strong></span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">两阶段提交协议中&nbsp;有两个重要角色</span><strong><span style="font-size: 14px;color: rgb(255, 0, 0);">，协调者（Coordinator）</span></strong><span style="font-size: 14px;">和</span><strong><span style="font-size: 14px;color: rgb(255, 0, 0);">&nbsp;参与者（Participant）</span></strong><span style="font-size: 14px;">,其中协调者只有一个，起到分布式事务的协调管理作用，参与者有多个。</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;"><br  />两阶段提交阶段分为两个阶段：</span><span style="font-size: 14px;color: rgb(255, 0, 0);"><strong>投票阶段（Voting）</strong></span><span style="font-size: 14px;">和&nbsp;</span><strong><span style="font-size: 14px;color: rgb(255, 0, 0);">提交阶段（Commit）。</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(255, 0, 0);">投票阶段：<br  /></span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">（1）协调者向所有参与者<strong>发送 prepare 请求</strong>和事务内容，询问是否可以准备事务提交，等待参与者的相应。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">（2）参与者执行事务中包含的操作，并记录 undo 日志（用于回滚）和 redo 日志（用于重放），但不真正提交。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">（3）参与者向协调者返回事务操作的执行结果，执行成功返回yes，失败返回no。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(255, 0, 0);">提交阶段：</span></strong><br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">分为成功与失败两种情况。</span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">若所有参与者都返回 yes，说明事务可以提交：</span></p><ul class="list-paddingleft-2" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><li style="text-align: left;letter-spacing: 1px;"><p><span style="font-size: 14px;letter-spacing: 1px;">协调者向所有参与者发送 commit 请求。</span></p></li><li style="text-align: left;letter-spacing: 1px;"><p><span style="font-size: 14px;letter-spacing: 1px;">参与者收到 commit 请求后，将事务真正地提交上去，并释放占用的事务资源，并向协调者返回 ack 。</span></p></li><li style="text-align: left;letter-spacing: 1px;"><section style="margin-bottom: 15px;"><span style="font-size: 14px;letter-spacing: 1px;">协调者收到所有参与者的 ack 消息，事务成功完成，如下图：</span></section></li></ul><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.49523809523809526" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQm9buQaO13038n3oPvdicaCllSeC97I31dVicibZvhvUwpictHHmylUET97g/640?wx_fmt=png" data-type="png" data-w="735" style="text-align: center;box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5068119891008175" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQmicddqLDhGJaribNDrGtFzAdUfsUtNquJqCcUp9oHpB9918QG9QEmWlOQ/640?wx_fmt=png" data-type="png" data-w="734" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-top: 15px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">若有参与者返回 no 或者超时未返回，说明事务中断，需要回滚：</span></p><ul class="list-paddingleft-2" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><li style="text-align: left;letter-spacing: 1px;"><p><span style="font-size: 14px;letter-spacing: 1px;">协调者向所有参与者发送rollback请求。</span></p></li><li style="text-align: left;letter-spacing: 1px;"><p><span style="font-size: 14px;letter-spacing: 1px;">参与者收到rollback请求后，根据undo日志回滚到事务执行前的状态，释放占用的事务资源，并向协调者返回ack。</span></p></li><li style="text-align: left;letter-spacing: 1px;"><p style="margin-bottom: 15px;"><span style="font-size: 14px;letter-spacing: 1px;">协调者收到所有参与者的ack消息，事务回滚完成。</span></p></li></ul><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQmNtJwdtL6HicL9feSUJRjb3OUxa84q2UuTXYeA5KeiaXT1djYDzmQEBJw/640?wx_fmt=png" data-type="png" data-w="734" style="text-align: center;box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5006784260515604" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQmEwXzImXJwssmH5QP9zYptJKuLRAN04FX8STbQUwl8Ze6PnV7UV1YsQ/640?wx_fmt=png" data-type="png" data-w="737" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">43、Flink 如何保证 Exactly-Once 语义？</span></p></blockquote></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">Flink通过两阶段提交协议来保证Exactly-Once语义。<br  /></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(255, 0, 0);"><strong><span style="font-size: 14px;">对于Source端：</span></strong></span><span style="font-size: 14px;">Source端严格一次处理比较简单，因为数据要进入Flink 中，所以Flink 只需要保存消费数据的偏移量 （offset）即可。如果Source端为 kafka，Flink 将 Kafka Consumer 作为 Source，可以将偏移量保存下来，如果后续任务出现了故障，恢复的时候可以由连接器重置偏移量，重新消费数据，保证一致性。</span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(255, 0, 0);"><strong><span style="font-size: 14px;">对于 Sink 端：</span></strong></span><span style="font-size: 14px;">Sink 端是最复杂的，因为数据是落地到其他系统上的，数据一旦离开 Flink 之后，Flink 就监控不到这些数据了，所以严格一次处理语义必须也要应用于 Flink 写入数据的外部系统，</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">故这些外部系统必须提供一种手段允许提交或回滚这些写入操作</span></strong><span style="font-size: 14px;">，同时还要保证与 Flink Checkpoint 能够协调使用（</span><span style="color: rgb(0, 128, 255);"><strong><span style="font-size: 14px;">Kafka 0.11 版本已经实现精确一次处理语义</span></strong></span><span style="font-size: 14px;">）。</span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;"><br  />我们以&nbsp;</span><span style="font-size: 14px;color: rgb(255, 76, 0);"><strong>Kafka - Flink -Kafka&nbsp;</strong></span><span style="font-size: 14px;">为例 说明如何保证Exactly-Once语义。</span></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5208333333333334" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQmhiaHuNPJkQGJG4ODOLktPpPRoo3QXY1QFmgffRV8RjV8snefv2K6bzg/640?wx_fmt=png" data-type="png" data-w="1056" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">如上图所示：Flink作业包含以下算子。<br  /></span></p><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（1）一个Source算子，从Kafka中读取数据（即KafkaConsumer）<br  /></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（2）一个窗口算子，基于时间窗口化的聚合运算（即window+window函数）<br  /></span></section><section style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">（3）一个Sink算子，将结果写会到Kafka（即kafkaProducer）<br  /></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink使用两阶段提交协议&nbsp;</span><span style="font-size: 14px;color: rgb(255, 76, 0);"><strong>预提交（Pre-commit）</strong></span><span style="font-size: 14px;">阶段和&nbsp;</span><strong><span style="font-size: 14px;color: rgb(255, 76, 0);">提交（Commit）阶段保证端到端严格一次。</span></strong></span></p><section style="margin-bottom: 20px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="color: rgb(122, 79, 214);letter-spacing: 1px;"><strong><span style="color: rgb(122, 79, 214);font-size: 14px;">（1）预提交阶段</span></strong></span></section><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(255, 76, 0);"><strong><span style="font-size: 14px;">1、当Checkpoint 启动时，进入预提交阶段</span></strong></span><span style="font-size: 14px;">，JobManager 向Source Task 注入检查点分界线（CheckpointBarrier）,Source Task 将 CheckpointBarrier 插入数据流，向下游广播开启本次快照，如下图所示：</span><br  /></span></section><p style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.52465483234714" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQmafNFQwLrLNEmmW0rtjWhwQJNhQ5cCPy5dmRdVTzGHiaOGnY5cNJD8Aw/640?wx_fmt=png" data-type="png" data-w="1014" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(136, 136, 136);font-family: PingFangSC-Light;font-size: 12px;word-spacing: 2px;letter-spacing: 1px;">预处理阶段：&nbsp; Checkpoint 启动</span></p><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(255, 76, 0);"><strong>2、Source 端：</strong></span><strong><span style="font-size: 14px;color: rgb(255, 76, 0);">Flink Data Source 负责保存 KafkaTopic&nbsp;的 offset偏移量</span></strong><span style="font-size: 14px;">，当 Checkpoint 成功时 Flink 负责提交这些写入，否则就终止取消掉它们，当 Checkpoint 完成位移保存，它会将 checkpoint barrier（检查点分界线） 传给下一个 Operator，然后每个算子会对当前的状态做个快照，保存到</span><strong><span style="font-size: 14px;color: rgb(255, 76, 0);">状态后端（State Backend）</span></strong><span style="font-size: 14px;">。</span></span></section><p style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);font-size: 14px;">对于 Source 任务而言，就会把当前的 offset 作为状态保存起来。下次从 Checkpoint 恢复时，Source 任务可以重新提交偏移量，从上次保存的位置开始重新消费数据，如下图所示：</span></strong></span></p><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.55599603567889" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQmlIFIYiaGYKYnPRyYbRQUbUQmkSzJjK3oBWAiaznTbMOkm709gd72DS4w/640?wx_fmt=png" data-type="png" data-w="1009" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(136, 136, 136);font-family: PingFangSC-Light;font-size: 12px;word-spacing: 2px;letter-spacing: 1px;">预处理阶段：checkpoint barrier传递&nbsp;及 offset 保存</span></p><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 128, 255);">3、Slink 端：</span></strong><span style="font-size: 14px;">从 Source 端开始，每个内部的 transformation 任务遇到 checkpoint barrier（检查点分界线）时，都会把状态存到 Checkpoint 里。数据处理完毕到 Sink 端时，Sink 任务首先把数据写入外部 Kafka，</span><strong><span style="font-size: 14px;color: rgb(255, 76, 0);">这些数据都属于预提交的事务（还不能被消费）</span></strong><span style="font-size: 14px;">，</span><span style="font-size: 14px;color: rgb(0, 128, 255);"><strong>此时的 Pre-commit 预提交阶段下Data Sink 在保存状态到状态后端的同时还必须预提交它的外部事务，</strong></span><span style="font-size: 14px;">如下图所示：</span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5499505440158259" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQmWX5n11eqricV4IQG5QCiabU7P1XaPftBuGaYibgXsiaY6E242R9uryUGrA/640?wx_fmt=png" data-type="png" data-w="1011" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(136, 136, 136);font-family: PingFangSC-Light;font-size: 12px;word-spacing: 2px;letter-spacing: 1px;">预处理阶段：预提交到外部系统</span></p><section style="margin-bottom: 20px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="color: rgb(122, 79, 214);letter-spacing: 1px;"><strong><span style="color: rgb(122, 79, 214);font-size: 14px;">（2）提交阶段</span></strong></span></section><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(255, 76, 0);"><strong><span style="font-size: 14px;">4、当所有算子任务的快照完成</span></strong></span><span style="font-size: 14px;">（所有创建的快照都被视为是 Checkpoint 的一部分），</span><strong><span style="font-size: 14px;color: rgb(255, 76, 0);">也就是这次的 Checkpoint 完成时</span></strong><span style="font-size: 14px;">，</span><span style="font-size: 14px;color: rgb(255, 76, 0);"><strong>JobManager 会向所有任务发通知，确认这次 Checkpoint 完成，此时 Pre-commit 预提交阶段才算完成</strong></span><span style="font-size: 14px;">。才正式到两阶段提交协议的</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">第二个阶段：</span></strong><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">commit 阶段</span></strong><span style="font-size: 14px;">。该阶段中 JobManager 会为应用中每个 Operator 发起 Checkpoint 已完成的回调逻辑。</span><br  /></span></section><p style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><br  /></p><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">本例中的 Data Source 和窗口操作无外部状态，因此在该阶段，这两个 Opeartor 无需执行任何逻辑，</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">但是 Data Sink 是有外部状态的，此时我们必须提交外部事务</span></strong><span style="font-size: 14px;">，当 Sink 任务收到确认通知，就会正式提交之前的事务，Kafka 中未确认的数据就改为“已确认”，数据就真正可以被消费了，如下图所示：</span></span></section><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5483234714003945" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQmajNJ6wia4Tib8kzoXwaelwJRVmL0bXRgR4QmaXXKxwrDLqlCl0oMoquQ/640?wx_fmt=png" data-type="png" data-w="1014" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(136, 136, 136);font-family: PingFangSC-Light;font-size: 12px;word-spacing: 2px;letter-spacing: 1px;">提交阶段：数据精准被消费</span></p><section style="margin-bottom: 10px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">注：Flink 由 JobManager 协调各个 TaskManager 进行 Checkpoint 存储，Checkpoint 保存在 StateBackend（状态后端） 中，默认 StateBackend 是内存级的，也可以改为文件级的进行持久化保存。</span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p><span style="font-size: 14px;letter-spacing: 1px;">44、数的很好，很清楚，那你对Flink 端到端&nbsp;严格一次Exactly-Once 语义做个总结</span></p></blockquote></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><img data-ratio="1.152057245080501" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8N7XsMqPjpLr6lrjbiaenJQmPWAr0UFoMKhAJCBCHfJVM1yu7jkyZrQotQggAOCvgVJRP3IxytHPag/640?wx_fmt=png" data-type="png" data-w="559"  /></span></section><section style="margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">如果觉得阿周讲解的知识点还满意的话，请关注公众号：</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>3分钟秒懂大数据</strong></span><span style="font-size: 14px;">，获取更多，更全面的技术博文。并加博主微信：</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">threeknowbigdata，</span></strong><span style="font-size: 14px;">拉你进大数据交流群。</span></span></section><p style="white-space: normal;text-align: center;"><img data-ratio="0.9967177242888403" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MS3ZsmzMtdMIMxYj0ZXuknFsp5ic4phuhV8VibbOOKMnMurNPibvNRILGaTXEmiavHof6xBxAcGQ0R9w/640?wx_fmt=png" data-type="png" data-w="914" style="height: 172px;width: 173px;"  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">45、Flink广播机制了解吗？</span></p></blockquote></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;letter-spacing: 1px;">如下图所示：</span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5305084745762711" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjicxLwreaRRE5MY1L4sGaLzwFR6KM2gicZpJLj9fRvn7rhJibJ4eM8oswQ/640?wx_fmt=png" data-type="png" data-w="590"  /></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(64, 64, 64);font-size: 14px;text-align: left;">（1）从图中可以理解&nbsp;</span><span style="font-size: 14px;text-align: left;color: rgb(217, 33, 66);"><strong>广播</strong></span><span style="color: rgb(64, 64, 64);font-size: 14px;text-align: left;">&nbsp;就是一个</span><strong><span style="font-size: 14px;text-align: left;color: rgb(217, 33, 66);">公共的共享变量，</span></strong><span style="color: rgb(64, 64, 64);font-size: 14px;text-align: left;">广播变量是发给</span><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;text-align: left;">TaskManager的内存中，</span></strong></span><span style="color: rgb(64, 64, 64);font-size: 14px;text-align: left;">所以广播变量不应该太大，将一个数据集广播后，不同的</span><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;text-align: left;">Task</span></strong></span><span style="color: rgb(64, 64, 64);font-size: 14px;text-align: left;">都可以在节点上获取到，每个节点只存一份。&nbsp;如果不使用广播，每一个Task都会拷贝一份数据集，造成内存资源浪费&nbsp;&nbsp;。</span></span></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">46、Flink反压了解吗？</span></p></blockquote></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">反压（backpressure）是实时计算应用开发中，特别是流式计算中，十分常见的问题。</span><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);">反压</span></strong><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">意味着数据管道中某个节点成为瓶颈，</span><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);"><strong>下游处理速率&nbsp;</strong></span><span style="color: rgb(0, 82, 255);"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">跟不上&nbsp;</span></strong></span><span style="color: rgb(217, 33, 66);"><strong><span style="text-align: left;font-size: 14px;line-height: 1.74;outline-style: none;">上游发送数据的速率</span></strong></span><span style="text-align: left;font-size: 14px;color: rgb(64, 64, 64);line-height: 1.74;outline-style: none;">，而需要对上游进行限速。由于实时计算应用通常使用消息队列来进行生产端和消费端的解耦，消费端数据源是 pull-based 的，所以反压通常是从某个节点传导至数据源并降低数据源（比如 Kafka consumer）的摄入速率。</span></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">简单来说就是<span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: left;line-height: 1.74;outline-style: none;color: rgb(217, 33, 66);"><strong>下游处理速率&nbsp;</strong></span><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 82, 255);"><strong><span style="font-size: 14px;text-align: left;line-height: 1.74;outline-style: none;">跟不上&nbsp;</span></strong></span><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;text-align: left;line-height: 1.74;outline-style: none;">上游发送数据的速率</span></strong></span>，<span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">下游来不及消费，导致队列被占满后，上游的生产会被阻塞，最终导致数据源的摄入被阻塞。</span></span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">47、Flink反压的影响有哪些？</span></p></blockquote></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;">反压会影响到两项指标:</span><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;color: rgb(217, 33, 66);"><strong>&nbsp;checkpoint 时长</strong></span><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;">和</span><strong><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;color: rgb(0, 82, 255);">&nbsp;state 大小</span></strong></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">（1）前者是因为 checkpoint barrier 是不会越过普通数据的，</span><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);color: rgb(0, 82, 255);"><strong>数据处理被阻塞</strong></span><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">也会</span><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">导致</span></strong></span><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">&nbsp;checkpoint barrier 流经</span><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);color: rgb(217, 33, 66);"><strong>整个数据管道的时长变长</strong></span><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">，因而 checkpoint 总体时间（End to End Duration）变长。</span></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">（2）后者是因为为保证 EOS（Exactly-Once-Semantics，准确一次），对于有两个以上输入管道的 Operator，checkpoint barrier 需要对齐（Alignment），接受到较快的输入管道的 barrier 后，它后面数据会被缓存起来但不处理，直到较慢的输入管道的 barrier 也到达，这些被缓存的数据会被放到state 里面，导致 checkpoint 变大。</span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><br  /></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">这两个影响对于生产环境的作业来说是十分危险的</span></strong></span><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">，因为 checkpoint 是保证数据一致性的关键，checkpoint 时间变长有可能导致 checkpoint 超时失败，而 state 大小同样可能拖慢 checkpoint 甚至导致 OOM （使用 Heap-based StateBackend）或者物理内存使用超出容器资源（使用 RocksDBStateBackend）的稳定性问题。</span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">48、Flink反压如何解决？</span></p></blockquote></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">Flink社区提出了 FLIP-76: Unaligned Checkpoints[4]&nbsp;</span><span style="background-color: rgb(255, 255, 255);color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;text-align: start;">来解耦反压和 checkpoint。</span></span></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">（1）定位反压节点</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">要解决反压首先要做的是定位到造成反压的节点，这主要有两种办法:</span></p><ol class="list-paddingleft-2" style="width: 577.412px;white-space: normal;"><li style="letter-spacing: 1px;"><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);font-size: 14px;">通过</span><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">&nbsp;Flink Web UI 自带的反压监控面板；</span></span></p></li><li style="letter-spacing: 1px;"><p style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">通过 Flink Task Metrics。</span></p></li></ol><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="color: rgb(255, 76, 65);letter-spacing: 1px;"><strong><span style="color: rgb(255, 76, 65);font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">（1）反压监控面板</span></strong></span></p><section style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">Flink Web UI 的反压监控提供了 SubTask 级别的反压监控，原理是通过周期性对 Task 线程的栈信息采样，得到线程被阻塞在请求 Buffer（意味着被下游队列阻塞）的频率来判断该节点是否处于反压状态。默认配置下，这个频率在 0.1 以下则为 OK，0.1 至 0.5 为 LOW，而超过 0.5 则为 HIGH。</span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.7541984732824427" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjial4qibpZTql4SORxKDCfD4rVLy3OFO2uDcwunVBtrXxSDbC2FwMiarxw/640?wx_fmt=png" data-type="png" data-w="655"  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><br  /></span></p><p style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);">（2）Task Metrics</span></strong></span></p><p style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">Flink 提供的 Task Metrics 是更好的反压监控手段</span></p><p style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">如果一个 Subtask 的发送端 Buffer 占用率很高，则表明它被下游反压限速了；</span></p><p style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">如果一个 Subtask 的接受端 Buffer 占用很高，则表明它将反压传导至上游。<br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">49、Flink支持的数据类型有哪些？</span></p></blockquote></section><p style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">Flink支持的数据类型如下图所示：</span></p><p style="margin-bottom: 16px;white-space: normal;outline: 0px;font-size: 16px;color: rgb(77, 77, 77);overflow: auto hidden;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;background-color: rgb(255, 255, 255);line-height: 26px !important;"><img data-ratio="0.5721757322175732" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjckLFEtM7u9GbrJAgOb6GxNb8ZKgsbBtiaHqia5fen2YKUI0HDFhEm8vQ/640?wx_fmt=png" data-type="png" data-w="956" style="box-sizing: border-box;outline: none;border-width: 0px;border-style: initial;border-color: initial;cursor: zoom-in;"  /></p><p style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">从图中可以看到 Flink 类型可以分为基础类型（Basic）、数组（Arrays）、复合类型（Composite）、辅助类型（Auxiliary）、泛型和其它类型（Generic）。Flink 支持任意的 Java 或是 Scala 类型。&nbsp;</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">50、Flink如何进行序列和反序列化的？</span></p></blockquote></section><section style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;letter-spacing: 1px;">所谓序列化和反序列化的含义：</span></section><section style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">序列化：</span></strong></span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">就是将一个内存对象转换成二进制串，形成网络传输或者持久化的数据流。</span></span></section><section style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(2, 30, 170);"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">反序列化：</span></strong></span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">将二进制串转换为内存对。</span></span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><strong><span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;background-color: rgb(255, 255, 255);color: rgb(255, 76, 65);"><span style="font-size: 14px;outline: 0px;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">TypeInformation 是 Flink 类型系统的核心类</span><span style="font-size: 14px;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">&nbsp;</span></span></strong></span></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-family: 等线;font-weight: bold;font-size: 14px;">在Flink中，当数据需要进行序列化时，会使用TypeInformation的</span><span style="font-family: 等线;font-weight: bold;font-size: 14px;color: rgb(255, 76, 65);">生成序列化器</span><span style="font-family: 等线;font-weight: bold;font-size: 14px;">接口调用一个 createSerialize() 方法，</span><span style="font-family: 等线;font-size: 14px;font-weight: bold;">创建出TypeSerializer，</span><span style="font-family: 等线;font-size: 14px;font-weight: 700;">TypeSerializer</span><span style="font-family: 等线;font-size: 14px;font-weight: bold;">提供了序列化和反序列化能力。如下图所示：Flink 的序列化过程</span></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 16px;font-family: 等线;font-weight: bold;letter-spacing: 1px;"><img data-ratio="0.7037974683544304" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjOzvmK3ELRjfLW1Hs6jsa6cibF8eEP9XZQ0KQtJMesHS8gT2EGBCxoAQ/640?wx_fmt=png" data-type="png" data-w="790"  /></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-family: 等线;font-weight: bold;font-size: 14px;">对于大多数数据类型&nbsp;</span><span style="font-family: 等线;font-weight: bold;font-size: 14px;color: rgb(255, 76, 65);">Flink 可以自动生成对应的序列化器</span><span style="font-family: 等线;font-weight: bold;font-size: 14px;">，能非常高效地对数据集进行序列化和反序列化 ，</span><strong><span style="font-family: 等线;font-size: 14px;color: rgb(255, 76, 65);">如下图：</span></strong></span></p><p style="white-space: normal;"><span style="font-family: 等线;font-weight: bold;font-size: 14px;letter-spacing: 1px;"><img data-ratio="0.6086286594761171" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjbn6qdria0Jd1r7lk7xbHdsvn3DpjywoB40dh2ialeEWCrlQyBic3zkmDA/640?wx_fmt=png" data-type="png" data-w="649"  /></span></p><p style="white-space: normal;"><span style="font-family: 等线;font-weight: bold;font-size: 14px;letter-spacing: 1px;">比如，BasicTypeInfo、WritableTypeIno ，但针对 GenericTypeInfo 类型，Flink 会使用 Kyro 进行序列化和反序列化。其中，Tuple、Pojo 和 CaseClass 类型是复合类型，它们可能嵌套一个或者多个数据类型。在这种情况下，它们的序列化器同样是复合的。它们会将内嵌类型的序列化委托给对应类型的序列化器。</span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="color: rgb(0, 82, 255);font-family: 等线;font-size: 14px;font-weight: bold;letter-spacing: 1px;">通过一个案例介绍Flink序列化和反序列化：<br  /></span></p><p style="white-space: normal;"><span style="font-size: 16px;font-family: 等线;font-weight: bold;letter-spacing: 1px;"><img data-ratio="0.4485549132947977" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjKycmynxZ48SBoT7tGQWduKPgGo3eN7VtRsLVTstA4vxAU3r9bL8GJg/640?wx_fmt=png" data-type="png" data-w="865"  /></span></p><p style="white-space: normal;"><span style="font-family: 等线;font-weight: bold;font-size: 14px;letter-spacing: 1px;">如上图所示，当创建一个Tuple 3 对象时，包含三个层面，一是 int 类型，一是 double 类型，还有一个是 Person。Person对象包含两个字段，一是 int 型的 ID，另一个是 String 类型的 name，</span></p><p style="white-space: normal;"><span style="font-family: 等线;font-weight: bold;font-size: 14px;letter-spacing: 1px;">（1）在序列化操作时，会委托相应具体序列化的序列化器进行相应的序列化操作。从图中可以看到 Tuple 3 会把 int 类型通过 IntSerializer 进行序列化操作，此时 int 只需要占用四个字节。</span></p><p style="white-space: normal;"><span style="font-family: 等线;font-weight: bold;font-size: 14px;letter-spacing: 1px;">（2）Person 类会被当成一个 Pojo 对象来进行处理，PojoSerializer 序列化器会把一些属性信息使用一个字节存储起来。同样，其字段则采取相对应的序列化器进行相应序列化，在序列化完的结果中，可以看到所有的数据都是由 MemorySegment 去支持。&nbsp;</span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-family: 等线;font-size: 14px;">MemorySegment 具有什么作用呢？</span></strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-family: 等线;font-weight: bold;font-size: 14px;letter-spacing: 1px;">MemorySegment 在 Flink 中会将对象序列化到预分配的内存块上，它代表 1 个固定长度的内存，默认大小为 32 kb。MemorySegment 代表 Flink 中的一个最小的内存分配单元，相当于是 Java 的一个 byte 数组。每条记录都会以序列化的形式存储在一个或多个 MemorySegment 中。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">51、为什么Flink使用自主内存而不用JVM内存管理？</span></p></blockquote></section><section style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">因为在内存中存储大量的数据 （包括缓存和高效处理）时，JVM会面临很多问题，包括如下：<br  /></span></section><p style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">JVM 内存管理的不足：&nbsp;</span></p><p style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">1）Java 对象存储密度低。</span></strong></span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">Java 的对象在内存中存储包含 3 个主要部分：对象头、实例 数据、对齐填充部分。例如，一个只包含 boolean 属性的对象占 16byte：对象头占 8byte， boolean 属性占 1byte，为了对齐达到 8 的倍数额外占 7byte。而实际上只需要一个 bit（1/8 字节）就够了。</span></span></p><p style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(0, 82, 255);"><strong>2）Full GC 会极大地影响性能。</strong></span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">尤其是为了处理更大数据而开了很大内存空间的 JVM 来说，GC 会达到秒级甚至分钟级。</span></span></p><p style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(122, 79, 214);">3）OOM 问题影响稳定性。</span></strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">OutOfMemoryError 是分布式计算框架经常会遇到的问题， 当JVM中所有对象大小超过分配给JVM的内存大小时，就会发生OutOfMemoryError错误， 导致 JVM 崩溃，分布式框架的健壮性和性能都会受到影响。</span></span></p><p style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(255, 76, 65);">4）缓存未命中问题。</span></strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">CPU 进行计算的时候，是从 CPU 缓存中获取数据。现代体系的 CPU 会有多级缓存，而加载的时候是以 Cache Line 为单位加载。如果能够将对象连续存储， 这样就会大大降低 Cache Miss。使得 CPU 集中处理业务，而不是空转。</span><br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">52、那Flink自主内存是如何管理对象的？</span></p></blockquote></section><section style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">Flink 并不是将大量对象存在堆内存上，而是将对象都序列化到一个预分配的内存块上， 这个内存块叫做</span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(255, 76, 65);"><strong>&nbsp;MemorySegment</strong></span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">，它代表了一段固定长度的内存（默认大小为 32KB），也 是&nbsp;</span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(255, 76, 65);"><strong>Flink 中最小的内存分配单元</strong></span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">，并且提供了非常高效的读写方法，很多运算可以直接操作 二进制数据，不需要反序列化即可执行。每条记录都会以序列化的形式存储在一个或多个 MemorySegment 中。如果需要处理的数据多于可以保存在内存中的数据，Flink 的运算符会 将部分数据溢出到磁盘</span></span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">53、Flink内存模型介绍一下？</span></p></blockquote></section><section style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">Flink总体内存类图如下：</span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5043290043290043" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjoaQX85ibqM9g60sFefcibx7YH4wbbXn2rq5CUQxNqfQGZpE4CcYhLA8g/640?wx_fmt=png" data-type="png" data-w="462"  /></p><section style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">主要包含</span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(255, 76, 65);"><strong>JobManager内存模型</strong></span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">和&nbsp;</span><span style="color: rgb(2, 30, 170);"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">TaskManager内存模型</span></strong></span><br  /></span></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="font-size: 15px;color: rgb(255, 76, 65);letter-spacing: 1px;"><strong><span style="font-size: 15px;color: rgb(255, 76, 65);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;background-color: rgb(255, 255, 255);">JobManager内存模型</span></strong><br  /></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.4140127388535032" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjz5EU34NEj0TXB8u9ibTnQiazAuib5d7PxbLmL1tGVEH1BYHGCMLKPgHOQ/640?wx_fmt=png" data-type="png" data-w="471"  /></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">在 1.10 中，Flink 统一了 TM 端的内存管理和配置，相应的在 1.11 中，Flink 进一步 对 JM 端的内存配置进行了修改，使它的选项和配置方式与 TM 端的配置方式保持一致。</span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.3407202216066482" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjGcgspiatpjfLc7IPylzWuoHCoiazTgJE2DYziaFNd4iavL1OVNPeibFvKXw/640?wx_fmt=png" data-type="png" data-w="722"  /></p><p style="white-space: normal;"><br  /></p><p style="margin-bottom: 10px;white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="color: rgb(2, 30, 170);font-size: 15px;letter-spacing: 1px;"><strong><span style="color: rgb(2, 30, 170);font-size: 15px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;background-color: rgb(255, 255, 255);">TaskManager内存模型</span></strong></span></p><section style="margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(255, 76, 65);"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">Flink 1.10</span></strong></span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">&nbsp;对 TaskManager 的内存模型和 Flink 应用程序的配置选项进行了</span><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(255, 76, 65);">重大更改</span></strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">， 让用户能够更加严格地控制其内存开销。</span></span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5779036827195467" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjrU7yWMj3WlpWib2wZWvTvgMcWib56nbshMMos59VibVYHxiaYkiagY66ib7w/640?wx_fmt=png" data-type="png" data-w="1059"  /></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.7227101631116688" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjNquMecQcwB2bcA0BRacKpIgoPymjRy2PN8FXh1KoxtrAEZR9LJib67A/640?wx_fmt=png" data-type="png" data-w="797"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="color: rgb(255, 76, 65);letter-spacing: 1px;"><strong><span style="color: rgb(255, 76, 65);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">JVM Heap：JVM 堆上内存&nbsp;</span></strong></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">1、Framework Heap Memory：</span></strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">Flink 框架本身使用的内存，即 TaskManager 本身所 占用的堆上内存，不计入 Slot 的资源中。&nbsp;</span></span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">配置参数：taskmanager.memory.framework.heap.size=128MB,默认 128MB</span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">2、Task Heap Memory：</span></strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">Task 执行用户代码时所使用的堆上内存。</span></span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">配置参数：taskmanager.memory.task.heap.size</span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(255, 76, 65);letter-spacing: 1px;"><strong>Off-Heap Mempry：JVM 堆外内存&nbsp;</strong></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">1、DirectMemory：JVM 直接内存</span></strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">&nbsp;</span></span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">1）Framework Off-Heap Memory：Flink框架本身所使用的内存，即TaskManager 本身所占用的对外内存，不计入 Slot 资源。</span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">配置参</span><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">数：</span><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(214, 214, 214);font-size: 13px;color: rgb(255, 76, 65);">taskmanager.memory.framework.off-heap.size=128MB</span><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 13px;">，</span><span style="color: rgb(0, 0, 0);font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(255, 255, 255);font-size: 14px;">默认 128</span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">MB&nbsp;</span></span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">2）Task Off-Heap Memory：Task 执行用户代码所使用的对外内存。</span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">&nbsp;配置参数：</span><span style="font-family: &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;text-align: left;background-color: rgb(214, 214, 214);font-size: 13px;color: rgb(255, 76, 65);">taskmanager.memory.task.off-heap.size=0</span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">,默认 0&nbsp;</span></span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">3）Network Memory：网络数据交换所使用的堆外内存大小，如网络数据交换 缓冲区&nbsp;</span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">2、Managed Memory：Flink 管理的堆外内存</span></strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">，</span></span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">用于排序、哈希表、缓存中间结果及 RocksDB State Backend 的本地内存。</span></p><p style="white-space: normal;"><br  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(255, 76, 65);letter-spacing: 1px;"><strong>JVM specific memory：JVM 本身使用的内存&nbsp;</strong></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">1、JVM metaspace：JVM 元空间&nbsp;</span></strong></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">2、JVM over-head 执行开销：</span></strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">JVM 执行时自身所需要的内容，包括线程堆栈、IO、 编译缓存等所使用的内存。</span></span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">配置参数：taskmanager.memory.jvm-overhead.min=192mb</span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">taskmanager.memory.jvm-overhead.max=1gb&nbsp;</span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">taskmanager.memory.jvm-overhead.fraction=0.1&nbsp;</span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);color: rgb(255, 76, 65);"><strong>总体内存</strong></span><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">&nbsp;</span></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">1、总进程内存：</span></strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">Flink Java 应用程序（包括用户代码）和 JVM 运行整个进程所消 耗的总内存。</span></span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">总进程内存 = Flink 使用内存 + JVM 元空间 + JVM 执行开销&nbsp;</span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">配置项：taskmanager.memory.process.size: 1728m</span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">2、Flink 总内存：</span></strong><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">仅 Flink Java 应用程序消耗的内存，包括用户代码，但不包括 JVM 为其运行而分配的内存。</span></span></p><p style="white-space: normal;"><span style="color: rgb(18, 18, 18);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);letter-spacing: 1px;">Flink 使用内存：框架堆内外 + task 堆内外 + network + manage</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">54、Flink如何进行资源管理的？</span></p></blockquote></section><section style="white-space: normal;text-align: start;letter-spacing: 0.544px;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);">Flink在资源管理上可以分为两层：</span><strong style="color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">集群资源</strong><span style="color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);">和</span><strong style="color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">自身资源</strong><span style="color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);">。集群资源支持主流的资源管理系统，如yarn、mesos、k8s等，也支持独立启动的standalone集群。自身资源涉及到每个子task的资源使用，由Flink自身维护。</span></span></section><h2 style="margin-top: 10px;margin-bottom: 10px;list-style-type: none;list-style-image: none;font-size: 21px;font-weight: bold;line-height: 1.5;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>1 集群架构剖析</strong></span></h2><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>&nbsp;</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">Flink的运行主要由 客户端、一个JobManager（后文简称JM）和 一个以上的TaskManager（简称TM或Worker）组成。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages" data-ratio="0.725" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/4PPc462eOOPtdLVtNgBOmakV7gaElDPTvakOegRvHhmpegLicqDBKNtvXfLLSl5Rpib5vNgYyFLwc1icOMwkeguxg/640?wx_fmt=png" data-type="png" data-w="880" style="border-width: initial;border-style: none;border-color: initial;max-width: 700px;cursor: zoom-in;margin-top: 10px;margin-bottom: 10px;transition: transform 0.3s cubic-bezier(0.2, 0, 0.2, 1) 0s !important;"  /></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>客户端</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">客户端主要用于提交任务到集群，在Session或Per Job模式中，客户端程序还要负责解析用户代码，生成JobGraph；在Application模式中，直接提交用户jar和执行参数即可。客户端一般支持两种模式：detached模式，客户端提交后自动退出。attached模式，客户端提交后阻塞等待任务执行完毕再退出。&nbsp;</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>JobManager</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>&nbsp;</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">JM负责决定应用何时调度task，在task执行结束或失败时如何处理，协调检查点、故障恢复。该进程主要由下面几个部分组成：</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>1 ResourceManager</strong>，负责资源的申请和释放、管理slot（Flink集群中最细粒度的资源管理单元）。Flink实现了多种RM的实现方案以适配多种资源管理框架，如yarn、mesos、k8s或standalone。在standalone模式下，RM只能分配slot，而不能启动新的TM。注意：这里所说的RM跟Yarn的RM不是一个东西，这里的RM是JM中的一个独立的服务。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>2 Dispatcher</strong>，提供Flink提交任务的rest接口，为每个提交的任务启动新的JobMaster，为所有的任务提供web ui，查询任务执行状态。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>3 JobMaster</strong>，负责管理执行单个JobGraph，多个任务可以同时在一个集群中启动，每个都有自己的JobMaster。注意这里的JobMaster和JobManager的区别。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>TaskManager</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>&nbsp;</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">TM也叫做worker，用于执行数据流图中的任务，缓存并交换数据。集群至少有一个TM，TM中最小的资源管理单元是Slot，每个Slot可以执行一个Task，因此TM中slot的数量就代表同时可以执行任务的数量。</span></p><h2 style="margin-top: 10px;margin-bottom: 10px;list-style-type: none;list-style-image: none;font-size: 21px;font-weight: bold;line-height: 1.5;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></h2><h2 style="margin-top: 10px;margin-bottom: 10px;list-style-type: none;list-style-image: none;font-size: 21px;font-weight: bold;line-height: 1.5;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">2 Slot与资源管理</span></h2><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">每个TM是一个独立的JVM进程，内部基于独立的线程执行一个或多个任务。TM为了控制每个任务的执行资源，使用task slot来进行管理。每个task slot代表TM中的一部分固定的资源，比如一个TM有3个slot，每个slot将会得到TM的1/3内存资源。不同任务之间不会进行资源的抢占，注意GPU目前没有进行隔离，目前slot只能划分内存资源。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">比如下面的数据流图，在扩展成并行流图后，同一的task可能分拆成多个任务并行在集群中执行。操作链可以把多个不同的任务进行合并，从而支持在一个线程中先后执行多个任务，无需频繁释放申请线程。同时操作链还可以统一缓存数据，增加数据处理吞吐量，降低处理延迟。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">在Flink中，想要不同子任务合并需要满足几个条件：下游节点的入边是1（保证不存在数据的shuffle）；子任务的上下游不为空；连接策略总是ALWAYS；分区类型为ForwardPartitioner；并行度一致；当前Flink开启Chain特性。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages" data-ratio="0.66721044045677" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/4PPc462eOOPtdLVtNgBOmakV7gaElDPTXN1Q6BekV4CqDgOfXXCiaTTDtldjiaG4LIN7g5nibyqUPeM1iaYeicoZehA/640?wx_fmt=png" data-type="png" data-w="613" style="border-width: initial;border-style: none;border-color: initial;max-width: 700px;margin-top: 10px;margin-bottom: 10px;"  /></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">在集群中的执行图可能如下：</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages" data-ratio="0.327991452991453" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/4PPc462eOOPtdLVtNgBOmakV7gaElDPT5dYqyKgqJxNlOGw0YMBwkwOVORmyW6OyppAuDIffKnh69oE9WtF9ibw/640?wx_fmt=png" data-type="png" data-w="936" style="border-width: initial;border-style: none;border-color: initial;max-width: 700px;cursor: zoom-in;margin-top: 10px;margin-bottom: 10px;transition: transform 0.3s cubic-bezier(0.2, 0, 0.2, 1) 0s !important;"  /></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">Flink也支持slot的共享，即把不同任务根据任务的依赖关系分配到同一个Slot中。这样带来几个好处：方便统计当前任务所需的最大资源配置（某个子任务的最大并行度）；避免Slot的过多申请与释放，提升Slot的使用效率。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages" data-ratio="0.47103004291845496" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/4PPc462eOOPtdLVtNgBOmakV7gaElDPTTSwSq9CZjOiakD8d1b5PtyaFlbKnGU4OG0F15KczhG79EgzZuicWyxgg/640?wx_fmt=png" data-type="png" data-w="932" style="border-width: initial;border-style: none;border-color: initial;max-width: 700px;cursor: zoom-in;margin-top: 10px;margin-bottom: 10px;transition: transform 0.3s cubic-bezier(0.2, 0, 0.2, 1) 0s !important;"  /></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">通过Slot共享，就有可能某个Slot中包含完整的任务执行链路。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;</span></p><h2 style="margin-top: 10px;margin-bottom: 10px;list-style-type: none;list-style-image: none;font-size: 21px;font-weight: bold;line-height: 1.5;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>3 应用执行</strong></span></h2><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>&nbsp;</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">一个Flink应用就是用户编写的main函数，其中可能包含一个或多个Flink的任务。这些任务可以在本地执行，也可以在远程集群启动，集群既可以长期运行，也支持独立启动。下面是目前支持的任务提交方案：</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>Session集群</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>&nbsp;</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>生命周期</strong>：集群事先创建并长期运行，客户端提交任务时与该集群连接。即使所有任务都执行完毕，集群仍会保持运行，除非手动停止。因此集群的生命周期与任务无关。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>资源隔离</strong>：TM的slot由RM申请，当上面的任务执行完毕会自动进行释放。由于多个任务会共享相同的集群，因此任务间会存在竞争，比如网络带宽等。如果某个TM挂掉，上面的所有任务都会失败。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>其他方面</strong>：拥有提前创建的集群，可以避免每次使用的时候过多考虑集群问题。比较适合那些执行时间很短，对启动时间有比较高的要求的场景，比如交互式查询分析。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>Per Job集群</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>&nbsp;</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>生命周期</strong>：为每个提交的任务单独创建一个集群，客户端在提交任务时，直接与ClusterManager沟通申请创建JM并在内部运行提交的任务。TM则根据任务运行需要的资源延迟申请。一旦任务执行完毕，集群将会被回收。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>资源隔离</strong>：任务如果出现致命问题，仅会影响自己的任务。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>其他方面</strong>：由于RM需要申请和等待资源，因此启动时间会稍长，适合单个比较大、长时间运行、需要保证长期的稳定性、不在乎启动时间的任务。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>Application集群</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>&nbsp;</strong></span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>生命周期</strong>：与Per Job类似，只是main()方法运行在集群中。任务的提交程序很简单，不需要启动或连接集群，而是直接把应用程序打包到资源管理系统中并启动对应的EntryPoint，在EntryPoint中调用用户程序的main()方法，解析生成JobGraph，然后启动运行。集群的生命周期与应用相同。</span></p><p style="margin: 10px auto;list-style-type: none;list-style-image: none;color: rgb(68, 68, 68);font-family: Tahoma, Arial, Helvetica, sans-serif;font-size: 14px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>资源隔离</strong>：RM和Dispatcher是应用级别。&nbsp;</span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section data-mpa-template="t" mpa-from-tpl="t"><section style="display: flex;justify-content: center;align-items: center;width: 100%;" data-mid="" mpa-from-tpl="t"><section style="display: flex;justify-content: flex-start;align-items: center;flex-direction: column;" data-mid="" mpa-from-tpl="t"><section style="display: flex;justify-content: center;align-items: center;" data-mid="" mpa-from-tpl="t"><section style="width: 27px;margin-right: 3px;" data-mid="" mpa-from-tpl="t"><img data-ratio="0.9629629629629629" src="https://mmbiz.qpic.cn/mmbiz_png/DiaLG0VOfnEibU5UwN5aic6Ez0obyBiapEUbCdUnqu7yuwQVF8mfAkNOux6iatlI7gtN9IgWHVIhy1pibiapFW89HzTRw/640?wx_fmt=png" data-type="png" data-w="54" style="display: block;"  /></section><section style="height: 28px;background: rgba(206, 226, 255, 0.53);text-align: center;padding-right: 7px;padding-left: 11px;" data-mid="" mpa-from-tpl="t"><p style="font-size: 16px;font-family: PingFangSC-Semibold, PingFang SC;font-weight: bold;color: #1D6EEA;line-height: 28px;letter-spacing: 3px;" data-mid=""><span style="letter-spacing: 1px;">03、Flink 源码篇</span></p></section></section><section style="display: flex;justify-content: center;align-items: center;justify-content: space-between;width: 100%;margin-top: 4px;" data-mid="" mpa-from-tpl="t"><section style="width: 60%;height: 1px;background-color: #5698FC;" data-mid="" mpa-from-tpl="t"><br  /></section><section style="width: 10%;height: 1px;background-color: #5698FC;" data-mid="" mpa-from-tpl="t"><br  /></section></section></section></section></section><p><br  /></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.7893129770992366" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PqALZbh7IQstylo5PALv6BpJ6wiapx6MrnzV2XsjehwDrZFeFRYiaibO3Z5O6xrgOmeoQLPhmNeA1FA/640?wx_fmt=png" data-type="png" data-w="655" style=""  /></p><p><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">55、<span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;text-align: left;word-spacing: 2px;background-color: rgb(227, 242, 253);">FLink作业提交流程应该了解吧？</span></span></p></blockquote></section><p style="white-space: normal;"><span style="color: rgb(255, 76, 65);letter-spacing: 1px;"><strong><span style="color: rgb(255, 76, 65);font-size: 15px;">Flink的提交流程：</span></strong><br  /></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">1.在Flink Client中，通过反射启动jar中的main函数，生成Flink StreamGraph和JobGraph，将JobGraph提交给Flink集群</span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">2.Flink集群收到JobGraph（JobManager收到）后，将JobGraph翻译成ExecutionGraph,然后开始调度，启动成功之后开始消费数据。</span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">总结来说：Flink核心执行流程，对用户API的调用可以转为 StreamGraph --&gt;JobGraph -- &gt;&nbsp; ExecutionGraph。</span></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">56、FLink作业提交分为几种方式？</span></p></blockquote></section><p style="white-space: normal;"><span style="color: rgb(255, 76, 65);letter-spacing: 1px;"><strong><span style="color: rgb(255, 76, 65);font-size: 15px;">Flink的作业提交分为两种方式</span></strong><br  /></span></p><p style="white-space: normal;"><br  /></p><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 14px;">1.Local 方式：</span></strong></span><span style="font-size: 14px;">即本地提交模式，直接在IDEA运行代码。</span></span></p><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 14px;">2.远程提交方式：</span></strong></span><span style="font-size: 14px;">分为Standalone方式、yarn方式、K8s方式</span></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 14px;">Yarn 方式分为三种提交模式：</span></strong></span><span style="font-size: 14px;">Yarn-perJob模式、Yarn-Sessionmo模式、Yarn-Application模式</span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">57、FLink JobGraph是在什么时候生成的？</span></p></blockquote></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">StreamGraph、JobGraph全部是在Flink Client 客户端生成的，即提交集群之前生成，原理图如下：</span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.2534908700322234" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqar0RsdHAFugHDNtY0XZg1qfIOB1sttsjHxEyG5TVlXa6uokrjgeqxw/640?wx_fmt=png" data-type="png" data-w="931"  /></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">58、那在jobGraph提交集群之前都经历哪些过程？</span></p></blockquote></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">（1）用户通过启动Flink集群，使用命令行提交作业，运行 flink run -c&nbsp;&nbsp;WordCount&nbsp; xxx.jar</span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">（2）运行命令行后，会通过run脚本调用CliFrontend入口，CliFrontend会触发用户提交的jar文件中的main方法，然后交给PipelineExecuteor # execute方法，最终根据提交的模式选择触发一个具体的PipelineExecutor执行。</span></p><section style="margin: 10px 16px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">（3）根据具体的PipelineExecutor执行，将对用户的代码进行编译生成streamGraph，经过优化后生成jobgraph。<br  /></span></section><p style="white-space: normal;"><span style="color: rgb(255, 76, 65);letter-spacing: 1px;"><strong><span style="color: rgb(255, 76, 65);font-size: 14px;">具体流程图如下：</span></strong><br  /></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.26500461680517085" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXq8dbnzGUs62NZE5T9sSiaia168kOMuT57mUZnG7BlkrMibliafc8nzZ8P7g/640?wx_fmt=png" data-type="png" data-w="1083"  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">59、看你提到PipeExecutor，它有哪些实现类？</span></p></blockquote></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（1）<span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;word-spacing: 2px;background-color: rgb(227, 242, 253);">PipeExecutor&nbsp;</span>在Flink中被叫做 流水线执行器，它是一个接口，是</span><span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;word-spacing: 2px;background-color: rgb(227, 242, 253);">Flink Client</span><span style="font-size: 14px;">生成</span><span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;word-spacing: 2px;background-color: rgb(227, 242, 253);">JobGraph</span><span style="font-size: 14px;">&nbsp;之后，将作业提交给集群的重要环节，前面说过，作业提交到集群有好几种方式，最常用的是</span><span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;word-spacing: 2px;background-color: rgb(227, 242, 253);">yarn</span><span style="font-size: 14px;">方式，</span><span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;word-spacing: 2px;background-color: rgb(227, 242, 253);">yarn</span><span style="font-size: 14px;">方式包含<span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;word-spacing: 2px;background-color: rgb(227, 242, 253);">3</span>种提交模式，主要使用&nbsp;</span><span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;word-spacing: 2px;background-color: rgb(227, 242, 253);">session</span><span style="font-size: 14px;">模式，</span><span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;word-spacing: 2px;background-color: rgb(227, 242, 253);">perjob</span><span style="font-size: 14px;">模式。Application模式 jaobGraph是在集群中生成。</span></span></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">所以</span><span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;text-align: left;word-spacing: 2px;background-color: rgb(227, 242, 253);">PipeExecutor</span><span style="font-size: 14px;">&nbsp;的实现类如下图所示：（在代码中按</span><span style="color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;text-align: left;word-spacing: 2px;background-color: rgb(227, 242, 253);">CTRL+H</span><span style="font-size: 14px;">就会出来）</span></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.32611464968152865" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXq5AN8Y7INMSCqjXIKTKfVb3RoVcU0maK8trm8yqs8hVQjHmg8SpAQTw/640?wx_fmt=png" data-type="png" data-w="785"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">除了上述框的两种模式外，在IDEA环境中运行Flink MiniCluster 进行调试时，使用LocalExecutor。<br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">60、Local提交模式有啥特点，怎么实现的？</span></p></blockquote></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">（1）<span style="font-size: 14px;color: rgb(0, 0, 0);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;word-spacing: 2px;background-color: rgb(227, 242, 253);">Local</span>是在本地IDEA环境中运行的提交方式。不上集群。主要用于调试，原理图如下：</span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5570866141732284" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqvCnianNI4wwxicBqe3hgu6kUS4gPv7HJt2VrMZbxvstRFib5LswZxqrYQ/640?wx_fmt=png" data-type="png" data-w="508"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">1. Flink程序由JobClient进行提交&nbsp;</span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">2. JobClient将作业提交给JobManager&nbsp;</span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">3. JobManager负责协调资源分配和作业执行。资源分配完成后，任务将提交给相应的TaskManager</span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">4. TaskManager启动一个线程开始执行，TaskManager会向JobManager报告状态更改，如开始执 行，正在进行或者已完成。&nbsp;</span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">5. 作业执行完成后，结果将发送回客户端。</span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(255, 76, 65);font-size: 15px;"><strong>源码分析：</strong></span><span style="font-size: 15px;color: rgb(2, 30, 170);"><strong>通过Flink1.12.2源码进行分析的</strong></span><br  /></span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（1）创建获取对应的StreamExecutionEnvironment对象</span></strong><span style="font-size: 14px;">：LocalStreamEnvironment</span></span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">调用StreamExecutionEnvironment对象的execute方法<br  /></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.07890365448504984" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqvzDJnuxEmxPRmpscZBPjLQYxFjyuVUiajgcbAUEa6h8vcfbukCt8uvg/640?wx_fmt=png" data-type="png" data-w="1204"  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.7582417582417582" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqdarN8Lnj4IysVicu3owo4MicFDulmfkhGA2bJpwpwKNPpxTvAlC9fpJQ/640?wx_fmt=png" data-type="png" data-w="91" style="height: 42px;width: 56px;"  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.08264462809917356" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqwQV6r9GhIl4NBSicgmCwBvRvmL82AiaHoiaqGyEHBlf5iaeEhqIPEdL5Vw/640?wx_fmt=png" data-type="png" data-w="847"  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.7582417582417582" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqdarN8Lnj4IysVicu3owo4MicFDulmfkhGA2bJpwpwKNPpxTvAlC9fpJQ/640?wx_fmt=png" data-type="png" data-w="91" style="height: 42px;width: 56px;"  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.12861736334405144" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqZmTQDLVR0yM7EvLKTODcrQ72ib596lOmRf6BeC7vRU3YMN0gJd4zVtg/640?wx_fmt=png" data-type="png" data-w="933"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（2）获取streamGraph</span></strong></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.14878397711015737" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqkRUB5EG78LK8zTH2hXnRGJq0gNwRpN8AQes4GMPOfacDeF6icEvEMtg/640?wx_fmt=png" data-type="png" data-w="1398"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（3）执行具体的PipeLineExecutor - &gt;得到localExecutorFactory</span></strong><br  /></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.22336769759450173" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXq8gjEHdia9Sf7dJkztiby98WCicPkh19Wa9MQ58qRTVeTOcibDk8RX67w0w/640?wx_fmt=png" data-type="png" data-w="1164"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">(4)&nbsp;获取JobGraph<br  /></span></strong></span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">根据localExecutorFactory的实现类LocalExecutor生成JobGraph</span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.18244803695150116" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqEQtT2RNOw3mTYAFQ5pq87aCXXNsyZkkLDSAg4ZsytvwlLdibGWhdrRA/640?wx_fmt=png" data-type="png" data-w="1299"  /></p><section style="margin-top: 10px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">上面这部分全部是在Flink Client生成的，由于是使用Local模式提交。所有接下来将创建MiniCluster集群，由miniCluster.submitJob指定要提交的jobGraph</span></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（5）实例化MiniCluster集群</span></strong></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.2240875912408759" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqSbfbe9OLmeSrfZWHChwaEoADwstWqUJicPuCS3oHxq3dbyjNtnQN0BA/640?wx_fmt=png" data-type="png" data-w="1370"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（6）返回JobClient 客户端</span></strong><br  /></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;">在上面执行<span style="font-size: 14px;">miniCluster.submitJob 将JobGraph提交到本地集群后，会返回一个JobClient客户端，该JobClient包含了应用的一些详细信息，包括JobID,应用的状态等等。最后返回到代码执行的上一层，对应类为StreamExecutionEnvironment。</span></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.22332506203473945" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqmsbSDWicT7ibWTM7hdN0lN1aUEW8aIQKsMedX2vnjicAAHWibxloVGZrVw/640?wx_fmt=png" data-type="png" data-w="806"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="color: rgb(255, 76, 65);letter-spacing: 1px;"><strong><span style="color: rgb(255, 76, 65);font-size: 14px;">以上就是Local模式的源码执行过程。</span></strong><br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">61、远程提交模式都有哪些？</span></p></blockquote></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 14px;">远程提交方式：</span></strong></span><span style="font-size: 14px;">分为Standalone方式、yarn方式、K8s方式</span></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">Standalone：</span></strong><span style="font-size: 14px;">包含session模式<br  /></span></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(122, 79, 214);"><strong><span style="font-size: 14px;">Yarn 方式分为三种提交模式：</span></strong></span><span style="font-size: 14px;">Yarn-perJob模式、Yarn-Sessionmo模式、Yarn-Application模式。</span></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">K8s方式：</span></strong><span style="font-size: 14px;">包含 session模式<br  /></span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">62、Standalone模式简单介绍一下？</span></p></blockquote></section><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">Standalone 模式为Flink集群的单机版提交方式，只使用一个节点进行提交，常用Session模式。<br  /></span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">作业提交原理图如下：</span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5382215288611545" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqY0crtUsgWojkoCFxQURnqXZP2kS8ZokYPNZ4HHHicpibnKEibkzKzYJ6w/640?wx_fmt=png" data-type="png" data-w="641"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">提交命令如下：</span></p><pre data-tool="mdnice编辑器" style="margin-top: 10px;margin-bottom: 10px;outline: 0px;color: rgb(0, 0, 0);font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><code style="padding: 15px 16px 16px;outline: 0px;overflow-x: auto;color: rgb(171, 178, 191);display: -webkit-box;font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;font-size: 12px;background: rgb(40, 44, 52);border-radius: 5px;"><span style="white-space: pre-wrap;letter-spacing: 1px;">bin/flink run org.apache.flink.WordCount xxx.jar</span></code></pre><ol class="list-paddingleft-2" style="width: 577.412px;white-space: normal;"><li style="letter-spacing: 1px;"><p><span style="font-size: 14px;letter-spacing: 1px;">client客户端提交任务给JobManager</span></p></li><li style="letter-spacing: 1px;"><p><span style="font-size: 14px;letter-spacing: 1px;">JobManager负责申请任务运行所需要的资源并管理任务和资源，</span></p></li><li style="letter-spacing: 1px;"><p><span style="font-size: 14px;letter-spacing: 1px;">JobManager分发任务给TaskManager执行</span></p></li><li style="letter-spacing: 1px;"><p><span style="font-size: 14px;letter-spacing: 1px;">TaskManager定期向JobManager汇报状态</span></p></li></ol><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">63、yarn集群提交方式介绍一下？</span></p></blockquote></section><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">通过yarn集群提交分为3种提交方式：分别为session模式、perjob模式、application模式</span></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">64、yarn - session模式特点？</span></p></blockquote></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">提交命令如下：</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">./bin/flink run -t yarn-session \</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">-Dyarn.application.id=application_XXXX_YY&nbsp;&nbsp;xxx.jar</span></span></code></pre></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">Yarn-Session模式：</span></strong><span style="font-size: 14px;">所有</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>作业共享集群资源</strong></span><span style="font-size: 14px;">，隔离性差，JM负载瓶颈，main方法在客户端执行。适合执行时间短，频繁执行的短任务，集群中的所有作业&nbsp;</span><span style="font-size: 14px;color: rgb(122, 79, 214);"><strong>只有一个JobManager</strong></span><span style="font-size: 14px;">，另外，</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>Job被随机分配给TaskManager</strong></span></span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><strong style="color: rgb(217, 33, 66);"><span style="font-size: 14px;">特点：</span></strong><br  /></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(2, 30, 170);"><strong><span style="font-size: 14px;">Session-Cluster模式需要先启动集群</span></strong></span><span style="font-size: 14px;">，</span><strong><span style="font-size: 14px;color: rgb(0, 122, 170);">然后再提交作业</span></strong><span style="font-size: 14px;">，接着会向yarn申请一块空间后，资源永远保持不变。如果资源满了，下一个作业就无法提交，只能等到 yarn中的其中一个作业执行完成后，释放了资源，下个作业才会正常提交。所有作业共享Dispatcher和ResourceManager；共享资源；适合规模小执行时间短的 作业。</span></span></p><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><strong style="color: rgb(217, 33, 66);"><span style="font-size: 14px;">原理图如下：</span></strong></span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqaIjEIIf6xBH40odQwgLIib1XZsfpmsvjdvH6ia3kBqricL92aFK0qLFTw/640?wx_fmt=png" data-type="png" data-w="792"  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">65、yarn - perJob模式特点？</span><strong style="color: rgb(51, 51, 51);font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 17px;text-align: justify;"></strong></span></p></blockquote></section><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">提交命令：</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">./bin/flink&nbsp;run&nbsp;-t&nbsp;yarn-per-job&nbsp;--detached&nbsp; xxx.jar</span></span></code></pre></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">Yarn-Per-Job模式：</span></strong><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>每个作业单独启动集群</strong></span><span style="font-size: 14px;">，隔离性好，JM负载均衡，main方法在客户端执行。在per-job模式下，每个Job都有一个JobManager，每个TaskManager只有单个Job。</span></span></p><p style="white-space: normal;"><br  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><strong style="color: rgb(217, 33, 66);"><span style="font-size: 14px;">特点：</span></strong></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 122, 170);">一个任务会对应一个Job</span></strong><span style="font-size: 14px;">，<strong>每提交一个作业</strong>会根据自身的情况，</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">都会单独向yarn申请资源</span></strong><span style="font-size: 14px;">，直到作业执行完成，一个作业的失败与否并不会影响下一个作业的正常提交和运行。独享Dispatcher 和 ResourceManager，按需接受资源申请；</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>适合规模大长时间运行的作业。</strong></span></span></p><p style="white-space: normal;"><br  /></p><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><strong style="color: rgb(217, 33, 66);"><span style="font-size: 14px;">原理图如下：</span></strong></span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.4918444165621079" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqkiaPxyWbwa39iceTHsP0UicEIUYicyj8AKf5drzqMxia10yDoIE7BVHMuSg/640?wx_fmt=png" data-type="png" data-w="797"  /></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">66、yarn - application模式特点？</span></p></blockquote></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">提交命令如下：</span></strong></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">./bin/flink&nbsp;run-application&nbsp;-t&nbsp;yarn-application&nbsp;xxx.jar</span></span></code></pre></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">Yarn-Application模式：</span></strong><span style="font-size: 14px;">每个作业单独启动集群，隔离性好，JM负载均衡，</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>main方法在JobManager上执行</strong></span><span style="font-size: 14px;">。</span></span></p><p style="white-space: normal;"><br  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">特点：</span></strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">在yarn-per-job 和 yarn-session模式下，客户端都需要执行以下三步，即：&nbsp;</span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">1、获取作业所需的依赖项；&nbsp;</span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">2、通过执行环境分析并取得逻辑计划，即StreamGraph→JobGraph；</span></p><section style="margin-bottom: 10px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">3、将依赖项和JobGraph上传到集群中。&nbsp;</span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.25774225774225773" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXqgdAvYDfTha5qqp5pSrwQwopbfq5mmjqQFSklxqkORILGcvTrAhoTicQ/640?wx_fmt=png" data-type="png" data-w="1001"  /></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">只有在这些都完成之后，才会通过env.execute()方法 触发 Flink运行时真正地开始执行作业。</span><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;">如果所有用户都在同一个客户端上提交作业</span></strong></span><span style="font-size: 14px;">，</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">较大的依赖会消耗更多的带宽</span></strong><span style="font-size: 14px;">，而较复杂的作业逻辑翻译成JobGraph也需要吃掉更多的CPU和内存，</span><strong><span style="font-size: 14px;color: rgb(2, 30, 170);">客户端的资源反而会成为瓶颈</span></strong><span style="font-size: 14px;">。</span></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">为了解决它，社区在传统部署模式的基础上实现了 Application模式。原本需要客户端做的三件事被转移到了JobManager里，也就是说main()方法在集群中执行(入口点位于 ApplicationClusterEntryPoint )，客 户端只需要负责发起部署请求了</span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><strong style="color: rgb(217, 33, 66);"><span style="font-size: 14px;">原理图如下：</span></strong></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.36271529888551163" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MauL9NX2cnb4iaby5dyibvXq74s0jPYGblp6PwAs4aqSDGnZsjymFL1l4SDI6SvQvrIic1uwNBEDKibg/640?wx_fmt=png" data-type="png" data-w="987"  /></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="color: rgb(122, 79, 214);font-size: 15px;letter-spacing: 1px;"><strong>综上所述，Flink社区比较推荐使用 yarn-perjob &nbsp;或者 yarn-application模式进行提交应用。</strong></span></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">67、yarn - session 提交流程详细介绍一下？</span></p></blockquote></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">提交流程图如下：</span></strong></span></p><p style="white-space: normal;text-align: center;"><img data-ratio="0.47160493827160493" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1x6jBJVCMD8q3VlhqeCOMZstf38pEibGHibvUowa2kianpwbxkuIwxBupA/640?wx_fmt=png" data-type="png" data-w="1215"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="font-size: 16px;letter-spacing: 1px;"><strong>1、启动集群</strong><br  /></span></p><section style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(217, 33, 66);font-size: 14px;letter-spacing: 1px;"><strong>（1）Flink Client向Yarn ResourceManager提交任务信息。</strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;1）Flink Client将应用配置（Flink-conf.yaml、logback.xml、log4j.properties）和相关文件（Flink Jar、配置类文件、用户Jar文件、JobGraph对象等）上传至分布式存储HDFS中。</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;2）Flink Client向Yarn ResourceManager提交任务信息<br  /></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">（2）Yarn 启动 Flink集群，做2步操作：</span></strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp; 1)&nbsp;</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">通过Yarn Client 向Yarn &nbsp;ResourceManager提交Flink创建集群的申请</span></strong><span style="font-size: 14px;color: rgb(0, 0, 0);">，Yarn ResourceManager 分配Container 资源，并通知对应的NodeManager上启动一个ApplicationMaster(每提交一个flink job 就会启动一个applicationMaster)，ApplicationMaster会包含当前要启动的 JobManager和 Flink自己内部要使用的ResourceManager。</span></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp; 2）在JobManager 进程中运行</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>YarnSessionClusterEntryPoint</strong></span><span style="font-size: 14px;color: rgb(0, 0, 0);">&nbsp;作为集群启动的入口。初始化Dispatcher，Flink自己内部要使用的ResourceManager，启动相关RPC服务，等待Flink Client 通过Rest接口提交JobGraph。</span></span></section><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong style="font-size: 16px;">2、作业提交</strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);font-size: 14px;"><strong>（3）Flink Client 通过Rest 向Dispatcher 提交编译好的JobGraph。</strong></span><span style="font-size: 14px;">Dispatcher 是 Rest 接口，不负责实际的调度、指定工作。</span></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);font-size: 14px;"><strong>（4）<strong>Dispatcher&nbsp;收到&nbsp;<strong>JobGraph</strong>&nbsp;后，为作业创建一个JobMaster，将工作交给JobMaster，</strong></strong></span><span style="font-size: 14px;color: rgb(0, 0, 0);">JobMaster负责作业调度，管理作业和Task的生命周期</span><span style="color: rgb(217, 33, 66);font-size: 14px;"><strong>，构建ExecutionGraph（</strong></span><span style="font-size: 14px;color: rgb(0, 0, 0);">JobGraph的并行化版本，调度层最核心的数据结构<strong><strong style="color: rgb(217, 33, 66);">）</strong></strong></span></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(122, 79, 214);letter-spacing: 1px;"><strong><span style="color: rgb(122, 79, 214);font-size: 14px;">以上两步执行完后，作业进入调度执行阶段。</span></strong></span></p><p style="white-space: normal;"><br  /></p><section style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 16px;letter-spacing: 1px;"><strong>3、作业调度执行</strong></span></section><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(217, 33, 66);font-size: 14px;letter-spacing: 1px;"><strong>（5）JobMaster向ResourceManager申请资源，<span style="font-size: 14px;color: rgb(0, 0, 0);">开始调度ExecutionGraph。</span></strong></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（6）ResourceManager将资源请求加入等待队列，通过心跳向YarnResourceManager申请新的Container来启动TaskManager进程。</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（7）YarnResourceManager启动，然后从HDFS加载Jar文件等所需相关资源，在容器中启动TaskManager，TaskManager启动TaskExecutor</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（8）TaskManager启动后,向ResourceManager 注册，并把自己的Slot资源情况汇报给ResourceManager。</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（9）ResourceManager从等待队列取出Slot请求，向TaskManager确认资源可用情况，并告知TaskManager将Slot分配给哪个JobMaster。</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（10）TaskManager向JobMaster回复自己的一个Slot属于你这个任务，JobMaser会将Slot缓存到SlotPool。<br  /></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（11）JobMaster调度Task到TaskMnager的Slot上执行。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">68、yarn - perjob 提交流程详细介绍一下？</span></p></blockquote></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">提交命令如下：</span></strong></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">./bin/flink run -t yarn-per-job --detached  xxx.jar</span></span></code></pre></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">提交流程图如下所示：</span></strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5064039408866995" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1yhicOVNFyxuMicNTNgYmV3ptRRbs8qiaGLzEa4MT7QRF5f7YOd4pploIQ/640?wx_fmt=png" data-type="png" data-w="1015"  /></p><p style="white-space: normal;"><br  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="font-size: 16px;letter-spacing: 1px;"><strong>1、启动集群</strong><br  /></span></p><section style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(217, 33, 66);font-size: 14px;letter-spacing: 1px;"><strong>（1）Flink Client向Yarn ResourceManager提交任务信息。</strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;1）Flink Client将应用配置（Flink-conf.yaml、logback.xml、log4j.properties）和相关文件（Flink Jar、配置类文件、用户Jar文件、JobGraph对象等）上传至分布式存储HDFS中。</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;2）Flink Client向Yarn ResourceManager提交任务信息<br  /></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">（2）Yarn 启动 Flink集群，做2步操作：</span></strong></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp; 1)&nbsp;</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">通过Yarn Client 向Yarn &nbsp;ResourceManager提交Flink创建集群的申请</span></strong><span style="font-size: 14px;color: rgb(0, 0, 0);">，Yarn ResourceManager 分配Container 资源，并通知对应的NodeManager上启动一个ApplicationMaster(每提交一个Flink job 就会启动一个ApplicationMaster)，ApplicationMaster会包含当前要启动的 JobManager和 Flink自己内部要使用的ResourceManager。</span></span></section><section style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 0, 0);">&nbsp; &nbsp; &nbsp; &nbsp; 2）在JobManager 进程中运行</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>YarnJobClusterEntryPoint&nbsp;</strong></span><span style="font-size: 14px;color: rgb(0, 0, 0);">作为集群启动的入口。初始化Dispatcher，Flink自己内部要使用的ResourceManager，启动相关RPC服务，等待Flink Client 通过Rest接口提交JobGraph。</span></span></section><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong style="font-size: 16px;">2、作业提交</strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);font-size: 14px;"><strong>（3）ApplicationMaster启动Dispatcher，<strong>Dispatcher</strong>启动ResourceManager和JobMaster</strong></span><strong><span style="font-size: 14px;color: rgb(0, 0, 0);">(该步和Session不同，Jabmaster是由Dispatcher拉起，而不是Client传过来的)。</span></strong><span style="font-size: 14px;color: rgb(0, 0, 0);">JobMaster负责作业调度，管理作业和Task的生命周期</span><span style="color: rgb(217, 33, 66);font-size: 14px;"><strong>，构建ExecutionGraph（</strong></span><span style="font-size: 14px;color: rgb(0, 0, 0);">JobGraph的并行化版本，调度层最核心的数据结构<strong><strong style="color: rgb(217, 33, 66);">）</strong></strong></span></span></p><p style="white-space: normal;line-height: 1.75em;"><br  /></p><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(122, 79, 214);letter-spacing: 1px;"><strong><span style="color: rgb(122, 79, 214);font-size: 14px;">以上两步执行完后，作业进入调度执行阶段。</span></strong></span></p><p style="white-space: normal;"><br  /></p><section style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 16px;letter-spacing: 1px;"><strong>3、作业调度执行</strong></span></section><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(217, 33, 66);font-size: 14px;letter-spacing: 1px;"><strong>（4）JobMaster向ResourceManager申请Slot资源，<span style="font-size: 14px;color: rgb(0, 0, 0);">开始调度ExecutionGraph。</span></strong></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（5）ResourceManager将资源请求加入等待队列，通过心跳向YarnResourceManager申请新的Container来启动TaskManager进程。</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（6）YarnResourceManager启动，然后从HDFS加载Jar文件等所需相关资源，在容器中启动TaskManager。<br  /></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（7）TaskManager在内部启动TaskExecutor。<br  /></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（8）TaskManager启动后,向ResourceManager 注册，并把自己的Slot资源情况汇报给ResourceManager。</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（9）ResourceManager从等待队列取出Slot请求，向TaskManager确认资源可用情况，并告知TaskManager将Slot分配给哪个JobMaster。</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（10）TaskManager向JobMaster回复自己的一个Slot属于你这个任务，JobMaser会将Slot缓存到SlotPool。<br  /></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（11）JobMaster调度Task到TaskMnager的Slot上执行。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">69、流图、作业图、执行图三者区别？</span></p></blockquote></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">Flink内部Graph总览图，由于现在Flink&nbsp;实行流批一体代码，Batch API基本废弃，就不过多介绍&nbsp;<br  /></span></strong></span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: left;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">在Flink DataStramAPI 中，Graph内部转换图如下：</span></strong></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.7396449704142012" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1cPicmAb3ibRZ871T5uFiaAvLZmaRPicWd2H7gE6JxA1UibdXAWIWziaYicFlQ/640?wx_fmt=png" data-type="png" data-w="676"  /></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">以WordCount为例，流图、作业图、执行图、物理执行图之间的Task调度如下：</span></strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.36445108289768485" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1blCofxNmF97uA71Z1Fnib7LYKnbNv0gCZicOKwDEcz8eh29Xb3X7Xeibw/640?wx_fmt=png" data-type="png" data-w="1339"  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.33856502242152464" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1CbZ4zlHpbdvKUKcKWkGHQcqvM6D2qic2Zpg2Lq0CWZIvFibcMuUdBiaMw/640?wx_fmt=png" data-type="png" data-w="1338"  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.33805970149253733" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1cCyRj5ZxicPCJm8yK8bBVkVnDNX9dB5THA4TjrSaoKCBORa6NTmkQfw/640?wx_fmt=png" data-type="png" data-w="1340"  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><br  /></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">对于Flink 流计算应用，运行用户代码时，首先调用DataStream API&nbsp;，将用户代码转换为&nbsp;</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>Transformation</strong></span><span style="font-size: 14px;">，然后经过：</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">StreamGraph</span></strong><span style="font-size: 14px;">-&gt;</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">JobGraph</span></strong><span style="font-size: 14px;">-&gt;</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>ExecutionGraph</strong></span><span style="font-size: 14px;">&nbsp;3层转换（这些都是Flink内置的数据结构），最后经过Flink调度执行，在Flink 集群中启动计算任务，形成一个</span><span style="font-size: 14px;color: rgb(61, 167, 66);"><strong>物理执行图</strong></span><span style="font-size: 14px;">。</span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">70、流图介绍一下？</span></p></blockquote></section><p style="white-space: normal;"><span style="font-size: 15px;color: rgb(217, 33, 66);letter-spacing: 1px;"><strong>（1）流图&nbsp; StreamGraph</strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.174512987012987" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1dm0IYEFibSd1Sia2aYbia2doeuYaWPAdY4pCMxWiafagQu5ZrUH1psibsmA/640?wx_fmt=png" data-type="png" data-w="1232"  /></p><section style="margin-top: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">流图StreamGraph 核心对象包括两个：</span><span style="font-size: 14px;color: rgb(255, 76, 0);"><strong>StreamNode 点&nbsp;和&nbsp;</strong></span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>StreamEdge 边</strong></span></span></section><p style="margin-top: 10px;white-space: normal;"><span style="font-size: 14px;color: rgb(255, 76, 0);letter-spacing: 1px;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;1）StreamNode 点</strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(255, 76, 0);"><strong>StreamNode&nbsp;点</strong></span><span style="font-size: 14px;">&nbsp;，从 Transformation转换而来，可以简单理解为</span><span style="font-size: 14px;color: rgb(255, 76, 0);"><strong>&nbsp;StreamNode</strong></span><span style="font-size: 14px;"><strong>&nbsp;</strong>表示一个算子，存在实体和虚拟，可以有多个输入和输出，实体</span><span style="font-size: 14px;color: rgb(255, 76, 0);"><strong>StreamNode</strong></span><span style="font-size: 14px;"><strong>&nbsp;</strong>最终变成物理算子，虚拟的附着在</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>StreamEdge 边</strong></span><span style="font-size: 14px;"><strong><span style="color: rgb(0, 122, 170);">&nbsp;</span></strong>上。</span></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 82, 255);letter-spacing: 1px;"><strong>&nbsp;&nbsp;&nbsp;&nbsp;2）</strong><strong>StreamEdge 边</strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;"><strong style="color: rgb(0, 82, 255);">StreamEdge 是&nbsp;<strong style="color: rgb(217, 33, 66);font-size: 15px;">StreamGraph&nbsp;的边，</strong></strong>用来连接两个StreamNode 点，一个StreamEdge可以有多个出边、入边等信息。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">71、作业图介绍一下？</span></p></blockquote></section><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;"><strong style="color: rgb(217, 33, 66);font-size: 15px;">（2）作业图&nbsp; JobGraph</strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 0, 0);">JobGraph是由StreamGraph优化而来，是通过</span><strong><span style="font-size: 14px;color: rgb(0, 0, 0);">OperationChain&nbsp;</span></strong><span style="font-size: 14px;color: rgb(0, 0, 0);">机制将算子合并起来，在执行时，调度在同一个Task线程上，避免数据的跨线程，跨网络传递。</span></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.36910569105691055" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae17DnY0PImvcq3X5WZuR5oIRsLzvK5FU2ibdVWxkeb1Quic1QdpQynu5YQ/640?wx_fmt=png" data-type="png" data-w="1230"  /></p><section style="margin-top: 10px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">作业图JobGraph 核心对象包括三个：</span></section><section style="margin-top: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(255, 76, 0);font-size: 14px;">JobVertex&nbsp;点</span></strong><span style="font-size: 14px;color: rgb(255, 76, 0);"><strong>&nbsp;、&nbsp;</strong></span><span style="color: rgb(0, 82, 255);font-size: 14px;"><strong>Job</strong><strong>Edge 边</strong></span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>、</strong></span><span style="font-size: 14px;color: rgb(122, 79, 214);"><strong>IntermediateDataSet&nbsp;中间数据集</strong></span></span></section><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(255, 76, 0);">1）JobVertex&nbsp;点</span></strong>&nbsp;</span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">经过算子融合优化后符合条件的多个StreamNode&nbsp;可能会融合在一起生成一个 JobVertex，即一个JobVertex&nbsp;包含一个或多个算子，&nbsp;</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>JobVertex&nbsp;的输入是 JobEdge.&nbsp;</strong></span><span style="font-size: 14px;color: rgb(122, 79, 214);"><strong>输出是</strong></span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>&nbsp;<strong style="color: rgb(122, 79, 214);">IntermediateDataSet&nbsp;</strong></strong></span></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;"><strong style="color: rgb(0, 82, 255);">2）</strong></span><strong style="font-size: 14px;color: rgb(0, 82, 255);">Job</strong><strong style="font-size: 14px;color: rgb(0, 82, 255);">Edge 边</strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;"><strong style="color: rgb(0, 82, 255);">Job</strong><strong style="color: rgb(0, 82, 255);">Edge&nbsp;</strong>表示 JobGraph 中的一 个数据流转通道， 其上游数据源是&nbsp;<strong style="color: rgb(217, 33, 66);"><strong style="color: rgb(122, 79, 214);">IntermediateDataSet&nbsp;</strong></strong>，下游消费者是&nbsp;<strong style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;color: rgb(255, 76, 0);">JobVertex&nbsp;</span></strong></strong>。</span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;"><strong style="color: rgb(0, 82, 255);">Job</strong><strong style="color: rgb(0, 82, 255);">Edge&nbsp;</strong>中的数据分发模式会直接影响执行时 Task 之间的数据连接关系是</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">点对点连接</span></strong><span style="font-size: 14px;">还是</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>全连接</strong></span><span style="font-size: 14px;">。</span></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;"><strong style="color: rgb(122, 79, 214);">3）</strong><strong style="color: rgb(122, 79, 214);">IntermediateDataSet&nbsp;中间数据集</strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">中间数据集&nbsp;<strong style="color: rgb(122, 79, 214);">IntermediateDataSet&nbsp;</strong>&nbsp;是一种逻辑结构.用来表示&nbsp;<strong style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;color: rgb(255, 76, 0);">JobVertex&nbsp;</span></strong></strong>的输出，即该 JobVertex 中包含的算子会产生的数据集。不同的执行模式下，其对应的结果分区类型不同，决 定了在执行时刻数据交换的模式。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">72、执行图介绍一下？</span></p></blockquote></section><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);font-size: 14px;">（3）执行图&nbsp; ExecutionGraph</span></strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong style="color: rgb(0, 82, 255);">ExecutionGraph</strong>是调度Flink 作业执行的核心数据结构，包含了作业中所有并行执行的Task信息、Task之间的关联关系、数据流转关系。</span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">StreamGraph 和JobGraph都在Flink Client生成，然后交给Flink集群。JobGraph到ExecutionGraph在JobMaster中 完成，转换过程中重要变化如下：<br  /></span></p><section style="margin-top: 10px;white-space: normal;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-size: 14px;">1）加入了并行度的概念，成为真正可调度的图结构。</span></strong><br  /></span></section><p style="margin-top: 10px;white-space: normal;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-size: 14px;">2）生成了6个核心对象。</span></strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5004625346901017" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1tTsZtpe1BJKv1nk95Npw1AnlfWrSCKibUSyl7TzqPcfWArdkCSosfNg/640?wx_fmt=png" data-type="png" data-w="1081"  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><br  /></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 0, 0);">执行图ExecutionGraph 核心对象包括6个：</span></strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">ExecutionJobVertex、ExecutionVertex、IntermediateResult、IntermediateResultPartition、ExecutionEdge、Execution。</span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-size: 14px;">1）ExecutionJobVertex</span></strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">该对象和 JobGraph 中的 JobVertex 一 一对应。该对象还包含一组&nbsp;ExecutionVertex， 数量 与该 JobVertex 中所包含的StreamNode&nbsp;的并行度一致，假设&nbsp;StreamNode&nbsp;的并行度为5 ，那么<strong style="color: rgb(217, 33, 66);">ExecutionJobVertex</strong>中也会包含 5个<strong>ExecutionVertex</strong>。</span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong style="color: rgb(217, 33, 66);">ExecutionJobVertex</strong>用来将一个JobVertex&nbsp;封装成&nbsp;<strong><strong style="color: rgb(217, 33, 66);">ExecutionJobVertex</strong></strong>，并依次创建&nbsp;ExecutionVertex、Execution、IntermediateResult 和&nbsp;&nbsp;IntermediateResultPartition，用于丰富<strong>ExecutionGraph。</strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">2）ExecutionVertex</span></strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong style="color: rgb(217, 33, 66);">ExecutionJobVertex</strong>会对作业进行并行化处理，构造可以并行执行的实例，每一个并行执行的实例就是&nbsp;<strong><span style="font-size: 14px;color: rgb(0, 82, 255);">ExecutionVertex</span></strong>。</span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">3）IntermediateResult</span></strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">IntermediateResult</span></strong>&nbsp;又叫作中间结果集，该对象是个逻辑概念 表示&nbsp;<strong style="color: rgb(217, 33, 66);">ExecutionJobVertex</strong>输出，和 JobGrap 中的IntermediateDalaSet 一 一对应，同样 一个<strong style="color: rgb(217, 33, 66);">ExecutionJobVertex</strong>&nbsp;&nbsp;可以有多个中间结果，取决于当前 JobVertex 有几个出边(JobEdge)。</span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 122, 170);">4）IntermediateResultPartition</span></strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 122, 170);">IntermediateResultPartition</span></strong>&nbsp;又叫作中间结果分区。表示1个&nbsp;<strong><span style="font-size: 14px;color: rgb(0, 82, 255);">ExecutionVertex</span></strong>输出结果，与 Execution Edge 相关联。</span></p><p style="white-space: normal;"><br  /></p><section style="margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(61, 167, 66);">5）ExecutionEdge</span></strong></span></section><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">表示<strong><span style="font-size: 14px;color: rgb(0, 82, 255);">ExecutionVertex</span></strong>&nbsp;的输入，连按到上游产生的<strong><span style="font-size: 14px;color: rgb(0, 122, 170);">IntermediateResultPartition</span></strong>&nbsp;。1个Execution对应唯一的1个<strong><span style="font-size: 14px;color: rgb(0, 122, 170);">IntermediateResultPartition</span></strong>&nbsp;和1个<strong><span style="font-size: 14px;color: rgb(0, 82, 255);">ExecutionVertex</span></strong>。1个<strong><span style="font-size: 14px;color: rgb(0, 82, 255);">ExecutionVertex</span></strong>&nbsp;可以有多个<strong><span style="font-size: 14px;color: rgb(61, 167, 66);">ExecutionEdge。</span></strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 0, 0);"><strong><span style="font-size: 14px;">6）</span></strong></span><strong><span style="color: rgb(0, 0, 0);font-size: 14px;">Execution</span></strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">ExecutionVertex</span></strong>&nbsp;相当于每个 Task 的模板，在真正执行的时候，会将<strong><span style="font-size: 14px;color: rgb(0, 82, 255);">ExecutionVertex中的信息包装为1个</span></strong><strong>Execution，执行一个ExecutionVertex的一次尝试。</strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">JobManager&nbsp;和 TaskManager&nbsp;之间关于Task&nbsp;的部署和Task执行状态的更新都是通过ExecutionAttemptID来识别标识的。</span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><br  /></span></p><section style="margin-bottom: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">如果觉得阿周讲解的知识点还满意的话，请关注公众号：</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>3分钟秒懂大数据</strong></span><span style="font-size: 14px;">，获取更多，更全面的技术博文。并加博主微信：</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">threeknowbigdata，</span></strong><span style="font-size: 14px;">拉你进大数据交流群。</span></span></section><p style="white-space: normal;text-align: center;"><img data-ratio="0.9967177242888403" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MS3ZsmzMtdMIMxYj0ZXuknFsp5ic4phuhV8VibbOOKMnMurNPibvNRILGaTXEmiavHof6xBxAcGQ0R9w/640?wx_fmt=png" data-type="png" data-w="914" style="height: 172px;width: 173px;"  /></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><br  /><br  /></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><p style="white-space: normal;text-align: center;"><span style="font-size: 16px;color: rgb(217, 33, 66);letter-spacing: 1px;"><strong>接下来问问作业调度的问题</strong></span></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">73、Flink调度器的概念介绍一下？</span></p></blockquote></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(0, 0, 0);font-size: 14px;">调度器</span></strong><span style="color: rgb(0, 0, 0);font-size: 14px;">是Flink作业执行的核心组件，管理作业执行的所有相关过程，包括JobGraph到ExecutionGraph的转换、作业生命周期管理（作业的发布、取消、停止）、作业的Task生命周期管理（Task的发布、取消、停止）、资源申请与释放、作业和Task的Faillover等。</span></span></p><section style="margin-top: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（1）DefaultScheduler</span></strong><br  /></span></section><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;">Flink 目前默认的调度器。是Flink新的调度设计，使用SchedulerStrategy来实现调度。</span></p><p style="white-space: normal;"><br  /></p><p style="margin-top: 10px;white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">（2）LegacySchedular</span></strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">过去的调度器，实现了原来的Execution调度逻辑。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">74、Flink调度行为包含几种？</span></p></blockquote></section><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong>调度行为包含四种：</strong></span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">SchedulerStrategy接口定义了调度行为，其中包含4种行为：<br  /></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.2138728323699422" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae176jJDCiaGLKlnYeTzUviaSiboAuQyu90uKGeXeuP0XXW7EicU4LdSVDYxg/640?wx_fmt=png" data-type="png" data-w="692"  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><br  /></span></p><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（1）startScheduling:调度入口，触发调度器的调度行为</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（2）restartTasks:重启执行失败的Task,一般是Task执行异常导致的。</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（3）onExecutionStateChange：当Execution状态发生改变时。</span></section><section style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">（4）onPartitionConsumable：当IntermediateResultPartition中的数据可以消费时。</span></section><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">75、Flink调度模式包含几种？</span></p></blockquote></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>调度模式包含3种：</strong></span><span style="color: rgb(0, 0, 0);font-size: 14px;"><strong>Eager模式、分阶段模式（Lazy_From_Source）、分阶段Slot重用模式（Lazy_From_Sources_With_Batch_Slot_Request）。</strong></span></span></p><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-size: 14px;">1）Eager 调度</span></strong></span></section><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(0, 0, 0);font-size: 14px;">　　</span><span style="font-size: 14px;color: rgb(2, 30, 170);"><strong>适用于流计算</strong></span><span style="color: rgb(0, 0, 0);font-size: 14px;">。一次性申请需要的所有资源，如果资源不足，则作业启动失败。</span></span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-size: 14px;">2）分阶段调度</span></strong></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;">　　LAZY_FROM_SOURCES&nbsp;<strong>适用于批处理</strong>。从 SourceTask 开始分阶段调度，申请资源的时候，一次性申请本阶段所需要的所有资源。上游 Task 执行完毕后开始调度执行下游的 Task，</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;">读取上游的数据，执行本阶段的计算任务，执行完毕之后，调度后一个阶段的 Task，依次进行调度，直到作业完成。</span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-size: 14px;">3）分阶段 Slot 重用调度</span></strong></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;">　　LAZY_FROM_SOURCES_WITH_BATCH_SLOT_REQUEST&nbsp;<strong>适用于批处理</strong>。与分阶段调度基本一样，区别在于该模式下使用批处理资源申请模式，可以在资源不足的情况下执行作</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;">业，但是需要确保在本阶段的作业执行中没有 Shuffle 行为。</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;">　　目前视线中的 Eager 模式和 LAZY_FROM_SOURCES 模式的资源申请逻辑一样，LAZY_FROM_SOURCES_WITH_BATCH_SLOT_REQUEST 是单独的资源申请逻辑。</span></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">76、Flink调度策略包含几种？</span></p></blockquote></section><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(217, 33, 66);letter-spacing: 1px;"><strong>调度策略包含3种：</strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><img data-ratio="0.20713577799801783" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1icz6UEortysx0aNLokWL5f0eMMkEZoOiaCGZG5lPrvmz5n5s8Vn6Izbg/640?wx_fmt=png" data-type="png" data-w="1009"  /></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.20950965824665677" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae17qknsibOwF7mJGtfxOe8K2tghnygkXSGVnafc9nu5cGhF0TMND1QX3Q/640?wx_fmt=png" data-type="png" data-w="673"  /></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><br  /></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;">调度策略全部实现于调度器SchedulingStrategy，有三种实现：</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(0, 0, 0);font-size: 14px;">1） EagerSchedulingStrategy：</span></strong><span style="color: rgb(0, 0, 0);font-size: 14px;">适用于流计算，同时调度所有的 task</span></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(0, 0, 0);font-size: 14px;">2） LazyFromSourcesSchedulingStrategy：</span></strong><span style="color: rgb(0, 0, 0);font-size: 14px;">适用于批处理，当输入数据准备好时（上游处理完）进行 vertices 调度。</span></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><strong><span style="color: rgb(0, 0, 0);font-size: 14px;">3） PipelinedRegionSchedulingStrategy：</span></strong><span style="color: rgb(0, 0, 0);font-size: 14px;">以流水线的局部为粒度进行调度</span></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;">　　PipelinedRegionSchedulingStrategy 是 1.11 加入的，从 1.12 开始，将以 pipelined region为单位进行调度。</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(0, 0, 0);font-size: 14px;letter-spacing: 1px;">pipelined region 是一组流水线连接的任务。这意味着，对于包含多个 region的流作业，在开始部署任务之前，它不再等待所有任务获取 slot。取而代之的是，一旦任何region 获得了足够的任务 slot 就可以部署它。对于批处理作业，将不会为任务分配 slot，也不会单独部署任务。取而代之的是，一旦某个 region 获得了足够的 slot，则该任务将与所有其他任务一起部署在同一区域中。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">77、Flink作业生命周期包含哪些状态？</span></p></blockquote></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">在Flink集群中，</span><span style="font-size: 14px;color: rgb(2, 30, 170);"><strong>JobMaster&nbsp;</strong></span><span style="font-size: 14px;">负责</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>作业</strong></span><span style="font-size: 14px;">的生命周期管理，具体的管理行为在调度器和ExecutionGraph中实现。</span><br  /></span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">作业的完整生命周期状态变换如下图所示：</span></p><p style="white-space: normal;"><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;"><img data-ratio="0.8784530386740331" src="https://mmbiz.qpic.cn/mmbiz/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1Fl7FfkSNuulZ4YgUV4A7jRkJGwW8z6GQ4ad5ibKqCJdp1DM7pZlIzEg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1086"  /></span><br  /></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">（1）作业首先处于创建状态（created），然后切换到运行状态（running），并且在完成所有工作后，它将切换到完成状态（finished）。</span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">（2）在失败的情况下，作业首先切换到失败状态（failing），取消所有正在运行任务。</span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">如果所有节点都已达到最终状态，并且作业不可重新启动，则状态将转换为失败（failed）。（3）如果作业可以重新启动，那么它将进入重新启动状态（restarting）。一旦完成重新启动，它将变成创建状态（created）。</span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">（4）在用户取消作业的情况下，将进入取消状态（cancelling），会取消所有当前正在运行的任务。一旦所有运行的任务已经达到最终状态，该作业将转换到已取消状态（canceled）。</span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;">完成状态（finished）</span></strong></span><strong><span style="font-size: 14px;color: rgb(61, 167, 66);">，取消状态（canceled）</span></strong><span style="font-size: 14px;">和</span><strong><span style="font-size: 14px;color: rgb(2, 30, 170);">失败状态（failed）</span></strong><span style="font-size: 14px;">表示一个全局的终结状态，并且触发清理工作，</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">而暂停状态（suspended）仅处于本地终止状态</span></strong><span style="font-size: 14px;">。意味着作业的执行在相应的 JobManager 上终止，但集群的另一个 JobManager 可以从持久的HA存储中恢复这个作业并重新启动。因此，处于暂停状态的作业将不会被完全清理。</span></span></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">78、Task的作业生命周期包含哪些状态？</span></p></blockquote></section><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">TaskManager</span></strong><span style="font-size: 14px;">&nbsp;负责</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">Task</span></strong><span style="font-size: 14px;">&nbsp;的生命周期管理，并将状态的变化通知到JobMaster,在ExecutionGraph中跟踪Execution的状态变化，一个Execution对于一个Task。</span></span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-size: 14px;">Task的生命周期如下：共8种状态。</span></strong></span></p><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;"><img data-ratio="0.6784968684759917" src="https://mmbiz.qpic.cn/mmbiz/nEEdkvXCJ8OYeY8jPMVaYMzHNtsKFae1iaXmlXRibkFKQJDBV1l3Vrb1mxNia1ZQ9yttI0PFSesZoEPZ1nlw7KCbw/640?wx_fmt=jpeg" data-type="jpeg" data-w="958"  /></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;">在执行 ExecutionGraph 期间，每个并行任务经过多个阶段，从创建（created）到完成（finished）或失败（failed） ，下图说明了它们之间的状态和可能的转换。任务可以执行多次（例如故障恢复）。每个 Execution 跟踪一个 ExecutionVertex 的执行，每个 ExecutionVertex 都有一个当前 Execution（current execution）和一个前驱 Execution（prior execution）。</span></strong></span></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">79、Flink的任务调度流程讲解一下？</span></p></blockquote></section><p style="white-space: normal;"><span style="letter-spacing: 1px;">任务调度流程图如下：<br  /></span></p><p style="white-space: normal;"><img data-ratio="0.6377952755905512" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MJFWiaPuolAQBCuo19vs95U3s1mXftwgWjw8j83HlF75TiasWqVgtM6nk6LPAx6fGe0xh2uF7Z702w/640?wx_fmt=png" data-type="png" data-w="889"  /></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="outline: 0px;font-size: 14px;">1. 当Flink执行executor会自动根据程序代码生成<strong style="outline: 0px;">DAG数据流图</strong>&nbsp;，即</span><span style="outline: 0px;font-size: 14px;color: rgb(255, 76, 65);">&nbsp;<strong style="outline: 0px;">Jobgraph；</strong></span></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="outline: 0px;font-size: 14px;">2.&nbsp;</span><strong style="outline: 0px;"><span style="outline: 0px;font-size: 14px;color: rgb(255, 76, 65);">ActorSystem</span></strong><span style="outline: 0px;font-size: 14px;">创建</span><span style="outline: 0px;font-size: 14px;color: rgb(255, 76, 65);"><strong style="outline: 0px;">Actor</strong></span><span style="outline: 0px;font-size: 14px;">将数据流图发送给JobManager中的Actor；</span></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="outline: 0px;font-size: 14px;">3.&nbsp;</span><strong style="outline: 0px;"><span style="outline: 0px;font-size: 14px;color: rgb(61, 167, 66);">JobManager</span></strong><span style="outline: 0px;font-size: 14px;">会不断接收</span><strong style="outline: 0px;"><span style="outline: 0px;font-size: 14px;color: rgb(172, 57, 255);">TaskManager</span></strong><span style="outline: 0px;font-size: 14px;">的心跳消息，从而可以获取到有效的TaskManager；</span></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">4. JobManager通过调度器在TaskManager中调度执行Task（在Flink中，最小的调度单元就是task，对应就是一个线程）&nbsp;；</span></p><section style="margin-bottom: 5px;white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">5. 在程序运行过程中，task与task之间是可以进行数据传输的&nbsp;。</span></section><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="outline: 0px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong style="outline: 0px;"><span style="color: rgb(0, 0, 0);outline: 0px;font-size: 14px;">• Job Client</span></strong></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="outline: 0px;font-size: 14px;">– 主要职责是提交任务, 提交后可以结束进程, 也可以等待结果返回 ；</span></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="outline: 0px;font-size: 14px;">– Job Client 不是 Flink 程序执行的内部部分，但它是任务执行的起点；</span></span></p><section style="margin-bottom: 5px;white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; &nbsp;<span style="outline: 0px;font-size: 14px;">– Job Client 负责接受用户的程序代码，然后创建数据流，将数据流提交给 JobManager 以便进一步执行。执行完成后，Job Client 将结果返回给用户。</span></span></section><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="outline: 0px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong style="outline: 0px;"><span style="color: rgb(0, 0, 0);outline: 0px;font-size: 14px;">• JobManager&nbsp;</span></strong></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="outline: 0px;font-size: 14px;">– 主要职责是调度工作并协调任务做检查点；</span></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="outline: 0px;font-size: 14px;">– 集群中至少要有一个 master，master 负责调度 task，协调checkpoints 和 容错；</span></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="outline: 0px;font-size: 14px;">– 高可用设置的话可以有多个 master，但要保证一个是 leader, 其他是stand by；</span></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="outline: 0px;font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; – Job Manager 包含&nbsp;</span><strong style="outline: 0px;"><span style="outline: 0px;font-size: 14px;color: rgb(172, 57, 255);">Actor System、Scheduler、CheckPoint</span></strong><span style="outline: 0px;font-size: 14px;">三个重要的组件 ；</span></span></p><section style="margin-bottom: 5px;white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="outline: 0px;font-size: 14px;">– JobManager从客户端接收到任务以后, 首先生成优化过的执行计划, 再调度到TaskManager中执行。</span></span></section><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="outline: 0px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong style="outline: 0px;"><span style="color: rgb(0, 0, 0);outline: 0px;font-size: 14px;">• TaskManager</span></strong></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="outline: 0px;font-size: 14px;">– 主要职责是从JobManager处接收任务, 并部署和启动任务, 接收上游的数 据并处理&nbsp;</span></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="outline: 0px;font-size: 14px;">– Task Manager 是在 JVM 中的一个或多个线程中执行任务的工作节点。&nbsp;</span></span></p><p style="white-space: normal;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="outline: 0px;font-size: 14px;">– TaskManager在创建之初就设置好了Slot, 每个Slot可以执行一个任务。</span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">80、Flink的任务槽是什么意思？</span></p></blockquote></section><p style="white-space: normal;"><img data-ratio="0.3411764705882353" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MJFWiaPuolAQBCuo19vs95UhrYfyRHYvmmEfhibYgh0cjws5zBTm66hiaSkezMJacEtvvckpwYf4Qicg/640?wx_fmt=png" data-type="png" data-w="935"  /></p><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">每个TaskManager是一个JVM的进程, 可以在不同的线程中执行一个或多个子任务。为了控制一个worker能接收多少个task。worker通过task slot来进行控制（一个worker 至少有一个task slot）。<br style="outline: 0px;"  /></span></p><p style="margin-top: 5px;margin-bottom: 5px;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;color: rgb(172, 57, 255);letter-spacing: 1px;"><strong style="outline: 0px;"><span style="color: rgb(172, 57, 255);outline: 0px;font-size: 14px;">1、任务槽</span></strong></span></p><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">每个task slot表示TaskManager拥有资源的一个固定大小的子集。&nbsp;</span></p><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">一般来说：我们分配槽的个数都是和CPU的核数相等，比如8核，那么就分配8个槽。</span></p><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">Flink将进程的内存划分到多个slot中。</span></p><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">图中有2个TaskManager，每个TaskManager有3个slot，每个slot占有1/3的内存。</span></p><section style="margin-bottom: 5px;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">内存被划分到不同的slot之后可以获得如下好处：</span></section><section style="margin-bottom: 5px;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="outline: 0px;font-size: 14px;">•&nbsp;</span><span style="outline: 0px;font-size: 14px;color: rgb(0, 0, 0);"><strong style="outline: 0px;">TaskManager</strong></span><span style="outline: 0px;font-size: 14px;">最多能同时并发执行的任务是可以控制的，那就是3个，因为不能超过slot的数量。&nbsp;</span><span style="outline: 0px;font-weight: 700;color: rgb(243, 59, 69);font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;">任务槽的作用就是分离任务的托管内存，不会发生cpu隔离。</span></span></section><section style="margin-bottom: 5px;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp; • slot有独占的内存空间，这样在一个TaskManager中可以运行多个不同的作业，作业之间不受影响。</span></section><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-weight: 700;font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;text-align: start;font-size: 14px;color: rgb(255, 0, 0);letter-spacing: 1px;">总结：task slot的个数代表TaskManager可以并行执行的task数。</span></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">81、Flink 槽共享又是什么意思？</span></p></blockquote></section><p style="margin-top: 5px;margin-bottom: 5px;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;"><strong style="outline: 0px;color: rgb(172, 57, 255);">2、槽共享</strong></span></p><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="outline: 0px;color: rgb(0, 0, 0);"><strong style="outline: 0px;"><span style="outline: 0px;font-size: 14px;">默认情况下，Flink允许子任务共享插槽</span></strong></span><span style="outline: 0px;font-size: 14px;">，即使它们是不同任务的子任务，只要它们来自同一个作业。结果是一个槽可以保存作业的整个管道。允许插槽共享有两个主要好处：</span></span></p><section style="margin-bottom: 5px;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;• 只需计算Job中最高并行度（parallelism）的task slot。只要这个满足，其他的job也都能满足。&nbsp;</span></section><section style="margin-bottom: 5px;outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;• 资源分配更加公平。如果有比较空闲的slot可以将更多的任务分配给它。图中若没有任务槽共享，负载不高的Source/Map等subtask将会占据许多资源，而负载较高的窗口subtask则会缺乏资源。&nbsp;</span></section><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="outline: 0px;font-size: 14px;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;• 有了任务槽共享，可以将基本并行度（base parallelism）从2提升到6。提高了分槽资源的利用率。同时它还可以保障TaskManager给subtask的分配的slot方案更加公平。</span></p><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.4834224598930481" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8MJFWiaPuolAQBCuo19vs95Uye5WL30NushOTXjrsQydMXNDTA2Qu81ibxbzLEnuyUg79crWSAhnGnA/640?wx_fmt=png" data-type="png" data-w="935" style="outline: 0px;box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section data-mpa-template="t" mpa-from-tpl="t"><section style="display: flex;justify-content: center;align-items: center;width: 100%;" data-mid="" mpa-from-tpl="t"><section style="display: flex;justify-content: flex-start;align-items: center;flex-direction: column;" data-mid="" mpa-from-tpl="t"><section style="display: flex;justify-content: center;align-items: center;" data-mid="" mpa-from-tpl="t"><section style="width: 27px;margin-right: 3px;" data-mid="" mpa-from-tpl="t"><img data-ratio="0.9629629629629629" src="https://mmbiz.qpic.cn/mmbiz_png/DiaLG0VOfnEibU5UwN5aic6Ez0obyBiapEUbCdUnqu7yuwQVF8mfAkNOux6iatlI7gtN9IgWHVIhy1pibiapFW89HzTRw/640?wx_fmt=png" data-type="png" data-w="54" style="display: block;"  /></section><section style="height: 28px;background: rgba(206, 226, 255, 0.53);text-align: center;padding-right: 7px;padding-left: 11px;" data-mid="" mpa-from-tpl="t"><p style="font-size: 16px;font-family: PingFangSC-Semibold, PingFang SC;font-weight: bold;color: #1D6EEA;line-height: 28px;letter-spacing: 3px;" data-mid=""><span style="letter-spacing: 1px;">04、Flink SQL篇</span></p></section></section><section style="display: flex;justify-content: center;align-items: center;justify-content: space-between;width: 100%;margin-top: 4px;" data-mid="" mpa-from-tpl="t"><section style="width: 60%;height: 1px;background-color: #5698FC;" data-mid="" mpa-from-tpl="t"><br  /></section><section style="width: 10%;height: 1px;background-color: #5698FC;" data-mid="" mpa-from-tpl="t"><br  /></section></section></section></section></section><p><br  /></p><p><span style="font-size: 14px;letter-spacing: 1px;">Flink SQL也是面试的重点考察点，不仅需要你掌握扎实的SQL编程，同时还需要理解SQL提交的核心原理，以及Flink SQL中涉及的一些重点知识，例如CEP、CDC、SQL GateWay、SQL-Hive等，思维导图如下：<br  /></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.51" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PqALZbh7IQstylo5PALv6BLD6OjW73ORmVNapcWMhMA3rr1pjeEVxyIlE5zhNH5PR4ODwUMOELjw/640?wx_fmt=png" data-type="png" data-w="500" style=""  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">82、Flink SQL有没有使用过？</span></p></blockquote></section><p style="white-space: normal;line-height: 1.75em;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">用过，在Flink中，一共有</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>四种</strong></span><span style="font-size: 14px;">级别的</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">抽象</span></strong><span style="font-size: 14px;">，而Flink SQL作为最上层，是Flink API的一等公民</span></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.4069097888675624" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PqALZbh7IQstylo5PALv6BxmJavNLvWSKnKbjsOibwNAemND9LvLd5lotvbVJ0ILdCVT6Jd8NnzMg/640?wx_fmt=png" data-type="png" data-w="1042" style=""  /></p><p style="white-space: normal;line-height: 1.75em;margin-top: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">在标准SQL中，SQL语句包含四种类型</span></p><p style="white-space: normal;line-height: 1.75em;margin-top: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">DML(Data Manipulation Language):数据操作语言，用来定义数据库记录（数据）。</span></p><p style="white-space: normal;line-height: 1.75em;margin-top: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">DCL (Data Control Language):数据控制语言，用来定义访问权限和安全级别。</span></p><p style="white-space: normal;line-height: 1.75em;margin-top: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">DQL (Data Query Language):数据查询语言，用来查询记录（数据）。</span></p><p style="white-space: normal;line-height: 1.75em;margin-top: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">DDL(Data Definition Language):数据定义语言，用来定义数据库对象（库，表，列等）。</span></p><p><span style="letter-spacing: 1px;"><span style="font-size: 14px;"><br  /></span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">Flink SQL包含 DML 数据操作语言、 DDL
数据语言， DQL 数据查询语言</span></strong><span style="font-size: 14px;">，</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">不包含DCL语言。</span></strong><br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">83、Flink被称作流批一体，那从哪个版本开始，真正实现流批一体的？</span></p></blockquote></section><p style="margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">从1.9.0版本开始，引入了阿里巴巴的 Blink ，对 FIink TabIe &amp; SQL 模块做了重大的重构，保留了 Flink Planner 的同时，引入了 Blink PIanner，没引入以前，Flink 没考虑流批作业统一，针对流批作业，底层实现两套代码，引入后，基于流批一体理念，重新设计算子，以流为核心，流作业和批作业最终都会被转为transformation。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">84、Flink SQL 使用哪种解析器？</span></p></blockquote></section><p style="margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">Flink SQL使用 Apache Calcite作为解析器和优化器。</span></p><p style="margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>Calcite </strong></span><span style="font-size: 14px;">一种动态数据管理框架，它具备很多典型数据库管理系统的功能 如SQL 解析、 SQL 校验、 SQL 查询优化、 SQL 生成以及数据连接查询等，但是又省略了一些关键的功能，如 Calcite并</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>不存储</strong></span><span style="font-size: 14px;">相关的</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">元数据</span></strong><span style="font-size: 14px;">和</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>基本数据</strong></span><span style="font-size: 14px;">，不完全包含相关处理数据的算法等。</span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">85、Calcite主要功能包含哪些？</span></p></blockquote></section><p><span style="font-size: 14px;letter-spacing: 1px;">Calcite 主要包含以下五个部分：</span></p><p style="margin-top: 10px;margin-bottom: 10px;"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);font-size: 14px;">(1) SQL 解析 (Parser)</span></strong></span></p><section style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Calcite SQL 解析是</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">通过 JavaCC </span></strong><span style="font-size: 14px;">实现的，使用 JavaCC 编写 SQL 语法描述文件，将 SQL
解析成未经校验的 AST 语法树。&nbsp;</span></span></section><p style="margin-top: 10px;margin-bottom: 10px;"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);font-size: 14px;">(2) SQL 校验 （Validato）</span></strong></span></p><p style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">校验分两部分&nbsp;</span></p><p style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">1）无状态的校验&nbsp; 即验证 SQL 语句是否符合规范。</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">2）有状态的校验 即通过与元数据结合验证 SQL 中的 Schema、Field、 Function 是否存
在，输入输出类型是否匹配等。&nbsp;</span></p><p style="margin-top: 10px;margin-bottom: 10px;"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);font-size: 14px;">(3) SQL 查询优化&nbsp;</span></strong></span></p><p style="line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">对上个步骤的输出( RelNode ，逻辑计划树)进行优化，得到优化后的物理执行计划
优化有两种：</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>基于规则的优化 </strong></span><span style="font-size: 14px;">和 </span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">基于代价的优化</span></strong><span style="font-size: 14px;">，后面会详细介绍。</span></span></p><p style="margin-top: 10px;margin-bottom: 10px;"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);font-size: 14px;">(4) SQL 生成&nbsp;&nbsp;</span></strong></span></p><p><span style="font-size: 14px;letter-spacing: 1px;">将物理执行计划生成为在特定平台/引擎的可执行程序，如生成符合 MySQL 或 Oracle 等不同平台规则的 SQL 查询语句等。&nbsp;</span></p><p style="margin-top: 10px;margin-bottom: 10px;"><span style="color: rgb(0, 82, 255);letter-spacing: 1px;"><strong><span style="color: rgb(0, 82, 255);font-size: 14px;">(5) 数据连接与执行&nbsp;</span></strong></span></p><p style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">通过各个执行平台执行查询，得到输出结果。&nbsp;</span></p><p style="line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;">在Flink 或者其他使用 Calcite 的大数据引擎中，一般到 SQL 查询优化即结束，由各个平台结合 Calcite SQL 代码生成 和 平台实现的代码生成，将优化后的物理执行计划组合成可执行的代码，然后在内存中编译执行。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">86、Flink SQL 处理流程说一下？</span></p></blockquote></section><p><span style="font-size: 14px;letter-spacing: 1px;">下面举个例子，详细描述一下Flink Sql的处理流程，如下图所示：<br  /></span></p><p><br  /></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.6357758620689655" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IxqIias9yNSpGDEmJ7HX2wweXLRGgG3fx3AWdSeTybD11VNtQdM5UtbQ/640?wx_fmt=png" data-type="png" data-w="464" style=""  /></p><p style="margin-top: 10px;margin-bottom: 10px;"><span style="font-size: 14px;letter-spacing: 1px;">我们写一张source表，来源为kafka，当执行create table log_kafka之后 Flink SQL将做如下操作：</span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.437125748502994" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IJgz7By71p5wCSMVH6ylUU0EdPW5PHmTf1EAzQ3Rz4j1dHOQpOnIib1g/640?wx_fmt=png" data-type="png" data-w="1336" style=""  /></p><section style="line-height: 1.75em;margin-bottom: 10px;"><br  /></section><section style="line-height: 1.75em;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（1）首先，FlinkSQL 底层使用的是 </span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">apache Calcite&nbsp;</span></strong><span style="font-size: 14px;">引擎来处理SQL语句，Calcite会使用javaCC做SQL解析，javaCC根据Calcite中定义的&nbsp;</span><strong><span style="font-size: 14px;color: rgb(217, 33, 66);">Parser.jj</span></strong><span style="font-size: 14px;"> 文件，生成一系列的java代码，生成的java代码会</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>把SQL转换成AST抽象语法树（即SQLNode类型）</strong></span><span style="font-size: 14px;">。</span></span></section><section style="line-height: 1.75em;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（2）生成的&nbsp;SqlNode&nbsp;抽象语法树，他是一个</span><strong><span style="font-size: 14px;color: rgb(172, 57, 255);">未经验证的抽象语法树</span></strong><span style="font-size: 14px;">，这时，SQL Validator 会获取 Flink Catalog中的元数据信息来验证 sql 语法，元数据信息检查包括表名，字段名，函数名，数据类型等检查。然后</span><strong><span style="font-size: 14px;color: rgb(172, 57, 255);">生成一个校验后的SqlNode</span></strong><span style="font-size: 14px;">。</span></span></section><section style="line-height: 1.75em;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（3）到达这步后，只是将 SQL 解析到 java 数据结构的固定节点上，并没有给出相关节点之间的关联关系以及每个节点的类型信息。所以，还 </span><span style="color: rgb(0, 82, 255);"><strong><span style="font-size: 14px;">需要将&nbsp;SqlNode&nbsp;转换为逻辑计划，也就是LogicalPl</span></strong></span><span style="font-size: 14px;">an，在转换过程中，会使用 </span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">SqlToOperationConverter </span></strong><span style="font-size: 14px;">类，来将SqlNode转换为Operation,Operation会根据SQL语法来执行创建表或者删除表等操作，同时</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>FlinkPlannerImpl.rel()方法会将SQLNode转换成RelNode树，并返回RelRoot</strong></span><span style="font-size: 14px;">。</span></span></section><section style="line-height: 1.75em;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（4）第4步将</span><span style="color: rgb(123, 12, 0);"><strong><span style="font-size: 14px;">执行&nbsp;Optimize&nbsp;操作</span></strong></span><span style="font-size: 14px;">，按照预定义的优化规则 RelOptRule 优化逻辑计划。</span></span></section><section style="line-height: 1.75em;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Calcite中的优化器RelOptPlanner有两种，一是</span><strong><span style="font-size: 14px;color: rgb(123, 12, 0);">基于规则优化（RBO）的HepPlanner</span></strong><span style="font-size: 14px;">，二是</span><strong><span style="font-size: 14px;color: rgb(64, 118, 0);">基于代价优化（CBO）的VolcanoPlanner</span></strong><span style="font-size: 14px;">。然后得到优化后的RelNode, &nbsp;再基于Flink里面的rules</span><span style="font-size: 14px;color: rgb(171, 25, 66);"><strong>将优化后的逻辑计划转换成物理计划</strong></span><span style="font-size: 14px;">。</span></span></section><section style="line-height: 1.75em;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（5）</span><span style="font-size: 14px;text-align: left;">第5步 </span><span style="color: rgb(255, 76, 0);"><strong><span style="font-size: 14px;text-align: left;">执行 execute&nbsp;操作</span></strong></span><span style="font-size: 14px;text-align: left;">，会通过代码生成 transformation,然后递归遍历各节点，将DataStreamRelNode 转换成DataStream, 在这期间，会依次递归调用DataStreamUnion、DataStreamCalc、DataStreamScan类中重写的 translateToPlan方法。递归调用各节点的translateToPlan，实际是利用CodeGen元编成Flink的各种算子，相当于直接利用Flink的DataSet或者DataStream开发程序。</span></span></section><section style="line-height: 1.75em;margin-bottom: 10px;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（6）<span style="text-align: left;font-family: 等线;color: black;">最后进一步</span></span><span style="text-align: left;font-family: 等线;font-size: 14px;color: rgb(122, 79, 214);"><strong>编译</strong></span><span style="font-size: 14px;text-align: left;font-family: 等线;color: black;">成可执行的 JobGraph 提交运行。</span></span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">87、Flink SQL包含哪些优化规则？</span></p></blockquote></section><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">如下图为执行流程图</span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5220649458784347" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IHqaeicibHiaKk7vFCYEeoHm7eS8InFnG9w94UC8nNArZ6gDfEKzrtxBpQ/640?wx_fmt=png" data-type="png" data-w="1201" style=""  /></p><section style="line-height: 1.75em;margin-bottom: 10px;"><span style="font-size: 14px;letter-spacing: 1px;"><strong>总结就是：</strong><br  /></span></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;font-family: 等线;color: black;">先解析，然后验证，将SqlNode转化为Operation来创建表，然后调用rel方法将sqlNode变成 逻辑计划 （RelNodeTree）</span><span style="color: black;font-family: 等线;font-size: 14px;text-indent: 0in;">紧接着对逻辑计划进行优化；</span></span></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="color: black;font-family: 等线;font-size: 14px;text-indent: 0in;letter-spacing: 1px;"><br  /></span></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: black;font-family: 等线;font-size: 14px;text-indent: 0in;">优化之前 会根据Calcite中的优化器中的基于规则优化的HepPlanner</span><span style="color: rgb(171, 25, 66);"><strong><span style="font-family: 等线;font-size: 14px;text-indent: 0in;">针对四种规则进行预处理</span></strong></span><span style="color: black;font-family: 等线;font-size: 14px;text-indent: 0in;">，处理完之后得到Logic RelNode，紧接着</span><strong><span style="font-family: 等线;font-size: 14px;text-indent: 0in;color: rgb(171, 25, 66);">使用代价优化的VolcanoPlanner使用</span></strong><span style="color: black;font-family: 等线;font-size: 14px;text-indent: 0in;">&nbsp; Logical_Opt_Rules（逻辑计划优化）找到最优的执行Planner,并转换为FlinkLogical RelNode。</span></span></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><br  /></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="font-size: 14px;font-family: 等线;color: black;letter-spacing: 1px;">最后运用 Flink包含的优化规则，如DataStream_Opt_Rules：流式计算优化，DataStream_Deco_Rules：装饰流式计算优化&nbsp;&nbsp; 将优化后的逻辑计划转换为物理计划。</span></section><p style="line-height:normal;text-indent:0in;text-align:left;direction:ltr;unicode-bidi:embed;vertical-align:auto;"><br  /></p><p style="line-height:normal;text-indent:0in;text-align:left;direction:ltr;unicode-bidi:embed;vertical-align:auto;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-size: 14px;">优化规则包含如下：</span></strong><br  /></span></p><p style="line-height:normal;text-indent:0in;text-align:left;direction:ltr;unicode-bidi:embed;vertical-align:auto;"><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></p><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="font-size: 14px;font-family: 等线;color: black;letter-spacing: 1px;">Table_subquery_rules&nbsp; 子查询优化</span></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="font-size: 14px;font-family: 等线;color: black;letter-spacing: 1px;">Expand_plan_rules：扩展计划优化</span></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="font-size: 14px;font-family: 等线;color: black;letter-spacing: 1px;">Post_expand_clean_up_rules：扩展计划优化</span></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 等线;color: black;">Datastream_norm_rules：正常化流处理</span><span style="font-size: 14px;font-family: 等线;color: black;vertical-align: baseline;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 等线;color: black;">Logical_Opt_Rules：逻辑计划优化</span><span style="font-size: 14px;font-family: 等线;color: black;vertical-align: baseline;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 等线;color: black;">DataStream_Opt_Rules：流式计算优化</span><span style="font-size: 14px;font-family: 等线;color: black;vertical-align: baseline;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></section><section style="text-indent: 0in;text-align: left;direction: ltr;unicode-bidi: embed;line-height: 1.75em;"><span style="font-size: 14px;font-family: 等线;color: black;letter-spacing: 1px;">DataStream_Deco_Rules：装饰流式计算优化</span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">88、Flink SQL中涉及到哪些operation？</span></p></blockquote></section><section style="white-space: normal;margin-bottom: 15px;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;"><strong><span style="color: rgb(217, 33, 66);font-size: 14px;">先介绍一下什么是Operation</span></strong></span></section><p style="white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">在Flink SQL中吗，涉及的DDL，DML，DQL操作都是Operation，在 Flink内部表示，Operation可以和SqlNode对应起来。<br  /></span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(122, 79, 214);"><strong><span style="font-size: 14px;">Operation执行在优化前</span></strong></span><span style="font-size: 14px;">，执行的函数为executeQperation,如下图所示，为执行的所有Operation。</span></span></p><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5199306759098787" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IOQlicHcaPZRBjky2Mm0Uib3YtibqXcYgjFo554CnQ8YNNAsFRAobkhXgA/640?wx_fmt=png" data-type="png" data-w="1154" style=""  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">89、Flink Hive有没有使用过？</span></p></blockquote></section><section style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">Flink社区在Flink1.11版本进行了重大改变，如下图所示：</span></section><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.6378109452736318" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IpRGfxTXAUp0nafklveD9TbSx9ROOBdqcsNJruWnibmUwiaF5BSIfvyMQ/640?wx_fmt=png" data-type="png" data-w="1005" style=""  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">90、Flink与Hive集成时都做了哪些操作？</span></p></blockquote></section><section style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">如下所示为Flink与HIve进行连接时的执行图：<br  /></span></section><p style="text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.28641975308641976" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6Ikys9jf3eLjnNQ2eHkZXaKaUiatr1aXgbOqsoOHqZrTmsoDcicR6J6ncQ/640?wx_fmt=png" data-type="png" data-w="1215" style=""  /></p><section style="margin-bottom: 15px;white-space: normal;"><br  /></section><p style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">（1）Flink1.1新引入了Hive方言，所以在Flink SQL中可以编写HIve语法，即Hive Dialect。</span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">（2）编写HIve SQL后，FlinkSQL Planner 会将SQL进行解析，验证，转换成逻辑计划，物理计划，最终变成Jobgraph。</span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">（3）</span><span style="font-size: 14px;color: rgb(255, 76, 65);"><strong>HiveCatalog作为Flink和Hive的表元素持久化介质，会将不同会话的Flink元数据存储到Hive Metastore中</strong></span><span style="font-size: 14px;">。用户利用HiveCatalog可以将hive表或者 Kafka表存储到Hive Metastore中。</span></span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">BlinkPlanner 是在Flink1.9版本新引入的机制，Blink 的查询处理器则实现流批作业接口的统一，</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>底层的 API 都是Transformation</strong></span><span style="font-size: 14px;">。真正实现 流 &amp;批 的统一处理，替代原FlinkPlanner将流&amp;批区分处理的方式。在1.11版本后 已经默认为Blink Planner。</span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">91、HiveCatalog类包含哪些方法？</span></p></blockquote></section><section style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">重点方法如下：</span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.6768421052631579" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IQ6sibCurGX4p0PIHRYKs2qI5YDm2yqVHviawQCvKqQbLa9jgkHzALAqw/640?wx_fmt=png" data-type="png" data-w="950"  /></p><section style="margin-bottom: 15px;white-space: normal;"><br  /></section><p style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">HiveCatalog主要是</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>持久化元数据</strong></span><span style="font-size: 14px;">，所以 一般的创建类型都包含，如 database,Table,View，Function,Partition,还有is_Generic字段判断等。</span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">92、Flink SQL1.11新增了实时数仓功能，介绍一下？</span></p></blockquote></section><section style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink1.11 版本新增的一大功能是实时数仓，可以实时的将kafka中的数据插入Hive中，传统的实时数仓基于 Kafka+ Flinkstreaming，定义全流程的流计算作业，有着秒级甚至毫秒的实时性，</span><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;">但实时数仓的一个问题是历史数据只有 3-15天，无法在其上做 Ad-hoc的查询。</span></strong></span></span></section><p style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">针对这个特点，Flink1.11 版本将</span><span style="font-size: 14px;color: rgb(217, 33, 66);">&nbsp;<strong>FlieSystemStreaming Sink</strong></span><span style="font-size: 14px;">&nbsp;重新修改，增加了</span><strong><span style="font-size: 14px;color: rgb(122, 79, 214);">分区提交</span></strong><span style="font-size: 14px;">和</span><span style="font-size: 14px;color: rgb(0, 82, 255);"><strong>滚动策略机制</strong></span><span style="font-size: 14px;">，让HiveStreaming &nbsp;sink 重新使用文件系统流接收器。</span></span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">Flink&nbsp;1.11 的 Table/SQL API 中，</span><span style="color: rgb(122, 79, 214);"><strong><span style="font-size: 14px;">FileSystemConnector 是靠增强版 StreamingFileSink组件实现</span></strong></span><span style="font-size: 14px;">，在源码中名为 StreamingFileWriter。</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>*&nbsp;</strong></span><span style="color: rgb(0, 122, 170);"><strong><span style="font-size: 14px;">只有在Checkpoint 成功时，StreamingFileSink写入的文件才会由 Pending状态变成 Finished状态，从而能够安全地被下游读取。所以，我们一定要打开 Checkpointing，并设定合理的间隔。</span></strong></span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">93、Flink -Hive实时写数据介绍下？</span></p></blockquote></section><p style="white-space: normal;text-align: left;direction: ltr;unicode-bidi: embed;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-family: 微软雅黑;font-size: 14px;">StreamingWrite</span></strong></span><span style="font-family: 微软雅黑;color: black;font-size: 14px;">，从kafka&nbsp;中实时拿到数据，</span><span style="color: black;font-family: 微软雅黑;font-size: 14px;">使用分区提交将数据从Kafka写入Hive表中，并运行批处理查询以读取该数据。</span></span></p><p style="white-space: normal;text-align: left;direction: ltr;unicode-bidi: embed;"><br  /></p><p style="white-space: normal;text-align: left;direction: ltr;unicode-bidi: embed;"><span style="color: black;font-family: 微软雅黑;font-size: 14px;letter-spacing: 1px;">Flink&nbsp;-SQL 写法<br  /></span></p><p style="white-space: normal;text-align: center;direction: ltr;unicode-bidi: embed;"><span style="font-size: 16px;letter-spacing: 1px;"><strong><span style="font-size: 16px;color: black;font-family: 微软雅黑;">Source源</span></strong></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.7392197125256673" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IpnHeVtD4juh3r0gJicTdXo7dSgkDfyZMQvyYcs9hL4wVJ1IcJbWQnVQ/640?wx_fmt=png" data-type="png" data-w="487"  /></p><p style="white-space: normal;text-align: left;direction: ltr;unicode-bidi: embed;"><br  /></p><p style="white-space: normal;text-align: center;"><span style="font-size: 16px;font-family: 等线;font-weight: bold;letter-spacing: 1px;"><strong><span style="font-size: 16px;font-weight: bold;color: black;font-family: 微软雅黑;">Sink目的地</span></strong></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5053272450532724" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6I5Gq6fY3Rib60x3fd80ILN3IlJzgvutH9MvSNF7Gc92hZaNbW7ukVKNA/640?wx_fmt=png" data-type="png" data-w="657"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: center;"><span style="font-size: 16px;font-family: 等线;font-weight: bold;letter-spacing: 1px;">Insert 插入<br  /></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.1712230215827338" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IBF2gkxoqG7Iu3mvibJibiaX9XQEzv3PZRlAO87JCl8fJNcCNaHXEESEhQ/640?wx_fmt=png" data-type="png" data-w="695"  /></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;text-align: left;direction: ltr;unicode-bidi: embed;"><span style="color: black;font-family: 微软雅黑;font-size: 14px;letter-spacing: 1px;">Flink-table写法：<br  /></span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: center;direction: ltr;unicode-bidi: embed;"><span style="color: black;font-family: 微软雅黑;font-size: 14px;letter-spacing: 1px;"><strong style="font-size: 16px;">Source源</strong></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.839851024208566" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IlNbMczUicu3dicw4mbN9dsC5g6Yykp19NF2LlyKXNJJEAyKSw9l76RjQ/640?wx_fmt=png" data-type="png" data-w="537"  /></p><p style="white-space: normal;text-align: left;direction: ltr;unicode-bidi: embed;"><br  /></p><section style="margin-bottom: 10px;white-space: normal;text-align: center;"><span style="letter-spacing: 1px;"><strong style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 16px;">Sink目的地</strong></span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.6370235934664247" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IAP0NR6LoKkE67IxcsMwTej2WQibBoOf9FicicwdQtvuBt0J5O1EP8vTaA/640?wx_fmt=png" data-type="png" data-w="551"  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;text-align: center;"><span style="letter-spacing: 1px;"><strong style="color: rgb(0, 0, 0);font-family: 微软雅黑;font-size: 16px;"></strong><span style="font-family: 等线;font-size: 16px;font-weight: 700;">Insert 插入</span></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.30864197530864196" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IORib4bFsj3icOic5V9umYUUW3EJ9EtbBWkt0GwSXeRSMuasE9MRfVmRWw/640?wx_fmt=png" data-type="png" data-w="567"  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">94、Flink -Hive实时读数据介绍下？</span></p></blockquote></section><p style="white-space: normal;text-align: left;direction: ltr;unicode-bidi: embed;"><span style="color: rgb(217, 33, 66);font-family: 微软雅黑;font-size: 14px;letter-spacing: 1px;"><strong>如下图所示：</strong></span></p><p style="white-space: normal;text-align: left;direction: ltr;unicode-bidi: embed;"><br  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.7316062176165803" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6I3sK3dMGeUW0pI76XsxbvOcQO38aUFlMfFtN40Ria5HDfkqVezVhvgZQ/640?wx_fmt=png" data-type="png" data-w="965"  /></p><section style="margin-top: 10px;margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">Flink 源码中在对Hive进行读取操作时，会经历以下几个步骤：</span></section><p cid="c138" mdtype="paragraph" style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">1、Flink都是基于calcite先解析sql，确定表来源于hive，如果是Hive表，将会</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>在HiveCatalog中创建HiveTableFactory</strong></span></span></p><p cid="c140" mdtype="paragraph" style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">2、HiveTableFactory 会基于配置文件</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>创建 HiveTableSource</strong></span><span style="font-size: 14px;">，然后HiveTableSource在真正执行时，会调用getDataStream方法，通过getDataStream方法来确定查询匹配的分区信息，然后创建表对应的InputFormat，然后确定并行度，根据并行度确定slot 分发HiveMapredSplitReader任务。</span></span></p><p cid="c142" mdtype="paragraph" style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">3、在TaskManager端的slot中，Split会确定读取的内容，基于Hive中定义的序列化工具，InputFormat执行读取反序列化，得到value值。</span></p><p cid="c144" mdtype="paragraph" style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">4、最后循环执行reader.next 获取value，将其解析成Row。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">95、Flink -Hive实时写数据时，如何保证已经写入分区的数据何时才能对下游可见呢？</span></p></blockquote></section><p style="white-space: normal;text-align: left;direction: ltr;unicode-bidi: embed;"><span style="color: rgb(217, 33, 66);font-family: 微软雅黑;font-size: 14px;letter-spacing: 1px;"><strong>如下图所示：</strong></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.47944297082228116" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IbvCqGWsEFZ60BzaQ5FolmHfxYDePV2JYk7LGwl5JMfQakQMARBWz6A/640?wx_fmt=png" data-type="png" data-w="1508"  /></p><p style="white-space: normal;"><br  /></p><p style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">首先可以看一下，在实时的将数据存储到Hive数仓中，FileSystemConnector 为了与 Flink-Hive集成的大环境适配，</span><span style="font-size: 14px;color: rgb(217, 33, 66);"><strong>最大的改变就是分区提交</strong></span><span style="font-size: 14px;">，可以看一下左下图，官方文档给出的，分区可以采取日期+ 小时的策略，或者时分秒的策略。</span></span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(217, 33, 66);"><strong><span style="font-size: 14px;">那如何保证已经写入分区的数据何时才能对下游可见呢？</span></strong></span><span style="font-size: 14px;">&nbsp;这就和&nbsp;</span><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">触发机制</span></strong><span style="font-size: 14px;">&nbsp;有关， 触发机制包含process-time和 partition-time以及时延。</span></span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(61, 170, 214);"><strong><span style="font-size: 14px;">partition-time&nbsp;</span></strong></span><span style="font-size: 14px;">指的是根据事件时间中提取的分区触发。当'watermark'&nbsp;&gt; 'partition-time' + 'delay'&nbsp;，选择partition-time的数据才能提交成功，</span></span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(0, 82, 255);">process-time&nbsp;</span></strong><span style="font-size: 14px;">指根据系统处理时间触发，当加上时延后，要想让分区进行提交，当'currentprocessing time' &gt; 'partition creation time' + 'delay'&nbsp;&nbsp;选择 process-time的数据可以提交成功。</span></span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">但选择process-time触发机制会有缺陷，就是当数据迟到或者程序失败重启时，数据不能按照事件时间被归入正确分区。所以 一般会选择 partition-time。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">96、源码中分区提交的PartitionCommitTrigger介绍一下？</span></p></blockquote></section><section style="margin-bottom: 10px;white-space: normal;text-align: left;direction: ltr;unicode-bidi: embed;"><span style="color: rgb(217, 33, 66);font-family: 微软雅黑;font-size: 14px;letter-spacing: 1px;"><strong>在源码中，PartitionCommitTrigger类图如下所示</strong></span></section><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.397172236503856" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IXNHHdzz0YyW6GdpOUtZFuibm74carNiaiaZWRQkfaxXt8YfMt8YjRDXSQ/640?wx_fmt=png" data-type="png" data-w="778"  /></p><section style="margin-top: 10px;margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">该类中维护了两对必要的信息：</span></section><p style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">1.pendingPartitions/pendingPartitionsState：等待提交的分区以及对应的状态；2.watermarks/watermarksState：watermarks（用 TreeMap 存储以保证有序）以及对应的状态。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">97、</span><span style="font-family: 微软雅黑;font-size: 14px;">PartitionTimeCommitTigger 是如何知道该提交哪些分区的呢？（源码分析）</span></span></p></blockquote></section><p style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">1、检查checkpoint ID 是否合法；</span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">2、取出当前checkpoint ID 对应的水印，并调用 TreeMap的headMap() 和 clear() 方法删掉早于当前 checkpoint ID的水印数据（没用了）；<br  /></span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">3、遍历等待提交的分区，调用之前定义的PartitionTimeExtractor。</span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">（比如${year}-${month}-${day} ${hour}:00:00）抽取分区时间。</span></p><p style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;">如果watermark&gt;partition-time+delay，说明可以提交，并返回它们<br  /></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">98、</span><span style="font-family: 微软雅黑;font-size: 14px;">如何保证已经写入分区的数据对下游可见的标志问题（源码分析）</span></span></p></blockquote></section><p style="margin-bottom: 15px;white-space: normal;"><span style="font-size: 14px;letter-spacing: 1px;"><strong style="color: rgb(217, 33, 66);font-family: 微软雅黑;text-align: left;">在源码中，主要涉及</strong><strong style="color: rgb(217, 33, 66);font-family: 微软雅黑;text-align: left;">PartitionCommitPolicy</strong><strong style="color: rgb(217, 33, 66);font-family: 微软雅黑;text-align: left;">类，如下图所示：</strong></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.3460410557184751" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IAl9rMPaZqgiaP7PbCIRRBp0MKQFvJgwvibF0aAPghIImnNpIaj8VSwQA/640?wx_fmt=png" data-type="png" data-w="682"  /></p><p style="margin-bottom: 15px;white-space: normal;"><br  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.27755905511811024" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PdhcdC3tVvo5LQKGibWXp6IMuUB4BgfItK1TmhjwrBohbEdiaiakxOHQZcLF8mvgfhAPbvqRAP4vChw/640?wx_fmt=png" data-type="png" data-w="1524"  /></p><section style="line-height: 1.75em;margin-bottom: 10px;"><span style="font-size: 14px;letter-spacing: 1px;"><br  /></span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">99、</span><span style="font-family: 微软雅黑;font-size: 14px;">Flink SQL CEP有没有接触过？</span></span></p></blockquote></section><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="font-size: 15px;color: rgb(255, 76, 65);">CEP的概念：</span></strong><br  /></span></p><section style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px;"><span style="color: red;font-family: Wingdings;">Ø</span><span style="font-family: 微软雅黑;color: rgb(91, 155, 213);">复杂事件处理（Complex Event Processing），用于识别输入流中符合指定规则的事件，并按照指定方式输出。</span></span></span></section><section style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px;"><span style="color: red;font-family: Wingdings;">Ø</span><span style="font-family: 微软雅黑;color: rgb(0, 176, 80);">起床—&gt;洗漱—&gt;吃饭—&gt;上班一系列串联起来的事件流形成的模式</span></span></span></section><section style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px;"><span style="color: red;font-family: Wingdings;">Ø</span><span style="font-family: 微软雅黑;color: rgb(112, 48, 160);">浏览商品—&gt;加入购物车—&gt;创建订单—&gt;支付完成—&gt;发货—&gt;收货事件流形成的模式。</span></span></span></section><section style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;letter-spacing: 1px;">通过概念可以了解，CEP主要是识别输入流中用户指定的一些基本规则的事件，然后将这些事件再通过指定方式输出。</span></section><section style="margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;letter-spacing: 1px;">如下图所示：&nbsp;我们指定“方块、圆”为基本规则的事件，在输入的原始流中，将这些事件作为一个结果流输出来。<br  /></span></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.25919117647058826" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPs3N8OGDhmKAhL4kJnib88PepZmuNXgibQLStF2icw0libVzIw9Y7dHG0E1A/640?wx_fmt=png" data-type="png" data-w="1088" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;color: rgb(255, 76, 65);letter-spacing: 1px;"><strong>CEP的使用场景：</strong></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.3233082706766917" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPsqeBlAVJiczrYx42dZP0dCFXkqEqGbiaRtcYsxzKDRh35rRL59E4sQTiaQ/640?wx_fmt=png" data-type="png" data-w="931" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.25025125628140704" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPsFXuhoVTUibDu71iau3Gjoib6HfQSz88Eiae8ibuclMXpVP36JJ5Dvu4pErA/640?wx_fmt=png" data-type="png" data-w="995" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /><br  /></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><br  /></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;">像用户异常检测：我们指定异常操作事件为要输出的结果流；策略营销：指定符合要求的事件为结果流；运维监控：指定一定范围的指标为结果流；银行卡盗刷：指定同一时刻在两个地方被刷两次为异常结果流。</span></p><p style="white-space: normal;"><span style="letter-spacing: 1px;"><span style="color: rgb(255, 76, 65);"><strong><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">Flink CEP SQL 语法 是通过SQL方式进行复杂事件处理，但是与</span></strong></span><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);">&nbsp;Flink SQL语法也不太相同，其中包含许多规则。</span></span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">100、</span><span style="font-family: 微软雅黑;font-size: 14px;">Flink SQL CEP了解的参数介绍一下？</span></span></p></blockquote></section><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="font-size: 15px;color: rgb(255, 76, 65);">CEP包含的参数如下：</span></strong></span></p><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="font-size: 15px;color: rgb(255, 76, 65);"><img data-ratio="0.45523091423185674" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPsLzfyU0EzdL59x9bngibda6ykbaTxdjVrvWoSQK2wBwGKfWLura6rO9A/640?wx_fmt=png" data-type="png" data-w="1061"  /></span></strong></span></p><section style="margin-top: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(2, 30, 170);">参数介绍</span></strong><br  /></span></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;color: red;font-family: Wingdings;">p</span><strong><span style="font-size: 14px;font-family: 微软雅黑;color: black;">输出模式（</span></strong><span style="font-size: 14px;font-family: 微软雅黑;color: red;">每个找到的匹配项应该输出多少行</span><span style="font-size: 14px;font-family: 微软雅黑;color: black;">）</span></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 176, 240);font-family: Wingdings;">&nbsp; &nbsp; &nbsp;Ø</span><span style="font-size: 14px;font-family: 微软雅黑;color: black;">one&nbsp; row&nbsp; per&nbsp; match</span></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;每次检测到完整的匹配后进行汇总输出</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 176, 240);font-family: Wingdings;">&nbsp; &nbsp; &nbsp;Ø</span><span style="font-size: 14px;font-family: 微软雅黑;color: black;">all&nbsp; rows per match (</span><span style="font-size: 14px;font-family: 微软雅黑;color: red;">flink暂不支持</span><span style="font-size: 14px;font-family: 微软雅黑;color: black;">)</span></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;检测到完整的匹配后会把匹配过程中每条具体记录进行输出</span></p><section style="margin-top: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;color: red;font-family: Wingdings;">p</span><strong><span style="font-size: 14px;font-family: 微软雅黑;color: black;">runningVS final语义</span></strong></span></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 176, 240);font-family: Wingdings;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ø</span><span style="font-size: 14px;font-family: 微软雅黑;color: black;">在计算中使用那些匹配的事件</span></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;running匹配中和final匹配结束</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 176, 240);font-family: Wingdings;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ø&nbsp;</span><span style="font-size: 14px;font-family: 微软雅黑;color: red;">define语句中只可以使用running,measure两者都可以</span></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 176, 240);font-family: Wingdings;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ø</span><span style="font-size: 14px;font-family: 微软雅黑;color: black;">输出结果区别</span></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 微软雅黑;color: black;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px;font-family: 微软雅黑;">&nbsp;对于one row per match，输出没区别</span></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对于all&nbsp; rows&nbsp; per match ，输出不同</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.42078364565587734" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPsnnTe5OxMe87KOxT2jkIwEQicoouhMnB0lsric430FOCL9MV0f0TmGFMw/640?wx_fmt=png" data-type="png" data-w="587" height="247" style="box-sizing: border-box !important;width: 573px !important;visibility: visible !important;" width="573"  /></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><img class="rich_pages" data-galleryid="" data-ratio="0.8636363636363636" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPsu5fc4cpEt7iaHnXnloDhozkw6GUR51nntk0IIRWyhgiakjqLWxHCvOLg/640?wx_fmt=png" data-type="png" data-w="154" style="text-align: center;box-sizing: border-box !important;width: 106px !important;visibility: visible !important;"  /><img class="rich_pages" data-galleryid="" data-ratio="0.4513888888888889" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPstQicicHe27avaZE664gd2nyF7spg6TeXHTiaxgaNZl83Dca8Vl671UgJw/640?wx_fmt=png" data-type="png" data-w="288" style="text-align: center;box-sizing: border-box !important;width: 210px !important;visibility: visible !important;"  /><img class="rich_pages" data-galleryid="" data-ratio="0.4298245614035088" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPs7V0V2MMYcOeibuD8R9g16nGQzJsNHQQNLH846iaJ2kVzfibiaDGddTb3vQ/640?wx_fmt=png" data-type="png" data-w="342" style="text-align: center;box-sizing: border-box !important;width: 215px !important;visibility: visible !important;"  /></p><p style="margin-top: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(2, 30, 170);">3、匹配后跳转模式介绍</span></strong></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 微软雅黑;color: black;">after&nbsp; match（</span><span style="font-size: 14px;font-family: 微软雅黑;color: red;">匹配后，从哪里开始重新匹配</span><span style="font-size: 14px;font-family: 微软雅黑;color: black;">）</span></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px;color: rgb(0, 176, 240);font-family: Wingdings;">Ø</span>&nbsp;skip to next row</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;从匹配成功的事件序列中的第一个事件的下一个事件开始进行下一次匹配</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px;color: rgb(0, 176, 240);font-family: Wingdings;">Ø</span>&nbsp;skip&nbsp; past last row</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;从匹配成功的事件序列中的最后一个事件的下一个事件开始进行下一次匹配</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="color: black;font-family: 微软雅黑;font-size: 14px;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px;color: rgb(0, 176, 240);font-family: Wingdings;">Ø</span>&nbsp;skip&nbsp; to first pattern&nbsp; Item&nbsp;&nbsp;</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;从匹配成功的事件序列中第一个对应于patternItem的事件开始进行下一次匹配&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-size: 14px;color: rgb(0, 176, 240);font-family: Wingdings;">Ø</span>skip&nbsp; to last pattern&nbsp; Item</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;font-family: 微软雅黑;color: black;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;从匹配成功的事件序列中最后一个对应于patternItem的事件开始进行下一次匹配</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: left;direction: ltr;unicode-bidi: embed;"><span style="font-family: 微软雅黑;color: red;font-size: 14px;letter-spacing: 1px;">注意：</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: left;direction: ltr;unicode-bidi: embed;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: 微软雅黑;color: black;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px;font-family: 微软雅黑;color: rgb(0, 176, 240);">在使用skip to first/last patternItem容易出现循环匹配问题，需要慎重</span></span></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">针对上面的匹配后跳转模式分别介绍:</span></p><section style="margin-top: 5px;margin-bottom: 10px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><span style="letter-spacing: 1px;"><strong><span style="font-size: 14px;color: rgb(172, 57, 255);">（1）<span style="font-family: 微软雅黑;">after&nbsp;&nbsp;match&nbsp; &nbsp;skip&nbsp;past&nbsp; last&nbsp;&nbsp;row&nbsp;如下图</span></span></strong></span></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.5099913119026933" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPsa5lBtKjZmib3lPJUXYib7xxrScibu8F6RG60IROCyFnriaa2hvYA9XrPbg/640?wx_fmt=png" data-type="png" data-w="1151" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><span style="color: rgb(172, 57, 255);letter-spacing: 1px;"><strong><span style="color: rgb(172, 57, 255);font-size: 14px;">（2）</span><span style="color: rgb(172, 57, 255);font-size: 14px;font-family: 微软雅黑;">after&nbsp;&nbsp;match&nbsp;&nbsp;&nbsp;skip to&nbsp; next&nbsp; row&nbsp;<strong>如下图</strong></span></strong></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.5059121621621622" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPsW8ZBBF4pnTLXpZHrR5VYy4G2FUch9a46vBW7icSjvbrzGTrOvrXnZkg/640?wx_fmt=png" data-type="png" data-w="1184" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><span style="color: rgb(172, 57, 255);letter-spacing: 1px;"><strong><span style="color: rgb(172, 57, 255);font-size: 14px;">（3）</span><span style="color: rgb(172, 57, 255);font-size: 14px;font-family: 微软雅黑;">after&nbsp;&nbsp;match&nbsp;&nbsp;&nbsp;skip to&nbsp;&nbsp;last&nbsp;patternItem&nbsp;<strong>如下图</strong></span></strong></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.5245762711864407" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPsib1IBnLE2EeHGcrUiauVemTRyfiayTwdyvkQVtXiccAuTkqfs9Lz5KjAqg/640?wx_fmt=png" data-type="png" data-w="1180" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><span style="color: rgb(172, 57, 255);letter-spacing: 1px;"><strong><span style="color: rgb(172, 57, 255);font-size: 14px;">（4）</span><span style="color: rgb(172, 57, 255);font-size: 14px;font-family: 微软雅黑;">after&nbsp;&nbsp;match&nbsp;&nbsp;&nbsp;skip to&nbsp;&nbsp;first&nbsp; patternItem&nbsp;<strong>如下图</strong></span></strong></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.43743536711478803" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPsxibwhwBYnSAfD32mwN4l8zoMwE9rxvo5rZEIjWnKeU7T2wSFVPvJrlg/640?wx_fmt=png" data-type="png" data-w="967" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;"  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">101、编写一个</span><span style="font-family: 微软雅黑;font-size: 14px;">CEP SQL案例，如银行卡盗刷</span></span></p></blockquote></section><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">通过Flink CEP SQL 写的关于金融场景 银行卡盗刷案例。</span></p><p style="margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="font-family: 华文楷体;text-align: start;font-size: 14px;color: rgb(255, 0, 0);">案例介绍：</span><span style="font-family: 华文楷体;font-size: 14px;text-align: start;">在金融场景中，有时会出现银行卡盗刷现象，犯罪分子利用互联网等技术，在间隔10分钟或者更短时间内，使一张银行卡在不同的两个地方出现多次刷卡记录，这从常规操作来说，在间隔时间很多的情况下，用户是无法同时在两个城市进行刷卡交易的，所以出现这种问题，就需要后台做出触发报警机制。<br  /></span></span></p><p style="margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="color: rgb(2, 30, 170);font-family: 华文楷体;font-size: 15px;text-align: start;letter-spacing: 1px;">要求：当相同的cardId在十分钟内，从两个不同的Location发生刷卡现象，触发报警机制，以便检测信用卡盗刷现象。<br  /></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.5108499095840868" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8PB7gbwuqx7oy4jFMwVicoPs6xFZNPbxbSlgFcHdvVn36ZTTGiaBiauOicPWKb1uTibY8noldyGbwAfzFQ/640?wx_fmt=png" data-type="png" data-w="1106" height="496" style="box-sizing: border-box !important;width: 677px !important;visibility: visible !important;" width="1080"  /></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">（1）编写cep sql时，包含许多技巧，首先我们编写最基础的查询语句,从一张表中查询需要的字段。<br  /></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="cs"><code style="white-space: pre-wrap;"><span class="code-snippet_outer"><span style="letter-spacing: 1px;">select starttime,endtime,cardId,event from dataStream</span></span></code></pre></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">（2）match_recognize();<br  /></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">该字段是CEP SQL 的前提条件，用于生成一个追加表，所有的 CEP SQL都是书写在这里面。</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">（3）分区，排序</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">由于是对同一ID，所以需要使用 partition by,还要根据时间进行排序 order by<br  /></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">（4）理解CEP&nbsp; SQL核心的编写顺序</span></p><section data-mpa-template="t" mpa-from-tpl="t" style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><section data-mpa-category="模板" data-mid="" mpa-from-tpl="t" style="padding-top: 20px;display: flex;justify-content: flex-start;align-items: center;flex-direction: column;"><section data-mid="" mpa-from-tpl="t" style="margin-right: 10px;margin-left: 10px;display: flex;justify-content: flex-start;align-items: center;flex-direction: column;"><section data-mid="" mpa-from-tpl="t" style="margin-bottom: -30.5px;margin-left: -30.5px;width: 631.525px;display: flex;justify-content: flex-start;align-items: flex-start;"><br  /></section><section data-mid="" mpa-from-tpl="t" style="margin-bottom: 20px;"><section data-mid="" mpa-from-tpl="t" style="z-index: 2;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Wic8BDGMRUojcP7P5MXxWPyW6sEXJUX24ujERumUlMJD6DwzTjzYnhxcwXgpBhQJ8Otgg4KPdtXQJGoHqDmO0Wg/640?wx_fmt=png&quot;);background-position: 0% 0%;background-size: 50% 50%;background-repeat: repeat;background-attachment: initial;background-origin: initial;background-clip: initial;border-width: 1px;border-style: solid;border-color: rgb(51, 51, 51);"><section data-mid="" mpa-from-tpl="t" style="padding: 18px 16px 17px 17px;transform: translate(-5.5px, -4.5px);background: rgb(231, 248, 255);border-radius: 2px;border-width: 1px;border-style: solid;border-color: rgb(51, 51, 51);"><p data-mid="" style="font-size: 14px;font-family: PingFangSC-Regular, &quot;PingFang SC&quot;;line-height: 20px;"><span style="color: rgb(0, 0, 0);letter-spacing: 1px;">如上图标的顺序</span></p><p data-mid="" style="font-size: 14px;font-family: PingFangSC-Regular, &quot;PingFang SC&quot;;line-height: 20px;"><span style="color: rgb(0, 0, 0);letter-spacing: 1px;">1、CEP SQL 的类为Pattern，检测在10分钟内两个地方出现刷卡现象，所以定义两个事件：<br  /></span></p><p data-mid="" style="font-size: 14px;font-family: PingFangSC-Regular, &quot;PingFang SC&quot;;line-height: 20px;"><span style="color: rgb(217, 33, 66);letter-spacing: 1px;">Pattern&nbsp;(e1&nbsp;e2+)&nbsp;within&nbsp;interval&nbsp;&nbsp;‘10’minute<br  /></span></p><p><span style="letter-spacing: 1px;"><span style="font-size: 14px;">2、定义在Pattern中要求的判断语句，规定使用</span><span style="font-size: 14px;color: rgb(0, 0, 0);">define</span></span></p><p><span style="font-size: 14px;color: rgb(0, 82, 255);letter-spacing: 1px;">define</span></p><p><span style="color: rgb(217, 33, 66);font-size: 14px;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e1&nbsp;as a1.action&nbsp;= ''<br  /></span></p><p><span style="font-size: 14px;color: rgb(217, 33, 66);letter-spacing: 1px;">&nbsp; &nbsp; &nbsp; e2 as&nbsp;e2.action&nbsp;= ''&nbsp;and&nbsp;e2.location&nbsp;&lt;&gt; e1.location</span></p><p><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">3、根据上述的输入条件构建输出条件，规定使用 measures</span></p><p><span style="font-size: 14px;color: rgb(0, 82, 255);letter-spacing: 1px;">measures</span></p><p><span style="font-size: 14px;color: rgb(217, 33, 66);letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e2.action as&nbsp;event<br  /></span></p><p><span style="font-size: 14px;color: rgb(217, 33, 66);letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e1.timestamp as&nbsp;starttime<br  /></span></p><p><span style="font-size: 14px;color: rgb(217, 33, 66);letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;last(e2.timestamp) as&nbsp;endtime</span></p><p><span style="letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(0, 0, 0);">4、输出条件匹配成功，输出一条，规定写法(</span><span style="font-size: 14px;color: rgb(0, 82, 255);">这块根据不同的规则写不同的语句)</span></span></p><p><span style="font-size: 14px;color: rgb(0, 82, 255);letter-spacing: 1px;">one&nbsp;row per match</span></p><p><span style="font-size: 14px;color: rgb(0, 0, 0);letter-spacing: 1px;">5、匹配后跳转跳转到下一行（根据不同规则写不同语句）</span></p><p><span style="font-size: 14px;color: rgb(0, 82, 255);letter-spacing: 1px;">after&nbsp;match&nbsp;skip to&nbsp; next row</span></p></section></section></section><section data-mid="" mpa-from-tpl="t" style="width: 631.525px;display: flex;justify-content: flex-end;align-items: flex-end;"><img data-ratio="1.123456790123457" data-type="gif" data-w="81" class="__bg_gif" src="https://mmbiz.qpic.cn/mmbiz_gif/b6beYwicB58hl0HVHYtRMBLZVmQhMLkWUBrDeZwjA5hIS9DgspzICqhF1IONibMQ3Il0nuicMZibGbRqCqzkQ8IYvw/640?wx_fmt=gif" style="margin-top: -56.5px;margin-right: -20.5px;z-index: 3;box-sizing: border-box !important;width: 50px !important;visibility: visible !important;"  /></section></section></section></section><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="font-size: 14px;letter-spacing: 1px;">根据核心编写顺序进行理解，然后在按照书写正确的顺序进行编写。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">102、</span><span style="font-family: 微软雅黑;font-size: 14px;">Flink CDC了解吗？什么是 Flink SQL CDC Connectors？</span></span></p></blockquote></section><p data-spm-anchor-id="a2c6h.12873639.0.i0.48fc638afjR7mH" style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>在 Flink 1.11 引入了 CDC 机制</strong>，CDC 的全称是<strong><span style="color: rgb(255, 76, 65);">&nbsp;Change Data Capture</span></strong>，用于捕捉数据库表的增删改查操作，是目前非常成熟的同步数据库变更方案。</span></p><p style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">Flink CDC Connectors 是 Apache Flink 的一组源连接器，是可以从 MySQL、PostgreSQL 数据直接读取全量数据和增量数据的 Source Connectors，开源地址：<span style="color: rgb(255, 76, 65);text-decoration: underline;">https://github.com/ververica/flink-cdc-connectors</span>。</span></p><p style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">目前(1.13版本)支持的 Connectors 如下：&nbsp; &nbsp; &nbsp;&nbsp;</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.4043478260869565" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NfO96GyiaAKrgdQ5KhdvattreSl0gJob3iaX3psDQiaEwdk2bKQ0bic22F3semAr9aJB6TADgaiaguvgw/640?wx_fmt=png" data-type="png" data-w="690" height="203" style="box-sizing: border-box !important;width: 394px !important;visibility: visible !important;" width="690"  /></p><p data-spm-anchor-id="a2c6h.12873639.0.i5.48fc638afjR7mH" style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">另外<span style="color: rgb(255, 76, 65);"><strong>支持解析 Kafka 中 debezium-json 和 canal-json 格式的 Change Log</strong></span>，通过Flink 进行计算或者直接写入到其他外部数据存储系统(比如 Elasticsearch)，或者将 Changelog Json 格式的 Flink 数据写入到 Kafka:</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.3185053380782918" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NfO96GyiaAKrgdQ5Khdvatt7UAUP9LFOZBevtnkHrib675WXoQtXXLg4C1v27enUfIQJibwZBXZDPOw/640?wx_fmt=png" data-type="png" data-w="562" height="97" style="box-sizing: border-box !important;width: 384px !important;visibility: visible !important;" width="562"  /></p><p data-spm-anchor-id="a2c6h.12873639.0.i0.48fc638afjR7mH" style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;;letter-spacing: 1px;">Flink CDC Connectors 和 Flink 之间的版本映射:<br  /></span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.6895787139689579" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NfO96GyiaAKrgdQ5Khdvattnet4ESBWvyPLGA6sILqic2MriaPv1MfzZVa3KReIY3libtlibnGKlCqlng/640?wx_fmt=png" data-type="png" data-w="451" height="276" style="box-sizing: border-box !important;width: 311px !important;visibility: visible !important;" width="451"  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">103、</span><span style="font-family: 微软雅黑;font-size: 14px;">Flink CDC原理介绍一下</span></span></p></blockquote></section><p data-spm-anchor-id="a2c6h.12873639.0.i16.48fc638afjR7mH" style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">在最新CDC 调研报告中，<strong><span style="color: rgb(172, 57, 255);">Debezium</span></strong>&nbsp;和&nbsp;<strong><span style="color: rgb(172, 57, 255);">Canal&nbsp;</span></strong>是目前最流行使用的 CDC 工具，这些 CDC 工具的核心原理是抽取数据库日志获取变更。在经过一系列调研后，目前Debezium (支持全量、增量同步，同时支持 MySQL、PostgreSQL、Oracle 等数据库)，使用较为广泛。</span></p><p data-spm-anchor-id="a2c6h.12873639.0.i7.48fc638afjR7mH" style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><span style="font-weight: 600;">Flink SQL CDC 内置了&nbsp;</span><span style="font-weight: 600;color: rgb(172, 57, 255);"><strong>Debezium</strong></span><span style="font-weight: 600;">&nbsp;引擎，利用其抽取日志获取变更的能力，将 changelog 转换为 Flink SQL 认识的 RowData 数据。</span>（以下右侧是 Debezium 的数据格式，左侧是 Flink 的&nbsp;<span style="color: rgb(255, 76, 65);"><strong>RowData 数据格式</strong></span>）。</span></p><p style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-galleryid="" data-ratio="0.5778985507246377" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NfO96GyiaAKrgdQ5Khdvattbag0GN608LgNYzwiaZmxByHdic8CJ5CSPq6RGTcf4tFTyxEFJp3YC2pg/640?wx_fmt=png" data-type="png" data-w="1104" height="531" style="box-sizing: border-box !important;width: 456px !important;visibility: visible !important;" width="1104"  /></p><section style="margin-top: 10px;margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">RowData 代表了一行的数据，在 RowData 上面会有一个元数据的信息&nbsp;<span style="color: rgb(61, 167, 66);"><strong>RowKind</strong></span>，RowKind 里面包括了插入(+I)、更新前(-U)、更新后(+U)、删除(-D)，这样和数据库里面的 binlog 概念十分类似。通过 Debezium 采集的数据，包含了旧数据(before)和新数据行(after)以及原数据信息(source)，op 的 u 表示是 update 更新操作标识符（op 字段的值 c，u，d，r 分别对应 create，update，delete，reade），ts_ms 表示同步的时间戳。</span></section><section style="white-space: normal;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">104、通过CDC</span><span style="font-size: 14px;font-family: 微软雅黑;">设计一种<span style="font-size: 14px;font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;">Flink SQL 采集+计算+传输(ETL)一体化的实时数仓</span></span></span></p></blockquote></section><p data-spm-anchor-id="a2c6h.12873639.0.i16.48fc638afjR7mH" style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;">设计图如下：</span></p><p data-spm-anchor-id="a2c6h.12873639.0.i0.48fc638afjR7mH" style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><img data-ratio="0.5187110187110187" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8NfO96GyiaAKrgdQ5Khdvatt0XPC9Xiauiayt5XINktUbbkaicTSw0JAzQcHVpCtMsmXs4SNPQMiaGTRCA/640?wx_fmt=png" data-type="png" data-w="962"  /></p><p style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;line-height: 26px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong>通过 Flink CDC connectors 替换 Debezium+Kafka 的数据采集模块</strong>，<span style="color: rgb(61, 167, 66);"><strong>实现</strong></span>&nbsp;<span style="color: rgb(0, 0, 0);"><strong>Flink SQL 采集+计算+传输(ETL)一体化</strong></span>，以Mysql为Source源，Flink CDC中间件为插件，ES或者Kafka，或者其他为Sink，这样设计的优点如下：</span></p><ul class="list-paddingleft-2" style="margin-bottom: 16px;padding-left: 2em;width: 577.412px;white-space: normal;letter-spacing: 0.544px;list-style-position: initial;list-style-image: initial;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 16px;text-align: start;background-color: rgb(255, 255, 255);"><li style="list-style: inherit;font-size: 14px;line-height: 26px;color: rgb(122, 79, 214);letter-spacing: 1px;"><p><span style="letter-spacing: 1px;">开箱即用，简单易上手</span></p></li><li style="margin-top: 0.25em;list-style: inherit;font-size: 14px;line-height: 26px;color: rgb(122, 79, 214);letter-spacing: 1px;"><p><span style="letter-spacing: 1px;">减少维护的组件，简化实时链路，减轻部署成本</span></p></li><li style="margin-top: 0.25em;list-style: inherit;font-size: 14px;line-height: 26px;color: rgb(122, 79, 214);letter-spacing: 1px;"><p><span style="letter-spacing: 1px;">减小端到端延迟</span></p></li><li style="margin-top: 0.25em;list-style: inherit;font-size: 14px;line-height: 26px;color: rgb(122, 79, 214);letter-spacing: 1px;"><p><span style="letter-spacing: 1px;">Flink 自身支持 Exactly Once 的读取和计算</span></p></li><li style="margin-top: 0.25em;list-style: inherit;font-size: 14px;line-height: 26px;color: rgb(122, 79, 214);letter-spacing: 1px;"><p><span style="letter-spacing: 1px;">数据不落地，减少存储成本</span></p></li><li style="margin-top: 0.25em;list-style: inherit;font-size: 14px;line-height: 26px;color: rgb(122, 79, 214);letter-spacing: 1px;"><p><span style="letter-spacing: 1px;">支持全量和增量流式读取</span></p></li><li style="margin-top: 0.25em;list-style: inherit;font-size: 14px;line-height: 26px;color: rgb(122, 79, 214);letter-spacing: 1px;"><p><span style="letter-spacing: 1px;">binlog 采集位点可回溯</span></p></li></ul><section style="white-space: normal;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="font-size: 14px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 1px;">105、Flink SQL CDC如何实现一致性保障（源码分析）</span></p></blockquote></section><section style="margin-bottom: 16px;white-space: normal;letter-spacing: 0.544px;font-size: 14px;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;text-align: start;background-color: rgb(255, 255, 255);line-height: 1.75em;"><span style="letter-spacing: 1px;">Flink SQL CDC 用于获取数据库变更日志的 Source 函数是&nbsp;<span style="color: rgb(255, 76, 65);"><strong>DebeziumSourceFunction</strong></span>，且最终返回的类型是<span style="color: rgb(0, 82, 255);"><strong>&nbsp;RowData</strong></span>，该函数实现了 CheckpointedFunction，即通过 Checkpoint 机制来保证发生 failure 时不会丢数，实现 exactly once 语义，这部分在函数的注释中有明确的解释。</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="java"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">/**</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * The {@link DebeziumSourceFunction} is a streaming data source that pulls captured change data</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * from databases into Flink.</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * 通过Checkpoint机制来保证发生failure时不会丢数，实现exactly once语义</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * &lt;p&gt;The source function participates in checkpointing and guarantees that no data is lost</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * during a failure, and that the computation processes elements "exactly once".</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * 注意：这个Source Function不能同时运行多个实例</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * &lt;p&gt;Note: currently, the source function can't run in multiple parallel instances.</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> *</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * &lt;p&gt;Please refer to Debezium's documentation for the available configuration properties:</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * https://debezium.io/documentation/reference/1.2/development/engine.html#engine-properties&lt;/p&gt;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> */</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">@PublicEvolving</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public class DebeziumSourceFunction&lt;T&gt; extends RichSourceFunction&lt;T&gt; implements</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">CheckpointedFunction,</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">ResultTypeQueryable&lt;T&gt; {}</span></span></code></pre></section><p style="white-space: normal;"><span style="color: rgb(36, 41, 46);text-align: start;background-color: rgb(255, 255, 255);font-size: 16px;font-family: 等线;font-weight: bold;letter-spacing: 1px;">为实现 CheckpointedFunction，需要实现以下两个方法：</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="java"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">public interface CheckpointedFunction {</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//做快照，把内存中的数据保存在checkpoint状态中</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">void snapshotState(FunctionSnapshotContext var1) throws Exception;</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">//程序异常恢复后从checkpoint状态中恢复数据</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">void initializeState(FunctionInitializationContext var1) throws Exception;</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">}</span></span></code></pre></section><p style="white-space: normal;"><span style="font-weight: bold;color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">接下来我们看看 DebeziumSourceFunction 中都记录了哪些状态。</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="java"><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">/** Accessor for state in the operator state backend. </span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">    offsetState中记录了读取的binlog文件和位移信息等，对应Debezium中的</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">*/</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">private transient ListState&lt;byte[]&gt; offsetState;</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">/**</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * State to store the history records, i.e. schema changes.</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * historyRecordsState记录了schema的变化等信息</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;"> * @see FlinkDatabaseHistory</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">*/</span></span></code><code><span class="code-snippet_outer"><span style="letter-spacing: 1px;">private transient ListState&lt;String&gt; historyRecordsState;</span></span></code></pre></section><p style="white-space: normal;"><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">我们发现在 Flink SQL CDC 是一个相对简易的场景，没有中间算子，是通过 Checkpoint 持久化 binglog 消费位移和 schema 变化信息的快照，来实现 Exactly Once。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">106、</span><span style="font-family: 微软雅黑;font-size: 14px;">Flink SQL GateWay了解吗？</span></span></p></blockquote></section><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="font-size: 15px;color: rgb(255, 76, 65);">Flink SQL GateWay的概念：</span></strong></span></p><p style="white-space: normal;"><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">FlinkSql Gateway是Flink集群的“任务网关”，支持以restapi 的形式提交查询、插入、删除等任务，如下图所示：</span></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.4" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjmpI1qnxL4iayd6g9iaBXX3dmhng2uqskrKoDbMn8Px7mKGGjUAxod3AQ/640?wx_fmt=png" data-type="png" data-w="840"  /></p><p style="white-space: normal;"><br  /></p><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">总体架构如下图所示：</span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.37180616740088107" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmjM1MicFzkISOv29QTzQEMNfUbVe2iaibjUZEoUCGNxLibibN0mNnIX92Uia6Q/640?wx_fmt=png" data-type="png" data-w="1135"  /></p><p style="white-space: normal;"><br  /></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">107、</span><span style="font-family: 微软雅黑;font-size: 14px;">Flink SQL GateWay创建会话讲解一下？</span></span></p></blockquote></section><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><span style="letter-spacing: 1px;"><strong><span style="font-size: 15px;color: rgb(255, 76, 65);">创建会话流程图如下：<br  /></span></strong></span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.27904328018223234" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nEEdkvXCJ8OEm0ibzDF4SWzGQtlzIYVmj6UGxaUCOqQzxoyJCUuzS9K7B5xaxr2CricnAqHmibVuGbu9v07G8QwAw/640?wx_fmt=png" data-type="png" data-w="878"  /></p><p style="margin-top: 5px;margin-bottom: 5px;white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><br  /></p><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);">（1）传入参数包含name名称、planner执行引擎（Blink或原生的flink）、executetype（streaming或者batch）、</span><span style="background-color: rgb(255, 255, 255);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;">properties（配置参数，如并发度等）；</span></span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">（2）在SessionMnager中，会根据这些参数创建对应的SessionContext；</span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);">&nbsp;</span><span style="background-color: rgb(255, 255, 255);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;">&nbsp;SessionContext sessionContext= new SessionContext(sessionName, sessionId, sessionEnv, defaultContext);</span></span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">（3）将创建Session放入Map集合中，最后返回对应的SessionId，方便后续使用。</span></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;background-color: rgb(255, 255, 255);letter-spacing: 1px;">&nbsp;&nbsp; sessions.put(sessionId,session); return sessionId;</span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">108、</span><span style="font-family: 微软雅黑;font-size: 14px;">Flink SQL GateWay如何处理并发请求？多个提交怎么处理？&nbsp;</span></span></p></blockquote></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="background-color: rgb(255, 255, 255);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql gateway内部维护SessionManager，里面通过Map维护了各个Session，每个Session的任务执行是独立的。同一个Session通过ExecuteContext内部的tEnv按顺序提交。</span></p><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">109、</span><span style="font-family: 微软雅黑;font-size: 14px;">如何维护多个SQL之间的关联性？&nbsp;</span></span></p></blockquote></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在每个Session中单独维护了tEnv，同一个session中的操作其实是在一个env中执行的。因此只要是同一个session中的任务，内部使用的tEnv就是同一个。这样就可以实现在Asession中，先创建一个view，然后执行一个select，最后执行一个insert。</span></section><section style="white-space: normal;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;"><blockquote style="padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(100, 149, 237);color: rgb(0, 0, 0);line-height: inherit;font-size: 0.9em;overflow-wrap: normal;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 2px;word-spacing: 2px;background: rgb(227, 242, 253);overflow: auto;word-break: normal;"><p style="text-align: left;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">110、</span><span style="font-family: 微软雅黑;font-size: 14px;">sql字符串如何提交到集群成为代码？</span></span></p></blockquote></section><section style="margin-top: 10px;margin-bottom: 10px;white-space: normal;line-height: 1.75em;"><span style="background-color: rgb(255, 255, 255);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;letter-spacing: 1px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="background-color: rgb(255, 255, 255);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;letter-spacing: 1px;color: rgb(217, 33, 66);"> <strong>Session</strong></span><span style="background-color: rgb(255, 255, 255);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;letter-spacing: 1px;">中维护了tenv，sql会通过tenv编译生成</span><strong><span style="background-color: rgb(255, 255, 255);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;letter-spacing: 1px;color: rgb(217, 33, 66);">pipeline</span></strong><span style="background-color: rgb(255, 255, 255);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;letter-spacing: 1px;">（即DAG图），在batch模式下是Plan执行计划；在stream模式下是</span><span style="background-color: rgb(255, 255, 255);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong>StreamGraph</strong></span><span style="background-color: rgb(255, 255, 255);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;letter-spacing: 1px;">。然后Session内部会创建一个ProgramDeployer代码发布器，根据Flink中配置的target创建不同的excutor。最后调用executor.execute方法提交Pipeline和config执行。</span></section><p style="margin-top: 10px;margin-bottom: 10px;white-space: normal;"><span style="background-color: rgb(255, 255, 255);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;letter-spacing: 1px;color: rgb(217, 33, 66);"><strong style="outline: 0px;letter-spacing: 0.544px;white-space: normal;font-size: 14px;color: rgb(255, 0, 0);font-family: system, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Segoe UI&quot;, &quot;Microsoft YaHei&quot;, &quot;wenquanyi micro hei&quot;, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, Roboto, Oxygen, Ubuntu, Cantarell, &quot;Fira Sans&quot;, &quot;Droid Sans&quot;, Arial, sans-serif;text-align: start;"><span style="letter-spacing: 1px;color: rgb(217, 33, 66);background-color: rgb(255, 255, 255);font-size: 14px;outline: 0px;text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">以上就是Flink 的全部内容，160张图全部亲自绘制出来</span></strong><strong style="outline: 0px;letter-spacing: 0.544px;white-space: normal;font-size: 14px;color: rgb(255, 0, 0);font-family: system, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Segoe UI&quot;, &quot;Microsoft YaHei&quot;, &quot;wenquanyi micro hei&quot;, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, Roboto, Oxygen, Ubuntu, Cantarell, &quot;Fira Sans&quot;, &quot;Droid Sans&quot;, Arial, sans-serif;text-align: start;"><span style="letter-spacing: 1px;color: rgb(217, 33, 66);background-color: rgb(255, 255, 255);font-size: 14px;outline: 0px;text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">！不想被白嫖呀，觉得好的，点赞，在看，分享三连击，谢谢！！！</span></strong></span></p><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="padding-right: 10px;padding-left: 10px;outline: 0px;white-space: normal;background-color: rgb(255, 255, 255);word-break: break-word;text-align: left;font-size: 15px;color: rgb(62, 62, 62);line-height: 1.8;word-spacing: 2px;letter-spacing: 2px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><section data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="padding-right: 10px;padding-left: 10px;outline: 0px;word-break: break-word;line-height: 1.8;"><h4 data-tool="mdnice编辑器" style="margin-top: 30px;margin-bottom: 15px;outline: 0px;font-weight: bold;font-size: 18px;color: black;"><span style="letter-spacing: 1px;">最后</span></h4><p data-tool="mdnice编辑器" style="padding-top: 1em;padding-bottom: 8px;outline: 0px;font-size: 16px;color: rgb(74, 74, 74);line-height: 1.75em;"><span style="letter-spacing: 1px;"><span style="font-size: 14px;">第一时间获取最新大数据技术，尽在本公众号：</span><span style="background-color: rgb(255, 255, 255);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;text-align: start;color: rgb(255, 76, 0);"><strong style="outline: 0px;letter-spacing: 0.544px;white-space: normal;font-size: 14px;color: rgb(255, 0, 0);font-family: system, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Segoe UI&quot;, &quot;Microsoft YaHei&quot;, &quot;wenquanyi micro hei&quot;, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, Roboto, Oxygen, Ubuntu, Cantarell, &quot;Fira Sans&quot;, &quot;Droid Sans&quot;, Arial, sans-serif;text-align: start;"><span style="color: rgb(255, 76, 0);background-color: rgb(255, 255, 255);font-size: 14px;outline: 0px;text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">3分钟秒懂大数据</span></strong></span></span></p></section></section><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="outline: 0px;font-size: 12px;letter-spacing: 1px;"><strong style="outline: 0px;"><span style="font-size: 12px;outline: 0px;color: rgb(74, 74, 74);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: left;word-spacing: 2px;">--END--</span></strong></span></p><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="outline: 0px;color: rgb(74, 74, 74);font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: left;word-spacing: 2px;font-size: 15px;letter-spacing: 1px;"><img data-backh="2" data-backw="578" data-ratio="0.0030211480362537764" src="https://mmbiz.qpic.cn/mmbiz/cZV2hRpuAPia3RFX6Mvw06kePJ7HbmI7b35o17yNJx4WHYPSQj280IElEicRPq2CviaJe8fjL2AeadmIjARqVZWnw/640?wx_fmt=jpeg" data-type="jpeg" data-w="662" style="padding-top: 10px;padding-bottom: 10px;outline: 0px;box-sizing: border-box;color: rgb(62, 62, 62);visibility: visible !important;width: 578px !important;"></span></p><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="letter-spacing: 1px;"><span style="background-color: rgb(255, 255, 255);color: rgb(36, 41, 46);font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif;font-size: 14px;letter-spacing: 1px;text-align: start;"><strong style="outline: 0px;letter-spacing: 0.544px;white-space: normal;font-size: 14px;color: rgb(255, 0, 0);font-family: system, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, Helvetica, &quot;PingFang SC&quot;, &quot;Segoe UI&quot;, &quot;Microsoft YaHei&quot;, &quot;wenquanyi micro hei&quot;, &quot;Hiragino Sans GB&quot;, &quot;Hiragino Sans GB W3&quot;, Roboto, Oxygen, Ubuntu, Cantarell, &quot;Fira Sans&quot;, &quot;Droid Sans&quot;, Arial, sans-serif;text-align: start;"><span style="background-color: rgb(255, 255, 255);color: rgb(36, 41, 46);outline: 0px;text-align: center;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">获取本文PDF版，请扫下方二维码&nbsp;</span></strong></span><span style="letter-spacing: 1px;outline: 0px;font-size: 14px;"><strong style="outline: 0px;"><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;outline: 0px;word-spacing: 2px;color: rgb(255, 0, 0);">加我微信，</span></strong><span style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;outline: 0px;word-spacing: 2px;color: rgb(255, 0, 0);">备注：Flink</span></span><span style="outline: 0px;font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 15px;letter-spacing: 2px;word-spacing: 2px;color: rgb(255, 0, 0);"><strong style="outline: 0px;">&nbsp;</strong></span></span></p><p style="outline: 0px;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages" data-cropselx1="0" data-cropselx2="140" data-cropsely1="0" data-cropsely2="129" data-galleryid="" data-ratio="1.0294117647058822" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/nEEdkvXCJ8PGSOFRwzQZOUoqVvE14Pu8WBqaN0jd5HYjgMtEEiaE0G191W7eQJKWDFgIricIVCIPUeH1hR6JyySQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="884" style="outline: 0px;box-sizing: border-box !important;visibility: visible !important;width: 140px;height: 144px;"  /></p></section></content>
</div>
</body>
</html>